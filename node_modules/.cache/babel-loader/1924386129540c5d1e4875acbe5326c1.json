{"ast":null,"code":"import { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { setStyleAttribute, closest as getClosest, remove, isBlazor } from '@syncfusion/ej2-base';\nimport { classList } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { RowRenderer } from './row-renderer';\nimport { Cell } from '../models/cell';\nimport { Row } from '../models/row';\nimport * as events from '../base/constant';\nimport { Draggable, Droppable } from '@syncfusion/ej2-base';\nimport { parentsUntil, wrap, measureColumnDepth, appendChildren } from '../base/util';\n/**\n * Content module is used to render grid content\n * @hidden\n */\n\nvar HeaderRender =\n/** @class */\nfunction () {\n  /**\n   * Constructor for header renderer module\n   */\n  function HeaderRender(parent, serviceLocator) {\n    var _this = this;\n\n    this.frzIdx = 0;\n    this.notfrzIdx = 0;\n\n    this.helper = function (e) {\n      var gObj = _this.parent;\n      var target = e.sender.target;\n      var parentEle = parentsUntil(target, 'e-headercell');\n\n      if (!(gObj.allowReordering || gObj.allowGrouping) || !isNullOrUndefined(parentEle) && parentEle.querySelectorAll('.e-checkselectall').length > 0) {\n        return false;\n      }\n\n      var visualElement = _this.parent.createElement('div', {\n        className: 'e-cloneproperties e-dragclone e-headerclone'\n      });\n\n      var element = target.classList.contains('e-headercell') ? target : parentEle;\n\n      if (!element || !gObj.allowReordering && element.classList.contains('e-stackedheadercell')) {\n        return false;\n      }\n\n      var height = element.offsetHeight;\n      var headercelldiv = element.querySelector('.e-headercelldiv') || element.querySelector('.e-stackedheadercelldiv');\n      var col;\n\n      if (headercelldiv) {\n        if (element.querySelector('.e-stackedheadercelldiv')) {\n          col = gObj.getStackedHeaderColumnByHeaderText(headercelldiv.innerText.trim(), gObj.columns);\n        } else {\n          col = gObj.getColumnByUid(headercelldiv.getAttribute('e-mappinguid'));\n        }\n\n        _this.column = col;\n\n        if (_this.column.lockColumn) {\n          return false;\n        }\n\n        visualElement.setAttribute('e-mappinguid', _this.column.uid);\n      }\n\n      if (col && !isNullOrUndefined(col.headerTemplate)) {\n        if (!isNullOrUndefined(col.headerTemplate)) {\n          var result = void 0;\n          var colIndex = gObj.getColumnIndexByField(col.field);\n          result = col.getHeaderTemplate()(extend({\n            'index': colIndex\n          }, col), gObj, 'headerTemplate');\n          appendChildren(visualElement, result);\n        } else {\n          visualElement.innerHTML = col.headerTemplate;\n        }\n      } else {\n        visualElement.innerHTML = headercelldiv ? col.headerText : element.firstElementChild.innerHTML;\n      }\n\n      visualElement.style.width = element.offsetWidth + 'px';\n      visualElement.style.height = element.offsetHeight + 'px';\n      visualElement.style.lineHeight = (height - 6).toString() + 'px';\n      gObj.element.appendChild(visualElement);\n      return visualElement;\n    };\n\n    this.dragStart = function (e) {\n      var gObj = _this.parent;\n      gObj.element.querySelector('.e-gridpopup').style.display = 'none';\n      gObj.notify(events.columnDragStart, {\n        target: e.target,\n        column: _this.column,\n        event: e.event\n      });\n\n      if (isBlazor()) {\n        e.bindEvents(e.dragElement);\n      }\n    };\n\n    this.drag = function (e) {\n      var gObj = _this.parent;\n      var target = e.target;\n\n      if (target) {\n        var closest = getClosest(target, '.e-grid');\n\n        var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n\n        if (!closest || closest.getAttribute('id') !== gObj.element.getAttribute('id')) {\n          classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n\n          if (gObj.allowReordering) {\n            gObj.element.querySelector('.e-reorderuparrow').style.display = 'none';\n            gObj.element.querySelector('.e-reorderdownarrow').style.display = 'none';\n          }\n\n          return;\n        }\n\n        gObj.notify(events.columnDrag, {\n          target: e.target,\n          column: _this.column,\n          event: e.event\n        });\n      }\n    };\n\n    this.dragStop = function (e) {\n      var gObj = _this.parent;\n      var cancel;\n      gObj.element.querySelector('.e-gridpopup').style.display = 'none';\n\n      if (!parentsUntil(e.target, 'e-headercell') && !parentsUntil(e.target, 'e-groupdroparea') || !gObj.allowReordering && parentsUntil(e.target, 'e-headercell') || !e.helper.getAttribute('e-mappinguid') && parentsUntil(e.target, 'e-groupdroparea')) {\n        remove(e.helper);\n        cancel = true;\n      }\n\n      gObj.notify(events.columnDragStop, {\n        target: e.target,\n        event: e.event,\n        column: _this.column,\n        cancel: cancel\n      });\n    };\n\n    this.drop = function (e) {\n      var gObj = _this.parent;\n      var uid = e.droppedElement.getAttribute('e-mappinguid');\n      var closest = getClosest(e.target, '.e-grid');\n      remove(e.droppedElement);\n\n      if (closest && closest.getAttribute('id') !== gObj.element.getAttribute('id') || !(gObj.allowReordering || gObj.allowGrouping)) {\n        return;\n      }\n\n      gObj.notify(events.headerDrop, {\n        target: e.target,\n        uid: uid\n      });\n    };\n\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.ariaService = this.serviceLocator.getService('ariaService');\n    this.widthService = this.serviceLocator.getService('widthService');\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    if (!this.parent.enableColumnVirtualization) {\n      this.parent.on(events.columnVisibilityChanged, this.setVisible, this);\n    }\n\n    this.parent.on(events.columnPositionChanged, this.colPosRefresh, this);\n  }\n  /**\n   * The function is used to render grid header div\n   */\n\n\n  HeaderRender.prototype.renderPanel = function () {\n    var div = this.parent.element.querySelector('.e-gridheader');\n    var isRendered = div != null;\n    div = isRendered ? div : this.parent.createElement('div', {\n      className: 'e-gridheader'\n    });\n    var innerDiv = isRendered ? div.querySelector('.e-headercontent') : this.parent.createElement('div', {\n      className: 'e-headercontent'\n    });\n    this.toggleStackClass(div);\n    div.appendChild(innerDiv);\n    this.setPanel(div);\n\n    if (!isRendered) {\n      this.parent.element.appendChild(div);\n    }\n  };\n  /**\n   * The function is used to render grid header table\n   */\n\n\n  HeaderRender.prototype.renderTable = function () {\n    var headerDiv = this.getPanel();\n    headerDiv.appendChild(this.createHeaderTable());\n    this.setTable(headerDiv.querySelector('.e-table'));\n\n    if (!this.parent.getFrozenColumns()) {\n      this.initializeHeaderDrag();\n      this.initializeHeaderDrop();\n    }\n\n    this.parent.notify(events.headerRefreshed, {\n      rows: this.rows,\n      args: {\n        isFrozen: this.parent.getFrozenColumns() !== 0\n      }\n    });\n  };\n  /**\n   * Get the header content div element of grid\n   * @return {Element}\n   */\n\n\n  HeaderRender.prototype.getPanel = function () {\n    return this.headerPanel;\n  };\n  /**\n   * Set the header content div element of grid\n   * @param  {Element} panel\n   */\n\n\n  HeaderRender.prototype.setPanel = function (panel) {\n    this.headerPanel = panel;\n  };\n  /**\n   * Get the header table element of grid\n   * @return {Element}\n   */\n\n\n  HeaderRender.prototype.getTable = function () {\n    return this.headerTable;\n  };\n  /**\n   * Set the header table element of grid\n   * @param  {Element} table\n   */\n\n\n  HeaderRender.prototype.setTable = function (table) {\n    this.headerTable = table;\n  };\n  /**\n   * Get the header colgroup element\n   * @returns {Element}\n   */\n\n\n  HeaderRender.prototype.getColGroup = function () {\n    return this.colgroup;\n  };\n  /**\n   * Set the header colgroup element\n   * @param {Element} colgroup\n   * @returns {Element}\n   */\n\n\n  HeaderRender.prototype.setColGroup = function (colGroup) {\n    return this.colgroup = colGroup;\n  };\n  /**\n   * Get the header row element collection.\n   * @return {Element[]}\n   */\n\n\n  HeaderRender.prototype.getRows = function () {\n    var table = this.getTable();\n    return table.tHead.rows;\n  };\n  /**\n   * The function is used to create header table elements\n   * @return {Element}\n   * @hidden\n   */\n\n\n  HeaderRender.prototype.createHeaderTable = function () {\n    var skipDom = isBlazor() && this.parent.frozenRows !== 0;\n    var table = this.createTable();\n    var innerDiv = this.getPanel().querySelector('.e-headercontent');\n\n    if (!skipDom) {\n      innerDiv.appendChild(table);\n    }\n\n    return innerDiv;\n  };\n  /**\n   * @hidden\n   */\n\n\n  HeaderRender.prototype.createTable = function (tableEle) {\n    if (tableEle === void 0) {\n      tableEle = null;\n    }\n\n    var skipDom = isBlazor() && this.parent.frozenRows !== 0;\n    var gObj = this.parent;\n\n    if (!(isBlazor() && !gObj.isJsComponent) && this.getTable() && !gObj.getFrozenColumns()) {\n      remove(this.getTable());\n    }\n\n    var columns = gObj.getColumns();\n    var innerDiv = this.getPanel().querySelector('.e-headercontent');\n    var table = skipDom ? tableEle || innerDiv.querySelector('.e-table') : this.parent.createElement('table', {\n      className: 'e-table',\n      attrs: {\n        cellspacing: '0.25px',\n        role: 'grid'\n      }\n    });\n    var findHeaderRow = this.createHeaderContent();\n    var thead = findHeaderRow.thead;\n    var tbody = this.parent.createElement('tbody', {\n      className: this.parent.frozenRows ? '' : 'e-hide'\n    });\n    this.caption = this.parent.createElement('caption', {\n      innerHTML: this.parent.element.id + '_header_table',\n      className: 'e-hide'\n    });\n    var colGroup = this.parent.createElement('colgroup');\n    var rowBody = this.parent.createElement('tr');\n    var bodyCell;\n    var rows = this.rows = findHeaderRow.rows;\n    var rowRenderer = new RowRenderer(this.serviceLocator, CellType.Header, this.parent);\n\n    for (var i = 0, len = rows.length; i < len; i++) {\n      for (var j = 0, len_1 = rows[i].cells.length; j < len_1; j++) {\n        var cell = rows[i].cells[j];\n        bodyCell = this.parent.createElement('td');\n        rowBody.appendChild(bodyCell);\n      }\n    }\n\n    if (gObj.allowFiltering || gObj.allowSorting || gObj.allowGrouping) {\n      table.classList.add('e-sortfilter');\n    }\n\n    this.updateColGroup(colGroup);\n\n    if (!skipDom) {\n      tbody.appendChild(rowBody);\n    }\n\n    table.appendChild(this.setColGroup(colGroup));\n    table.appendChild(thead);\n\n    if (!skipDom) {\n      table.appendChild(tbody);\n    }\n\n    table.appendChild(this.caption);\n    this.ariaService.setOptions(table, {\n      colcount: gObj.getColumns().length.toString()\n    });\n    return table;\n  };\n\n  HeaderRender.prototype.createHeaderContent = function () {\n    var gObj = this.parent;\n    var columns = gObj.getColumns();\n    var thead = this.parent.createElement('thead');\n    var colHeader = this.parent.createElement('tr', {\n      className: 'e-columnheader'\n    });\n    var rowRenderer = new RowRenderer(this.serviceLocator, CellType.Header, gObj);\n    rowRenderer.element = colHeader;\n    var rows = [];\n    var headerRow;\n    this.colDepth = measureColumnDepth(gObj.columns);\n\n    for (var i = 0, len = this.colDepth; i < len; i++) {\n      rows[i] = this.generateRow(i);\n      rows[i].cells = [];\n    }\n\n    rows = this.ensureColumns(rows);\n    rows = this.getHeaderCells(rows);\n\n    for (var i = 0, len = this.colDepth; i < len; i++) {\n      headerRow = rowRenderer.render(rows[i], columns);\n\n      if (this.parent.rowHeight && headerRow.querySelector('.e-headercell')) {\n        headerRow.style.height = this.parent.rowHeight + 'px';\n      }\n\n      thead.appendChild(headerRow);\n    }\n\n    var findHeaderRow = {\n      thead: thead,\n      rows: rows\n    };\n    return findHeaderRow;\n  };\n\n  HeaderRender.prototype.updateColGroup = function (colGroup) {\n    var cols = this.parent.getColumns();\n    var col;\n    var indexes = this.parent.getColumnIndexesInView();\n    colGroup.id = this.parent.element.id + 'colGroup';\n\n    if (this.parent.allowGrouping) {\n      for (var i = 0, len = this.parent.groupSettings.columns.length; i < len; i++) {\n        if (this.parent.enableColumnVirtualization && indexes.indexOf(i) === -1) {\n          continue;\n        }\n\n        col = this.parent.createElement('col', {\n          className: 'e-group-intent'\n        });\n        colGroup.appendChild(col);\n      }\n    }\n\n    if (this.parent.detailTemplate || this.parent.childGrid) {\n      col = this.parent.createElement('col', {\n        className: 'e-detail-intent'\n      });\n      colGroup.appendChild(col);\n    }\n\n    if (this.parent.isRowDragable()) {\n      col = this.parent.createElement('col', {\n        className: 'e-drag-intent'\n      });\n      colGroup.appendChild(col);\n    }\n\n    for (var i = 0, len = cols.length; i < len; i++) {\n      col = this.parent.createElement('col');\n\n      if (cols[i].visible === false) {\n        setStyleAttribute(col, {\n          'display': 'none'\n        });\n      }\n\n      colGroup.appendChild(col);\n    }\n\n    return colGroup;\n  };\n\n  HeaderRender.prototype.ensureColumns = function (rows) {\n    //TODO: generate dummy column for group, detail, stacked row here; ensureColumns here\n    var gObj = this.parent;\n    var indexes = this.parent.getColumnIndexesInView();\n\n    for (var i = 0, len = rows.length; i < len; i++) {\n      if (gObj.allowGrouping) {\n        for (var c = 0, len_2 = gObj.groupSettings.columns.length; c < len_2; c++) {\n          if (this.parent.enableColumnVirtualization && indexes.indexOf(c) === -1) {\n            continue;\n          }\n\n          rows[i].cells.push(this.generateCell({}, CellType.HeaderIndent));\n        }\n      }\n\n      if (gObj.detailTemplate || gObj.childGrid) {\n        var args = {};\n        this.parent.notify(events.detailIndentCellInfo, args);\n        rows[i].cells.push(this.generateCell(args, CellType.DetailHeader));\n      }\n\n      if (gObj.isRowDragable()) {\n        rows[i].cells.push(this.generateCell({}, CellType.RowDragHIcon));\n      }\n    }\n\n    return rows;\n  };\n\n  HeaderRender.prototype.getHeaderCells = function (rows) {\n    var column;\n    var thead = this.parent.getHeaderTable() && this.parent.getHeaderTable().querySelector('thead');\n    var cols = this.parent.enableColumnVirtualization ? this.parent.getColumns(this.parent.enablePersistence) : this.parent.columns;\n    this.frzIdx = 0;\n    this.notfrzIdx = 0;\n\n    if (this.parent.lockcolPositionCount) {\n      for (var i = 0; i < cols.length; i++) {\n        this.lockColsRendered = false;\n        rows = this.appendCells(cols[i], rows, 0, i === 0, false, i === cols.length - 1, thead);\n      }\n    }\n\n    for (var i = 0, len = cols.length; i < len; i++) {\n      this.notfrzIdx = 0;\n      this.lockColsRendered = true;\n      rows = this.appendCells(cols[i], rows, 0, i === 0, false, i === len - 1, thead);\n    }\n\n    return rows;\n  };\n\n  HeaderRender.prototype.appendCells = function (cols, rows, index, isFirstObj, isFirstCol, isLastCol, isMovable) {\n    var lastCol = isLastCol ? 'e-lastcell' : '';\n    var frzCols = this.parent.getFrozenColumns();\n    var left;\n\n    if (this.parent.enableColumnVirtualization && frzCols) {\n      left = this.parent.getContent().querySelector('.e-movablecontent').scrollLeft;\n    }\n\n    if (!cols.columns) {\n      if (left && left > 0 && this.parent.enableColumnVirtualization && this.parent.inViewIndexes[0] !== 0) {\n        rows[index].cells.push(this.generateCell(cols, CellType.Header, this.colDepth - index, (isFirstObj ? '' : isFirstCol ? 'e-firstcell' : '') + lastCol, index, this.parent.getColumnIndexByUid(cols.uid)));\n      } else {\n        if (!frzCols && (!this.parent.lockcolPositionCount || cols.lockColumn && !this.lockColsRendered || !cols.lockColumn && this.lockColsRendered) || frzCols && (!isMovable && (this.frzIdx + this.notfrzIdx < this.parent.frozenColumns || cols.isFrozen) && (!this.parent.lockcolPositionCount || cols.lockColumn && !this.lockColsRendered || !cols.lockColumn && this.lockColsRendered) || isMovable && this.frzIdx + this.notfrzIdx >= this.parent.frozenColumns && !cols.isFrozen && (!this.parent.lockcolPositionCount || cols.lockColumn && !this.lockColsRendered || !cols.lockColumn && this.lockColsRendered))) {\n          rows[index].cells.push(this.generateCell(cols, CellType.Header, this.colDepth - index, (isFirstObj ? '' : isFirstCol ? 'e-firstcell' : '') + lastCol, index, this.parent.getColumnIndexByUid(cols.uid)));\n        }\n      }\n\n      if (this.parent.lockcolPositionCount) {\n        if (this.frzIdx + this.notfrzIdx < this.parent.frozenColumns && (cols.lockColumn && !this.lockColsRendered || !cols.lockColumn && this.lockColsRendered)) {\n          this.frzIdx++;\n        } else {\n          this.notfrzIdx++;\n        }\n      } else {\n        this.frzIdx++;\n      }\n    } else {\n      var colSpan = this.getCellCnt(cols, 0);\n\n      if (colSpan) {\n        var frzObj = this.refreshFrozenHdr(cols.columns, {\n          isPartial: false,\n          isComp: true,\n          cnt: 0\n        });\n        var stackedLockColsCount = this.getStackedLockColsCount(cols, 0);\n\n        if (!frzCols && (!this.parent.lockcolPositionCount || !this.lockColsRendered && stackedLockColsCount || this.lockColsRendered && colSpan - stackedLockColsCount) || frzCols && (!isMovable && (this.parent.frozenColumns - this.frzIdx > 0 || frzObj.isPartial) || isMovable && colSpan + this.frzIdx > this.parent.frozenColumns && !frzObj.isComp)) {\n          rows[index].cells.push(new Cell({\n            cellType: CellType.StackedHeader,\n            column: cols,\n            colSpan: this.getColSpan(colSpan, isMovable, frzObj.cnt, stackedLockColsCount)\n          }));\n        }\n      }\n\n      if (this.parent.lockcolPositionCount && !this.lockColsRendered) {\n        for (var i = 0; i < cols.columns.length; i++) {\n          rows = this.appendCells(cols.columns[i], rows, index + 1, isFirstObj, i === 0, i === cols.columns.length - 1 && isLastCol, isMovable);\n        }\n      }\n\n      if (this.lockColsRendered) {\n        for (var i = 0, len = cols.columns.length; i < len; i++) {\n          rows = this.appendCells(cols.columns[i], rows, index + 1, isFirstObj, i === 0, i === len - 1 && isLastCol, isMovable);\n        }\n      }\n    }\n\n    return rows;\n  };\n\n  HeaderRender.prototype.getStackedLockColsCount = function (col, lockColsCount) {\n    if (col.columns) {\n      for (var i = 0; i < col.columns.length; i++) {\n        lockColsCount = this.getStackedLockColsCount(col.columns[i], lockColsCount);\n      }\n    } else if (col.lockColumn) {\n      lockColsCount++;\n    }\n\n    return lockColsCount;\n  };\n\n  HeaderRender.prototype.refreshFrozenHdr = function (cols, frzObj) {\n    for (var i = 0; i < cols.length; i++) {\n      if (cols[i].columns) {\n        frzObj = this.refreshFrozenHdr(cols[i].columns, frzObj);\n      } else {\n        if (cols[i].isFrozen) {\n          frzObj.isPartial = true;\n          frzObj.cnt++;\n        }\n\n        frzObj.isComp = frzObj.isComp && (cols[i].isFrozen || this.parent.getColumnIndexByField(cols[i].field) < this.parent.frozenColumns);\n      }\n    }\n\n    return frzObj;\n  };\n\n  HeaderRender.prototype.getColSpan = function (colSpan, isMovable, frozenCnt, stackedLockColsCount) {\n    var frzCol = this.parent.frozenColumns;\n\n    if (this.parent.getFrozenColumns() && this.frzIdx + colSpan > frzCol) {\n      if (isMovable) {\n        colSpan = colSpan - (frzCol > this.frzIdx ? frzCol - this.frzIdx : 0) - frozenCnt;\n      } else {\n        colSpan = colSpan - (colSpan - (frzCol > this.frzIdx ? frzCol + frozenCnt - this.frzIdx : frozenCnt));\n      }\n    } else if (this.parent.lockcolPositionCount) {\n      colSpan = !this.lockColsRendered ? stackedLockColsCount : colSpan - stackedLockColsCount;\n    }\n\n    return colSpan;\n  };\n\n  HeaderRender.prototype.generateRow = function (index) {\n    return new Row({});\n  };\n\n  HeaderRender.prototype.generateCell = function (column, cellType, rowSpan, className, rowIndex, colIndex) {\n    var opt = {\n      'visible': column.visible,\n      'isDataCell': false,\n      'isTemplate': !isNullOrUndefined(column.headerTemplate),\n      'rowID': '',\n      'column': column,\n      'cellType': cellType,\n      'rowSpan': rowSpan,\n      'className': className,\n      'index': rowIndex,\n      'colIndex': colIndex\n    };\n\n    if (!opt.rowSpan || opt.rowSpan < 2) {\n      delete opt.rowSpan;\n    }\n\n    return new Cell(opt);\n  };\n  /**\n   * Function to hide header table column based on visible property\n   * @param  {Column[]} columns?\n   */\n\n\n  HeaderRender.prototype.setVisible = function (columns) {\n    var gObj = this.parent;\n    var rows = [].slice.call(this.getRows()); //NodeList -> Array        \n\n    var displayVal;\n    var idx;\n    var className;\n    var element;\n    var frzCols = gObj.getFrozenColumns();\n\n    for (var c = 0, clen = columns.length; c < clen; c++) {\n      var column = columns[c];\n      idx = gObj.getNormalizedColumnIndex(column.uid);\n      displayVal = column.visible ? '' : 'none';\n\n      if (frzCols) {\n        if (idx < frzCols) {\n          if (isBlazor() && gObj.isServerRendered) {\n            setStyleAttribute(this.getTable().querySelector('colgroup').children[idx], {\n              'display': displayVal\n            });\n            setStyleAttribute(this.getTable().querySelectorAll('th')[idx], {\n              'display': displayVal\n            });\n          } else {\n            setStyleAttribute(this.getColGroup().children[idx], {\n              'display': displayVal\n            });\n          }\n        } else {\n          var mTblColGrp = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('colgroup');\n          var mTbl = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('table');\n          setStyleAttribute(mTblColGrp.children[idx - frzCols], {\n            'display': displayVal\n          });\n\n          if (isBlazor() && gObj.isServerRendered) {\n            setStyleAttribute(mTbl.querySelectorAll('th')[idx - frzCols], {\n              'display': displayVal\n            });\n          }\n        }\n      } else {\n        if (gObj.isRowDragable()) {\n          idx++;\n        }\n\n        setStyleAttribute(this.getColGroup().children[idx], {\n          'display': displayVal\n        });\n      }\n\n      this.refreshUI();\n    }\n  };\n\n  HeaderRender.prototype.colPosRefresh = function () {\n    if (isBlazor() && this.parent.isServerRendered && this.parent.frozenRows && this.parent.getFrozenColumns()) {\n      this.freezeReorder = true;\n    }\n\n    this.refreshUI();\n  };\n  /**\n   * Refresh the header of the Grid.\n   * @returns {void}\n   */\n\n\n  HeaderRender.prototype.refreshUI = function () {\n    var frzCols = this.parent.getFrozenColumns();\n    var isVFTable = this.parent.enableColumnVirtualization && frzCols !== 0;\n    var setFrozenTable = isBlazor() && this.parent.isServerRendered && this.parent.frozenRows !== 0 && frzCols !== 0;\n    var headerDiv = this.getPanel();\n    this.toggleStackClass(headerDiv);\n    var table = this.parent.enableColumnVirtualization && frzCols || this.freezeReorder ? this.headerPanel.querySelector('.e-movableheader').querySelector('.e-table') : this.getTable();\n\n    if (setFrozenTable && !isVFTable) {\n      table = this.freezeReorder ? this.headerPanel.querySelector('.e-movableheader').querySelector('.e-table') : this.headerPanel.querySelector('.e-frozenheader').querySelector('.e-table');\n    }\n\n    if (table) {\n      if (isBlazor() && this.parent.isServerRendered) {\n        table.removeChild(table.querySelector('colgroup'));\n        table.removeChild(table.querySelector('thead'));\n      } else {\n        remove(table);\n        table.removeChild(table.firstChild);\n        table.removeChild(table.childNodes[0]);\n      }\n\n      var colGroup = this.parent.createElement('colgroup');\n      var findHeaderRow = this.createHeaderContent();\n      this.rows = findHeaderRow.rows;\n      table.insertBefore(findHeaderRow.thead, table.firstChild);\n      this.updateColGroup(colGroup);\n      table.insertBefore(this.setColGroup(colGroup), table.firstChild);\n\n      if (!isVFTable && !setFrozenTable) {\n        this.setTable(table);\n      }\n\n      if (!(isBlazor() && this.parent.isServerRendered)) {\n        this.appendContent(table);\n      }\n\n      this.parent.notify(events.colGroupRefresh, {});\n      this.widthService.setWidthToColumns();\n      this.parent.updateDefaultCursor();\n\n      if (!frzCols) {\n        this.initializeHeaderDrag();\n      }\n\n      var rows = [].slice.call(headerDiv.querySelectorAll('tr.e-columnheader'));\n\n      for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n        var row = rows_1[_i];\n        var gCells = [].slice.call(row.querySelectorAll('.e-grouptopleftcell'));\n\n        if (gCells.length) {\n          gCells[gCells.length - 1].classList.add('e-lastgrouptopleftcell');\n        }\n      }\n\n      if (!frzCols) {\n        this.parent.notify(events.headerRefreshed, {\n          rows: this.rows,\n          args: {\n            isFrozen: this.parent.getFrozenColumns() !== 0\n          }\n        });\n      }\n\n      if (this.parent.allowTextWrap && this.parent.textWrapSettings.wrapMode === 'Header') {\n        wrap(rows, true);\n      }\n    }\n  };\n\n  HeaderRender.prototype.toggleStackClass = function (div) {\n    var column = this.parent.columns;\n    var stackedHdr = column.some(function (column) {\n      return !isNullOrUndefined(column.columns);\n    });\n\n    if (stackedHdr) {\n      div.classList.add('e-stackedheader');\n    } else {\n      div.classList.remove('e-stackedheader');\n    }\n  };\n\n  HeaderRender.prototype.appendContent = function (table) {\n    this.getPanel().querySelector('.e-headercontent').appendChild(table);\n  };\n\n  HeaderRender.prototype.getCellCnt = function (col, cnt) {\n    if (col.columns) {\n      for (var i = 0, len = col.columns.length; i < len; i++) {\n        cnt = this.getCellCnt(col.columns[i], cnt);\n      }\n    } else {\n      if (col.visible) {\n        cnt++;\n      }\n    }\n\n    return cnt;\n  };\n\n  HeaderRender.prototype.initializeHeaderDrag = function () {\n    var gObj = this.parent;\n\n    if (!(this.parent.allowReordering || this.parent.allowGrouping && this.parent.groupSettings.showDropArea)) {\n      return;\n    }\n\n    var headerRows = [].slice.call(gObj.getHeaderContent().querySelectorAll('.e-columnheader'));\n\n    for (var i = 0, len = headerRows.length; i < len; i++) {\n      var drag = new Draggable(headerRows[i], {\n        dragTarget: '.e-headercell',\n        distance: 5,\n        helper: this.helper,\n        dragStart: this.dragStart,\n        drag: this.drag,\n        dragStop: this.dragStop,\n        abort: '.e-rhandler'\n      });\n    }\n  };\n\n  HeaderRender.prototype.initializeHeaderDrop = function () {\n    var gObj = this.parent;\n    var drop = new Droppable(gObj.getHeaderContent(), {\n      accept: '.e-dragclone',\n      drop: this.drop\n    });\n  };\n\n  return HeaderRender;\n}();\n\nexport { HeaderRender };","map":{"version":3,"sources":["C:/CN2/workspace-trunk/kain-front-end/node_modules/@syncfusion/ej2-grids/src/grid/renderer/header-renderer.js"],"names":["isNullOrUndefined","extend","setStyleAttribute","closest","getClosest","remove","isBlazor","classList","CellType","RowRenderer","Cell","Row","events","Draggable","Droppable","parentsUntil","wrap","measureColumnDepth","appendChildren","HeaderRender","parent","serviceLocator","_this","frzIdx","notfrzIdx","helper","e","gObj","target","sender","parentEle","allowReordering","allowGrouping","querySelectorAll","length","visualElement","createElement","className","element","contains","height","offsetHeight","headercelldiv","querySelector","col","getStackedHeaderColumnByHeaderText","innerText","trim","columns","getColumnByUid","getAttribute","column","lockColumn","setAttribute","uid","headerTemplate","result","colIndex","getColumnIndexByField","field","getHeaderTemplate","innerHTML","headerText","firstElementChild","style","width","offsetWidth","lineHeight","toString","appendChild","dragStart","display","notify","columnDragStart","event","bindEvents","dragElement","drag","cloneElement","columnDrag","dragStop","cancel","columnDragStop","drop","droppedElement","headerDrop","ariaService","getService","widthService","isDestroyed","enableColumnVirtualization","on","columnVisibilityChanged","setVisible","columnPositionChanged","colPosRefresh","prototype","renderPanel","div","isRendered","innerDiv","toggleStackClass","setPanel","renderTable","headerDiv","getPanel","createHeaderTable","setTable","getFrozenColumns","initializeHeaderDrag","initializeHeaderDrop","headerRefreshed","rows","args","isFrozen","headerPanel","panel","getTable","headerTable","table","getColGroup","colgroup","setColGroup","colGroup","getRows","tHead","skipDom","frozenRows","createTable","tableEle","isJsComponent","getColumns","attrs","cellspacing","role","findHeaderRow","createHeaderContent","thead","tbody","caption","id","rowBody","bodyCell","rowRenderer","Header","i","len","j","len_1","cells","cell","allowFiltering","allowSorting","add","updateColGroup","setOptions","colcount","colHeader","headerRow","colDepth","generateRow","ensureColumns","getHeaderCells","render","rowHeight","cols","indexes","getColumnIndexesInView","groupSettings","indexOf","detailTemplate","childGrid","isRowDragable","visible","c","len_2","push","generateCell","HeaderIndent","detailIndentCellInfo","DetailHeader","RowDragHIcon","getHeaderTable","enablePersistence","lockcolPositionCount","lockColsRendered","appendCells","index","isFirstObj","isFirstCol","isLastCol","isMovable","lastCol","frzCols","left","getContent","scrollLeft","inViewIndexes","getColumnIndexByUid","frozenColumns","colSpan","getCellCnt","frzObj","refreshFrozenHdr","isPartial","isComp","cnt","stackedLockColsCount","getStackedLockColsCount","cellType","StackedHeader","getColSpan","lockColsCount","frozenCnt","frzCol","rowSpan","rowIndex","opt","slice","call","displayVal","idx","clen","getNormalizedColumnIndex","isServerRendered","children","mTblColGrp","getHeaderContent","mTbl","refreshUI","freezeReorder","isVFTable","setFrozenTable","removeChild","firstChild","childNodes","insertBefore","appendContent","colGroupRefresh","setWidthToColumns","updateDefaultCursor","_i","rows_1","row","gCells","allowTextWrap","textWrapSettings","wrapMode","stackedHdr","some","showDropArea","headerRows","dragTarget","distance","abort","accept"],"mappings":"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","sourcesContent":["import { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { setStyleAttribute, closest as getClosest, remove, isBlazor } from '@syncfusion/ej2-base';\nimport { classList } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { RowRenderer } from './row-renderer';\nimport { Cell } from '../models/cell';\nimport { Row } from '../models/row';\nimport * as events from '../base/constant';\nimport { Draggable, Droppable } from '@syncfusion/ej2-base';\nimport { parentsUntil, wrap, measureColumnDepth, appendChildren } from '../base/util';\n/**\n * Content module is used to render grid content\n * @hidden\n */\nvar HeaderRender = /** @class */ (function () {\n    /**\n     * Constructor for header renderer module\n     */\n    function HeaderRender(parent, serviceLocator) {\n        var _this = this;\n        this.frzIdx = 0;\n        this.notfrzIdx = 0;\n        this.helper = function (e) {\n            var gObj = _this.parent;\n            var target = e.sender.target;\n            var parentEle = parentsUntil(target, 'e-headercell');\n            if (!(gObj.allowReordering || gObj.allowGrouping) || (!isNullOrUndefined(parentEle)\n                && parentEle.querySelectorAll('.e-checkselectall').length > 0)) {\n                return false;\n            }\n            var visualElement = _this.parent.createElement('div', { className: 'e-cloneproperties e-dragclone e-headerclone' });\n            var element = target.classList.contains('e-headercell') ? target : parentEle;\n            if (!element || (!gObj.allowReordering && element.classList.contains('e-stackedheadercell'))) {\n                return false;\n            }\n            var height = element.offsetHeight;\n            var headercelldiv = element.querySelector('.e-headercelldiv') || element.querySelector('.e-stackedheadercelldiv');\n            var col;\n            if (headercelldiv) {\n                if (element.querySelector('.e-stackedheadercelldiv')) {\n                    col = gObj.getStackedHeaderColumnByHeaderText(headercelldiv.innerText.trim(), gObj.columns);\n                }\n                else {\n                    col = gObj.getColumnByUid(headercelldiv.getAttribute('e-mappinguid'));\n                }\n                _this.column = col;\n                if (_this.column.lockColumn) {\n                    return false;\n                }\n                visualElement.setAttribute('e-mappinguid', _this.column.uid);\n            }\n            if (col && !isNullOrUndefined(col.headerTemplate)) {\n                if (!isNullOrUndefined(col.headerTemplate)) {\n                    var result = void 0;\n                    var colIndex = gObj.getColumnIndexByField(col.field);\n                    result = col.getHeaderTemplate()(extend({ 'index': colIndex }, col), gObj, 'headerTemplate');\n                    appendChildren(visualElement, result);\n                }\n                else {\n                    visualElement.innerHTML = col.headerTemplate;\n                }\n            }\n            else {\n                visualElement.innerHTML = headercelldiv ?\n                    col.headerText : element.firstElementChild.innerHTML;\n            }\n            visualElement.style.width = element.offsetWidth + 'px';\n            visualElement.style.height = element.offsetHeight + 'px';\n            visualElement.style.lineHeight = (height - 6).toString() + 'px';\n            gObj.element.appendChild(visualElement);\n            return visualElement;\n        };\n        this.dragStart = function (e) {\n            var gObj = _this.parent;\n            gObj.element.querySelector('.e-gridpopup').style.display = 'none';\n            gObj.notify(events.columnDragStart, { target: e.target, column: _this.column, event: e.event });\n            if (isBlazor()) {\n                e.bindEvents(e.dragElement);\n            }\n        };\n        this.drag = function (e) {\n            var gObj = _this.parent;\n            var target = e.target;\n            if (target) {\n                var closest = getClosest(target, '.e-grid');\n                var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n                if (!closest || closest.getAttribute('id') !== gObj.element.getAttribute('id')) {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n                    if (gObj.allowReordering) {\n                        gObj.element.querySelector('.e-reorderuparrow').style.display = 'none';\n                        gObj.element.querySelector('.e-reorderdownarrow').style.display = 'none';\n                    }\n                    return;\n                }\n                gObj.notify(events.columnDrag, { target: e.target, column: _this.column, event: e.event });\n            }\n        };\n        this.dragStop = function (e) {\n            var gObj = _this.parent;\n            var cancel;\n            gObj.element.querySelector('.e-gridpopup').style.display = 'none';\n            if ((!parentsUntil(e.target, 'e-headercell') && !parentsUntil(e.target, 'e-groupdroparea')) ||\n                (!gObj.allowReordering && parentsUntil(e.target, 'e-headercell')) ||\n                (!e.helper.getAttribute('e-mappinguid') && parentsUntil(e.target, 'e-groupdroparea'))) {\n                remove(e.helper);\n                cancel = true;\n            }\n            gObj.notify(events.columnDragStop, { target: e.target, event: e.event, column: _this.column, cancel: cancel });\n        };\n        this.drop = function (e) {\n            var gObj = _this.parent;\n            var uid = e.droppedElement.getAttribute('e-mappinguid');\n            var closest = getClosest(e.target, '.e-grid');\n            remove(e.droppedElement);\n            if (closest && closest.getAttribute('id') !== gObj.element.getAttribute('id') ||\n                !(gObj.allowReordering || gObj.allowGrouping)) {\n                return;\n            }\n            gObj.notify(events.headerDrop, { target: e.target, uid: uid });\n        };\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.ariaService = this.serviceLocator.getService('ariaService');\n        this.widthService = this.serviceLocator.getService('widthService');\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        if (!this.parent.enableColumnVirtualization) {\n            this.parent.on(events.columnVisibilityChanged, this.setVisible, this);\n        }\n        this.parent.on(events.columnPositionChanged, this.colPosRefresh, this);\n    }\n    /**\n     * The function is used to render grid header div\n     */\n    HeaderRender.prototype.renderPanel = function () {\n        var div = this.parent.element.querySelector('.e-gridheader');\n        var isRendered = (div != null);\n        div = isRendered ? div : this.parent.createElement('div', { className: 'e-gridheader' });\n        var innerDiv = isRendered ? div.querySelector('.e-headercontent') :\n            this.parent.createElement('div', { className: 'e-headercontent' });\n        this.toggleStackClass(div);\n        div.appendChild(innerDiv);\n        this.setPanel(div);\n        if (!isRendered) {\n            this.parent.element.appendChild(div);\n        }\n    };\n    /**\n     * The function is used to render grid header table\n     */\n    HeaderRender.prototype.renderTable = function () {\n        var headerDiv = this.getPanel();\n        headerDiv.appendChild(this.createHeaderTable());\n        this.setTable(headerDiv.querySelector('.e-table'));\n        if (!this.parent.getFrozenColumns()) {\n            this.initializeHeaderDrag();\n            this.initializeHeaderDrop();\n        }\n        this.parent.notify(events.headerRefreshed, { rows: this.rows, args: { isFrozen: this.parent.getFrozenColumns() !== 0 } });\n    };\n    /**\n     * Get the header content div element of grid\n     * @return {Element}\n     */\n    HeaderRender.prototype.getPanel = function () {\n        return this.headerPanel;\n    };\n    /**\n     * Set the header content div element of grid\n     * @param  {Element} panel\n     */\n    HeaderRender.prototype.setPanel = function (panel) {\n        this.headerPanel = panel;\n    };\n    /**\n     * Get the header table element of grid\n     * @return {Element}\n     */\n    HeaderRender.prototype.getTable = function () {\n        return this.headerTable;\n    };\n    /**\n     * Set the header table element of grid\n     * @param  {Element} table\n     */\n    HeaderRender.prototype.setTable = function (table) {\n        this.headerTable = table;\n    };\n    /**\n     * Get the header colgroup element\n     * @returns {Element}\n     */\n    HeaderRender.prototype.getColGroup = function () {\n        return this.colgroup;\n    };\n    /**\n     * Set the header colgroup element\n     * @param {Element} colgroup\n     * @returns {Element}\n     */\n    HeaderRender.prototype.setColGroup = function (colGroup) {\n        return this.colgroup = colGroup;\n    };\n    /**\n     * Get the header row element collection.\n     * @return {Element[]}\n     */\n    HeaderRender.prototype.getRows = function () {\n        var table = this.getTable();\n        return table.tHead.rows;\n    };\n    /**\n     * The function is used to create header table elements\n     * @return {Element}\n     * @hidden\n     */\n    HeaderRender.prototype.createHeaderTable = function () {\n        var skipDom = isBlazor() && this.parent.frozenRows !== 0;\n        var table = this.createTable();\n        var innerDiv = this.getPanel().querySelector('.e-headercontent');\n        if (!skipDom) {\n            innerDiv.appendChild(table);\n        }\n        return innerDiv;\n    };\n    /**\n     * @hidden\n     */\n    HeaderRender.prototype.createTable = function (tableEle) {\n        if (tableEle === void 0) { tableEle = null; }\n        var skipDom = isBlazor() && this.parent.frozenRows !== 0;\n        var gObj = this.parent;\n        if (!(isBlazor() && !gObj.isJsComponent) && this.getTable() && (!gObj.getFrozenColumns())) {\n            remove(this.getTable());\n        }\n        var columns = gObj.getColumns();\n        var innerDiv = this.getPanel().querySelector('.e-headercontent');\n        var table = skipDom ? tableEle || innerDiv.querySelector('.e-table') :\n            this.parent.createElement('table', { className: 'e-table', attrs: { cellspacing: '0.25px', role: 'grid' } });\n        var findHeaderRow = this.createHeaderContent();\n        var thead = findHeaderRow.thead;\n        var tbody = this.parent.createElement('tbody', { className: this.parent.frozenRows ? '' : 'e-hide' });\n        this.caption = this.parent.createElement('caption', { innerHTML: this.parent.element.id + '_header_table', className: 'e-hide' });\n        var colGroup = this.parent.createElement('colgroup');\n        var rowBody = this.parent.createElement('tr');\n        var bodyCell;\n        var rows = this.rows = findHeaderRow.rows;\n        var rowRenderer = new RowRenderer(this.serviceLocator, CellType.Header, this.parent);\n        for (var i = 0, len = rows.length; i < len; i++) {\n            for (var j = 0, len_1 = rows[i].cells.length; j < len_1; j++) {\n                var cell = rows[i].cells[j];\n                bodyCell = this.parent.createElement('td');\n                rowBody.appendChild(bodyCell);\n            }\n        }\n        if (gObj.allowFiltering || gObj.allowSorting || gObj.allowGrouping) {\n            table.classList.add('e-sortfilter');\n        }\n        this.updateColGroup(colGroup);\n        if (!skipDom) {\n            tbody.appendChild(rowBody);\n        }\n        table.appendChild(this.setColGroup(colGroup));\n        table.appendChild(thead);\n        if (!skipDom) {\n            table.appendChild(tbody);\n        }\n        table.appendChild(this.caption);\n        this.ariaService.setOptions(table, { colcount: gObj.getColumns().length.toString() });\n        return table;\n    };\n    HeaderRender.prototype.createHeaderContent = function () {\n        var gObj = this.parent;\n        var columns = gObj.getColumns();\n        var thead = this.parent.createElement('thead');\n        var colHeader = this.parent.createElement('tr', { className: 'e-columnheader' });\n        var rowRenderer = new RowRenderer(this.serviceLocator, CellType.Header, gObj);\n        rowRenderer.element = colHeader;\n        var rows = [];\n        var headerRow;\n        this.colDepth = measureColumnDepth(gObj.columns);\n        for (var i = 0, len = this.colDepth; i < len; i++) {\n            rows[i] = this.generateRow(i);\n            rows[i].cells = [];\n        }\n        rows = this.ensureColumns(rows);\n        rows = this.getHeaderCells(rows);\n        for (var i = 0, len = this.colDepth; i < len; i++) {\n            headerRow = rowRenderer.render(rows[i], columns);\n            if (this.parent.rowHeight && headerRow.querySelector('.e-headercell')) {\n                headerRow.style.height = this.parent.rowHeight + 'px';\n            }\n            thead.appendChild(headerRow);\n        }\n        var findHeaderRow = {\n            thead: thead,\n            rows: rows\n        };\n        return findHeaderRow;\n    };\n    HeaderRender.prototype.updateColGroup = function (colGroup) {\n        var cols = this.parent.getColumns();\n        var col;\n        var indexes = this.parent.getColumnIndexesInView();\n        colGroup.id = this.parent.element.id + 'colGroup';\n        if (this.parent.allowGrouping) {\n            for (var i = 0, len = this.parent.groupSettings.columns.length; i < len; i++) {\n                if (this.parent.enableColumnVirtualization && indexes.indexOf(i) === -1) {\n                    continue;\n                }\n                col = this.parent.createElement('col', { className: 'e-group-intent' });\n                colGroup.appendChild(col);\n            }\n        }\n        if (this.parent.detailTemplate || this.parent.childGrid) {\n            col = this.parent.createElement('col', { className: 'e-detail-intent' });\n            colGroup.appendChild(col);\n        }\n        if (this.parent.isRowDragable()) {\n            col = this.parent.createElement('col', { className: 'e-drag-intent' });\n            colGroup.appendChild(col);\n        }\n        for (var i = 0, len = cols.length; i < len; i++) {\n            col = this.parent.createElement('col');\n            if (cols[i].visible === false) {\n                setStyleAttribute(col, { 'display': 'none' });\n            }\n            colGroup.appendChild(col);\n        }\n        return colGroup;\n    };\n    HeaderRender.prototype.ensureColumns = function (rows) {\n        //TODO: generate dummy column for group, detail, stacked row here; ensureColumns here\n        var gObj = this.parent;\n        var indexes = this.parent.getColumnIndexesInView();\n        for (var i = 0, len = rows.length; i < len; i++) {\n            if (gObj.allowGrouping) {\n                for (var c = 0, len_2 = gObj.groupSettings.columns.length; c < len_2; c++) {\n                    if (this.parent.enableColumnVirtualization && indexes.indexOf(c) === -1) {\n                        continue;\n                    }\n                    rows[i].cells.push(this.generateCell({}, CellType.HeaderIndent));\n                }\n            }\n            if (gObj.detailTemplate || gObj.childGrid) {\n                var args = {};\n                this.parent.notify(events.detailIndentCellInfo, args);\n                rows[i].cells.push(this.generateCell(args, CellType.DetailHeader));\n            }\n            if (gObj.isRowDragable()) {\n                rows[i].cells.push(this.generateCell({}, CellType.RowDragHIcon));\n            }\n        }\n        return rows;\n    };\n    HeaderRender.prototype.getHeaderCells = function (rows) {\n        var column;\n        var thead = this.parent.getHeaderTable() && this.parent.getHeaderTable().querySelector('thead');\n        var cols = this.parent.enableColumnVirtualization ?\n            this.parent.getColumns(this.parent.enablePersistence) : this.parent.columns;\n        this.frzIdx = 0;\n        this.notfrzIdx = 0;\n        if (this.parent.lockcolPositionCount) {\n            for (var i = 0; i < cols.length; i++) {\n                this.lockColsRendered = false;\n                rows = this.appendCells(cols[i], rows, 0, i === 0, false, i === (cols.length - 1), thead);\n            }\n        }\n        for (var i = 0, len = cols.length; i < len; i++) {\n            this.notfrzIdx = 0;\n            this.lockColsRendered = true;\n            rows = this.appendCells(cols[i], rows, 0, i === 0, false, i === (len - 1), thead);\n        }\n        return rows;\n    };\n    HeaderRender.prototype.appendCells = function (cols, rows, index, isFirstObj, isFirstCol, isLastCol, isMovable) {\n        var lastCol = isLastCol ? 'e-lastcell' : '';\n        var frzCols = this.parent.getFrozenColumns();\n        var left;\n        if (this.parent.enableColumnVirtualization && frzCols) {\n            left = this.parent.getContent().querySelector('.e-movablecontent').scrollLeft;\n        }\n        if (!cols.columns) {\n            if (left && left > 0 && this.parent.enableColumnVirtualization\n                && this.parent.inViewIndexes[0] !== 0) {\n                rows[index].cells.push(this.generateCell(cols, CellType.Header, this.colDepth - index, (isFirstObj ? '' : (isFirstCol ? 'e-firstcell' : '')) + lastCol, index, this.parent.getColumnIndexByUid(cols.uid)));\n            }\n            else {\n                if (!frzCols && (!this.parent.lockcolPositionCount\n                    || (cols.lockColumn && !this.lockColsRendered) || (!cols.lockColumn && this.lockColsRendered))\n                    || (frzCols && ((!isMovable && (this.frzIdx + this.notfrzIdx < this.parent.frozenColumns || cols.isFrozen) &&\n                        (!this.parent.lockcolPositionCount || (cols.lockColumn && !this.lockColsRendered) ||\n                            (!cols.lockColumn && this.lockColsRendered)))\n                        || (isMovable && (this.frzIdx + this.notfrzIdx >= this.parent.frozenColumns && !cols.isFrozen) &&\n                            (!this.parent.lockcolPositionCount || (cols.lockColumn && !this.lockColsRendered) ||\n                                (!cols.lockColumn && this.lockColsRendered)))))) {\n                    rows[index].cells.push(this.generateCell(cols, CellType.Header, this.colDepth - index, (isFirstObj ? '' : (isFirstCol ? 'e-firstcell' : '')) + lastCol, index, this.parent.getColumnIndexByUid(cols.uid)));\n                }\n            }\n            if (this.parent.lockcolPositionCount) {\n                if ((this.frzIdx + this.notfrzIdx < this.parent.frozenColumns) &&\n                    ((cols.lockColumn && !this.lockColsRendered) || (!cols.lockColumn && this.lockColsRendered))) {\n                    this.frzIdx++;\n                }\n                else {\n                    this.notfrzIdx++;\n                }\n            }\n            else {\n                this.frzIdx++;\n            }\n        }\n        else {\n            var colSpan = this.getCellCnt(cols, 0);\n            if (colSpan) {\n                var frzObj = this.refreshFrozenHdr(cols.columns, { isPartial: false, isComp: true, cnt: 0 });\n                var stackedLockColsCount = this.getStackedLockColsCount(cols, 0);\n                if (!frzCols && (!this.parent.lockcolPositionCount\n                    || (!this.lockColsRendered && stackedLockColsCount) || (this.lockColsRendered && (colSpan - stackedLockColsCount)))\n                    || (frzCols && ((!isMovable && (this.parent.frozenColumns - this.frzIdx > 0 || (frzObj.isPartial)))\n                        || (isMovable && (colSpan + this.frzIdx > this.parent.frozenColumns && !frzObj.isComp))))) {\n                    rows[index].cells.push(new Cell({\n                        cellType: CellType.StackedHeader, column: cols,\n                        colSpan: this.getColSpan(colSpan, isMovable, frzObj.cnt, stackedLockColsCount)\n                    }));\n                }\n            }\n            if (this.parent.lockcolPositionCount && !this.lockColsRendered) {\n                for (var i = 0; i < cols.columns.length; i++) {\n                    rows = this.appendCells(cols.columns[i], rows, index + 1, isFirstObj, i === 0, i === (cols.columns.length - 1) && isLastCol, isMovable);\n                }\n            }\n            if (this.lockColsRendered) {\n                for (var i = 0, len = cols.columns.length; i < len; i++) {\n                    rows = this.appendCells(cols.columns[i], rows, index + 1, isFirstObj, i === 0, i === (len - 1) && isLastCol, isMovable);\n                }\n            }\n        }\n        return rows;\n    };\n    HeaderRender.prototype.getStackedLockColsCount = function (col, lockColsCount) {\n        if (col.columns) {\n            for (var i = 0; i < col.columns.length; i++) {\n                lockColsCount = this.getStackedLockColsCount(col.columns[i], lockColsCount);\n            }\n        }\n        else if (col.lockColumn) {\n            lockColsCount++;\n        }\n        return lockColsCount;\n    };\n    HeaderRender.prototype.refreshFrozenHdr = function (cols, frzObj) {\n        for (var i = 0; i < cols.length; i++) {\n            if (cols[i].columns) {\n                frzObj = this.refreshFrozenHdr(cols[i].columns, frzObj);\n            }\n            else {\n                if (cols[i].isFrozen) {\n                    frzObj.isPartial = true;\n                    frzObj.cnt++;\n                }\n                frzObj.isComp = frzObj.isComp && (cols[i].isFrozen ||\n                    this.parent.getColumnIndexByField(cols[i].field) < this.parent.frozenColumns);\n            }\n        }\n        return frzObj;\n    };\n    HeaderRender.prototype.getColSpan = function (colSpan, isMovable, frozenCnt, stackedLockColsCount) {\n        var frzCol = this.parent.frozenColumns;\n        if (this.parent.getFrozenColumns() && this.frzIdx + colSpan > frzCol) {\n            if (isMovable) {\n                colSpan = colSpan - (frzCol > this.frzIdx ? frzCol - this.frzIdx : 0) - frozenCnt;\n            }\n            else {\n                colSpan = colSpan - (colSpan - (frzCol > this.frzIdx ? frzCol + frozenCnt - this.frzIdx : frozenCnt));\n            }\n        }\n        else if (this.parent.lockcolPositionCount) {\n            colSpan = !this.lockColsRendered ? stackedLockColsCount : colSpan - stackedLockColsCount;\n        }\n        return colSpan;\n    };\n    HeaderRender.prototype.generateRow = function (index) {\n        return new Row({});\n    };\n    HeaderRender.prototype.generateCell = function (column, cellType, rowSpan, className, rowIndex, colIndex) {\n        var opt = {\n            'visible': column.visible,\n            'isDataCell': false,\n            'isTemplate': !isNullOrUndefined(column.headerTemplate),\n            'rowID': '',\n            'column': column,\n            'cellType': cellType,\n            'rowSpan': rowSpan,\n            'className': className,\n            'index': rowIndex,\n            'colIndex': colIndex\n        };\n        if (!opt.rowSpan || opt.rowSpan < 2) {\n            delete opt.rowSpan;\n        }\n        return new Cell(opt);\n    };\n    /**\n     * Function to hide header table column based on visible property\n     * @param  {Column[]} columns?\n     */\n    HeaderRender.prototype.setVisible = function (columns) {\n        var gObj = this.parent;\n        var rows = [].slice.call(this.getRows()); //NodeList -> Array        \n        var displayVal;\n        var idx;\n        var className;\n        var element;\n        var frzCols = gObj.getFrozenColumns();\n        for (var c = 0, clen = columns.length; c < clen; c++) {\n            var column = columns[c];\n            idx = gObj.getNormalizedColumnIndex(column.uid);\n            displayVal = column.visible ? '' : 'none';\n            if (frzCols) {\n                if (idx < frzCols) {\n                    if (isBlazor() && gObj.isServerRendered) {\n                        setStyleAttribute(this.getTable().querySelector('colgroup').children[idx], { 'display': displayVal });\n                        setStyleAttribute(this.getTable().querySelectorAll('th')[idx], { 'display': displayVal });\n                    }\n                    else {\n                        setStyleAttribute(this.getColGroup().children[idx], { 'display': displayVal });\n                    }\n                }\n                else {\n                    var mTblColGrp = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('colgroup');\n                    var mTbl = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('table');\n                    setStyleAttribute(mTblColGrp.children[idx - frzCols], { 'display': displayVal });\n                    if (isBlazor() && gObj.isServerRendered) {\n                        setStyleAttribute(mTbl.querySelectorAll('th')[idx - frzCols], { 'display': displayVal });\n                    }\n                }\n            }\n            else {\n                if (gObj.isRowDragable()) {\n                    idx++;\n                }\n                setStyleAttribute(this.getColGroup().children[idx], { 'display': displayVal });\n            }\n            this.refreshUI();\n        }\n    };\n    HeaderRender.prototype.colPosRefresh = function () {\n        if (isBlazor() && this.parent.isServerRendered && this.parent.frozenRows && this.parent.getFrozenColumns()) {\n            this.freezeReorder = true;\n        }\n        this.refreshUI();\n    };\n    /**\n     * Refresh the header of the Grid.\n     * @returns {void}\n     */\n    HeaderRender.prototype.refreshUI = function () {\n        var frzCols = this.parent.getFrozenColumns();\n        var isVFTable = this.parent.enableColumnVirtualization && frzCols !== 0;\n        var setFrozenTable = isBlazor() && this.parent.isServerRendered && this.parent.frozenRows !== 0 && frzCols !== 0;\n        var headerDiv = this.getPanel();\n        this.toggleStackClass(headerDiv);\n        var table = (this.parent.enableColumnVirtualization && frzCols) || this.freezeReorder\n            ? this.headerPanel.querySelector('.e-movableheader').querySelector('.e-table') : this.getTable();\n        if (setFrozenTable && !isVFTable) {\n            table = this.freezeReorder ? this.headerPanel.querySelector('.e-movableheader').querySelector('.e-table') :\n                this.headerPanel.querySelector('.e-frozenheader').querySelector('.e-table');\n        }\n        if (table) {\n            if (isBlazor() && this.parent.isServerRendered) {\n                table.removeChild(table.querySelector('colgroup'));\n                table.removeChild(table.querySelector('thead'));\n            }\n            else {\n                remove(table);\n                table.removeChild(table.firstChild);\n                table.removeChild(table.childNodes[0]);\n            }\n            var colGroup = this.parent.createElement('colgroup');\n            var findHeaderRow = this.createHeaderContent();\n            this.rows = findHeaderRow.rows;\n            table.insertBefore(findHeaderRow.thead, table.firstChild);\n            this.updateColGroup(colGroup);\n            table.insertBefore(this.setColGroup(colGroup), table.firstChild);\n            if (!isVFTable && !setFrozenTable) {\n                this.setTable(table);\n            }\n            if (!(isBlazor() && this.parent.isServerRendered)) {\n                this.appendContent(table);\n            }\n            this.parent.notify(events.colGroupRefresh, {});\n            this.widthService.setWidthToColumns();\n            this.parent.updateDefaultCursor();\n            if (!frzCols) {\n                this.initializeHeaderDrag();\n            }\n            var rows = [].slice.call(headerDiv.querySelectorAll('tr.e-columnheader'));\n            for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n                var row = rows_1[_i];\n                var gCells = [].slice.call(row.querySelectorAll('.e-grouptopleftcell'));\n                if (gCells.length) {\n                    gCells[gCells.length - 1].classList.add('e-lastgrouptopleftcell');\n                }\n            }\n            if (!frzCols) {\n                this.parent.notify(events.headerRefreshed, { rows: this.rows, args: { isFrozen: this.parent.getFrozenColumns() !== 0 } });\n            }\n            if (this.parent.allowTextWrap && this.parent.textWrapSettings.wrapMode === 'Header') {\n                wrap(rows, true);\n            }\n        }\n    };\n    HeaderRender.prototype.toggleStackClass = function (div) {\n        var column = this.parent.columns;\n        var stackedHdr = column.some(function (column) { return !isNullOrUndefined(column.columns); });\n        if (stackedHdr) {\n            div.classList.add('e-stackedheader');\n        }\n        else {\n            div.classList.remove('e-stackedheader');\n        }\n    };\n    HeaderRender.prototype.appendContent = function (table) {\n        this.getPanel().querySelector('.e-headercontent').appendChild(table);\n    };\n    HeaderRender.prototype.getCellCnt = function (col, cnt) {\n        if (col.columns) {\n            for (var i = 0, len = col.columns.length; i < len; i++) {\n                cnt = this.getCellCnt(col.columns[i], cnt);\n            }\n        }\n        else {\n            if (col.visible) {\n                cnt++;\n            }\n        }\n        return cnt;\n    };\n    HeaderRender.prototype.initializeHeaderDrag = function () {\n        var gObj = this.parent;\n        if (!(this.parent.allowReordering || (this.parent.allowGrouping && this.parent.groupSettings.showDropArea))) {\n            return;\n        }\n        var headerRows = [].slice.call(gObj.getHeaderContent().querySelectorAll('.e-columnheader'));\n        for (var i = 0, len = headerRows.length; i < len; i++) {\n            var drag = new Draggable(headerRows[i], {\n                dragTarget: '.e-headercell',\n                distance: 5,\n                helper: this.helper,\n                dragStart: this.dragStart,\n                drag: this.drag,\n                dragStop: this.dragStop,\n                abort: '.e-rhandler'\n            });\n        }\n    };\n    HeaderRender.prototype.initializeHeaderDrop = function () {\n        var gObj = this.parent;\n        var drop = new Droppable(gObj.getHeaderContent(), {\n            accept: '.e-dragclone',\n            drop: this.drop\n        });\n    };\n    return HeaderRender;\n}());\nexport { HeaderRender };\n"]},"metadata":{},"sourceType":"module"}