{"ast":null,"code":"import { extend, isBlazor } from '@syncfusion/ej2-base';\nimport { remove, isNullOrUndefined, updateBlazorTemplate, resetBlazorTemplate } from '@syncfusion/ej2-base';\nimport { parentsUntil, isGroupAdaptive, refreshForeignData, getObject } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * `NormalEdit` module is used to handle normal('inline, dialog, external') editing actions.\n * @hidden\n */\n\nvar NormalEdit =\n/** @class */\nfunction () {\n  function NormalEdit(parent, serviceLocator, renderer) {\n    this.args = {};\n    this.parent = parent;\n    this.renderer = renderer;\n    this.serviceLocator = serviceLocator;\n    this.addEventListener();\n  }\n\n  NormalEdit.prototype.clickHandler = function (e) {\n    var target = e.target;\n    var gObj = this.parent;\n\n    if ((parentsUntil(target, 'e-gridcontent') && parentsUntil(parentsUntil(target, 'e-gridcontent'), 'e-grid').id === gObj.element.id || gObj.frozenRows && parentsUntil(target, 'e-headercontent')) && !parentsUntil(target, 'e-unboundcelldiv')) {\n      this.rowIndex = parentsUntil(target, 'e-rowcell') ? parseInt(target.parentElement.getAttribute('aria-rowindex'), 10) : -1;\n\n      if (gObj.isEdit) {\n        gObj.editModule.endEdit();\n      }\n    }\n  };\n\n  NormalEdit.prototype.dblClickHandler = function (e) {\n    if (parentsUntil(e.target, 'e-rowcell') && this.parent.editSettings.allowEditOnDblClick) {\n      this.parent.editModule.startEdit(parentsUntil(e.target, 'e-row'));\n    }\n  };\n  /**\n   * The function used to trigger editComplete\n   * @return {void}\n   * @hidden\n   */\n\n\n  NormalEdit.prototype.editComplete = function (e) {\n    this.parent.isEdit = false;\n    var action = 'action';\n\n    if (isBlazor() && !this.parent.isJsComponent) {\n      e.rows = null;\n    }\n\n    switch (e.requestType) {\n      case 'save':\n        if (!(this.parent.isCheckBoxSelection || this.parent.selectionSettings.type === 'Multiple') || !this.parent.isPersistSelection) {\n          if (e[action] !== 'edit') {\n            this.parent.selectRow(0);\n          }\n        }\n\n        this.parent.trigger(events.actionComplete, extend(e, {\n          requestType: 'save',\n          type: events.actionComplete\n        }));\n        break;\n\n      case 'delete':\n        if (isBlazor() && !this.parent.isJsComponent) {\n          var d = 'data';\n          e[d] = e[d][0];\n        }\n\n        this.parent.trigger(events.actionComplete, extend(e, {\n          requestType: 'delete',\n          type: events.actionComplete\n        }));\n        this.parent.selectRow(this.editRowIndex);\n        break;\n    }\n  };\n\n  NormalEdit.prototype.startEdit = function (tr) {\n    var _this = this;\n\n    var gObj = this.parent;\n    var primaryKeys = gObj.getPrimaryKeyFieldNames();\n    var primaryKeyValues = [];\n    this.rowIndex = this.editRowIndex = parseInt(tr.getAttribute('aria-rowindex'), 10);\n\n    if (isBlazor()) {\n      var cols = this.parent.getColumns();\n\n      for (var i = 0; i < cols.length; i++) {\n        var col = cols[i];\n\n        if (col.template) {\n          resetBlazorTemplate(gObj.element.id + col.uid, 'Template', this.rowIndex);\n        }\n      }\n    }\n\n    if (isGroupAdaptive(gObj)) {\n      var rObj = gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n      this.previousData = rObj.data;\n    } else {\n      this.previousData = gObj.getCurrentViewRecords()[this.rowIndex];\n    }\n\n    for (var i = 0; i < primaryKeys.length; i++) {\n      primaryKeyValues.push(getObject(primaryKeys[i], this.previousData));\n    }\n\n    this.uid = tr.getAttribute('data-uid');\n    var rowObj = gObj.getRowObjectFromUID(this.uid);\n    var args = {\n      primaryKey: primaryKeys,\n      primaryKeyValue: primaryKeyValues,\n      requestType: 'beginEdit',\n      rowData: this.previousData,\n      rowIndex: this.rowIndex,\n      type: 'edit',\n      cancel: false,\n      foreignKeyData: rowObj && rowObj.foreignKeyData,\n      target: undefined\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      args.row = tr;\n    }\n\n    gObj.trigger(events.beginEdit, args, function (begineditargs) {\n      begineditargs.type = 'actionBegin';\n      gObj.trigger(events.actionBegin, begineditargs, function (editargs) {\n        if (!editargs.cancel) {\n          var cloneRow = 'cloneRow';\n          var frozen = 'frozen';\n          var cloneFrozen = 'cloneFrozen';\n          gObj.isEdit = true;\n          editargs.row = editargs.row ? editargs.row : tr;\n\n          if (isBlazor() && gObj.isServerRendered) {\n            _this.originalRow = editargs.row;\n            _this.cloneRow = editargs.row.cloneNode(true);\n            editargs[cloneRow] = _this.cloneRow;\n          }\n\n          if (gObj.editSettings.mode !== 'Dialog') {\n            gObj.clearSelection();\n          }\n\n          if (gObj.editSettings.mode === 'Dialog' && gObj.selectionModule) {\n            gObj.selectionModule.preventFocus = true;\n            editargs.row.classList.add('e-dlgeditrow');\n          }\n\n          _this.renderer.update(editargs);\n\n          if (isBlazor()) {\n            editargs.form = null;\n            _this.cloneFrozen = editargs[cloneFrozen];\n            _this.frozen = editargs[frozen];\n            _this.cloneRow = editargs[cloneRow];\n            _this.originalRow = editargs.row;\n          }\n\n          _this.uid = tr.getAttribute('data-uid');\n          gObj.editModule.applyFormValidation();\n          editargs.type = 'actionComplete';\n          gObj.trigger(events.actionComplete, editargs);\n          _this.args = editargs;\n\n          if (_this.parent.allowTextWrap) {\n            _this.parent.notify(events.freezeRender, {\n              case: 'textwrap'\n            });\n          }\n\n          if (isBlazor()) {\n            _this.parent.notify(events.toolbarRefresh, {});\n\n            gObj.element.querySelector('.e-gridpopup').style.display = 'none';\n\n            _this.parent.notify('start-edit', {});\n          }\n        }\n      });\n    });\n  };\n\n  NormalEdit.prototype.updateRow = function (index, data) {\n    var _this = this;\n\n    var gObj = this.parent;\n    var args = {\n      requestType: 'save',\n      type: events.actionBegin,\n      data: data,\n      cancel: false,\n      previousData: gObj.getCurrentViewRecords()[index],\n      row: gObj.getRowByIndex(index)\n    };\n    gObj.showSpinner();\n    gObj.notify(events.updateData, args);\n\n    if (args.promise) {\n      args.promise.then(function () {\n        return gObj.refresh();\n      }).catch(function (e) {\n        return _this.edFail(e);\n      });\n    } else {\n      gObj.refresh();\n    }\n  };\n\n  NormalEdit.prototype.editFormValidate = function () {\n    var gObj = this.parent;\n    var form1 = gObj.editModule.formObj.validate();\n    var form2 = gObj.editModule.mFormObj ? gObj.editModule.mFormObj.validate() : true;\n    return form1 && form2;\n  };\n\n  NormalEdit.prototype.endEdit = function () {\n    var gObj = this.parent;\n\n    if (!this.parent.isEdit || !this.editFormValidate()) {\n      return;\n    }\n\n    var editedData = extend({}, {}, this.previousData, true);\n    var args = extend(this.args, {\n      requestType: 'save',\n      type: events.actionBegin,\n      data: editedData,\n      cancel: false,\n      previousData: this.previousData,\n      selectedRow: gObj.selectedRowIndex,\n      foreignKeyData: {}\n    });\n    var isDlg = gObj.editSettings.mode === 'Dialog';\n    var dlgWrapper = document.querySelector('#' + gObj.element.id + '_dialogEdit_wrapper');\n    var dlgForm = isDlg ? dlgWrapper.querySelector('.e-gridform') : gObj.element.querySelector('.e-gridform');\n    editedData = gObj.editModule.getCurrentEditedData(dlgForm, editedData);\n\n    if (gObj.getFrozenColumns() && gObj.editSettings.mode === 'Normal') {\n      var mForm = gObj.element.querySelector('.e-movableheader').querySelector('.e-gridform');\n\n      if (gObj.frozenRows && mForm) {\n        editedData = gObj.editModule.getCurrentEditedData(mForm, editedData);\n      } else {\n        editedData = gObj.editModule.getCurrentEditedData(gObj.element.querySelector('.e-movablecontent').querySelector('.e-gridform'), editedData);\n      }\n    }\n\n    if (isBlazor()) {\n      var form = 'form';\n      var movableForm = 'movableForm';\n      args[form] = null;\n      args[movableForm] = null;\n      args.row = {};\n    }\n\n    if (isDlg ? dlgWrapper.querySelectorAll('.e-editedrow').length : gObj.element.querySelectorAll('.e-editedrow').length) {\n      args.action = 'edit';\n      gObj.trigger(events.actionBegin, args, function (endEditArgs) {\n        if (endEditArgs.cancel) {\n          return;\n        }\n\n        gObj.showSpinner();\n        gObj.notify(events.updateData, endEditArgs);\n      });\n    } else {\n      args.action = 'add';\n      args.selectedRow = 0;\n      args.index = this.addedRowIndex;\n      gObj.notify(events.modelChanged, args);\n      this.addedRowIndex = null;\n\n      if (args.cancel) {\n        return;\n      }\n    }\n  };\n\n  NormalEdit.prototype.destroyElements = function () {\n    var gObj = this.parent;\n    gObj.editModule.destroyWidgets();\n    gObj.editModule.destroyForm();\n    this.parent.notify(events.dialogDestroy, {});\n  };\n\n  NormalEdit.prototype.editHandler = function (args) {\n    var _this = this;\n\n    if (args.promise) {\n      args.promise.then(function (e) {\n        return _this.edSucc(e, args);\n      }).catch(function (e) {\n        return _this.edFail(e);\n      });\n    } else {\n      this.editSuccess(args.data, args);\n    }\n  };\n\n  NormalEdit.prototype.edSucc = function (e, args) {\n    this.editSuccess(e, args);\n  };\n\n  NormalEdit.prototype.edFail = function (e) {\n    this.editFailure(e);\n  };\n\n  NormalEdit.prototype.updateCurrentViewData = function (data) {\n    this.parent.getCurrentViewRecords()[this.editRowIndex] = data;\n  };\n\n  NormalEdit.prototype.requestSuccess = function (args) {\n    if (this.parent.editModule.formObj && !this.parent.editModule.formObj.isDestroyed) {\n      this.destroyElements();\n      this.stopEditStatus();\n\n      if (this.parent.editSettings.mode === 'Dialog' && args.action !== 'add') {\n        this.parent.element.querySelector('.e-dlgeditrow').classList.remove('e-dlgeditrow');\n      }\n    }\n  };\n\n  NormalEdit.prototype.editSuccess = function (e, args) {\n    if (!isNullOrUndefined(e) && !(e instanceof Array)) {\n      var rowData = 'rowData';\n      args.data = extend({}, extend({}, args[rowData], args.data), e);\n    }\n\n    var editArgs;\n    this.requestSuccess(args);\n    this.parent.trigger(events.beforeDataBound, args);\n    args.type = events.actionComplete;\n    this.parent.isEdit = false;\n\n    if (isBlazor() && this.parent.isServerRendered) {\n      this.closeForm();\n      var rowIndex = 'rowIndex';\n      var action = 'action';\n      editArgs = {\n        requestType: args.requestType,\n        rowIndex: args[rowIndex],\n        action: args[action]\n      };\n      this.parent.notify('editsuccess', editArgs);\n    } else {\n      this.refreshRow(args.data);\n    }\n\n    this.parent.editModule.checkLastRow(args.row);\n    this.parent.editModule.isLastRow = false;\n    this.updateCurrentViewData(args.data);\n    this.blazorTemplate();\n\n    if (!(isBlazor() && this.parent.isServerRendered)) {\n      this.parent.trigger(events.actionComplete, args);\n    }\n\n    if (isBlazor()) {\n      this.parent.notify(events.toolbarRefresh, {});\n    }\n\n    if (!(this.parent.isCheckBoxSelection || this.parent.selectionSettings.type === 'Multiple') || !this.parent.isPersistSelection) {\n      if (this.parent.editSettings.mode !== 'Dialog') {\n        this.parent.selectRow(this.rowIndex > -1 ? this.rowIndex : this.editRowIndex);\n\n        if (isBlazor() && this.parent.isServerRendered) {\n          var rowIndex = 'editRowIndex';\n          editArgs[rowIndex] = this.rowIndex > -1 ? this.rowIndex : this.editRowIndex;\n        }\n      }\n    }\n\n    this.parent.hideSpinner();\n  };\n\n  NormalEdit.prototype.closeForm = function () {\n    if (!this.cloneRow && this.parent.isEdit) {\n      this.stopEditStatus();\n    }\n\n    if (this.cloneRow) {\n      this.cloneRow.remove();\n      this.originalRow.classList.remove('e-hiddenrow');\n    }\n\n    if (this.parent.getFrozenColumns() && this.cloneFrozen) {\n      this.cloneFrozen.remove();\n      this.frozen.classList.remove('e-hiddenrow');\n    }\n  };\n\n  NormalEdit.prototype.blazorTemplate = function () {\n    var cols = this.parent.getColumns();\n\n    if (this.parent.editSettings.template && this.parent.editSettings.mode === 'Normal') {\n      updateBlazorTemplate(this.parent.element.id + 'editSettingsTemplate', 'Template', this.parent.editSettings);\n    }\n\n    for (var i = 0; i < cols.length; i++) {\n      var col = cols[i];\n\n      if (col.template) {\n        updateBlazorTemplate(this.parent.element.id + col.uid, 'Template', col, false);\n      }\n\n      if (col.editTemplate) {\n        updateBlazorTemplate(this.parent.element.id + col.uid + 'editTemplate', 'EditTemplate', col);\n      }\n    }\n  };\n\n  NormalEdit.prototype.editFailure = function (e) {\n    this.parent.trigger(events.actionFailure, isBlazor() && e instanceof Array ? e[0] : e);\n    this.parent.hideSpinner();\n    this.parent.log('actionfailure', {\n      error: e\n    });\n  };\n\n  NormalEdit.prototype.refreshRow = function (data) {\n    var frzCols = this.parent.getFrozenColumns();\n    var row = new RowRenderer(this.serviceLocator, null, this.parent);\n    var rowObj = this.parent.getRowObjectFromUID(this.uid);\n\n    if (rowObj) {\n      rowObj.changes = data;\n      refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n      row.refresh(rowObj, this.parent.getColumns(), true);\n\n      if (frzCols) {\n        var uid = void 0;\n        var tr = this.parent.element.querySelector('[data-uid=' + rowObj.uid + ']');\n\n        if (parentsUntil(tr, 'e-frozencontent') || parentsUntil(tr, 'e-frozenheader')) {\n          uid = this.parent.getMovableRows()[rowObj.index].getAttribute('data-uid');\n        } else {\n          uid = this.parent.getRows()[rowObj.index].getAttribute('data-uid');\n        }\n\n        rowObj = this.parent.getRowObjectFromUID(uid);\n        rowObj.changes = data;\n        row.refresh(rowObj, this.parent.columns, true);\n        this.parent.editModule.checkLastRow(tr);\n      }\n    }\n  };\n\n  NormalEdit.prototype.closeEdit = function () {\n    var _this = this;\n\n    if (!this.parent.isEdit) {\n      return;\n    }\n\n    var gObj = this.parent;\n    var args = extend(this.args, {\n      requestType: 'cancel',\n      type: events.actionBegin,\n      data: this.previousData,\n      selectedRow: gObj.selectedRowIndex\n    });\n    this.blazorTemplate();\n\n    if (isBlazor()) {\n      var form = 'form';\n      args[form] = null;\n    }\n\n    gObj.trigger(events.actionBegin, args, function (closeEditArgs) {\n      if (_this.parent.editSettings.mode === 'Dialog') {\n        _this.parent.notify(events.dialogDestroy, {});\n      }\n\n      gObj.isEdit = false;\n\n      _this.stopEditStatus();\n\n      closeEditArgs.type = events.actionComplete;\n\n      if (gObj.editSettings.mode !== 'Dialog') {\n        if (isBlazor() && gObj.isServerRendered) {\n          _this.closeForm();\n        } else {\n          _this.refreshRow(closeEditArgs.data);\n        }\n      }\n\n      if (!gObj.getContentTable().querySelector('tr.e-emptyrow') && !gObj.getContentTable().querySelector('tr.e-row')) {\n        gObj.renderModule.emptyRow();\n      }\n\n      if (gObj.editSettings.mode !== 'Dialog') {\n        gObj.selectRow(_this.rowIndex);\n      }\n\n      gObj.trigger(events.actionComplete, closeEditArgs);\n\n      if (isBlazor()) {\n        _this.parent.notify(events.toolbarRefresh, {});\n\n        _this.parent.notify('close-edit', {});\n      }\n    });\n  };\n\n  NormalEdit.prototype.addRecord = function (data, index) {\n    var _this = this;\n\n    var gObj = this.parent;\n    this.addedRowIndex = index = !isNullOrUndefined(index) ? index : 0;\n\n    if (data) {\n      gObj.notify(events.modelChanged, {\n        requestType: 'save',\n        type: events.actionBegin,\n        data: data,\n        selectedRow: 0,\n        action: 'add',\n        index: index\n      });\n      return;\n    }\n\n    if (gObj.isEdit) {\n      return;\n    }\n\n    this.previousData = {};\n    this.uid = '';\n    gObj.columnModel.forEach(function (col) {\n      if (col.field) {\n        DataUtil.setValue(col.field, col.defaultValue, _this.previousData);\n      }\n    });\n    var args = {\n      cancel: false,\n      foreignKeyData: {},\n      requestType: 'add',\n      data: this.previousData,\n      type: events.actionBegin,\n      index: index,\n      rowData: this.previousData,\n      target: undefined\n    };\n\n    if (isBlazor()) {\n      var form = 'form';\n      args[form] = null;\n    }\n\n    gObj.trigger(events.actionBegin, args, function (addArgs) {\n      if (addArgs.cancel) {\n        return;\n      }\n\n      gObj.isEdit = true;\n\n      if (gObj.editSettings.mode !== 'Dialog') {\n        gObj.clearSelection();\n      }\n\n      _this.renderer.addNew(addArgs);\n\n      gObj.editModule.applyFormValidation();\n      addArgs.type = events.actionComplete;\n      addArgs.row = gObj.element.querySelector('.e-addedrow');\n      gObj.trigger(events.actionComplete, addArgs);\n\n      if (isBlazor()) {\n        _this.parent.notify(events.toolbarRefresh, {});\n\n        _this.parent.notify('start-add', {});\n      }\n\n      _this.args = addArgs;\n    });\n  };\n\n  NormalEdit.prototype.deleteRecord = function (fieldname, data) {\n    this.editRowIndex = this.parent.selectedRowIndex;\n\n    if (data) {\n      data = data instanceof Array ? data : [data];\n      var gObj = this.parent;\n      var index = 0;\n      var dataLen = Object.keys(data).length;\n      fieldname = fieldname || this.parent.getPrimaryKeyFieldNames()[0];\n\n      var _loop_1 = function (i) {\n        var _a;\n\n        var tmpRecord;\n        var contained = gObj.currentViewData.some(function (record) {\n          tmpRecord = record;\n          return data[i] === getObject(fieldname, record) || data[i] === record;\n        });\n        data[i] = contained ? tmpRecord : (_a = {}, _a[fieldname] = data[i], _a);\n      };\n\n      for (var i = 0; i < dataLen; i++) {\n        _loop_1(i);\n      }\n    }\n\n    var args = {\n      requestType: 'delete',\n      type: events.actionBegin,\n      foreignKeyData: {},\n      data: data ? data : this.parent.getSelectedRecords(),\n      tr: this.parent.getSelectedRows(),\n      cancel: false\n    };\n    var dataInString = 'data';\n\n    if (isBlazor() && !this.parent.isJsComponent) {\n      args[dataInString] = args[dataInString][0];\n    }\n\n    this.parent.notify(events.modelChanged, args);\n  };\n\n  NormalEdit.prototype.stopEditStatus = function () {\n    var gObj = this.parent;\n    var elem = gObj.element.querySelector('.e-addedrow');\n    var mElem;\n    var editMElem;\n\n    if (gObj.getFrozenColumns()) {\n      mElem = gObj.element.querySelectorAll('.e-addedrow')[1];\n      editMElem = gObj.element.querySelectorAll('.e-editedrow')[1];\n\n      if (mElem) {\n        remove(mElem);\n      }\n\n      if (editMElem) {\n        editMElem.classList.remove('e-editedrow');\n      }\n    }\n\n    if (elem) {\n      remove(elem);\n    }\n\n    elem = gObj.element.querySelector('.e-editedrow');\n\n    if (elem) {\n      elem.classList.remove('e-editedrow');\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  NormalEdit.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.crudAction, this.editHandler, this);\n    this.parent.on(events.doubleTap, this.dblClickHandler, this);\n    this.parent.on(events.click, this.clickHandler, this);\n    this.parent.on(events.recordAdded, this.requestSuccess, this);\n    this.parent.on(events.dblclick, this.dblClickHandler, this);\n    this.parent.on(events.deleteComplete, this.editComplete, this);\n    this.parent.on(events.saveComplete, this.editComplete, this);\n    this.parent.on('closeinline', this.closeForm, this);\n  };\n  /**\n   * @hidden\n   */\n\n\n  NormalEdit.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.crudAction, this.editHandler);\n    this.parent.off(events.doubleTap, this.dblClickHandler);\n    this.parent.off(events.click, this.clickHandler);\n    this.parent.off(events.recordAdded, this.requestSuccess);\n    this.parent.off(events.dblclick, this.dblClickHandler);\n    this.parent.off(events.deleteComplete, this.editComplete);\n    this.parent.off(events.saveComplete, this.editComplete);\n    this.parent.off('closeinline', this.closeForm);\n  };\n  /**\n   * @hidden\n   */\n\n\n  NormalEdit.prototype.destroy = function () {\n    this.removeEventListener();\n    this.renderer.destroy();\n  };\n\n  return NormalEdit;\n}();\n\nexport { NormalEdit };","map":{"version":3,"sources":["C:/CN2/workspace-trunk/kain-front-end/node_modules/@syncfusion/ej2-grids/src/grid/actions/normal-edit.js"],"names":["extend","isBlazor","remove","isNullOrUndefined","updateBlazorTemplate","resetBlazorTemplate","parentsUntil","isGroupAdaptive","refreshForeignData","getObject","events","RowRenderer","DataUtil","NormalEdit","parent","serviceLocator","renderer","args","addEventListener","prototype","clickHandler","e","target","gObj","id","element","frozenRows","rowIndex","parseInt","parentElement","getAttribute","isEdit","editModule","endEdit","dblClickHandler","editSettings","allowEditOnDblClick","startEdit","editComplete","action","isJsComponent","rows","requestType","isCheckBoxSelection","selectionSettings","type","isPersistSelection","selectRow","trigger","actionComplete","d","editRowIndex","tr","_this","primaryKeys","getPrimaryKeyFieldNames","primaryKeyValues","cols","getColumns","i","length","col","template","uid","rObj","getRowObjectFromUID","previousData","data","getCurrentViewRecords","push","rowObj","primaryKey","primaryKeyValue","rowData","cancel","foreignKeyData","undefined","row","beginEdit","begineditargs","actionBegin","editargs","cloneRow","frozen","cloneFrozen","isServerRendered","originalRow","cloneNode","mode","clearSelection","selectionModule","preventFocus","classList","add","update","form","applyFormValidation","allowTextWrap","notify","freezeRender","case","toolbarRefresh","querySelector","style","display","updateRow","index","getRowByIndex","showSpinner","updateData","promise","then","refresh","catch","edFail","editFormValidate","form1","formObj","validate","form2","mFormObj","editedData","selectedRow","selectedRowIndex","isDlg","dlgWrapper","document","dlgForm","getCurrentEditedData","getFrozenColumns","mForm","movableForm","querySelectorAll","endEditArgs","addedRowIndex","modelChanged","destroyElements","destroyWidgets","destroyForm","dialogDestroy","editHandler","edSucc","editSuccess","editFailure","updateCurrentViewData","requestSuccess","isDestroyed","stopEditStatus","Array","editArgs","beforeDataBound","closeForm","refreshRow","checkLastRow","isLastRow","blazorTemplate","hideSpinner","editTemplate","actionFailure","log","error","frzCols","changes","getForeignKeyColumns","getMovableRows","getRows","columns","closeEdit","closeEditArgs","getContentTable","renderModule","emptyRow","addRecord","columnModel","forEach","field","setValue","defaultValue","addArgs","addNew","deleteRecord","fieldname","dataLen","Object","keys","_loop_1","_a","tmpRecord","contained","currentViewData","some","record","getSelectedRecords","getSelectedRows","dataInString","elem","mElem","editMElem","on","crudAction","doubleTap","click","recordAdded","dblclick","deleteComplete","saveComplete","removeEventListener","off","destroy"],"mappings":"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","sourcesContent":["import { extend, isBlazor } from '@syncfusion/ej2-base';\nimport { remove, isNullOrUndefined, updateBlazorTemplate, resetBlazorTemplate } from '@syncfusion/ej2-base';\nimport { parentsUntil, isGroupAdaptive, refreshForeignData, getObject } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * `NormalEdit` module is used to handle normal('inline, dialog, external') editing actions.\n * @hidden\n */\nvar NormalEdit = /** @class */ (function () {\n    function NormalEdit(parent, serviceLocator, renderer) {\n        this.args = {};\n        this.parent = parent;\n        this.renderer = renderer;\n        this.serviceLocator = serviceLocator;\n        this.addEventListener();\n    }\n    NormalEdit.prototype.clickHandler = function (e) {\n        var target = e.target;\n        var gObj = this.parent;\n        if ((((parentsUntil(target, 'e-gridcontent') &&\n            parentsUntil(parentsUntil(target, 'e-gridcontent'), 'e-grid').id === gObj.element.id)) || (gObj.frozenRows\n            && parentsUntil(target, 'e-headercontent'))) && !parentsUntil(target, 'e-unboundcelldiv')) {\n            this.rowIndex = parentsUntil(target, 'e-rowcell') ? parseInt(target.parentElement.getAttribute('aria-rowindex'), 10) : -1;\n            if (gObj.isEdit) {\n                gObj.editModule.endEdit();\n            }\n        }\n    };\n    NormalEdit.prototype.dblClickHandler = function (e) {\n        if (parentsUntil(e.target, 'e-rowcell') && this.parent.editSettings.allowEditOnDblClick) {\n            this.parent.editModule.startEdit(parentsUntil(e.target, 'e-row'));\n        }\n    };\n    /**\n     * The function used to trigger editComplete\n     * @return {void}\n     * @hidden\n     */\n    NormalEdit.prototype.editComplete = function (e) {\n        this.parent.isEdit = false;\n        var action = 'action';\n        if (isBlazor() && !this.parent.isJsComponent) {\n            e.rows = null;\n        }\n        switch (e.requestType) {\n            case 'save':\n                if (!(this.parent.isCheckBoxSelection || this.parent.selectionSettings.type === 'Multiple')\n                    || (!this.parent.isPersistSelection)) {\n                    if (e[action] !== 'edit') {\n                        this.parent.selectRow(0);\n                    }\n                }\n                this.parent.trigger(events.actionComplete, extend(e, {\n                    requestType: 'save',\n                    type: events.actionComplete\n                }));\n                break;\n            case 'delete':\n                if (isBlazor() && !this.parent.isJsComponent) {\n                    var d = 'data';\n                    e[d] = e[d][0];\n                }\n                this.parent.trigger(events.actionComplete, extend(e, {\n                    requestType: 'delete',\n                    type: events.actionComplete\n                }));\n                this.parent.selectRow(this.editRowIndex);\n                break;\n        }\n    };\n    NormalEdit.prototype.startEdit = function (tr) {\n        var _this = this;\n        var gObj = this.parent;\n        var primaryKeys = gObj.getPrimaryKeyFieldNames();\n        var primaryKeyValues = [];\n        this.rowIndex = this.editRowIndex = parseInt(tr.getAttribute('aria-rowindex'), 10);\n        if (isBlazor()) {\n            var cols = this.parent.getColumns();\n            for (var i = 0; i < cols.length; i++) {\n                var col = cols[i];\n                if (col.template) {\n                    resetBlazorTemplate(gObj.element.id + col.uid, 'Template', this.rowIndex);\n                }\n            }\n        }\n        if (isGroupAdaptive(gObj)) {\n            var rObj = gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n            this.previousData = rObj.data;\n        }\n        else {\n            this.previousData = gObj.getCurrentViewRecords()[this.rowIndex];\n        }\n        for (var i = 0; i < primaryKeys.length; i++) {\n            primaryKeyValues.push(getObject(primaryKeys[i], this.previousData));\n        }\n        this.uid = tr.getAttribute('data-uid');\n        var rowObj = gObj.getRowObjectFromUID(this.uid);\n        var args = {\n            primaryKey: primaryKeys, primaryKeyValue: primaryKeyValues, requestType: 'beginEdit',\n            rowData: this.previousData, rowIndex: this.rowIndex, type: 'edit', cancel: false,\n            foreignKeyData: rowObj && rowObj.foreignKeyData, target: undefined\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            args.row = tr;\n        }\n        gObj.trigger(events.beginEdit, args, function (begineditargs) {\n            begineditargs.type = 'actionBegin';\n            gObj.trigger(events.actionBegin, begineditargs, function (editargs) {\n                if (!editargs.cancel) {\n                    var cloneRow = 'cloneRow';\n                    var frozen = 'frozen';\n                    var cloneFrozen = 'cloneFrozen';\n                    gObj.isEdit = true;\n                    editargs.row = editargs.row ? editargs.row : tr;\n                    if (isBlazor() && gObj.isServerRendered) {\n                        _this.originalRow = editargs.row;\n                        _this.cloneRow = editargs.row.cloneNode(true);\n                        editargs[cloneRow] = _this.cloneRow;\n                    }\n                    if (gObj.editSettings.mode !== 'Dialog') {\n                        gObj.clearSelection();\n                    }\n                    if (gObj.editSettings.mode === 'Dialog' && gObj.selectionModule) {\n                        gObj.selectionModule.preventFocus = true;\n                        editargs.row.classList.add('e-dlgeditrow');\n                    }\n                    _this.renderer.update(editargs);\n                    if (isBlazor()) {\n                        editargs.form = null;\n                        _this.cloneFrozen = editargs[cloneFrozen];\n                        _this.frozen = editargs[frozen];\n                        _this.cloneRow = editargs[cloneRow];\n                        _this.originalRow = editargs.row;\n                    }\n                    _this.uid = tr.getAttribute('data-uid');\n                    gObj.editModule.applyFormValidation();\n                    editargs.type = 'actionComplete';\n                    gObj.trigger(events.actionComplete, editargs);\n                    _this.args = editargs;\n                    if (_this.parent.allowTextWrap) {\n                        _this.parent.notify(events.freezeRender, { case: 'textwrap' });\n                    }\n                    if (isBlazor()) {\n                        _this.parent.notify(events.toolbarRefresh, {});\n                        gObj.element.querySelector('.e-gridpopup').style.display = 'none';\n                        _this.parent.notify('start-edit', {});\n                    }\n                }\n            });\n        });\n    };\n    NormalEdit.prototype.updateRow = function (index, data) {\n        var _this = this;\n        var gObj = this.parent;\n        var args = {\n            requestType: 'save', type: events.actionBegin, data: data, cancel: false,\n            previousData: gObj.getCurrentViewRecords()[index],\n            row: gObj.getRowByIndex(index)\n        };\n        gObj.showSpinner();\n        gObj.notify(events.updateData, args);\n        if (args.promise) {\n            args.promise.then(function () { return gObj.refresh(); }).catch(function (e) { return _this.edFail(e); });\n        }\n        else {\n            gObj.refresh();\n        }\n    };\n    NormalEdit.prototype.editFormValidate = function () {\n        var gObj = this.parent;\n        var form1 = gObj.editModule.formObj.validate();\n        var form2 = gObj.editModule.mFormObj ? gObj.editModule.mFormObj.validate() : true;\n        return (form1 && form2);\n    };\n    NormalEdit.prototype.endEdit = function () {\n        var gObj = this.parent;\n        if (!this.parent.isEdit || !this.editFormValidate()) {\n            return;\n        }\n        var editedData = extend({}, {}, this.previousData, true);\n        var args = extend(this.args, {\n            requestType: 'save', type: events.actionBegin, data: editedData, cancel: false,\n            previousData: this.previousData, selectedRow: gObj.selectedRowIndex, foreignKeyData: {}\n        });\n        var isDlg = gObj.editSettings.mode === 'Dialog';\n        var dlgWrapper = document.querySelector('#' + gObj.element.id + '_dialogEdit_wrapper');\n        var dlgForm = isDlg ? dlgWrapper.querySelector('.e-gridform') : gObj.element.querySelector('.e-gridform');\n        editedData = gObj.editModule.getCurrentEditedData(dlgForm, editedData);\n        if (gObj.getFrozenColumns() && gObj.editSettings.mode === 'Normal') {\n            var mForm = gObj.element.querySelector('.e-movableheader').querySelector('.e-gridform');\n            if (gObj.frozenRows && mForm) {\n                editedData = gObj.editModule.getCurrentEditedData(mForm, editedData);\n            }\n            else {\n                editedData = gObj.editModule.getCurrentEditedData(gObj.element.querySelector('.e-movablecontent').querySelector('.e-gridform'), editedData);\n            }\n        }\n        if (isBlazor()) {\n            var form = 'form';\n            var movableForm = 'movableForm';\n            args[form] = null;\n            args[movableForm] = null;\n            args.row = {};\n        }\n        if (isDlg ? dlgWrapper.querySelectorAll('.e-editedrow').length : gObj.element.querySelectorAll('.e-editedrow').length) {\n            args.action = 'edit';\n            gObj.trigger(events.actionBegin, args, function (endEditArgs) {\n                if (endEditArgs.cancel) {\n                    return;\n                }\n                gObj.showSpinner();\n                gObj.notify(events.updateData, endEditArgs);\n            });\n        }\n        else {\n            args.action = 'add';\n            args.selectedRow = 0;\n            args.index = this.addedRowIndex;\n            gObj.notify(events.modelChanged, args);\n            this.addedRowIndex = null;\n            if (args.cancel) {\n                return;\n            }\n        }\n    };\n    NormalEdit.prototype.destroyElements = function () {\n        var gObj = this.parent;\n        gObj.editModule.destroyWidgets();\n        gObj.editModule.destroyForm();\n        this.parent.notify(events.dialogDestroy, {});\n    };\n    NormalEdit.prototype.editHandler = function (args) {\n        var _this = this;\n        if (args.promise) {\n            args.promise.then(function (e) { return _this.edSucc(e, args); }).catch(function (e) { return _this.edFail(e); });\n        }\n        else {\n            this.editSuccess(args.data, args);\n        }\n    };\n    NormalEdit.prototype.edSucc = function (e, args) {\n        this.editSuccess(e, args);\n    };\n    NormalEdit.prototype.edFail = function (e) {\n        this.editFailure(e);\n    };\n    NormalEdit.prototype.updateCurrentViewData = function (data) {\n        this.parent.getCurrentViewRecords()[this.editRowIndex] = data;\n    };\n    NormalEdit.prototype.requestSuccess = function (args) {\n        if (this.parent.editModule.formObj && !this.parent.editModule.formObj.isDestroyed) {\n            this.destroyElements();\n            this.stopEditStatus();\n            if (this.parent.editSettings.mode === 'Dialog' && args.action !== 'add') {\n                this.parent.element.querySelector('.e-dlgeditrow').classList.remove('e-dlgeditrow');\n            }\n        }\n    };\n    NormalEdit.prototype.editSuccess = function (e, args) {\n        if (!isNullOrUndefined(e) && !(e instanceof Array)) {\n            var rowData = 'rowData';\n            args.data = extend({}, extend({}, args[rowData], args.data), e);\n        }\n        var editArgs;\n        this.requestSuccess(args);\n        this.parent.trigger(events.beforeDataBound, args);\n        args.type = events.actionComplete;\n        this.parent.isEdit = false;\n        if (isBlazor() && this.parent.isServerRendered) {\n            this.closeForm();\n            var rowIndex = 'rowIndex';\n            var action = 'action';\n            editArgs = { requestType: args.requestType,\n                rowIndex: args[rowIndex], action: args[action] };\n            this.parent.notify('editsuccess', editArgs);\n        }\n        else {\n            this.refreshRow(args.data);\n        }\n        this.parent.editModule.checkLastRow(args.row);\n        this.parent.editModule.isLastRow = false;\n        this.updateCurrentViewData(args.data);\n        this.blazorTemplate();\n        if (!(isBlazor() && this.parent.isServerRendered)) {\n            this.parent.trigger(events.actionComplete, args);\n        }\n        if (isBlazor()) {\n            this.parent.notify(events.toolbarRefresh, {});\n        }\n        if (!(this.parent.isCheckBoxSelection || this.parent.selectionSettings.type === 'Multiple')\n            || (!this.parent.isPersistSelection)) {\n            if (this.parent.editSettings.mode !== 'Dialog') {\n                this.parent.selectRow(this.rowIndex > -1 ? this.rowIndex : this.editRowIndex);\n                if (isBlazor() && this.parent.isServerRendered) {\n                    var rowIndex = 'editRowIndex';\n                    editArgs[rowIndex] = this.rowIndex > -1 ? this.rowIndex : this.editRowIndex;\n                }\n            }\n        }\n        this.parent.hideSpinner();\n    };\n    NormalEdit.prototype.closeForm = function () {\n        if (!this.cloneRow && this.parent.isEdit) {\n            this.stopEditStatus();\n        }\n        if (this.cloneRow) {\n            this.cloneRow.remove();\n            this.originalRow.classList.remove('e-hiddenrow');\n        }\n        if (this.parent.getFrozenColumns() && this.cloneFrozen) {\n            this.cloneFrozen.remove();\n            this.frozen.classList.remove('e-hiddenrow');\n        }\n    };\n    NormalEdit.prototype.blazorTemplate = function () {\n        var cols = this.parent.getColumns();\n        if (this.parent.editSettings.template && this.parent.editSettings.mode === 'Normal') {\n            updateBlazorTemplate(this.parent.element.id + 'editSettingsTemplate', 'Template', this.parent.editSettings);\n        }\n        for (var i = 0; i < cols.length; i++) {\n            var col = cols[i];\n            if (col.template) {\n                updateBlazorTemplate(this.parent.element.id + col.uid, 'Template', col, false);\n            }\n            if (col.editTemplate) {\n                updateBlazorTemplate(this.parent.element.id + col.uid + 'editTemplate', 'EditTemplate', col);\n            }\n        }\n    };\n    NormalEdit.prototype.editFailure = function (e) {\n        this.parent.trigger(events.actionFailure, ((isBlazor() && e instanceof Array) ? e[0] : e));\n        this.parent.hideSpinner();\n        this.parent.log('actionfailure', { error: e });\n    };\n    NormalEdit.prototype.refreshRow = function (data) {\n        var frzCols = this.parent.getFrozenColumns();\n        var row = new RowRenderer(this.serviceLocator, null, this.parent);\n        var rowObj = this.parent.getRowObjectFromUID(this.uid);\n        if (rowObj) {\n            rowObj.changes = data;\n            refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n            row.refresh(rowObj, this.parent.getColumns(), true);\n            if (frzCols) {\n                var uid = void 0;\n                var tr = this.parent.element.querySelector('[data-uid=' + rowObj.uid + ']');\n                if ((parentsUntil(tr, 'e-frozencontent')) || (parentsUntil(tr, 'e-frozenheader'))) {\n                    uid = this.parent.getMovableRows()[rowObj.index].getAttribute('data-uid');\n                }\n                else {\n                    uid = this.parent.getRows()[rowObj.index].getAttribute('data-uid');\n                }\n                rowObj = this.parent.getRowObjectFromUID(uid);\n                rowObj.changes = data;\n                row.refresh(rowObj, this.parent.columns, true);\n                this.parent.editModule.checkLastRow(tr);\n            }\n        }\n    };\n    NormalEdit.prototype.closeEdit = function () {\n        var _this = this;\n        if (!this.parent.isEdit) {\n            return;\n        }\n        var gObj = this.parent;\n        var args = extend(this.args, {\n            requestType: 'cancel', type: events.actionBegin, data: this.previousData, selectedRow: gObj.selectedRowIndex\n        });\n        this.blazorTemplate();\n        if (isBlazor()) {\n            var form = 'form';\n            args[form] = null;\n        }\n        gObj.trigger(events.actionBegin, args, function (closeEditArgs) {\n            if (_this.parent.editSettings.mode === 'Dialog') {\n                _this.parent.notify(events.dialogDestroy, {});\n            }\n            gObj.isEdit = false;\n            _this.stopEditStatus();\n            closeEditArgs.type = events.actionComplete;\n            if (gObj.editSettings.mode !== 'Dialog') {\n                if (isBlazor() && gObj.isServerRendered) {\n                    _this.closeForm();\n                }\n                else {\n                    _this.refreshRow(closeEditArgs.data);\n                }\n            }\n            if (!gObj.getContentTable().querySelector('tr.e-emptyrow') &&\n                !gObj.getContentTable().querySelector('tr.e-row')) {\n                gObj.renderModule.emptyRow();\n            }\n            if (gObj.editSettings.mode !== 'Dialog') {\n                gObj.selectRow(_this.rowIndex);\n            }\n            gObj.trigger(events.actionComplete, closeEditArgs);\n            if (isBlazor()) {\n                _this.parent.notify(events.toolbarRefresh, {});\n                _this.parent.notify('close-edit', {});\n            }\n        });\n    };\n    NormalEdit.prototype.addRecord = function (data, index) {\n        var _this = this;\n        var gObj = this.parent;\n        this.addedRowIndex = index = !isNullOrUndefined(index) ? index : 0;\n        if (data) {\n            gObj.notify(events.modelChanged, {\n                requestType: 'save', type: events.actionBegin, data: data, selectedRow: 0, action: 'add', index: index\n            });\n            return;\n        }\n        if (gObj.isEdit) {\n            return;\n        }\n        this.previousData = {};\n        this.uid = '';\n        (gObj.columnModel).forEach(function (col) {\n            if (col.field) {\n                DataUtil.setValue(col.field, col.defaultValue, _this.previousData);\n            }\n        });\n        var args = {\n            cancel: false, foreignKeyData: {},\n            requestType: 'add', data: this.previousData, type: events.actionBegin, index: index,\n            rowData: this.previousData, target: undefined\n        };\n        if (isBlazor()) {\n            var form = 'form';\n            args[form] = null;\n        }\n        gObj.trigger(events.actionBegin, args, function (addArgs) {\n            if (addArgs.cancel) {\n                return;\n            }\n            gObj.isEdit = true;\n            if (gObj.editSettings.mode !== 'Dialog') {\n                gObj.clearSelection();\n            }\n            _this.renderer.addNew(addArgs);\n            gObj.editModule.applyFormValidation();\n            addArgs.type = events.actionComplete;\n            addArgs.row = gObj.element.querySelector('.e-addedrow');\n            gObj.trigger(events.actionComplete, addArgs);\n            if (isBlazor()) {\n                _this.parent.notify(events.toolbarRefresh, {});\n                _this.parent.notify('start-add', {});\n            }\n            _this.args = addArgs;\n        });\n    };\n    NormalEdit.prototype.deleteRecord = function (fieldname, data) {\n        this.editRowIndex = this.parent.selectedRowIndex;\n        if (data) {\n            data = (data instanceof Array) ? data : [data];\n            var gObj = this.parent;\n            var index = 0;\n            var dataLen = Object.keys(data).length;\n            fieldname = fieldname || this.parent.getPrimaryKeyFieldNames()[0];\n            var _loop_1 = function (i) {\n                var _a;\n                var tmpRecord;\n                var contained = gObj.currentViewData.some(function (record) {\n                    tmpRecord = record;\n                    return data[i] === getObject(fieldname, record) || data[i] === record;\n                });\n                data[i] = contained ? tmpRecord : (_a = {}, _a[fieldname] = data[i], _a);\n            };\n            for (var i = 0; i < dataLen; i++) {\n                _loop_1(i);\n            }\n        }\n        var args = {\n            requestType: 'delete', type: events.actionBegin, foreignKeyData: {},\n            data: data ? data : this.parent.getSelectedRecords(), tr: this.parent.getSelectedRows(), cancel: false\n        };\n        var dataInString = 'data';\n        if (isBlazor() && !this.parent.isJsComponent) {\n            args[dataInString] = args[dataInString][0];\n        }\n        this.parent.notify(events.modelChanged, args);\n    };\n    NormalEdit.prototype.stopEditStatus = function () {\n        var gObj = this.parent;\n        var elem = gObj.element.querySelector('.e-addedrow');\n        var mElem;\n        var editMElem;\n        if (gObj.getFrozenColumns()) {\n            mElem = gObj.element.querySelectorAll('.e-addedrow')[1];\n            editMElem = gObj.element.querySelectorAll('.e-editedrow')[1];\n            if (mElem) {\n                remove(mElem);\n            }\n            if (editMElem) {\n                editMElem.classList.remove('e-editedrow');\n            }\n        }\n        if (elem) {\n            remove(elem);\n        }\n        elem = gObj.element.querySelector('.e-editedrow');\n        if (elem) {\n            elem.classList.remove('e-editedrow');\n        }\n    };\n    /**\n     * @hidden\n     */\n    NormalEdit.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.crudAction, this.editHandler, this);\n        this.parent.on(events.doubleTap, this.dblClickHandler, this);\n        this.parent.on(events.click, this.clickHandler, this);\n        this.parent.on(events.recordAdded, this.requestSuccess, this);\n        this.parent.on(events.dblclick, this.dblClickHandler, this);\n        this.parent.on(events.deleteComplete, this.editComplete, this);\n        this.parent.on(events.saveComplete, this.editComplete, this);\n        this.parent.on('closeinline', this.closeForm, this);\n    };\n    /**\n     * @hidden\n     */\n    NormalEdit.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.crudAction, this.editHandler);\n        this.parent.off(events.doubleTap, this.dblClickHandler);\n        this.parent.off(events.click, this.clickHandler);\n        this.parent.off(events.recordAdded, this.requestSuccess);\n        this.parent.off(events.dblclick, this.dblClickHandler);\n        this.parent.off(events.deleteComplete, this.editComplete);\n        this.parent.off(events.saveComplete, this.editComplete);\n        this.parent.off('closeinline', this.closeForm);\n    };\n    /**\n     * @hidden\n     */\n    NormalEdit.prototype.destroy = function () {\n        this.removeEventListener();\n        this.renderer.destroy();\n    };\n    return NormalEdit;\n}());\nexport { NormalEdit };\n"]},"metadata":{},"sourceType":"module"}