{"ast":null,"code":"/* tslint:disable-next-line:max-line-length */\nimport { EventHandler, isNullOrUndefined, extend, classList, addClass, removeClass, Browser, getValue, setValue, isBlazor } from '@syncfusion/ej2-base';\nimport { parentsUntil, getUid, appendChildren, getDatePredicate, getObject, extendObjWithFn } from '../base/util';\nimport { remove, debounce } from '@syncfusion/ej2-base';\nimport { DataUtil, Query, DataManager, Predicate, UrlAdaptor, Deferred } from '@syncfusion/ej2-data';\nimport { createCheckBox } from '@syncfusion/ej2-buttons';\nimport * as events from '../base/constant';\nimport { ValueFormatter } from '../services/value-formatter';\nimport { getForeignData } from '../base/util';\nimport { Dialog } from '@syncfusion/ej2-popups';\nimport { Input } from '@syncfusion/ej2-inputs';\nimport { createSpinner, hideSpinner, showSpinner } from '@syncfusion/ej2-popups';\nimport { getFilterMenuPostion, toogleCheckbox, createCboxWithWrap, removeAddCboxClasses, getColumnByForeignKeyValue } from '../base/util';\n/**\n * @hidden\n * `CheckBoxFilterBase` module is used to handle filtering action.\n */\n\nvar CheckBoxFilterBase =\n/** @class */\nfunction () {\n  /**\n   * Constructor for checkbox filtering module\n   * @hidden\n   */\n  function CheckBoxFilterBase(parent) {\n    this.existingPredicate = {};\n    this.foreignKeyQuery = new Query();\n    this.filterState = true;\n    this.values = {};\n    this.renderEmpty = false;\n    this.parent = parent;\n    this.id = this.parent.element.id;\n    this.valueFormatter = new ValueFormatter(this.parent.locale);\n    this.cBoxTrue = createCheckBox(this.parent.createElement, false, {\n      checked: true,\n      label: ' '\n    });\n    this.cBoxFalse = createCheckBox(this.parent.createElement, false, {\n      checked: false,\n      label: ' '\n    });\n    this.cBoxTrue.insertBefore(this.parent.createElement('input', {\n      className: 'e-chk-hidden',\n      attrs: {\n        type: 'checkbox'\n      }\n    }), this.cBoxTrue.firstChild);\n    this.cBoxFalse.insertBefore(this.parent.createElement('input', {\n      className: 'e-chk-hidden',\n      attrs: {\n        'type': 'checkbox'\n      }\n    }), this.cBoxFalse.firstChild);\n    this.cBoxFalse.querySelector('.e-frame').classList.add('e-uncheck');\n\n    if (this.parent.enableRtl) {\n      addClass([this.cBoxTrue, this.cBoxFalse], ['e-rtl']);\n    }\n  }\n  /**\n   * To destroy the filter bar.\n   * @return {void}\n   * @hidden\n   */\n\n\n  CheckBoxFilterBase.prototype.destroy = function () {\n    this.closeDialog();\n  };\n\n  CheckBoxFilterBase.prototype.wireEvents = function () {\n    EventHandler.add(this.dlg, 'click', this.clickHandler, this);\n    this.searchHandler = debounce(this.searchBoxKeyUp, 200);\n    EventHandler.add(this.dlg.querySelector('.e-searchinput'), 'keyup', this.searchHandler, this);\n  };\n\n  CheckBoxFilterBase.prototype.unWireEvents = function () {\n    EventHandler.remove(this.dlg, 'click', this.clickHandler);\n    var elem = this.dlg.querySelector('.e-searchinput');\n\n    if (elem) {\n      EventHandler.remove(elem, 'keyup', this.searchHandler);\n    }\n  };\n\n  CheckBoxFilterBase.prototype.foreignKeyFilter = function (args, fColl, mPredicate) {\n    var _this = this;\n\n    var fPredicate = {};\n    var filterCollection = [];\n    var query = this.foreignKeyQuery.clone();\n    this.options.column.dataSource.executeQuery(query.where(mPredicate)).then(function (e) {\n      _this.options.column.columnData = e.result;\n\n      _this.parent.notify(events.generateQuery, {\n        predicate: fPredicate,\n        column: _this.options.column\n      });\n\n      args.ejpredicate = fPredicate.predicate.predicates;\n      fPredicate.predicate.predicates.forEach(function (fpred) {\n        filterCollection.push({\n          field: fpred.field,\n          predicate: 'or',\n          matchCase: fpred.ignoreCase,\n          ignoreAccent: fpred.ignoreAccent,\n          operator: fpred.operator,\n          value: fpred.value,\n          type: _this.options.type\n        });\n      });\n      args.filterCollection = filterCollection.length ? filterCollection : fColl.filter(function (col) {\n        return col.field = _this.options.field;\n      });\n\n      _this.options.handler(args);\n    });\n  };\n\n  CheckBoxFilterBase.prototype.foreignFilter = function (args, value) {\n    var operator = this.options.isRemote ? this.options.column.type === 'string' ? 'contains' : 'equal' : this.options.column.type ? 'startswith' : 'contains';\n    var initalPredicate = new Predicate(this.options.column.foreignKeyValue, operator, value, true, this.options.ignoreAccent);\n    this.foreignKeyFilter(args, [args.filterCollection], initalPredicate);\n  };\n\n  CheckBoxFilterBase.prototype.searchBoxClick = function (e) {\n    var target = e.target;\n\n    if (target.classList.contains('e-searchclear')) {\n      this.sInput.value = '';\n      this.refreshCheckboxes();\n      this.updateSearchIcon();\n      this.sInput.focus();\n    }\n  };\n\n  CheckBoxFilterBase.prototype.searchBoxKeyUp = function (e) {\n    this.refreshCheckboxes();\n    this.updateSearchIcon();\n  };\n\n  CheckBoxFilterBase.prototype.updateSearchIcon = function () {\n    if (this.sInput.value.length) {\n      classList(this.sIcon, ['e-chkcancel-icon'], ['e-search-icon']);\n    } else {\n      classList(this.sIcon, ['e-search-icon'], ['e-chkcancel-icon']);\n    }\n  };\n  /**\n   * Gets the localized label by locale keyword.\n   * @param  {string} key\n   * @return {string}\n   */\n\n\n  CheckBoxFilterBase.prototype.getLocalizedLabel = function (key) {\n    return this.localeObj.getConstant(key);\n  };\n\n  CheckBoxFilterBase.prototype.updateDataSource = function () {\n    var dataSource = this.options.dataSource;\n    var str = 'object';\n\n    if (!(dataSource instanceof DataManager)) {\n      for (var i = 0; i < dataSource.length; i++) {\n        if (typeof dataSource !== str) {\n          var obj = {};\n          obj[this.options.field] = dataSource[i];\n          dataSource[i] = obj;\n        }\n      }\n    }\n  };\n\n  CheckBoxFilterBase.prototype.updateModel = function (options) {\n    this.options = options;\n    this.existingPredicate = options.actualPredicate || {};\n    this.options.dataSource = options.dataSource;\n    this.options.dataManager = options.dataManager ? options.dataManager : options.dataSource;\n    this.updateDataSource();\n    this.options.type = options.type;\n    this.options.format = options.format || '';\n    this.options.ignoreAccent = options.ignoreAccent || false;\n    this.options.filteredColumns = options.filteredColumns || this.parent.filterSettings.columns;\n    this.options.query = options.query || new Query();\n    this.options.allowCaseSensitive = options.allowCaseSensitive || false;\n    this.options.uid = options.column.uid;\n    this.values = {};\n    this.localeObj = options.localeObj;\n    this.isFiltered = options.filteredColumns.length;\n  };\n\n  CheckBoxFilterBase.prototype.getAndSetChkElem = function (options) {\n    this.dlg = this.parent.createElement('div', {\n      id: this.id + this.options.type + '_excelDlg',\n      className: 'e-checkboxfilter e-filter-popup'\n    });\n    this.sBox = this.parent.createElement('div', {\n      className: 'e-searchcontainer'\n    });\n\n    if (!options.hideSearchbox) {\n      this.sInput = this.parent.createElement('input', {\n        id: this.id + '_SearchBox',\n        className: 'e-searchinput'\n      });\n      this.sIcon = this.parent.createElement('span', {\n        className: 'e-searchclear e-search-icon e-icons e-input-group-icon',\n        attrs: {\n          type: 'text',\n          title: this.getLocalizedLabel('Search')\n        }\n      });\n      this.searchBox = this.parent.createElement('span', {\n        className: 'e-searchbox e-fields'\n      });\n      this.searchBox.appendChild(this.sInput);\n      this.sBox.appendChild(this.searchBox);\n      var inputargs = {\n        element: this.sInput,\n        floatLabelType: 'Never',\n        properties: {\n          placeholder: this.getLocalizedLabel('Search')\n        }\n      };\n      Input.createInput(inputargs, this.parent.createElement);\n      this.searchBox.querySelector('.e-input-group').appendChild(this.sIcon);\n    }\n\n    this.spinner = this.parent.createElement('div', {\n      className: 'e-spinner'\n    }); //for spinner\n\n    this.cBox = this.parent.createElement('div', {\n      id: this.id + this.options.type + '_CheckBoxList',\n      className: 'e-checkboxlist e-fields'\n    });\n    this.spinner.appendChild(this.cBox);\n    this.sBox.appendChild(this.spinner);\n    return this.sBox;\n  };\n\n  CheckBoxFilterBase.prototype.showDialog = function (options) {\n    var args = {\n      requestType: events.filterBeforeOpen,\n      columnName: this.options.field,\n      columnType: this.options.type,\n      cancel: false\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      var filterModel = 'filterModel';\n      args[filterModel] = this;\n    }\n\n    this.parent.notify(events.cBoxFltrBegin, args);\n\n    if (args.cancel) {\n      return;\n    }\n\n    this.dialogObj = new Dialog({\n      visible: false,\n      content: this.sBox,\n      close: this.closeDialog.bind(this),\n      width: !isNullOrUndefined(parentsUntil(options.target, 'e-bigger')) || this.parent.element.classList.contains('e-device') ? 260 : 255,\n      target: this.parent.element,\n      animationSettings: {\n        effect: 'None'\n      },\n      buttons: [{\n        click: this.btnClick.bind(this),\n        buttonModel: {\n          content: this.getLocalizedLabel(this.isExcel ? 'OKButton' : 'FilterButton'),\n          cssClass: 'e-primary',\n          isPrimary: true\n        }\n      }, {\n        click: this.btnClick.bind(this),\n        buttonModel: {\n          cssClass: 'e-flat',\n          content: this.getLocalizedLabel(this.isExcel ? 'CancelButton' : 'ClearButton')\n        }\n      }],\n      created: this.dialogCreated.bind(this),\n      open: this.dialogOpen.bind(this)\n    });\n    var isStringTemplate = 'isStringTemplate';\n    this.dialogObj[isStringTemplate] = true;\n    this.dlg.setAttribute('aria-label', this.getLocalizedLabel('ExcelFilterDialogARIA'));\n    this.dialogObj.appendTo(this.dlg);\n    this.dialogObj.element.style.maxHeight = this.options.height + 'px';\n    this.dialogObj.show();\n    this.wireEvents();\n    createSpinner({\n      target: this.spinner\n    }, this.parent.createElement);\n    showSpinner(this.spinner);\n    this.getAllData();\n  };\n\n  CheckBoxFilterBase.prototype.dialogCreated = function (e) {\n    if (!Browser.isDevice) {\n      getFilterMenuPostion(this.options.target, this.dialogObj, this.parent);\n    } else {\n      this.dialogObj.position = {\n        X: 'center',\n        Y: 'center'\n      };\n    }\n\n    this.parent.notify(events.filterDialogCreated, e);\n  };\n\n  CheckBoxFilterBase.prototype.openDialog = function (options) {\n    this.updateModel(options);\n    this.getAndSetChkElem(options);\n    this.showDialog(options);\n  };\n\n  CheckBoxFilterBase.prototype.closeDialog = function () {\n    if (this.dialogObj && !this.dialogObj.isDestroyed) {\n      var filterTemplateCol = this.options.columns.filter(function (col) {\n        return col.getFilterItemTemplate();\n      });\n\n      if (filterTemplateCol.length) {\n        this.parent.destroyTemplate(['filterItemTemplate']);\n      }\n\n      this.parent.notify(events.filterMenuClose, {\n        field: this.options.field\n      });\n      this.dialogObj.destroy();\n      this.unWireEvents();\n      remove(this.dlg);\n      this.dlg = null;\n    }\n  };\n\n  CheckBoxFilterBase.prototype.clearFilter = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var args = {\n      instance: this,\n      handler: this.clearFilter,\n      cancel: false\n    };\n    this.parent.notify(events.fltrPrevent, args);\n\n    if (args.cancel) {\n      return;\n    }\n\n    this.options.handler({\n      action: 'clear-filter',\n      field: this.options.field\n    });\n  };\n\n  CheckBoxFilterBase.prototype.btnClick = function (e) {\n    if (this.filterState) {\n      if (e.target.tagName.toLowerCase() === 'input') {\n        var value = e.target.value;\n\n        if (this.options.column.type === 'boolean') {\n          if (value !== undefined && this.getLocalizedLabel('FilterTrue').toLowerCase().indexOf(value.toLowerCase()) !== -1) {\n            value = 'true';\n          } else if (value !== undefined && this.getLocalizedLabel('FilterFalse').toLowerCase().indexOf(value.toLowerCase()) !== -1) {\n            value = 'false';\n          }\n        }\n\n        var args = {\n          action: 'filtering',\n          filterCollection: {\n            field: this.options.field,\n            operator: this.options.isRemote ? this.options.column.type === 'string' ? 'contains' : 'equal' : this.options.column.type === 'date' || this.options.column.type === 'datetime' || this.options.column.type === 'boolean' ? 'equal' : 'contains',\n            value: value,\n            matchCase: false,\n            type: this.options.column.type\n          },\n          field: this.options.field\n        };\n        value ? this.isForeignColumn(this.options.column) ? this.foreignFilter(args, value) : this.options.handler(args) : this.closeDialog();\n      } else {\n        var text = e.target.firstChild.textContent.toLowerCase();\n\n        if (this.getLocalizedLabel(this.isExcel ? 'OKButton' : 'FilterButton').toLowerCase() === text) {\n          this.fltrBtnHandler();\n        } else if (this.getLocalizedLabel('ClearButton').toLowerCase() === text) {\n          this.clearFilter();\n        }\n      }\n\n      this.closeDialog();\n    } else if (!(e.target.tagName.toLowerCase() === 'input')) {\n      this.clearFilter();\n      this.closeDialog();\n    }\n  };\n\n  CheckBoxFilterBase.prototype.fltrBtnHandler = function () {\n    var checked = [].slice.call(this.cBox.querySelectorAll('.e-check:not(.e-selectall)'));\n    var optr = 'equal';\n    var searchInput = this.searchBox.querySelector('.e-searchinput');\n    var caseSen = this.options.allowCaseSensitive;\n    var defaults = {\n      field: this.options.field,\n      predicate: 'or',\n      uid: this.options.uid,\n      operator: optr,\n      type: this.options.type,\n      matchCase: caseSen,\n      ignoreAccent: this.options.ignoreAccent\n    };\n    var isNotEqual = this.itemsCnt !== checked.length && this.itemsCnt - checked.length < checked.length;\n\n    if (isNotEqual && searchInput.value === '') {\n      optr = 'notequal';\n      checked = [].slice.call(this.cBox.querySelectorAll('.e-uncheck:not(.e-selectall)'));\n      defaults.predicate = 'and';\n      defaults.operator = 'notequal';\n    }\n\n    var value;\n    var fObj;\n    var coll = [];\n\n    if (checked.length !== this.itemsCnt || searchInput.value && searchInput.value !== '') {\n      for (var i = 0; i < checked.length; i++) {\n        value = this.values[parentsUntil(checked[i], 'e-ftrchk').getAttribute('uid')];\n        fObj = extend({}, {\n          value: value\n        }, defaults);\n\n        if (value && !value.toString().length) {\n          fObj.operator = isNotEqual ? 'notequal' : 'equal';\n        }\n\n        if (value === '' || isNullOrUndefined(value)) {\n          if (this.options.type === 'string') {\n            coll.push({\n              field: defaults.field,\n              ignoreAccent: defaults.ignoreAccent,\n              matchCase: defaults.matchCase,\n              operator: defaults.operator,\n              predicate: defaults.predicate,\n              value: ''\n            });\n          }\n\n          coll.push({\n            field: defaults.field,\n            matchCase: defaults.matchCase,\n            operator: defaults.operator,\n            predicate: defaults.predicate,\n            value: null\n          });\n          coll.push({\n            field: defaults.field,\n            matchCase: defaults.matchCase,\n            operator: defaults.operator,\n            predicate: defaults.predicate,\n            value: undefined\n          });\n        } else {\n          coll.push(fObj);\n        }\n\n        var args = {\n          instance: this,\n          handler: this.fltrBtnHandler,\n          arg1: fObj.field,\n          arg2: fObj.predicate,\n          arg3: fObj.operator,\n          arg4: fObj.matchCase,\n          arg5: fObj.ignoreAccent,\n          arg6: fObj.value,\n          cancel: false\n        };\n        this.parent.notify(events.fltrPrevent, args);\n\n        if (args.cancel) {\n          return;\n        }\n      }\n\n      this.initiateFilter(coll);\n    } else {\n      this.clearFilter();\n    }\n  };\n\n  CheckBoxFilterBase.prototype.initiateFilter = function (fColl) {\n    var firstVal = fColl[0];\n    var predicate;\n\n    if (!isNullOrUndefined(firstVal)) {\n      predicate = firstVal.ejpredicate ? firstVal.ejpredicate : new Predicate(firstVal.field, firstVal.operator, firstVal.value, !firstVal.matchCase, firstVal.ignoreAccent);\n\n      for (var j = 1; j < fColl.length; j++) {\n        predicate = fColl[j].ejpredicate !== undefined ? predicate[fColl[j].predicate](fColl[j].ejpredicate) : predicate[fColl[j].predicate](fColl[j].field, fColl[j].operator, fColl[j].value, !fColl[j].matchCase, fColl[j].ignoreAccent);\n      }\n\n      var args = {\n        action: 'filtering',\n        filterCollection: fColl,\n        field: this.options.field,\n        ejpredicate: Predicate.or(predicate)\n      };\n      this.options.handler(args);\n    }\n  };\n\n  CheckBoxFilterBase.prototype.isForeignColumn = function (col) {\n    return col.isForeignColumn ? col.isForeignColumn() : false;\n  };\n\n  CheckBoxFilterBase.prototype.refreshCheckboxes = function () {\n    var _this = this;\n\n    var val = this.sInput.value;\n    var column = this.options.column;\n    var query = this.isForeignColumn(column) ? this.foreignKeyQuery.clone() : this.options.query.clone();\n    var foreignQuery = this.options.query.clone();\n    var pred = query.queries.filter(function (e) {\n      return e && e.fn === 'onWhere';\n    })[0];\n    query.queries = [];\n    foreignQuery.queries = [];\n    var parsed = this.options.type !== 'string' && parseFloat(val) ? parseFloat(val) : val;\n    var operator = this.options.isRemote ? this.options.type === 'string' ? 'contains' : 'equal' : this.options.type ? 'startswith' : 'contains';\n    var matchCase = true;\n    var ignoreAccent = this.options.ignoreAccent;\n    var field = this.isForeignColumn(column) ? column.foreignKeyValue : column.field;\n    parsed = parsed === '' || parsed === undefined ? undefined : parsed;\n    var predicte;\n    var moduleName = this.options.dataManager.adaptor.getModuleName;\n\n    if (this.options.type === 'boolean') {\n      if (parsed !== undefined && this.getLocalizedLabel('FilterTrue').toLowerCase().indexOf(parsed.toLowerCase()) !== -1 && moduleName) {\n        parsed = moduleName() === 'ODataAdaptor' || 'ODataV4Adaptor' ? true : 'true';\n      } else if (parsed !== undefined && this.getLocalizedLabel('FilterFalse').toLowerCase().indexOf(parsed.toLowerCase()) !== -1 && moduleName) {\n        parsed = moduleName() === 'ODataAdaptor' || 'ODataV4Adaptor' ? false : 'false';\n      }\n\n      operator = 'equal';\n    }\n\n    this.addDistinct(query);\n    /* tslint:disable-next-line:max-line-length */\n\n    var args = {\n      requestType: events.filterSearchBegin,\n      filterModel: this,\n      columnName: field,\n      column: column,\n      operator: operator,\n      matchCase: matchCase,\n      ignoreAccent: ignoreAccent,\n      filterChoiceCount: null,\n      query: query\n    };\n\n    if (isBlazor() && !this.parent.isJsComponent) {\n      var filterModel = 'filterModel';\n      args[filterModel] = {};\n    }\n\n    this.parent.notify(events.cBoxFltrBegin, args);\n    predicte = new Predicate(field, args.operator, parsed, args.matchCase, args.ignoreAccent);\n\n    if (this.options.type === 'date' || this.options.type === 'datetime') {\n      parsed = this.valueFormatter.fromView(val, this.options.parserFn, this.options.type);\n      operator = 'equal';\n\n      if (isNullOrUndefined(parsed) && val.length) {\n        return;\n      }\n\n      var filterObj = {\n        field: field,\n        operator: operator,\n        value: parsed,\n        matchCase: matchCase,\n        ignoreAccent: ignoreAccent\n      };\n      predicte = getDatePredicate(filterObj, this.options.type);\n    }\n\n    if (val.length) {\n      predicte = !isNullOrUndefined(pred) ? predicte.and(pred.e) : predicte;\n      query.where(predicte);\n    } else if (!isNullOrUndefined(pred)) {\n      query.where(pred.e);\n    }\n\n    args.filterChoiceCount = !isNullOrUndefined(args.filterChoiceCount) ? args.filterChoiceCount : 1000;\n    var fPredicate = {};\n    showSpinner(this.spinner);\n    this.renderEmpty = false;\n\n    if (this.isForeignColumn(column) && val.length) {\n      // tslint:disable-next-line:no-any\n      column.dataSource.executeQuery(query).then(function (e) {\n        var columnData = _this.options.column.columnData;\n        _this.options.column.columnData = e.result;\n\n        _this.parent.notify(events.generateQuery, {\n          predicate: fPredicate,\n          column: column\n        });\n\n        if (fPredicate.predicate.predicates.length) {\n          foreignQuery.where(fPredicate.predicate);\n        } else {\n          _this.renderEmpty = true;\n        }\n\n        _this.options.column.columnData = columnData;\n        foreignQuery.take(args.filterChoiceCount);\n\n        _this.search(args, foreignQuery);\n      });\n    } else {\n      query.take(args.filterChoiceCount);\n      this.search(args, query);\n    }\n  };\n\n  CheckBoxFilterBase.prototype.search = function (args, query) {\n    if (this.parent.dataSource && 'result' in this.parent.dataSource) {\n      this.filterEvent(args, query);\n    } else {\n      this.processSearch(query);\n    }\n  };\n\n  CheckBoxFilterBase.prototype.getPredicateFromCols = function (columns) {\n    var predicates = CheckBoxFilterBase.getPredicate(columns);\n    var predicateList = [];\n    var fPredicate = {};\n    var isGrid = this.parent.getForeignKeyColumns !== undefined;\n    var foreignColumn = isGrid ? this.parent.getForeignKeyColumns() : [];\n\n    for (var _i = 0, _a = Object.keys(predicates); _i < _a.length; _i++) {\n      var prop = _a[_i];\n      var col = void 0;\n\n      if (isGrid && this.parent.getColumnByField(prop).isForeignColumn()) {\n        col = getColumnByForeignKeyValue(prop, foreignColumn);\n      }\n\n      if (col) {\n        this.parent.notify(events.generateQuery, {\n          predicate: fPredicate,\n          column: col\n        });\n\n        if (fPredicate.predicate.predicates.length) {\n          predicateList.push(Predicate.or(fPredicate.predicate.predicates));\n        }\n      } else {\n        predicateList.push(predicates[prop]);\n      }\n    }\n\n    return predicateList.length && Predicate.and(predicateList);\n  };\n\n  CheckBoxFilterBase.prototype.getQuery = function () {\n    return this.parent.getQuery ? this.parent.getQuery().clone() : new Query();\n  };\n\n  CheckBoxFilterBase.prototype.getAllData = function () {\n    var _this = this;\n\n    var query = this.getQuery();\n    query.requiresCount(); //consider take query\n\n    this.addDistinct(query);\n    var args = {\n      requestType: events.filterChoiceRequest,\n      query: query,\n      filterChoiceCount: null\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      var filterModel = 'filterModel';\n      args[filterModel] = this;\n    }\n\n    this.parent.trigger(events.actionBegin, args, function (args) {\n      args.filterChoiceCount = !isNullOrUndefined(args.filterChoiceCount) ? args.filterChoiceCount : 1000;\n      query.take(args.filterChoiceCount);\n\n      if (_this.parent.dataSource && 'result' in _this.parent.dataSource) {\n        _this.filterEvent(args, query);\n      } else {\n        _this.processDataOperation(query, true);\n      }\n    });\n  };\n\n  CheckBoxFilterBase.prototype.addDistinct = function (query) {\n    var filteredColumn = DataUtil.distinct(this.options.filteredColumns, 'field');\n\n    if (filteredColumn.indexOf(this.options.column.field) <= -1) {\n      filteredColumn = filteredColumn.concat(this.options.column.field);\n    }\n\n    query.distinct(filteredColumn);\n    return query;\n  };\n\n  CheckBoxFilterBase.prototype.filterEvent = function (args, query) {\n    var _this = this;\n\n    var def = this.eventPromise(args, query);\n    def.promise.then(function (e) {\n      _this.dataSuccess(e);\n    });\n  };\n\n  CheckBoxFilterBase.prototype.eventPromise = function (args, query) {\n    var state;\n    state = this.getStateEventArgument(query);\n    var def = new Deferred();\n    state.dataSource = def.resolve;\n    state.action = args;\n    this.parent.trigger(events.dataStateChange, state);\n    return def;\n  };\n\n  ;\n\n  CheckBoxFilterBase.prototype.getStateEventArgument = function (query) {\n    var adaptr = new UrlAdaptor();\n    var dm = new DataManager({\n      url: '',\n      adaptor: new UrlAdaptor()\n    });\n    var state = adaptr.processQuery(dm, query);\n    var data = JSON.parse(state.data);\n    return data;\n  };\n\n  ;\n\n  CheckBoxFilterBase.prototype.processDataOperation = function (query, isInitial) {\n    var _this = this;\n\n    this.options.dataSource = this.options.dataSource instanceof DataManager ? this.options.dataSource : new DataManager(this.options.dataSource);\n    var allPromise = [];\n    var runArray = [];\n\n    if (this.isForeignColumn(this.options.column) && isInitial) {\n      allPromise.push(this.options.column.dataSource.executeQuery(this.foreignKeyQuery));\n      runArray.push(function (data) {\n        return _this.foreignKeyData = data;\n      });\n    }\n\n    allPromise.push(this.options.dataSource.executeQuery(query));\n    runArray.push(this.dataSuccess.bind(this));\n    var i = 0;\n    Promise.all(allPromise).then(function (e) {\n      e.forEach(function (data) {\n        runArray[i++](data.result);\n      });\n    });\n  };\n\n  CheckBoxFilterBase.prototype.dataSuccess = function (e) {\n    this.fullData = e;\n    var query = new Query();\n\n    if (this.parent.searchSettings && this.parent.searchSettings.key.length) {\n      var sSettings = this.parent.searchSettings;\n      var fields = sSettings.fields.length ? sSettings.fields : this.options.columns.map(function (f) {\n        return f.field;\n      });\n      /* tslint:disable-next-line:max-line-length */\n\n      query.search(sSettings.key, fields, sSettings.operator, sSettings.ignoreCase, sSettings.ignoreAccent);\n    }\n\n    if (this.options.filteredColumns.length) {\n      var cols = [];\n\n      for (var i = 0; i < this.options.filteredColumns.length; i++) {\n        var filterColumn = this.options.filteredColumns[i];\n\n        if (this.options.uid) {\n          filterColumn.uid = filterColumn.uid || this.parent.getColumnByField(filterColumn.field).uid;\n\n          if (filterColumn.uid !== this.options.uid) {\n            cols.push(this.options.filteredColumns[i]);\n          }\n        } else {\n          if (filterColumn.field !== this.options.field) {\n            cols.push(this.options.filteredColumns[i]);\n          }\n        }\n      }\n\n      var predicate = this.getPredicateFromCols(cols);\n\n      if (predicate) {\n        query.where(predicate);\n      }\n    } // query.select(this.options.field);\n\n\n    var result = new DataManager(this.fullData).executeLocal(query);\n    var col = this.options.column;\n    this.filteredData = CheckBoxFilterBase.getDistinct(result, this.options.field, col, this.foreignKeyData).records || [];\n    this.processDataSource(null, true, this.filteredData);\n    this.sInput.focus();\n    var args = {\n      requestType: events.filterAfterOpen,\n      columnName: this.options.field,\n      columnType: this.options.type\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      var filterModel = 'filterModel';\n      args[filterModel] = this;\n    }\n\n    this.parent.notify(events.cBoxFltrComplete, args);\n  };\n\n  CheckBoxFilterBase.prototype.processDataSource = function (query, isInitial, dataSource) {\n    showSpinner(this.spinner); // query = query ? query : this.options.query.clone();\n    // query.requiresCount();\n    // let result: Object = new DataManager(dataSource as JSON[]).executeLocal(query);\n    // let res: { result: Object[] } = result as { result: Object[] };\n\n    this.updateResult();\n    this.createFilterItems(dataSource, isInitial);\n  };\n\n  CheckBoxFilterBase.prototype.processSearch = function (query) {\n    this.processDataOperation(query);\n  };\n\n  CheckBoxFilterBase.prototype.updateResult = function () {\n    this.result = {};\n    var predicate = this.getPredicateFromCols(this.options.filteredColumns);\n    var query = new Query();\n\n    if (predicate) {\n      query.where(predicate);\n    }\n\n    var result = new DataManager(this.fullData).executeLocal(query);\n\n    for (var _i = 0, result_1 = result; _i < result_1.length; _i++) {\n      var res = result_1[_i];\n      this.result[getObject(this.options.field, res)] = true;\n    }\n  };\n\n  CheckBoxFilterBase.prototype.clickHandler = function (e) {\n    var target = e.target;\n    var elem = parentsUntil(target, 'e-checkbox-wrapper');\n\n    if (parentsUntil(target, 'e-searchbox')) {\n      this.searchBoxClick(e);\n    }\n\n    if (elem) {\n      var selectAll = elem.querySelector('.e-selectall');\n\n      if (selectAll) {\n        this.updateAllCBoxes(!selectAll.classList.contains('e-check'));\n      } else {\n        toogleCheckbox(elem.parentElement);\n      }\n\n      this.updateIndeterminatenBtn();\n      elem.querySelector('.e-chk-hidden').focus();\n    }\n  };\n\n  CheckBoxFilterBase.prototype.updateAllCBoxes = function (checked) {\n    var cBoxes = [].slice.call(this.cBox.querySelectorAll('.e-frame'));\n\n    for (var _i = 0, cBoxes_1 = cBoxes; _i < cBoxes_1.length; _i++) {\n      var cBox = cBoxes_1[_i];\n      removeAddCboxClasses(cBox, checked);\n    }\n  };\n\n  CheckBoxFilterBase.prototype.dialogOpen = function () {\n    if (this.parent.element.classList.contains('e-device')) {\n      this.dialogObj.element.querySelector('.e-input-group').classList.remove('e-input-focus');\n      this.dialogObj.element.querySelector('.e-btn').focus();\n    }\n  };\n\n  CheckBoxFilterBase.prototype.createCheckbox = function (value, checked, data) {\n    var elem = checked ? this.cBoxTrue.cloneNode(true) : this.cBoxFalse.cloneNode(true);\n    var label = elem.querySelector('.e-label');\n    var dummyData = extendObjWithFn({}, data, {\n      column: this.options.column,\n      parent: this.parent\n    });\n    label.innerHTML = !isNullOrUndefined(value) && value.toString().length ? value : this.getLocalizedLabel('Blanks');\n    addClass([label], ['e-checkboxfiltertext']);\n\n    if (this.options.template && data[this.options.column.field] !== this.getLocalizedLabel('SelectAll')) {\n      label.innerHTML = '';\n      appendChildren(label, this.options.template(dummyData, this.parent, 'filterItemTemplate'));\n    }\n\n    return elem;\n  };\n\n  CheckBoxFilterBase.prototype.updateIndeterminatenBtn = function () {\n    var cnt = this.cBox.children.length - 1;\n    var className = [];\n    var elem = this.cBox.querySelector('.e-selectall');\n    var selected = this.cBox.querySelectorAll('.e-check:not(.e-selectall)').length;\n    var btn = this.dialogObj.btnObj[0];\n    btn.disabled = false;\n\n    if (cnt === selected) {\n      className = ['e-check'];\n    } else if (selected) {\n      className = ['e-stop'];\n    } else {\n      className = ['e-uncheck'];\n      btn.disabled = true;\n    }\n\n    this.filterState = !btn.disabled;\n    btn.dataBind();\n    removeClass([elem], ['e-check', 'e-stop', 'e-uncheck']);\n    addClass([elem], className);\n  };\n\n  CheckBoxFilterBase.prototype.createFilterItems = function (data, isInitial) {\n    var _a;\n\n    var cBoxes = this.parent.createElement('div');\n    var btn = this.dialogObj.btnObj[0];\n    var nullCounter = -1;\n\n    for (var i = 0; i < data.length; i++) {\n      var val = getValue('ejValue', data[i]);\n\n      if (val === '' || isNullOrUndefined(val)) {\n        nullCounter = nullCounter + 1;\n      }\n    }\n\n    this.itemsCnt = nullCounter !== -1 ? data.length - nullCounter : data.length;\n\n    if (data.length && !this.renderEmpty) {\n      var selectAllValue = this.getLocalizedLabel('SelectAll');\n      var checkBox = this.createCheckbox(selectAllValue, false, (_a = {}, _a[this.options.field] = selectAllValue, _a));\n      var selectAll = createCboxWithWrap(getUid('cbox'), checkBox, 'e-ftrchk');\n      selectAll.querySelector('.e-frame').classList.add('e-selectall');\n      cBoxes.appendChild(selectAll);\n      var predicate = new Predicate('field', 'equal', this.options.field);\n\n      if (this.options.foreignKeyValue) {\n        predicate = predicate.or('field', 'equal', this.options.foreignKeyValue);\n      }\n\n      var isColFiltered = new DataManager(this.options.filteredColumns).executeLocal(new Query().where(predicate)).length;\n      var isRndere = void 0;\n\n      for (var i = 0; i < data.length; i++) {\n        var uid = getUid('cbox');\n        this.values[uid] = getValue('ejValue', data[i]);\n        var value = getValue(this.options.field, data[i]);\n\n        if (this.options.formatFn) {\n          value = this.valueFormatter.toView(value, this.options.formatFn);\n        }\n\n        var args_1 = {\n          value: value,\n          column: this.options.column,\n          data: data[i]\n        };\n        this.parent.notify(events.filterCboxValue, args_1);\n        value = args_1.value;\n\n        if (value === '' || isNullOrUndefined(value)) {\n          if (isRndere) {\n            continue;\n          }\n\n          isRndere = true;\n        }\n\n        var checkbox = this.createCheckbox(value, this.getCheckedState(isColFiltered, this.values[uid]), getValue('dataObj', data[i]));\n        cBoxes.appendChild(createCboxWithWrap(uid, checkbox, 'e-ftrchk'));\n      }\n\n      this.cBox.innerHTML = '';\n      appendChildren(this.cBox, [].slice.call(cBoxes.children));\n      this.updateIndeterminatenBtn();\n      btn.disabled = false;\n    } else {\n      cBoxes.appendChild(this.parent.createElement('span', {\n        innerHTML: this.getLocalizedLabel('NoResult')\n      }));\n      this.cBox.innerHTML = '';\n      appendChildren(this.cBox, [].slice.call(cBoxes.children));\n      btn.disabled = true;\n    }\n\n    this.filterState = !btn.disabled;\n    btn.dataBind();\n    var args = {\n      requestType: events.filterChoiceRequest,\n      dataSource: this.renderEmpty || isBlazor() && this.parent.isServerRendered ? [] : data\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      var filterModel = 'filterModel';\n      args[filterModel] = this;\n    }\n\n    this.parent.notify(events.cBoxFltrComplete, args);\n    hideSpinner(this.spinner);\n  };\n\n  CheckBoxFilterBase.prototype.getCheckedState = function (isColFiltered, value) {\n    if (!this.isFiltered || !isColFiltered) {\n      return true;\n    } else {\n      return this.result[value];\n    }\n  };\n\n  CheckBoxFilterBase.getDistinct = function (json, field, column, foreignKeyData) {\n    var len = json.length;\n    var result = [];\n    var value;\n    var ejValue = 'ejValue';\n    var lookup = {};\n    var isForeignKey = column && column.isForeignColumn ? column.isForeignColumn() : false;\n\n    while (len--) {\n      value = json[len];\n      value = getObject(field, value); //local remote diff, check with mdu   \n\n      if (!(value in lookup)) {\n        var obj = {};\n        obj[ejValue] = value;\n        lookup[value] = true;\n\n        if (isForeignKey) {\n          var foreignDataObj = getForeignData(column, {}, value, foreignKeyData)[0];\n          setValue(events.foreignKeyData, foreignDataObj, json[len]);\n          value = getValue(column.foreignKeyValue, foreignDataObj);\n        }\n\n        setValue(field, isNullOrUndefined(value) ? null : value, obj);\n        setValue('dataObj', json[len], obj);\n        result.push(obj);\n      }\n    }\n\n    return DataUtil.group(DataUtil.sort(result, field, DataUtil.fnAscending), 'ejValue');\n  };\n\n  CheckBoxFilterBase.getPredicate = function (columns) {\n    var cols = DataUtil.distinct(columns, 'field', true) || [];\n    var collection = [];\n    var pred = {};\n\n    for (var i = 0; i < cols.length; i++) {\n      collection = new DataManager(columns).executeLocal(new Query().where('field', 'equal', cols[i].field));\n\n      if (collection.length !== 0) {\n        pred[cols[i].field] = CheckBoxFilterBase.generatePredicate(collection);\n      }\n    }\n\n    return pred;\n  };\n\n  CheckBoxFilterBase.generatePredicate = function (cols) {\n    var len = cols ? cols.length : 0;\n    var predicate;\n    var first;\n    first = CheckBoxFilterBase.updateDateFilter(cols[0]);\n    first.ignoreAccent = !isNullOrUndefined(first.ignoreAccent) ? first.ignoreAccent : false;\n\n    if (first.type === 'date' || first.type === 'datetime') {\n      predicate = getDatePredicate(first, first.type);\n    } else {\n      predicate = first.ejpredicate ? first.ejpredicate : new Predicate(first.field, first.operator, first.value, !CheckBoxFilterBase.getCaseValue(first), first.ignoreAccent);\n    }\n\n    for (var p = 1; p < len; p++) {\n      cols[p] = CheckBoxFilterBase.updateDateFilter(cols[p]);\n\n      if (len > 2 && p > 1 && cols[p].predicate === 'or') {\n        if (cols[p].type === 'date' || cols[p].type === 'datetime') {\n          predicate.predicates.push(getDatePredicate(cols[p], cols[p].type));\n        } else {\n          predicate.predicates.push(new Predicate(cols[p].field, cols[p].operator, cols[p].value, !CheckBoxFilterBase.getCaseValue(cols[p]), cols[p].ignoreAccent));\n        }\n      } else {\n        if (cols[p].type === 'date' || cols[p].type === 'datetime') {\n          predicate = predicate[cols[p].predicate](getDatePredicate(cols[p]), cols[p].type, cols[p].ignoreAccent);\n        } else {\n          /* tslint:disable-next-line:max-line-length */\n          predicate = cols[p].ejpredicate ? predicate[cols[p].predicate](cols[p].ejpredicate) : predicate[cols[p].predicate](cols[p].field, cols[p].operator, cols[p].value, !CheckBoxFilterBase.getCaseValue(cols[p]), cols[p].ignoreAccent);\n        }\n      }\n    }\n\n    return predicate || null;\n  };\n\n  CheckBoxFilterBase.getCaseValue = function (filter) {\n    if (isNullOrUndefined(filter.matchCase)) {\n      return true;\n    } else {\n      return filter.matchCase;\n    }\n  };\n\n  CheckBoxFilterBase.updateDateFilter = function (filter) {\n    if (filter.type === 'date' || filter.type === 'datetime' || filter.value instanceof Date) {\n      filter.type = filter.type || 'date';\n    }\n\n    return filter;\n  };\n\n  return CheckBoxFilterBase;\n}();\n\nexport { CheckBoxFilterBase };","map":{"version":3,"sources":["C:/CN2/workspace-trunk/kain-front-end/node_modules/@syncfusion/ej2-grids/src/grid/common/checkbox-filter-base.js"],"names":["EventHandler","isNullOrUndefined","extend","classList","addClass","removeClass","Browser","getValue","setValue","isBlazor","parentsUntil","getUid","appendChildren","getDatePredicate","getObject","extendObjWithFn","remove","debounce","DataUtil","Query","DataManager","Predicate","UrlAdaptor","Deferred","createCheckBox","events","ValueFormatter","getForeignData","Dialog","Input","createSpinner","hideSpinner","showSpinner","getFilterMenuPostion","toogleCheckbox","createCboxWithWrap","removeAddCboxClasses","getColumnByForeignKeyValue","CheckBoxFilterBase","parent","existingPredicate","foreignKeyQuery","filterState","values","renderEmpty","id","element","valueFormatter","locale","cBoxTrue","createElement","checked","label","cBoxFalse","insertBefore","className","attrs","type","firstChild","querySelector","add","enableRtl","prototype","destroy","closeDialog","wireEvents","dlg","clickHandler","searchHandler","searchBoxKeyUp","unWireEvents","elem","foreignKeyFilter","args","fColl","mPredicate","_this","fPredicate","filterCollection","query","clone","options","column","dataSource","executeQuery","where","then","e","columnData","result","notify","generateQuery","predicate","ejpredicate","predicates","forEach","fpred","push","field","matchCase","ignoreCase","ignoreAccent","operator","value","length","filter","col","handler","foreignFilter","isRemote","initalPredicate","foreignKeyValue","searchBoxClick","target","contains","sInput","refreshCheckboxes","updateSearchIcon","focus","sIcon","getLocalizedLabel","key","localeObj","getConstant","updateDataSource","str","i","obj","updateModel","actualPredicate","dataManager","format","filteredColumns","filterSettings","columns","allowCaseSensitive","uid","isFiltered","getAndSetChkElem","sBox","hideSearchbox","title","searchBox","appendChild","inputargs","floatLabelType","properties","placeholder","createInput","spinner","cBox","showDialog","requestType","filterBeforeOpen","columnName","columnType","cancel","isJsComponent","filterModel","cBoxFltrBegin","dialogObj","visible","content","close","bind","width","animationSettings","effect","buttons","click","btnClick","buttonModel","isExcel","cssClass","isPrimary","created","dialogCreated","open","dialogOpen","isStringTemplate","setAttribute","appendTo","style","maxHeight","height","show","getAllData","isDevice","position","X","Y","filterDialogCreated","openDialog","isDestroyed","filterTemplateCol","getFilterItemTemplate","destroyTemplate","filterMenuClose","clearFilter","instance","fltrPrevent","action","tagName","toLowerCase","undefined","indexOf","isForeignColumn","text","textContent","fltrBtnHandler","slice","call","querySelectorAll","optr","searchInput","caseSen","defaults","isNotEqual","itemsCnt","fObj","coll","getAttribute","toString","arg1","arg2","arg3","arg4","arg5","arg6","initiateFilter","firstVal","j","or","val","foreignQuery","pred","queries","fn","parsed","parseFloat","predicte","moduleName","adaptor","getModuleName","addDistinct","filterSearchBegin","filterChoiceCount","fromView","parserFn","filterObj","and","take","search","filterEvent","processSearch","getPredicateFromCols","getPredicate","predicateList","isGrid","getForeignKeyColumns","foreignColumn","_i","_a","Object","keys","prop","getColumnByField","getQuery","requiresCount","filterChoiceRequest","trigger","actionBegin","processDataOperation","filteredColumn","distinct","concat","def","eventPromise","promise","dataSuccess","state","getStateEventArgument","resolve","dataStateChange","adaptr","dm","url","processQuery","data","JSON","parse","isInitial","allPromise","runArray","foreignKeyData","Promise","all","fullData","searchSettings","sSettings","fields","map","f","cols","filterColumn","executeLocal","filteredData","getDistinct","records","processDataSource","filterAfterOpen","cBoxFltrComplete","updateResult","createFilterItems","result_1","res","selectAll","updateAllCBoxes","parentElement","updateIndeterminatenBtn","cBoxes","cBoxes_1","createCheckbox","cloneNode","dummyData","innerHTML","template","cnt","children","selected","btn","btnObj","disabled","dataBind","nullCounter","selectAllValue","checkBox","isColFiltered","isRndere","formatFn","toView","args_1","filterCboxValue","checkbox","getCheckedState","isServerRendered","json","len","ejValue","lookup","isForeignKey","foreignDataObj","group","sort","fnAscending","collection","generatePredicate","first","updateDateFilter","getCaseValue","p","Date"],"mappings":"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","sourcesContent":["/* tslint:disable-next-line:max-line-length */\nimport { EventHandler, isNullOrUndefined, extend, classList, addClass, removeClass, Browser, getValue, setValue, isBlazor } from '@syncfusion/ej2-base';\nimport { parentsUntil, getUid, appendChildren, getDatePredicate, getObject, extendObjWithFn } from '../base/util';\nimport { remove, debounce } from '@syncfusion/ej2-base';\nimport { DataUtil, Query, DataManager, Predicate, UrlAdaptor, Deferred } from '@syncfusion/ej2-data';\nimport { createCheckBox } from '@syncfusion/ej2-buttons';\nimport * as events from '../base/constant';\nimport { ValueFormatter } from '../services/value-formatter';\nimport { getForeignData } from '../base/util';\nimport { Dialog } from '@syncfusion/ej2-popups';\nimport { Input } from '@syncfusion/ej2-inputs';\nimport { createSpinner, hideSpinner, showSpinner } from '@syncfusion/ej2-popups';\nimport { getFilterMenuPostion, toogleCheckbox, createCboxWithWrap, removeAddCboxClasses, getColumnByForeignKeyValue } from '../base/util';\n/**\n * @hidden\n * `CheckBoxFilterBase` module is used to handle filtering action.\n */\nvar CheckBoxFilterBase = /** @class */ (function () {\n    /**\n     * Constructor for checkbox filtering module\n     * @hidden\n     */\n    function CheckBoxFilterBase(parent) {\n        this.existingPredicate = {};\n        this.foreignKeyQuery = new Query();\n        this.filterState = true;\n        this.values = {};\n        this.renderEmpty = false;\n        this.parent = parent;\n        this.id = this.parent.element.id;\n        this.valueFormatter = new ValueFormatter(this.parent.locale);\n        this.cBoxTrue = createCheckBox(this.parent.createElement, false, { checked: true, label: ' ' });\n        this.cBoxFalse = createCheckBox(this.parent.createElement, false, { checked: false, label: ' ' });\n        this.cBoxTrue.insertBefore(this.parent.createElement('input', {\n            className: 'e-chk-hidden', attrs: { type: 'checkbox' }\n        }), this.cBoxTrue.firstChild);\n        this.cBoxFalse.insertBefore(this.parent.createElement('input', {\n            className: 'e-chk-hidden', attrs: { 'type': 'checkbox' }\n        }), this.cBoxFalse.firstChild);\n        this.cBoxFalse.querySelector('.e-frame').classList.add('e-uncheck');\n        if (this.parent.enableRtl) {\n            addClass([this.cBoxTrue, this.cBoxFalse], ['e-rtl']);\n        }\n    }\n    /**\n     * To destroy the filter bar.\n     * @return {void}\n     * @hidden\n     */\n    CheckBoxFilterBase.prototype.destroy = function () {\n        this.closeDialog();\n    };\n    CheckBoxFilterBase.prototype.wireEvents = function () {\n        EventHandler.add(this.dlg, 'click', this.clickHandler, this);\n        this.searchHandler = debounce(this.searchBoxKeyUp, 200);\n        EventHandler.add(this.dlg.querySelector('.e-searchinput'), 'keyup', this.searchHandler, this);\n    };\n    CheckBoxFilterBase.prototype.unWireEvents = function () {\n        EventHandler.remove(this.dlg, 'click', this.clickHandler);\n        var elem = this.dlg.querySelector('.e-searchinput');\n        if (elem) {\n            EventHandler.remove(elem, 'keyup', this.searchHandler);\n        }\n    };\n    CheckBoxFilterBase.prototype.foreignKeyFilter = function (args, fColl, mPredicate) {\n        var _this = this;\n        var fPredicate = {};\n        var filterCollection = [];\n        var query = this.foreignKeyQuery.clone();\n        this.options.column.dataSource.\n            executeQuery(query.where(mPredicate)).then(function (e) {\n            _this.options.column.columnData = e.result;\n            _this.parent.notify(events.generateQuery, { predicate: fPredicate, column: _this.options.column });\n            args.ejpredicate = fPredicate.predicate.predicates;\n            fPredicate.predicate.predicates.forEach(function (fpred) {\n                filterCollection.push({\n                    field: fpred.field,\n                    predicate: 'or',\n                    matchCase: fpred.ignoreCase,\n                    ignoreAccent: fpred.ignoreAccent,\n                    operator: fpred.operator,\n                    value: fpred.value,\n                    type: _this.options.type\n                });\n            });\n            args.filterCollection = filterCollection.length ? filterCollection :\n                fColl.filter(function (col) { return col.field = _this.options.field; });\n            _this.options.handler(args);\n        });\n    };\n    CheckBoxFilterBase.prototype.foreignFilter = function (args, value) {\n        var operator = this.options.isRemote ?\n            (this.options.column.type === 'string' ? 'contains' : 'equal') : (this.options.column.type ? 'startswith' : 'contains');\n        var initalPredicate = new Predicate(this.options.column.foreignKeyValue, operator, value, true, this.options.ignoreAccent);\n        this.foreignKeyFilter(args, [args.filterCollection], initalPredicate);\n    };\n    CheckBoxFilterBase.prototype.searchBoxClick = function (e) {\n        var target = e.target;\n        if (target.classList.contains('e-searchclear')) {\n            this.sInput.value = '';\n            this.refreshCheckboxes();\n            this.updateSearchIcon();\n            this.sInput.focus();\n        }\n    };\n    CheckBoxFilterBase.prototype.searchBoxKeyUp = function (e) {\n        this.refreshCheckboxes();\n        this.updateSearchIcon();\n    };\n    CheckBoxFilterBase.prototype.updateSearchIcon = function () {\n        if (this.sInput.value.length) {\n            classList(this.sIcon, ['e-chkcancel-icon'], ['e-search-icon']);\n        }\n        else {\n            classList(this.sIcon, ['e-search-icon'], ['e-chkcancel-icon']);\n        }\n    };\n    /**\n     * Gets the localized label by locale keyword.\n     * @param  {string} key\n     * @return {string}\n     */\n    CheckBoxFilterBase.prototype.getLocalizedLabel = function (key) {\n        return this.localeObj.getConstant(key);\n    };\n    CheckBoxFilterBase.prototype.updateDataSource = function () {\n        var dataSource = this.options.dataSource;\n        var str = 'object';\n        if (!(dataSource instanceof DataManager)) {\n            for (var i = 0; i < dataSource.length; i++) {\n                if (typeof dataSource !== str) {\n                    var obj = {};\n                    obj[this.options.field] = dataSource[i];\n                    dataSource[i] = obj;\n                }\n            }\n        }\n    };\n    CheckBoxFilterBase.prototype.updateModel = function (options) {\n        this.options = options;\n        this.existingPredicate = options.actualPredicate || {};\n        this.options.dataSource = options.dataSource;\n        this.options.dataManager = options.dataManager ? options.dataManager : options.dataSource;\n        this.updateDataSource();\n        this.options.type = options.type;\n        this.options.format = options.format || '';\n        this.options.ignoreAccent = options.ignoreAccent || false;\n        this.options.filteredColumns = options.filteredColumns || this.parent.filterSettings.columns;\n        this.options.query = options.query || new Query();\n        this.options.allowCaseSensitive = options.allowCaseSensitive || false;\n        this.options.uid = options.column.uid;\n        this.values = {};\n        this.localeObj = options.localeObj;\n        this.isFiltered = options.filteredColumns.length;\n    };\n    CheckBoxFilterBase.prototype.getAndSetChkElem = function (options) {\n        this.dlg = this.parent.createElement('div', {\n            id: this.id + this.options.type + '_excelDlg',\n            className: 'e-checkboxfilter e-filter-popup'\n        });\n        this.sBox = this.parent.createElement('div', { className: 'e-searchcontainer' });\n        if (!options.hideSearchbox) {\n            this.sInput = this.parent.createElement('input', {\n                id: this.id + '_SearchBox',\n                className: 'e-searchinput'\n            });\n            this.sIcon = this.parent.createElement('span', {\n                className: 'e-searchclear e-search-icon e-icons e-input-group-icon', attrs: {\n                    type: 'text', title: this.getLocalizedLabel('Search')\n                }\n            });\n            this.searchBox = this.parent.createElement('span', { className: 'e-searchbox e-fields' });\n            this.searchBox.appendChild(this.sInput);\n            this.sBox.appendChild(this.searchBox);\n            var inputargs = {\n                element: this.sInput, floatLabelType: 'Never', properties: {\n                    placeholder: this.getLocalizedLabel('Search')\n                }\n            };\n            Input.createInput(inputargs, this.parent.createElement);\n            this.searchBox.querySelector('.e-input-group').appendChild(this.sIcon);\n        }\n        this.spinner = this.parent.createElement('div', { className: 'e-spinner' }); //for spinner\n        this.cBox = this.parent.createElement('div', {\n            id: this.id + this.options.type + '_CheckBoxList',\n            className: 'e-checkboxlist e-fields'\n        });\n        this.spinner.appendChild(this.cBox);\n        this.sBox.appendChild(this.spinner);\n        return this.sBox;\n    };\n    CheckBoxFilterBase.prototype.showDialog = function (options) {\n        var args = {\n            requestType: events.filterBeforeOpen,\n            columnName: this.options.field, columnType: this.options.type, cancel: false\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            var filterModel = 'filterModel';\n            args[filterModel] = this;\n        }\n        this.parent.notify(events.cBoxFltrBegin, args);\n        if (args.cancel) {\n            return;\n        }\n        this.dialogObj = new Dialog({\n            visible: false, content: this.sBox,\n            close: this.closeDialog.bind(this),\n            width: (!isNullOrUndefined(parentsUntil(options.target, 'e-bigger')))\n                || this.parent.element.classList.contains('e-device') ? 260 : 255,\n            target: this.parent.element, animationSettings: { effect: 'None' },\n            buttons: [{\n                    click: this.btnClick.bind(this),\n                    buttonModel: {\n                        content: this.getLocalizedLabel(this.isExcel ? 'OKButton' : 'FilterButton'),\n                        cssClass: 'e-primary', isPrimary: true\n                    }\n                },\n                {\n                    click: this.btnClick.bind(this),\n                    buttonModel: { cssClass: 'e-flat', content: this.getLocalizedLabel(this.isExcel ? 'CancelButton' : 'ClearButton') }\n                }],\n            created: this.dialogCreated.bind(this),\n            open: this.dialogOpen.bind(this)\n        });\n        var isStringTemplate = 'isStringTemplate';\n        this.dialogObj[isStringTemplate] = true;\n        this.dlg.setAttribute('aria-label', this.getLocalizedLabel('ExcelFilterDialogARIA'));\n        this.dialogObj.appendTo(this.dlg);\n        this.dialogObj.element.style.maxHeight = this.options.height + 'px';\n        this.dialogObj.show();\n        this.wireEvents();\n        createSpinner({ target: this.spinner }, this.parent.createElement);\n        showSpinner(this.spinner);\n        this.getAllData();\n    };\n    CheckBoxFilterBase.prototype.dialogCreated = function (e) {\n        if (!Browser.isDevice) {\n            getFilterMenuPostion(this.options.target, this.dialogObj, this.parent);\n        }\n        else {\n            this.dialogObj.position = { X: 'center', Y: 'center' };\n        }\n        this.parent.notify(events.filterDialogCreated, e);\n    };\n    CheckBoxFilterBase.prototype.openDialog = function (options) {\n        this.updateModel(options);\n        this.getAndSetChkElem(options);\n        this.showDialog(options);\n    };\n    CheckBoxFilterBase.prototype.closeDialog = function () {\n        if (this.dialogObj && !this.dialogObj.isDestroyed) {\n            var filterTemplateCol = this.options.columns.filter(function (col) { return col.getFilterItemTemplate(); });\n            if (filterTemplateCol.length) {\n                this.parent.destroyTemplate(['filterItemTemplate']);\n            }\n            this.parent.notify(events.filterMenuClose, { field: this.options.field });\n            this.dialogObj.destroy();\n            this.unWireEvents();\n            remove(this.dlg);\n            this.dlg = null;\n        }\n    };\n    CheckBoxFilterBase.prototype.clearFilter = function () {\n        /* tslint:disable-next-line:max-line-length */\n        var args = { instance: this, handler: this.clearFilter, cancel: false };\n        this.parent.notify(events.fltrPrevent, args);\n        if (args.cancel) {\n            return;\n        }\n        this.options.handler({ action: 'clear-filter', field: this.options.field });\n    };\n    CheckBoxFilterBase.prototype.btnClick = function (e) {\n        if (this.filterState) {\n            if (e.target.tagName.toLowerCase() === 'input') {\n                var value = e.target.value;\n                if (this.options.column.type === 'boolean') {\n                    if (value !== undefined &&\n                        this.getLocalizedLabel('FilterTrue').toLowerCase().indexOf(value.toLowerCase()) !== -1) {\n                        value = 'true';\n                    }\n                    else if (value !== undefined &&\n                        this.getLocalizedLabel('FilterFalse').toLowerCase().indexOf(value.toLowerCase()) !== -1) {\n                        value = 'false';\n                    }\n                }\n                var args = {\n                    action: 'filtering', filterCollection: {\n                        field: this.options.field,\n                        operator: this.options.isRemote ?\n                            (this.options.column.type === 'string' ? 'contains' : 'equal') :\n                            (this.options.column.type === 'date' || this.options.column.type === 'datetime' ||\n                                this.options.column.type === 'boolean' ? 'equal' : 'contains'),\n                        value: value, matchCase: false, type: this.options.column.type\n                    },\n                    field: this.options.field\n                };\n                value ? this.isForeignColumn(this.options.column) ? this.foreignFilter(args, value) :\n                    this.options.handler(args) : this.closeDialog();\n            }\n            else {\n                var text = e.target.firstChild.textContent.toLowerCase();\n                if (this.getLocalizedLabel(this.isExcel ? 'OKButton' : 'FilterButton').toLowerCase() === text) {\n                    this.fltrBtnHandler();\n                }\n                else if (this.getLocalizedLabel('ClearButton').toLowerCase() === text) {\n                    this.clearFilter();\n                }\n            }\n            this.closeDialog();\n        }\n        else if (!(e.target.tagName.toLowerCase() === 'input')) {\n            this.clearFilter();\n            this.closeDialog();\n        }\n    };\n    CheckBoxFilterBase.prototype.fltrBtnHandler = function () {\n        var checked = [].slice.call(this.cBox.querySelectorAll('.e-check:not(.e-selectall)'));\n        var optr = 'equal';\n        var searchInput = this.searchBox.querySelector('.e-searchinput');\n        var caseSen = this.options.allowCaseSensitive;\n        var defaults = {\n            field: this.options.field, predicate: 'or', uid: this.options.uid,\n            operator: optr, type: this.options.type, matchCase: caseSen, ignoreAccent: this.options.ignoreAccent\n        };\n        var isNotEqual = this.itemsCnt !== checked.length && this.itemsCnt - checked.length < checked.length;\n        if (isNotEqual && searchInput.value === '') {\n            optr = 'notequal';\n            checked = [].slice.call(this.cBox.querySelectorAll('.e-uncheck:not(.e-selectall)'));\n            defaults.predicate = 'and';\n            defaults.operator = 'notequal';\n        }\n        var value;\n        var fObj;\n        var coll = [];\n        if (checked.length !== this.itemsCnt || (searchInput.value && searchInput.value !== '')) {\n            for (var i = 0; i < checked.length; i++) {\n                value = this.values[parentsUntil(checked[i], 'e-ftrchk').getAttribute('uid')];\n                fObj = extend({}, { value: value }, defaults);\n                if (value && !value.toString().length) {\n                    fObj.operator = isNotEqual ? 'notequal' : 'equal';\n                }\n                if (value === '' || isNullOrUndefined(value)) {\n                    if (this.options.type === 'string') {\n                        coll.push({\n                            field: defaults.field, ignoreAccent: defaults.ignoreAccent, matchCase: defaults.matchCase,\n                            operator: defaults.operator, predicate: defaults.predicate, value: ''\n                        });\n                    }\n                    coll.push({\n                        field: defaults.field,\n                        matchCase: defaults.matchCase, operator: defaults.operator, predicate: defaults.predicate, value: null\n                    });\n                    coll.push({\n                        field: defaults.field, matchCase: defaults.matchCase, operator: defaults.operator,\n                        predicate: defaults.predicate, value: undefined\n                    });\n                }\n                else {\n                    coll.push(fObj);\n                }\n                var args = {\n                    instance: this, handler: this.fltrBtnHandler, arg1: fObj.field, arg2: fObj.predicate, arg3: fObj.operator,\n                    arg4: fObj.matchCase, arg5: fObj.ignoreAccent, arg6: fObj.value, cancel: false\n                };\n                this.parent.notify(events.fltrPrevent, args);\n                if (args.cancel) {\n                    return;\n                }\n            }\n            this.initiateFilter(coll);\n        }\n        else {\n            this.clearFilter();\n        }\n    };\n    CheckBoxFilterBase.prototype.initiateFilter = function (fColl) {\n        var firstVal = fColl[0];\n        var predicate;\n        if (!isNullOrUndefined(firstVal)) {\n            predicate = firstVal.ejpredicate ? firstVal.ejpredicate :\n                new Predicate(firstVal.field, firstVal.operator, firstVal.value, !firstVal.matchCase, firstVal.ignoreAccent);\n            for (var j = 1; j < fColl.length; j++) {\n                predicate = fColl[j].ejpredicate !== undefined ?\n                    predicate[fColl[j].predicate](fColl[j].ejpredicate) :\n                    predicate[fColl[j].predicate](fColl[j].field, fColl[j].operator, fColl[j].value, !fColl[j].matchCase, fColl[j].ignoreAccent);\n            }\n            var args = {\n                action: 'filtering', filterCollection: fColl, field: this.options.field,\n                ejpredicate: Predicate.or(predicate)\n            };\n            this.options.handler(args);\n        }\n    };\n    CheckBoxFilterBase.prototype.isForeignColumn = function (col) {\n        return col.isForeignColumn ? col.isForeignColumn() : false;\n    };\n    CheckBoxFilterBase.prototype.refreshCheckboxes = function () {\n        var _this = this;\n        var val = this.sInput.value;\n        var column = this.options.column;\n        var query = this.isForeignColumn(column) ? this.foreignKeyQuery.clone() : this.options.query.clone();\n        var foreignQuery = this.options.query.clone();\n        var pred = query.queries.filter(function (e) { return e && e.fn === 'onWhere'; })[0];\n        query.queries = [];\n        foreignQuery.queries = [];\n        var parsed = (this.options.type !== 'string' && parseFloat(val)) ? parseFloat(val) : val;\n        var operator = this.options.isRemote ?\n            (this.options.type === 'string' ? 'contains' : 'equal') : (this.options.type ? 'startswith' : 'contains');\n        var matchCase = true;\n        var ignoreAccent = this.options.ignoreAccent;\n        var field = this.isForeignColumn(column) ? column.foreignKeyValue : column.field;\n        parsed = (parsed === '' || parsed === undefined) ? undefined : parsed;\n        var predicte;\n        var moduleName = this.options.dataManager.adaptor.getModuleName;\n        if (this.options.type === 'boolean') {\n            if (parsed !== undefined &&\n                this.getLocalizedLabel('FilterTrue').toLowerCase().indexOf(parsed.toLowerCase()) !== -1 && moduleName) {\n                parsed = (moduleName() === 'ODataAdaptor' || 'ODataV4Adaptor') ? true : 'true';\n            }\n            else if (parsed !== undefined &&\n                this.getLocalizedLabel('FilterFalse').toLowerCase().indexOf(parsed.toLowerCase()) !== -1 && moduleName) {\n                parsed = (moduleName() === 'ODataAdaptor' || 'ODataV4Adaptor') ? false : 'false';\n            }\n            operator = 'equal';\n        }\n        this.addDistinct(query);\n        /* tslint:disable-next-line:max-line-length */\n        var args = {\n            requestType: events.filterSearchBegin,\n            filterModel: this, columnName: field, column: column,\n            operator: operator, matchCase: matchCase, ignoreAccent: ignoreAccent, filterChoiceCount: null,\n            query: query\n        };\n        if (isBlazor() && !this.parent.isJsComponent) {\n            var filterModel = 'filterModel';\n            args[filterModel] = {};\n        }\n        this.parent.notify(events.cBoxFltrBegin, args);\n        predicte = new Predicate(field, args.operator, parsed, args.matchCase, args.ignoreAccent);\n        if (this.options.type === 'date' || this.options.type === 'datetime') {\n            parsed = this.valueFormatter.fromView(val, this.options.parserFn, this.options.type);\n            operator = 'equal';\n            if (isNullOrUndefined(parsed) && val.length) {\n                return;\n            }\n            var filterObj = {\n                field: field, operator: operator, value: parsed, matchCase: matchCase,\n                ignoreAccent: ignoreAccent\n            };\n            predicte = getDatePredicate(filterObj, this.options.type);\n        }\n        if (val.length) {\n            predicte = !isNullOrUndefined(pred) ? predicte.and(pred.e) : predicte;\n            query.where(predicte);\n        }\n        else if (!isNullOrUndefined(pred)) {\n            query.where(pred.e);\n        }\n        args.filterChoiceCount = !isNullOrUndefined(args.filterChoiceCount) ? args.filterChoiceCount : 1000;\n        var fPredicate = {};\n        showSpinner(this.spinner);\n        this.renderEmpty = false;\n        if (this.isForeignColumn(column) && val.length) {\n            // tslint:disable-next-line:no-any\n            column.dataSource.executeQuery(query).then(function (e) {\n                var columnData = _this.options.column.columnData;\n                _this.options.column.columnData = e.result;\n                _this.parent.notify(events.generateQuery, { predicate: fPredicate, column: column });\n                if (fPredicate.predicate.predicates.length) {\n                    foreignQuery.where(fPredicate.predicate);\n                }\n                else {\n                    _this.renderEmpty = true;\n                }\n                _this.options.column.columnData = columnData;\n                foreignQuery.take(args.filterChoiceCount);\n                _this.search(args, foreignQuery);\n            });\n        }\n        else {\n            query.take(args.filterChoiceCount);\n            this.search(args, query);\n        }\n    };\n    CheckBoxFilterBase.prototype.search = function (args, query) {\n        if (this.parent.dataSource && 'result' in this.parent.dataSource) {\n            this.filterEvent(args, query);\n        }\n        else {\n            this.processSearch(query);\n        }\n    };\n    CheckBoxFilterBase.prototype.getPredicateFromCols = function (columns) {\n        var predicates = CheckBoxFilterBase.getPredicate(columns);\n        var predicateList = [];\n        var fPredicate = {};\n        var isGrid = this.parent.getForeignKeyColumns !== undefined;\n        var foreignColumn = isGrid ? this.parent.getForeignKeyColumns() : [];\n        for (var _i = 0, _a = Object.keys(predicates); _i < _a.length; _i++) {\n            var prop = _a[_i];\n            var col = void 0;\n            if (isGrid && this.parent.getColumnByField(prop).isForeignColumn()) {\n                col = getColumnByForeignKeyValue(prop, foreignColumn);\n            }\n            if (col) {\n                this.parent.notify(events.generateQuery, { predicate: fPredicate, column: col });\n                if (fPredicate.predicate.predicates.length) {\n                    predicateList.push(Predicate.or(fPredicate.predicate.predicates));\n                }\n            }\n            else {\n                predicateList.push(predicates[prop]);\n            }\n        }\n        return predicateList.length && Predicate.and(predicateList);\n    };\n    CheckBoxFilterBase.prototype.getQuery = function () {\n        return this.parent.getQuery ? this.parent.getQuery().clone() : new Query();\n    };\n    CheckBoxFilterBase.prototype.getAllData = function () {\n        var _this = this;\n        var query = this.getQuery();\n        query.requiresCount(); //consider take query\n        this.addDistinct(query);\n        var args = {\n            requestType: events.filterChoiceRequest, query: query, filterChoiceCount: null\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            var filterModel = 'filterModel';\n            args[filterModel] = this;\n        }\n        this.parent.trigger(events.actionBegin, args, function (args) {\n            args.filterChoiceCount = !isNullOrUndefined(args.filterChoiceCount) ? args.filterChoiceCount : 1000;\n            query.take(args.filterChoiceCount);\n            if (_this.parent.dataSource && 'result' in _this.parent.dataSource) {\n                _this.filterEvent(args, query);\n            }\n            else {\n                _this.processDataOperation(query, true);\n            }\n        });\n    };\n    CheckBoxFilterBase.prototype.addDistinct = function (query) {\n        var filteredColumn = DataUtil.distinct(this.options.filteredColumns, 'field');\n        if (filteredColumn.indexOf(this.options.column.field) <= -1) {\n            filteredColumn = filteredColumn.concat(this.options.column.field);\n        }\n        query.distinct(filteredColumn);\n        return query;\n    };\n    CheckBoxFilterBase.prototype.filterEvent = function (args, query) {\n        var _this = this;\n        var def = this.eventPromise(args, query);\n        def.promise.then(function (e) {\n            _this.dataSuccess(e);\n        });\n    };\n    CheckBoxFilterBase.prototype.eventPromise = function (args, query) {\n        var state;\n        state = this.getStateEventArgument(query);\n        var def = new Deferred();\n        state.dataSource = def.resolve;\n        state.action = args;\n        this.parent.trigger(events.dataStateChange, state);\n        return def;\n    };\n    ;\n    CheckBoxFilterBase.prototype.getStateEventArgument = function (query) {\n        var adaptr = new UrlAdaptor();\n        var dm = new DataManager({ url: '', adaptor: new UrlAdaptor });\n        var state = adaptr.processQuery(dm, query);\n        var data = JSON.parse(state.data);\n        return data;\n    };\n    ;\n    CheckBoxFilterBase.prototype.processDataOperation = function (query, isInitial) {\n        var _this = this;\n        this.options.dataSource = this.options.dataSource instanceof DataManager ?\n            this.options.dataSource : new DataManager(this.options.dataSource);\n        var allPromise = [];\n        var runArray = [];\n        if (this.isForeignColumn(this.options.column) && isInitial) {\n            allPromise.push(this.options.column.dataSource.executeQuery(this.foreignKeyQuery));\n            runArray.push(function (data) { return _this.foreignKeyData = data; });\n        }\n        allPromise.push(this.options.dataSource.executeQuery(query));\n        runArray.push(this.dataSuccess.bind(this));\n        var i = 0;\n        Promise.all(allPromise).then(function (e) {\n            e.forEach(function (data) {\n                runArray[i++](data.result);\n            });\n        });\n    };\n    CheckBoxFilterBase.prototype.dataSuccess = function (e) {\n        this.fullData = e;\n        var query = new Query();\n        if (this.parent.searchSettings && this.parent.searchSettings.key.length) {\n            var sSettings = this.parent.searchSettings;\n            var fields = sSettings.fields.length ? sSettings.fields : this.options.columns.map(function (f) { return f.field; });\n            /* tslint:disable-next-line:max-line-length */\n            query.search(sSettings.key, fields, sSettings.operator, sSettings.ignoreCase, sSettings.ignoreAccent);\n        }\n        if ((this.options.filteredColumns.length)) {\n            var cols = [];\n            for (var i = 0; i < this.options.filteredColumns.length; i++) {\n                var filterColumn = this.options.filteredColumns[i];\n                if (this.options.uid) {\n                    filterColumn.uid = filterColumn.uid || this.parent.getColumnByField(filterColumn.field).uid;\n                    if (filterColumn.uid !== this.options.uid) {\n                        cols.push(this.options.filteredColumns[i]);\n                    }\n                }\n                else {\n                    if (filterColumn.field !== this.options.field) {\n                        cols.push(this.options.filteredColumns[i]);\n                    }\n                }\n            }\n            var predicate = this.getPredicateFromCols(cols);\n            if (predicate) {\n                query.where(predicate);\n            }\n        }\n        // query.select(this.options.field);\n        var result = new DataManager(this.fullData).executeLocal(query);\n        var col = this.options.column;\n        this.filteredData = CheckBoxFilterBase.\n            getDistinct(result, this.options.field, col, this.foreignKeyData).records || [];\n        this.processDataSource(null, true, this.filteredData);\n        this.sInput.focus();\n        var args = {\n            requestType: events.filterAfterOpen,\n            columnName: this.options.field, columnType: this.options.type\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            var filterModel = 'filterModel';\n            args[filterModel] = this;\n        }\n        this.parent.notify(events.cBoxFltrComplete, args);\n    };\n    CheckBoxFilterBase.prototype.processDataSource = function (query, isInitial, dataSource) {\n        showSpinner(this.spinner);\n        // query = query ? query : this.options.query.clone();\n        // query.requiresCount();\n        // let result: Object = new DataManager(dataSource as JSON[]).executeLocal(query);\n        // let res: { result: Object[] } = result as { result: Object[] };\n        this.updateResult();\n        this.createFilterItems(dataSource, isInitial);\n    };\n    CheckBoxFilterBase.prototype.processSearch = function (query) {\n        this.processDataOperation(query);\n    };\n    CheckBoxFilterBase.prototype.updateResult = function () {\n        this.result = {};\n        var predicate = this.getPredicateFromCols(this.options.filteredColumns);\n        var query = new Query();\n        if (predicate) {\n            query.where(predicate);\n        }\n        var result = new DataManager(this.fullData).executeLocal(query);\n        for (var _i = 0, result_1 = result; _i < result_1.length; _i++) {\n            var res = result_1[_i];\n            this.result[getObject(this.options.field, res)] = true;\n        }\n    };\n    CheckBoxFilterBase.prototype.clickHandler = function (e) {\n        var target = e.target;\n        var elem = parentsUntil(target, 'e-checkbox-wrapper');\n        if (parentsUntil(target, 'e-searchbox')) {\n            this.searchBoxClick(e);\n        }\n        if (elem) {\n            var selectAll = elem.querySelector('.e-selectall');\n            if (selectAll) {\n                this.updateAllCBoxes(!selectAll.classList.contains('e-check'));\n            }\n            else {\n                toogleCheckbox(elem.parentElement);\n            }\n            this.updateIndeterminatenBtn();\n            elem.querySelector('.e-chk-hidden').focus();\n        }\n    };\n    CheckBoxFilterBase.prototype.updateAllCBoxes = function (checked) {\n        var cBoxes = [].slice.call(this.cBox.querySelectorAll('.e-frame'));\n        for (var _i = 0, cBoxes_1 = cBoxes; _i < cBoxes_1.length; _i++) {\n            var cBox = cBoxes_1[_i];\n            removeAddCboxClasses(cBox, checked);\n        }\n    };\n    CheckBoxFilterBase.prototype.dialogOpen = function () {\n        if (this.parent.element.classList.contains('e-device')) {\n            this.dialogObj.element.querySelector('.e-input-group').classList.remove('e-input-focus');\n            this.dialogObj.element.querySelector('.e-btn').focus();\n        }\n    };\n    CheckBoxFilterBase.prototype.createCheckbox = function (value, checked, data) {\n        var elem = checked ? this.cBoxTrue.cloneNode(true) :\n            this.cBoxFalse.cloneNode(true);\n        var label = elem.querySelector('.e-label');\n        var dummyData = extendObjWithFn({}, data, { column: this.options.column, parent: this.parent });\n        label.innerHTML = !isNullOrUndefined(value) && value.toString().length ? value :\n            this.getLocalizedLabel('Blanks');\n        addClass([label], ['e-checkboxfiltertext']);\n        if (this.options.template && data[this.options.column.field] !== this.getLocalizedLabel('SelectAll')) {\n            label.innerHTML = '';\n            appendChildren(label, this.options.template(dummyData, this.parent, 'filterItemTemplate'));\n        }\n        return elem;\n    };\n    CheckBoxFilterBase.prototype.updateIndeterminatenBtn = function () {\n        var cnt = this.cBox.children.length - 1;\n        var className = [];\n        var elem = this.cBox.querySelector('.e-selectall');\n        var selected = this.cBox.querySelectorAll('.e-check:not(.e-selectall)').length;\n        var btn = this.dialogObj.btnObj[0];\n        btn.disabled = false;\n        if (cnt === selected) {\n            className = ['e-check'];\n        }\n        else if (selected) {\n            className = ['e-stop'];\n        }\n        else {\n            className = ['e-uncheck'];\n            btn.disabled = true;\n        }\n        this.filterState = !btn.disabled;\n        btn.dataBind();\n        removeClass([elem], ['e-check', 'e-stop', 'e-uncheck']);\n        addClass([elem], className);\n    };\n    CheckBoxFilterBase.prototype.createFilterItems = function (data, isInitial) {\n        var _a;\n        var cBoxes = this.parent.createElement('div');\n        var btn = this.dialogObj.btnObj[0];\n        var nullCounter = -1;\n        for (var i = 0; i < data.length; i++) {\n            var val = getValue('ejValue', data[i]);\n            if (val === '' || isNullOrUndefined(val)) {\n                nullCounter = nullCounter + 1;\n            }\n        }\n        this.itemsCnt = nullCounter !== -1 ? data.length - nullCounter : data.length;\n        if (data.length && !this.renderEmpty) {\n            var selectAllValue = this.getLocalizedLabel('SelectAll');\n            var checkBox = this.createCheckbox(selectAllValue, false, (_a = {}, _a[this.options.field] = selectAllValue, _a));\n            var selectAll = createCboxWithWrap(getUid('cbox'), checkBox, 'e-ftrchk');\n            selectAll.querySelector('.e-frame').classList.add('e-selectall');\n            cBoxes.appendChild(selectAll);\n            var predicate = new Predicate('field', 'equal', this.options.field);\n            if (this.options.foreignKeyValue) {\n                predicate = predicate.or('field', 'equal', this.options.foreignKeyValue);\n            }\n            var isColFiltered = new DataManager(this.options.filteredColumns).executeLocal(new Query().where(predicate)).length;\n            var isRndere = void 0;\n            for (var i = 0; i < data.length; i++) {\n                var uid = getUid('cbox');\n                this.values[uid] = getValue('ejValue', data[i]);\n                var value = getValue(this.options.field, data[i]);\n                if (this.options.formatFn) {\n                    value = this.valueFormatter.toView(value, this.options.formatFn);\n                }\n                var args_1 = { value: value, column: this.options.column, data: data[i] };\n                this.parent.notify(events.filterCboxValue, args_1);\n                value = args_1.value;\n                if ((value === '' || isNullOrUndefined(value))) {\n                    if (isRndere) {\n                        continue;\n                    }\n                    isRndere = true;\n                }\n                var checkbox = this.createCheckbox(value, this.getCheckedState(isColFiltered, this.values[uid]), getValue('dataObj', data[i]));\n                cBoxes.appendChild(createCboxWithWrap(uid, checkbox, 'e-ftrchk'));\n            }\n            this.cBox.innerHTML = '';\n            appendChildren(this.cBox, [].slice.call(cBoxes.children));\n            this.updateIndeterminatenBtn();\n            btn.disabled = false;\n        }\n        else {\n            cBoxes.appendChild(this.parent.createElement('span', { innerHTML: this.getLocalizedLabel('NoResult') }));\n            this.cBox.innerHTML = '';\n            appendChildren(this.cBox, [].slice.call(cBoxes.children));\n            btn.disabled = true;\n        }\n        this.filterState = !btn.disabled;\n        btn.dataBind();\n        var args = { requestType: events.filterChoiceRequest, dataSource: this.renderEmpty ||\n                (isBlazor() && this.parent.isServerRendered) ? [] : data };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            var filterModel = 'filterModel';\n            args[filterModel] = this;\n        }\n        this.parent.notify(events.cBoxFltrComplete, args);\n        hideSpinner(this.spinner);\n    };\n    CheckBoxFilterBase.prototype.getCheckedState = function (isColFiltered, value) {\n        if (!this.isFiltered || !isColFiltered) {\n            return true;\n        }\n        else {\n            return this.result[value];\n        }\n    };\n    CheckBoxFilterBase.getDistinct = function (json, field, column, foreignKeyData) {\n        var len = json.length;\n        var result = [];\n        var value;\n        var ejValue = 'ejValue';\n        var lookup = {};\n        var isForeignKey = column && column.isForeignColumn ? column.isForeignColumn() : false;\n        while (len--) {\n            value = json[len];\n            value = getObject(field, value); //local remote diff, check with mdu   \n            if (!(value in lookup)) {\n                var obj = {};\n                obj[ejValue] = value;\n                lookup[value] = true;\n                if (isForeignKey) {\n                    var foreignDataObj = getForeignData(column, {}, value, foreignKeyData)[0];\n                    setValue(events.foreignKeyData, foreignDataObj, json[len]);\n                    value = getValue(column.foreignKeyValue, foreignDataObj);\n                }\n                setValue(field, isNullOrUndefined(value) ? null : value, obj);\n                setValue('dataObj', json[len], obj);\n                result.push(obj);\n            }\n        }\n        return DataUtil.group(DataUtil.sort(result, field, DataUtil.fnAscending), 'ejValue');\n    };\n    CheckBoxFilterBase.getPredicate = function (columns) {\n        var cols = DataUtil.distinct(columns, 'field', true) || [];\n        var collection = [];\n        var pred = {};\n        for (var i = 0; i < cols.length; i++) {\n            collection = new DataManager(columns).executeLocal(new Query().where('field', 'equal', cols[i].field));\n            if (collection.length !== 0) {\n                pred[cols[i].field] = CheckBoxFilterBase.generatePredicate(collection);\n            }\n        }\n        return pred;\n    };\n    CheckBoxFilterBase.generatePredicate = function (cols) {\n        var len = cols ? cols.length : 0;\n        var predicate;\n        var first;\n        first = CheckBoxFilterBase.updateDateFilter(cols[0]);\n        first.ignoreAccent = !isNullOrUndefined(first.ignoreAccent) ? first.ignoreAccent : false;\n        if (first.type === 'date' || first.type === 'datetime') {\n            predicate = getDatePredicate(first, first.type);\n        }\n        else {\n            predicate = first.ejpredicate ? first.ejpredicate :\n                new Predicate(first.field, first.operator, first.value, !CheckBoxFilterBase.getCaseValue(first), first.ignoreAccent);\n        }\n        for (var p = 1; p < len; p++) {\n            cols[p] = CheckBoxFilterBase.updateDateFilter(cols[p]);\n            if (len > 2 && p > 1 && cols[p].predicate === 'or') {\n                if (cols[p].type === 'date' || cols[p].type === 'datetime') {\n                    predicate.predicates.push(getDatePredicate(cols[p], cols[p].type));\n                }\n                else {\n                    predicate.predicates.push(new Predicate(cols[p].field, cols[p].operator, cols[p].value, !CheckBoxFilterBase.getCaseValue(cols[p]), cols[p].ignoreAccent));\n                }\n            }\n            else {\n                if (cols[p].type === 'date' || cols[p].type === 'datetime') {\n                    predicate = predicate[(cols[p].predicate)](getDatePredicate(cols[p]), cols[p].type, cols[p].ignoreAccent);\n                }\n                else {\n                    /* tslint:disable-next-line:max-line-length */\n                    predicate = cols[p].ejpredicate ?\n                        predicate[cols[p].predicate](cols[p].ejpredicate) :\n                        predicate[(cols[p].predicate)](cols[p].field, cols[p].operator, cols[p].value, !CheckBoxFilterBase.getCaseValue(cols[p]), cols[p].ignoreAccent);\n                }\n            }\n        }\n        return predicate || null;\n    };\n    CheckBoxFilterBase.getCaseValue = function (filter) {\n        if (isNullOrUndefined(filter.matchCase)) {\n            return true;\n        }\n        else {\n            return filter.matchCase;\n        }\n    };\n    CheckBoxFilterBase.updateDateFilter = function (filter) {\n        if ((filter.type === 'date' || filter.type === 'datetime' || filter.value instanceof Date)) {\n            filter.type = filter.type || 'date';\n        }\n        return filter;\n    };\n    return CheckBoxFilterBase;\n}());\nexport { CheckBoxFilterBase };\n"]},"metadata":{},"sourceType":"module"}