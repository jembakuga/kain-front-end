{"ast":null,"code":"import { Draggable, isBlazor } from '@syncfusion/ej2-base';\nimport { removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest as closestElement, classList } from '@syncfusion/ej2-base';\nimport { parentsUntil, removeElement, getPosition, addRemoveActiveClasses, isActionPrevent } from '../base/util';\nimport * as events from '../base/constant';\nimport { Scroll } from '../actions/scroll';\nimport { Query } from '@syncfusion/ej2-data';\n/**\n *\n * Reorder module is used to handle row reordering.\n * @hidden\n */\n\nvar RowDD =\n/** @class */\nfunction () {\n  /**\n   * Constructor for the Grid print module\n   * @hidden\n   */\n  function RowDD(parent) {\n    var _this = this;\n\n    this.selectedRows = [];\n    this.isOverflowBorder = true;\n    this.selectedRowColls = [];\n    this.isRefresh = true;\n    /* tslint:disable-next-line:max-line-length */\n    // tslint:disable-next-line:max-func-body-length\n\n    this.helper = function (e) {\n      var gObj = _this.parent;\n      var target = _this.draggable.currentStateTarget;\n\n      var visualElement = _this.parent.createElement('div', {\n        className: 'e-cloneproperties e-draganddrop e-grid e-dragclone',\n        styles: 'height:\"auto\", z-index:2, width:' + gObj.element.offsetWidth\n      });\n\n      var table = _this.parent.createElement('table', {\n        styles: 'width:' + gObj.element.offsetWidth\n      });\n\n      var tbody = _this.parent.createElement('tbody');\n\n      if (document.getElementsByClassName('e-griddragarea').length || gObj.rowDropSettings.targetID && !e.sender.target.classList.contains('e-selectionbackground') && gObj.selectionSettings.type !== 'Single' || !gObj.rowDropSettings.targetID && !parentsUntil(e.sender.target, 'e-rowdragdrop')) {\n        return false;\n      }\n\n      if (gObj.rowDropSettings.targetID && gObj.selectionSettings.mode === 'Row' && gObj.selectionSettings.type === 'Single') {\n        gObj.selectRow(parseInt(_this.draggable.currentStateTarget.parentElement.getAttribute('aria-rowindex'), 10));\n      }\n\n      _this.startedRow = closestElement(target, 'tr').cloneNode(true);\n\n      _this.processArgs(target);\n\n      var args = {\n        selectedRow: _this.rows,\n        dragelement: target,\n        cloneElement: visualElement,\n        cancel: false,\n        data: _this.rowData\n      };\n      var selectedRows = gObj.getSelectedRows();\n      gObj.trigger(events.rowDragStartHelper, args);\n      var cancel = 'cancel';\n      var cloneElement = 'cloneElement';\n\n      if (args[cancel]) {\n        return false;\n      }\n\n      removeElement(_this.startedRow, '.e-indentcell');\n      removeElement(_this.startedRow, '.e-detailrowcollapse');\n      removeElement(_this.startedRow, '.e-detailrowexpand');\n\n      _this.removeCell(_this.startedRow, 'e-gridchkbox');\n\n      var exp = new RegExp('e-active', 'g'); //high contrast issue\n\n      _this.startedRow.innerHTML = _this.startedRow.innerHTML.replace(exp, '');\n      tbody.appendChild(_this.startedRow);\n\n      if (gObj.getSelectedRows().length > 1) {\n        var dropCountEle = _this.parent.createElement('span', {\n          className: 'e-dropitemscount',\n          innerHTML: '' + selectedRows.length\n        });\n\n        visualElement.appendChild(dropCountEle);\n      }\n\n      var ele = closestElement(target, 'tr').querySelector('.e-icon-rowdragicon');\n\n      if (ele) {\n        ele.classList.add('e-dragstartrow');\n      }\n\n      table.appendChild(tbody);\n      visualElement.appendChild(table);\n      gObj.element.appendChild(visualElement);\n      return visualElement;\n    };\n\n    this.dragStart = function (e) {\n      var gObj = _this.parent;\n\n      if (document.getElementsByClassName('e-griddragarea').length) {\n        return;\n      }\n\n      var target = e.target;\n\n      var spanCssEle = _this.parent.element.querySelector('.e-dropitemscount');\n\n      if (_this.parent.getSelectedRecords().length > 1 && spanCssEle) {\n        spanCssEle.style.left = _this.parent.element.querySelector('.e-cloneproperties table').offsetWidth - 5 + 'px';\n      }\n\n      _this.processArgs(target);\n\n      gObj.trigger(events.rowDragStart, {\n        rows: _this.rows,\n        target: e.target,\n        draggableType: 'rows',\n        fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n        data: _this.rowData\n      });\n\n      if (isBlazor()) {\n        e.bindEvents(e.dragElement);\n      }\n\n      _this.dragStartData = _this.rowData;\n      var dropElem = document.getElementById(gObj.rowDropSettings.targetID);\n\n      if (gObj.rowDropSettings.targetID && dropElem && dropElem.ej2_instances && dropElem.ej2_instances[0].getModuleName() === 'grid') {\n        dropElem.ej2_instances[0].getContent().classList.add('e-allowRowDrop');\n      }\n    };\n\n    this.drag = function (e) {\n      var gObj = _this.parent;\n\n      var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n\n      var target = _this.getElementFromPosition(cloneElement, e.event);\n\n      classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur', 'e-movecur']);\n      _this.isOverflowBorder = true;\n      _this.hoverState = gObj.enableHover;\n      var trElement = parentsUntil(target, 'e-grid') ? closestElement(e.target, 'tr') : null;\n      gObj.enableHover = false;\n\n      if (!e.target) {\n        return;\n      }\n\n      _this.processArgs(target);\n\n      var args = {\n        rows: _this.rows,\n        target: target,\n        draggableType: 'rows',\n        data: _this.rowData,\n        originalEvent: e,\n        cancel: false\n      };\n      gObj.trigger(events.rowDrag, args);\n\n      _this.stopTimer();\n\n      if (args.cancel) {\n        return;\n      }\n\n      gObj.element.classList.add('e-rowdrag');\n      _this.dragTarget = trElement && parentsUntil(target, 'e-grid').id === cloneElement.parentElement.id ? trElement.rowIndex : parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10);\n\n      if (gObj.rowDropSettings.targetID) {\n        if (!parentsUntil(target, 'e-gridcontent') || parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id) {\n          classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n        } else {\n          classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n        }\n      } else {\n        var elem = parentsUntil(target, 'e-grid');\n\n        if (elem && elem.id === cloneElement.parentElement.id) {\n          classList(cloneElement, ['e-movecur'], ['e-defaultcur']);\n        } else {\n          classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n        }\n      }\n\n      if (!gObj.rowDropSettings.targetID && (!gObj.groupSettings.columns.length || e.target.classList.contains('e-selectionbackground'))) {\n        if (parentsUntil(target, 'e-grid')) {\n          _this.updateScrollPostion(e.event, target);\n        }\n\n        if (_this.isOverflowBorder && parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10) !== _this.dragTarget) {\n          _this.moveDragRows(e, _this.startedRow, trElement);\n        } else {\n          if (trElement && _this.parent.getRowByIndex(_this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') === trElement.getAttribute('data-uid')) {\n            var bottomborder = _this.parent.createElement('div', {\n              className: 'e-lastrow-dragborder'\n            });\n\n            var gridcontentEle = _this.parent.getContent();\n\n            bottomborder.style.width = _this.parent.element.offsetWidth - _this.getScrollWidth() + 'px';\n\n            if (!gridcontentEle.querySelectorAll('.e-lastrow-dragborder').length) {\n              gridcontentEle.classList.add('e-grid-relative');\n              gridcontentEle.appendChild(bottomborder);\n              bottomborder.style.bottom = _this.getScrollWidth() + 'px';\n            }\n          }\n\n          _this.removeBorder(trElement);\n        }\n      }\n    };\n\n    this.dragStop = function (e) {\n      if (isActionPrevent(_this.parent)) {\n        _this.parent.notify(events.preventBatch, {\n          instance: _this,\n          handler: _this.processDragStop,\n          arg1: e\n        });\n      } else {\n        _this.processDragStop(e);\n      }\n    };\n\n    this.processDragStop = function (e) {\n      var gObj = _this.parent;\n\n      if (_this.parent.isDestroyed) {\n        return;\n      }\n\n      var targetEle = _this.getElementFromPosition(e.helper, e.event);\n\n      var target = targetEle && !targetEle.classList.contains('e-dlg-overlay') ? targetEle : e.target;\n\n      var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n\n      gObj.element.classList.remove('e-rowdrag');\n      var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n\n      if (gObj.rowDropSettings.targetID && dropElement && dropElement.ej2_instances && dropElement.ej2_instances[0].getModuleName() === 'grid') {\n        dropElement.ej2_instances[0].getContent().classList.remove('e-allowRowDrop');\n      }\n\n      if (gObj.isRowDragable()) {\n        _this.stopTimer();\n\n        gObj.enableHover = _this.hoverState;\n\n        _this.parent.getContent().classList.remove('e-grid-relative');\n\n        _this.removeBorder(targetEle);\n\n        var stRow = gObj.element.querySelector('.e-dragstartrow');\n\n        if (stRow) {\n          stRow.classList.remove('e-dragstartrow');\n        }\n      }\n\n      _this.processArgs(target);\n\n      var args = {\n        target: target,\n        draggableType: 'rows',\n        cancel: false,\n        fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n        dropIndex: _this.dragTarget,\n        rows: _this.rows,\n        data: _this.dragStartData\n      };\n      gObj.trigger(events.rowDrop, args);\n\n      if (!parentsUntil(target, 'e-gridcontent') || args.cancel) {\n        _this.dragTarget = null;\n        remove(e.helper);\n        return;\n      }\n\n      _this.isRefresh = false;\n\n      var selectedIndexes = _this.parent.getSelectedRowIndexes();\n\n      if (gObj.isRowDragable()) {\n        if (!isBlazor()) {\n          if (!_this.parent.rowDropSettings.targetID && _this.startedRow.querySelector('td.e-selectionbackground') && selectedIndexes.length > 1 && selectedIndexes.length !== _this.parent.getCurrentViewRecords().length) {\n            _this.reorderRows(selectedIndexes, args.dropIndex);\n          } else {\n            _this.reorderRows([parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10)], _this.dragTarget);\n          }\n        } else {\n          var fromIdx = parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10);\n          var currentVdata_1 = [];\n          var ind_1 = 0;\n          selectedIndexes.forEach(function (rec) {\n            currentVdata_1[ind_1] = _this.parent.currentViewData[rec];\n            ind_1++;\n          });\n\n          if (!(_this.parent.rowDropSettings.targetID && selectedIndexes.length)) {\n            currentVdata_1[ind_1] = _this.parent.currentViewData[fromIdx];\n          }\n\n          var draggedData = _this.parent.getSelectedRecords().length ? _this.parent.getSelectedRecords() : currentVdata_1;\n          var changeRecords = {\n            addedRecords: [],\n            deletedRecords: draggedData,\n            changedRecords: []\n          };\n          var toIdx = _this.dragTarget ? _this.dragTarget : args.dropIndex;\n          toIdx = toIdx - draggedData.length + 1 > 0 ? toIdx - draggedData.length + 1 : toIdx;\n          var dragDropDestinationIndex = 'dragDropDestinationIndex';\n          var query = new Query();\n          query[dragDropDestinationIndex] = toIdx;\n\n          _this.saveChange(changeRecords, query);\n\n          changeRecords.deletedRecords = [];\n          changeRecords.addedRecords = draggedData;\n\n          _this.saveChange(changeRecords, query);\n        }\n\n        _this.dragTarget = null;\n\n        if (!gObj.rowDropSettings.targetID) {\n          remove(e.helper);\n          gObj.refresh();\n        }\n      }\n\n      _this.isRefresh = true;\n    };\n\n    this.removeCell = function (targetRow, className) {\n      return [].slice.call(targetRow.querySelectorAll('td')).filter(function (cell) {\n        if (cell.classList.contains(className)) {\n          targetRow.deleteCell(cell.cellIndex);\n        }\n      });\n    };\n\n    this.parent = parent;\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.initialEnd, this.initializeDrag, this);\n    this.parent.on(events.columnDrop, this.columnDrop, this);\n    this.onDataBoundFn = this.onDataBound.bind(this);\n    this.parent.addEventListener(events.dataBound, this.onDataBoundFn);\n    this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n  }\n\n  RowDD.prototype.saveChange = function (changeRecords, query) {\n    var _this = this;\n\n    this.parent.getDataModule().saveChanges(changeRecords, this.parent.getPrimaryKeyFieldNames()[0], {}, query).then(function () {\n      _this.parent.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n    }).catch(function (e) {\n      _this.parent.trigger(events.actionFailure, {\n        error: e\n      });\n    });\n  };\n\n  RowDD.prototype.reorderRows = function (fromIndexes, toIndex) {\n    var selectedIndexes = this.parent.getSelectedRowIndexes();\n    var selectedRecords = [];\n    var draggedRecords = [];\n    var currentViewData = this.parent.renderModule.data.dataManager.dataSource.json;\n    var dropIdx = toIndex;\n    var actualIdx = fromIndexes[0];\n\n    for (var i = 0, len = fromIndexes.length; i < len; i++) {\n      draggedRecords[i] = currentViewData[fromIndexes[i]];\n    }\n\n    for (var i = 0, len = selectedIndexes.length; i < len; i++) {\n      selectedRecords[i] = currentViewData[selectedIndexes[i]];\n    }\n\n    for (var i = 0, len = draggedRecords.length; i < len; i++) {\n      if (i !== 0) {\n        for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n          if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i])) {\n            actualIdx = j;\n            break;\n          }\n        }\n\n        for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n          if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i - 1])) {\n            if (actualIdx > j) {\n              dropIdx = j + 1;\n            }\n\n            break;\n          }\n        }\n      }\n\n      this.reorderRow(actualIdx, dropIdx);\n    }\n\n    if (this.isRefresh) {\n      this.parent.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n    }\n\n    for (var i = 0, len = selectedRecords.length; i < len; i++) {\n      for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n        if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(selectedRecords[i])) {\n          selectedIndexes[i] = j;\n          break;\n        }\n      }\n    }\n\n    this.selectedRowColls = selectedIndexes;\n  };\n\n  RowDD.prototype.stopTimer = function () {\n    window.clearInterval(this.timer);\n  };\n\n  RowDD.prototype.initializeDrag = function () {\n    var gObj = this.parent;\n    this.draggable = new Draggable(gObj.getContent(), {\n      dragTarget: '.e-rowcelldrag, .e-rowdragdrop, .e-rowcell',\n      distance: 5,\n      helper: this.helper,\n      dragStart: this.dragStart,\n      drag: this.drag,\n      dragStop: this.dragStop\n    });\n  };\n\n  RowDD.prototype.updateScrollPostion = function (e, target) {\n    var _this = this;\n\n    var frzCols = this.parent.getFrozenColumns();\n    var y = getPosition(e).y;\n    var cliRect = this.parent.getContent().getBoundingClientRect();\n    var rowHeight = this.parent.getRowHeight() - 15;\n    var scrollElem = frzCols ? this.parent.getContent().querySelector('.e-movablecontent') : this.parent.getContent().firstElementChild;\n\n    if (cliRect.top + rowHeight >= y) {\n      var scrollPixel_1 = -this.parent.getRowHeight();\n      this.isOverflowBorder = false;\n      this.timer = window.setInterval(function () {\n        _this.setScrollDown(scrollElem, scrollPixel_1, true);\n      }, 200);\n    } else if (cliRect.top + this.parent.getContent().clientHeight - rowHeight - 33 <= y) {\n      var scrollPixel_2 = this.parent.getRowHeight();\n      this.isOverflowBorder = false;\n      this.timer = window.setInterval(function () {\n        _this.setScrollDown(scrollElem, scrollPixel_2, true);\n      }, 200);\n    }\n  };\n\n  RowDD.prototype.setScrollDown = function (scrollElem, scrollPixel, isLeft) {\n    scrollElem.scrollTop = scrollElem.scrollTop + scrollPixel;\n  };\n\n  RowDD.prototype.moveDragRows = function (e, startedRow, targetRow) {\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    var element = closestElement(e.target, 'tr');\n\n    if (parentsUntil(element, 'e-gridcontent') && parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) {\n      var targetElement = element ? element : this.startedRow;\n      this.setBorder(targetElement, e.event, startedRow, targetRow);\n    }\n  };\n\n  RowDD.prototype.setBorder = function (element, event, startedRow, targetRow) {\n    var node = this.parent.element;\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    this.removeFirstRowBorder(element);\n    this.removeLastRowBorder(element);\n\n    if (parentsUntil(element, 'e-gridcontent') && parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) {\n      removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop'), ['e-dragborder']);\n      var rowElement = [];\n\n      if (targetRow && targetRow.rowIndex === 0) {\n        var div = this.parent.createElement('div', {\n          className: 'e-firstrow-dragborder'\n        });\n        var gridheaderEle = this.parent.getHeaderContent();\n        gridheaderEle.classList.add('e-grid-relative');\n        div.style.width = node.offsetWidth - this.getScrollWidth() + 'px';\n\n        if (!gridheaderEle.querySelectorAll('.e-firstrow-dragborder').length) {\n          gridheaderEle.appendChild(div);\n        }\n      } else if (targetRow && parseInt(startedRow.getAttribute('aria-rowindex'), 10) > targetRow.rowIndex) {\n        element = this.parent.getRowByIndex(targetRow.rowIndex - 1);\n        rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n      } else {\n        rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n      }\n\n      if (rowElement.length > 0) {\n        addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n      }\n    }\n  };\n\n  RowDD.prototype.getScrollWidth = function () {\n    var scrollElem = this.parent.getContent().firstElementChild;\n    return scrollElem.scrollWidth > scrollElem.offsetWidth ? Scroll.getScrollBarWidth() : 0;\n  };\n\n  RowDD.prototype.removeFirstRowBorder = function (element) {\n    if (this.parent.element.getElementsByClassName('e-firstrow-dragborder').length > 0 && element && element.rowIndex !== 0) {\n      this.parent.element.getElementsByClassName('e-firstrow-dragborder')[0].remove();\n    }\n  };\n\n  RowDD.prototype.removeLastRowBorder = function (element) {\n    var islastRowIndex = element && this.parent.getRowByIndex(this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') !== element.getAttribute('data-uid');\n\n    if (this.parent.element.getElementsByClassName('e-lastrow-dragborder').length > 0 && element && islastRowIndex) {\n      this.parent.element.getElementsByClassName('e-lastrow-dragborder')[0].remove();\n    }\n  };\n\n  RowDD.prototype.removeBorder = function (element) {\n    this.removeFirstRowBorder(element);\n    this.removeLastRowBorder(element);\n    element = this.parent.getRows().filter(function (row) {\n      return row.querySelector('td.e-dragborder');\n    })[0];\n\n    if (element) {\n      var rowElement = [].slice.call(element.querySelectorAll('.e-dragborder'));\n      addRemoveActiveClasses(rowElement, false, 'e-dragborder');\n    }\n  };\n\n  RowDD.prototype.getElementFromPosition = function (element, event) {\n    var target;\n    var position = getPosition(event);\n    element.style.display = 'none';\n    target = document.elementFromPoint(position.x, position.y);\n    element.style.display = '';\n    return target;\n  };\n\n  RowDD.prototype.onDataBound = function (e) {\n    if (this.selectedRowColls.length > 0) {\n      this.parent.selectRows(this.selectedRowColls);\n      this.selectedRowColls = [];\n    }\n  };\n\n  RowDD.prototype.getTargetIdx = function (targetRow) {\n    return targetRow ? parseInt(targetRow.getAttribute('aria-rowindex'), 10) : 0;\n  };\n\n  RowDD.prototype.singleRowDrop = function (e) {\n    var targetRow = closestElement(e.target, 'tr');\n    var currentIndex;\n    var srcControl;\n    srcControl = e.droppedElement.parentElement.ej2_instances[0];\n    currentIndex = targetRow ? targetRow.rowIndex : srcControl.currentViewData.length - 1;\n    this.reorderRow(this.startedRowIndex, currentIndex);\n  };\n\n  RowDD.prototype.columnDrop = function (e) {\n    var gObj = this.parent;\n    var draggObj = e.droppedElement.parentElement.ej2_instances[0];\n\n    if (e.droppedElement.getAttribute('action') !== 'grouping') {\n      var targetRow = closestElement(e.target, 'tr');\n      var srcControl_1;\n      var currentIndex = void 0;\n\n      if (e.droppedElement.querySelector('tr').getAttribute('single-dragrow') !== 'true' && e.droppedElement.parentElement.id === gObj.element.id || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true' && e.droppedElement.parentElement.id !== gObj.element.id) {\n        return;\n      }\n\n      if (e.droppedElement.parentElement.id !== gObj.element.id) {\n        srcControl_1 = e.droppedElement.parentElement.ej2_instances[0];\n      } else if (this.isSingleRowDragDrop || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true') {\n        this.singleRowDrop(e);\n        return;\n      }\n\n      if (srcControl_1.element.id !== gObj.element.id && srcControl_1.rowDropSettings.targetID !== gObj.element.id) {\n        return;\n      }\n\n      var records = srcControl_1.getSelectedRecords();\n      var targetIndex = currentIndex = this.getTargetIdx(targetRow);\n      var count = 0;\n\n      if (isNaN(targetIndex)) {\n        targetIndex = currentIndex = 0;\n      }\n\n      if (gObj.allowPaging) {\n        targetIndex = targetIndex + gObj.pageSettings.currentPage * gObj.pageSettings.pageSize - gObj.pageSettings.pageSize;\n      } //Todo: drag and drop mapper & BatchChanges\n\n\n      if (!isBlazor()) {\n        gObj.notify(events.rowsAdded, {\n          toIndex: targetIndex,\n          records: records\n        });\n        gObj.notify(events.modelChanged, {\n          type: events.actionBegin,\n          requestType: 'rowdraganddrop'\n        });\n        var selectedRows = srcControl_1.getSelectedRowIndexes();\n        var skip = srcControl_1.allowPaging ? srcControl_1.pageSettings.currentPage * srcControl_1.pageSettings.pageSize - srcControl_1.pageSettings.pageSize : 0;\n        this.selectedRows = [];\n\n        for (var i = 0, len = records.length; i < len; i++) {\n          this.selectedRows.push(skip + selectedRows[i]);\n        }\n\n        srcControl_1.notify(events.rowsRemoved, {\n          indexes: this.selectedRows,\n          records: records\n        });\n        srcControl_1.notify(events.modelChanged, {\n          type: events.actionBegin,\n          requestType: 'rowdraganddrop'\n        });\n      } else {\n        var currentVdata_2 = [];\n        var ind_2 = 0;\n        var selectedIndex = srcControl_1.getSelectedRowIndexes();\n        selectedIndex.forEach(function (rec) {\n          currentVdata_2[ind_2] = srcControl_1.currentViewData[rec];\n          ind_2++;\n        });\n        records = currentVdata_2;\n        var changes = {\n          addedRecords: records,\n          deletedRecords: [],\n          changedRecords: []\n        };\n        var dragDropDestinationIndex = 'dragDropDestinationIndex';\n        var query = new Query();\n        query[dragDropDestinationIndex] = targetIndex;\n        gObj.getDataModule().saveChanges(changes, gObj.getPrimaryKeyFieldNames()[0], {}, query).then(function () {\n          gObj.notify(events.modelChanged, {\n            type: events.actionBegin,\n            requestType: 'rowdraganddrop'\n          });\n        }).catch(function (e) {\n          gObj.trigger(events.actionFailure, {\n            error: e\n          });\n        });\n        changes.deletedRecords = records;\n        changes.addedRecords = [];\n        srcControl_1.getDataModule().saveChanges(changes, srcControl_1.getPrimaryKeyFieldNames()[0], {}, query).then(function () {\n          srcControl_1.notify(events.modelChanged, {\n            type: events.actionBegin,\n            requestType: 'rowdraganddrop'\n          });\n        }).catch(function (e) {\n          srcControl_1.trigger(events.actionFailure, {\n            error: e\n          });\n        });\n      }\n    }\n  };\n\n  RowDD.prototype.reorderRow = function (fromIndexes, toIndex) {\n    var gObj = this.parent;\n\n    if (!gObj.sortSettings.columns.length && !gObj.groupSettings.columns.length && !gObj.filterSettings.columns.length) {\n      //Todo: drag and drop mapper & BatchChanges                 \n      var skip = gObj.allowPaging ? gObj.pageSettings.currentPage * gObj.pageSettings.pageSize - gObj.pageSettings.pageSize : 0;\n      var fromIndex = fromIndexes;\n      toIndex = toIndex + skip;\n      this.selectedRows = gObj.getSelectedRowIndexes();\n      gObj.notify(events.rowPositionChanged, {\n        fromIndex: fromIndexes + skip,\n        toIndex: toIndex\n      });\n    }\n  };\n\n  RowDD.prototype.enableAfterRender = function (e) {\n    if (e.module === this.getModuleName() && e.enable) {\n      this.initializeDrag();\n    }\n  };\n  /**\n   * To destroy the print\n   * @return {void}\n   * @hidden\n   */\n\n\n  RowDD.prototype.destroy = function () {\n    var gridElement = this.parent.element;\n\n    if (this.parent.isDestroyed || !gridElement || !gridElement.querySelector('.e-gridheader') && !gridElement.querySelector('.e-gridcontent')) {\n      return;\n    }\n\n    this.draggable.destroy();\n    this.parent.off(events.initialEnd, this.initializeDrag);\n    this.parent.off(events.columnDrop, this.columnDrop);\n    this.parent.removeEventListener(events.dataBound, this.onDataBoundFn);\n    this.parent.off(events.uiUpdate, this.enableAfterRender); //destory ejdrag and drop\n  };\n  /**\n   * For internal use only - Get the module name.\n   * @private\n   */\n\n\n  RowDD.prototype.getModuleName = function () {\n    return 'rowDragAndDrop';\n  };\n\n  RowDD.prototype.processArgs = function (target) {\n    var gObj = this.parent;\n\n    if (gObj.getSelectedRecords().length > 0 && this.startedRow.cells[0].classList.contains('e-selectionbackground') === false || gObj.getSelectedRecords().length === 0) {\n      this.rows = [this.startedRow];\n      this.rowData = this.parent.getRowInfo(this.startedRow.querySelector('.e-rowcell')).rowData;\n    } else {\n      this.rows = gObj.getSelectedRows();\n      this.rowData = gObj.getSelectedRecords();\n    }\n  };\n\n  return RowDD;\n}();\n\nexport { RowDD };","map":{"version":3,"sources":["C:/CN2/workspace-trunk/kain-front-end/node_modules/@syncfusion/ej2-grids/src/grid/actions/row-reorder.js"],"names":["Draggable","isBlazor","removeClass","remove","closest","closestElement","classList","parentsUntil","removeElement","getPosition","addRemoveActiveClasses","isActionPrevent","events","Scroll","Query","RowDD","parent","_this","selectedRows","isOverflowBorder","selectedRowColls","isRefresh","helper","e","gObj","target","draggable","currentStateTarget","visualElement","createElement","className","styles","element","offsetWidth","table","tbody","document","getElementsByClassName","length","rowDropSettings","targetID","sender","contains","selectionSettings","type","mode","selectRow","parseInt","parentElement","getAttribute","startedRow","cloneNode","processArgs","args","selectedRow","rows","dragelement","cloneElement","cancel","data","rowData","getSelectedRows","trigger","rowDragStartHelper","removeCell","exp","RegExp","innerHTML","replace","appendChild","dropCountEle","ele","querySelector","add","dragStart","spanCssEle","getSelectedRecords","style","left","rowDragStart","draggableType","fromIndex","bindEvents","dragElement","dragStartData","dropElem","getElementById","ej2_instances","getModuleName","getContent","drag","getElementFromPosition","event","hoverState","enableHover","trElement","originalEvent","rowDrag","stopTimer","dragTarget","id","rowIndex","elem","groupSettings","columns","updateScrollPostion","moveDragRows","getRowByIndex","getCurrentViewRecords","bottomborder","gridcontentEle","width","getScrollWidth","querySelectorAll","bottom","removeBorder","dragStop","notify","preventBatch","instance","handler","processDragStop","arg1","isDestroyed","targetEle","dropElement","isRowDragable","stRow","dropIndex","rowDrop","selectedIndexes","getSelectedRowIndexes","reorderRows","fromIdx","currentVdata_1","ind_1","forEach","rec","currentViewData","draggedData","changeRecords","addedRecords","deletedRecords","changedRecords","toIdx","dragDropDestinationIndex","query","saveChange","refresh","targetRow","slice","call","filter","cell","deleteCell","cellIndex","on","initialEnd","initializeDrag","columnDrop","onDataBoundFn","onDataBound","bind","addEventListener","dataBound","uiUpdate","enableAfterRender","prototype","getDataModule","saveChanges","getPrimaryKeyFieldNames","then","modelChanged","actionBegin","requestType","catch","actionFailure","error","fromIndexes","toIndex","selectedRecords","draggedRecords","renderModule","dataManager","dataSource","json","dropIdx","actualIdx","i","len","j","len1","JSON","stringify","reorderRow","window","clearInterval","timer","distance","frzCols","getFrozenColumns","y","cliRect","getBoundingClientRect","rowHeight","getRowHeight","scrollElem","firstElementChild","top","scrollPixel_1","setInterval","setScrollDown","clientHeight","scrollPixel_2","scrollPixel","isLeft","scrollTop","targetElement","setBorder","node","removeFirstRowBorder","removeLastRowBorder","rowElement","div","gridheaderEle","getHeaderContent","scrollWidth","getScrollBarWidth","islastRowIndex","getRows","row","position","display","elementFromPoint","x","selectRows","getTargetIdx","singleRowDrop","currentIndex","srcControl","droppedElement","startedRowIndex","draggObj","srcControl_1","isSingleRowDragDrop","records","targetIndex","count","isNaN","allowPaging","pageSettings","currentPage","pageSize","rowsAdded","skip","push","rowsRemoved","indexes","currentVdata_2","ind_2","selectedIndex","changes","sortSettings","filterSettings","rowPositionChanged","module","enable","destroy","gridElement","off","removeEventListener","cells","getRowInfo"],"mappings":"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","sourcesContent":["import { Draggable, isBlazor } from '@syncfusion/ej2-base';\nimport { removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest as closestElement, classList } from '@syncfusion/ej2-base';\nimport { parentsUntil, removeElement, getPosition, addRemoveActiveClasses, isActionPrevent } from '../base/util';\nimport * as events from '../base/constant';\nimport { Scroll } from '../actions/scroll';\nimport { Query } from '@syncfusion/ej2-data';\n/**\n *\n * Reorder module is used to handle row reordering.\n * @hidden\n */\nvar RowDD = /** @class */ (function () {\n    /**\n     * Constructor for the Grid print module\n     * @hidden\n     */\n    function RowDD(parent) {\n        var _this = this;\n        this.selectedRows = [];\n        this.isOverflowBorder = true;\n        this.selectedRowColls = [];\n        this.isRefresh = true;\n        /* tslint:disable-next-line:max-line-length */\n        // tslint:disable-next-line:max-func-body-length\n        this.helper = function (e) {\n            var gObj = _this.parent;\n            var target = _this.draggable.currentStateTarget;\n            var visualElement = _this.parent.createElement('div', {\n                className: 'e-cloneproperties e-draganddrop e-grid e-dragclone',\n                styles: 'height:\"auto\", z-index:2, width:' + gObj.element.offsetWidth\n            });\n            var table = _this.parent.createElement('table', { styles: 'width:' + gObj.element.offsetWidth });\n            var tbody = _this.parent.createElement('tbody');\n            if (document.getElementsByClassName('e-griddragarea').length ||\n                (gObj.rowDropSettings.targetID && (!e.sender.target.classList.contains('e-selectionbackground')\n                    && gObj.selectionSettings.type !== 'Single')) ||\n                (!gObj.rowDropSettings.targetID && !parentsUntil(e.sender.target, 'e-rowdragdrop'))) {\n                return false;\n            }\n            if (gObj.rowDropSettings.targetID &&\n                gObj.selectionSettings.mode === 'Row' && gObj.selectionSettings.type === 'Single') {\n                gObj.selectRow(parseInt(_this.draggable.currentStateTarget.parentElement.getAttribute('aria-rowindex'), 10));\n            }\n            _this.startedRow = closestElement(target, 'tr').cloneNode(true);\n            _this.processArgs(target);\n            var args = {\n                selectedRow: _this.rows, dragelement: target,\n                cloneElement: visualElement, cancel: false, data: _this.rowData\n            };\n            var selectedRows = gObj.getSelectedRows();\n            gObj.trigger(events.rowDragStartHelper, args);\n            var cancel = 'cancel';\n            var cloneElement = 'cloneElement';\n            if (args[cancel]) {\n                return false;\n            }\n            removeElement(_this.startedRow, '.e-indentcell');\n            removeElement(_this.startedRow, '.e-detailrowcollapse');\n            removeElement(_this.startedRow, '.e-detailrowexpand');\n            _this.removeCell(_this.startedRow, 'e-gridchkbox');\n            var exp = new RegExp('e-active', 'g'); //high contrast issue\n            _this.startedRow.innerHTML = _this.startedRow.innerHTML.replace(exp, '');\n            tbody.appendChild(_this.startedRow);\n            if (gObj.getSelectedRows().length > 1) {\n                var dropCountEle = _this.parent.createElement('span', {\n                    className: 'e-dropitemscount', innerHTML: '' + selectedRows.length,\n                });\n                visualElement.appendChild(dropCountEle);\n            }\n            var ele = closestElement(target, 'tr').querySelector('.e-icon-rowdragicon');\n            if (ele) {\n                ele.classList.add('e-dragstartrow');\n            }\n            table.appendChild(tbody);\n            visualElement.appendChild(table);\n            gObj.element.appendChild(visualElement);\n            return visualElement;\n        };\n        this.dragStart = function (e) {\n            var gObj = _this.parent;\n            if (document.getElementsByClassName('e-griddragarea').length) {\n                return;\n            }\n            var target = e.target;\n            var spanCssEle = _this.parent.element.querySelector('.e-dropitemscount');\n            if (_this.parent.getSelectedRecords().length > 1 && spanCssEle) {\n                spanCssEle.style.left = _this.parent.element.querySelector('.e-cloneproperties table')\n                    .offsetWidth - 5 + 'px';\n            }\n            _this.processArgs(target);\n            gObj.trigger(events.rowDragStart, {\n                rows: _this.rows,\n                target: e.target, draggableType: 'rows', fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n                data: _this.rowData\n            });\n            if (isBlazor()) {\n                e.bindEvents(e.dragElement);\n            }\n            _this.dragStartData = _this.rowData;\n            var dropElem = document.getElementById(gObj.rowDropSettings.targetID);\n            if (gObj.rowDropSettings.targetID && dropElem && dropElem.ej2_instances &&\n                dropElem.ej2_instances[0].getModuleName() === 'grid') {\n                dropElem.ej2_instances[0].getContent().classList.add('e-allowRowDrop');\n            }\n        };\n        this.drag = function (e) {\n            var gObj = _this.parent;\n            var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n            var target = _this.getElementFromPosition(cloneElement, e.event);\n            classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur', 'e-movecur']);\n            _this.isOverflowBorder = true;\n            _this.hoverState = gObj.enableHover;\n            var trElement = parentsUntil(target, 'e-grid') ? closestElement(e.target, 'tr') : null;\n            gObj.enableHover = false;\n            if (!e.target) {\n                return;\n            }\n            _this.processArgs(target);\n            var args = {\n                rows: _this.rows, target: target, draggableType: 'rows',\n                data: _this.rowData, originalEvent: e, cancel: false\n            };\n            gObj.trigger(events.rowDrag, args);\n            _this.stopTimer();\n            if (args.cancel) {\n                return;\n            }\n            gObj.element.classList.add('e-rowdrag');\n            _this.dragTarget = trElement && parentsUntil(target, 'e-grid').id === cloneElement.parentElement.id ?\n                trElement.rowIndex : parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10);\n            if (gObj.rowDropSettings.targetID) {\n                if (!parentsUntil(target, 'e-gridcontent') ||\n                    parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id) {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n                }\n                else {\n                    classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n                }\n            }\n            else {\n                var elem = parentsUntil(target, 'e-grid');\n                if (elem && elem.id === cloneElement.parentElement.id) {\n                    classList(cloneElement, ['e-movecur'], ['e-defaultcur']);\n                }\n                else {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n                }\n            }\n            if (!gObj.rowDropSettings.targetID &&\n                (!gObj.groupSettings.columns.length || e.target.classList.contains('e-selectionbackground'))) {\n                if (parentsUntil(target, 'e-grid')) {\n                    _this.updateScrollPostion(e.event, target);\n                }\n                if (_this.isOverflowBorder && parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10) !== _this.dragTarget) {\n                    _this.moveDragRows(e, _this.startedRow, trElement);\n                }\n                else {\n                    if (trElement && _this.parent.getRowByIndex(_this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') ===\n                        trElement.getAttribute('data-uid')) {\n                        var bottomborder = _this.parent.createElement('div', { className: 'e-lastrow-dragborder' });\n                        var gridcontentEle = _this.parent.getContent();\n                        bottomborder.style.width = _this.parent.element.offsetWidth - _this.getScrollWidth() + 'px';\n                        if (!gridcontentEle.querySelectorAll('.e-lastrow-dragborder').length) {\n                            gridcontentEle.classList.add('e-grid-relative');\n                            gridcontentEle.appendChild(bottomborder);\n                            bottomborder.style.bottom = _this.getScrollWidth() + 'px';\n                        }\n                    }\n                    _this.removeBorder(trElement);\n                }\n            }\n        };\n        this.dragStop = function (e) {\n            if (isActionPrevent(_this.parent)) {\n                _this.parent.notify(events.preventBatch, {\n                    instance: _this, handler: _this.processDragStop, arg1: e\n                });\n            }\n            else {\n                _this.processDragStop(e);\n            }\n        };\n        this.processDragStop = function (e) {\n            var gObj = _this.parent;\n            if (_this.parent.isDestroyed) {\n                return;\n            }\n            var targetEle = _this.getElementFromPosition(e.helper, e.event);\n            var target = targetEle && !targetEle.classList.contains('e-dlg-overlay') ?\n                targetEle : e.target;\n            var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n            gObj.element.classList.remove('e-rowdrag');\n            var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n            if (gObj.rowDropSettings.targetID && dropElement && dropElement.ej2_instances &&\n                dropElement.ej2_instances[0].getModuleName() === 'grid') {\n                dropElement.ej2_instances[0].getContent().classList.remove('e-allowRowDrop');\n            }\n            if (gObj.isRowDragable()) {\n                _this.stopTimer();\n                gObj.enableHover = _this.hoverState;\n                _this.parent.getContent().classList.remove('e-grid-relative');\n                _this.removeBorder(targetEle);\n                var stRow = gObj.element.querySelector('.e-dragstartrow');\n                if (stRow) {\n                    stRow.classList.remove('e-dragstartrow');\n                }\n            }\n            _this.processArgs(target);\n            var args = {\n                target: target, draggableType: 'rows',\n                cancel: false,\n                fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n                dropIndex: _this.dragTarget,\n                rows: _this.rows, data: _this.dragStartData\n            };\n            gObj.trigger(events.rowDrop, args);\n            if (!parentsUntil(target, 'e-gridcontent') || args.cancel) {\n                _this.dragTarget = null;\n                remove(e.helper);\n                return;\n            }\n            _this.isRefresh = false;\n            var selectedIndexes = _this.parent.getSelectedRowIndexes();\n            if (gObj.isRowDragable()) {\n                if (!isBlazor()) {\n                    if (!_this.parent.rowDropSettings.targetID &&\n                        _this.startedRow.querySelector('td.e-selectionbackground') && selectedIndexes.length > 1 &&\n                        selectedIndexes.length !== _this.parent.getCurrentViewRecords().length) {\n                        _this.reorderRows(selectedIndexes, args.dropIndex);\n                    }\n                    else {\n                        _this.reorderRows([parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10)], _this.dragTarget);\n                    }\n                }\n                else {\n                    var fromIdx = parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10);\n                    var currentVdata_1 = [];\n                    var ind_1 = 0;\n                    selectedIndexes.forEach(function (rec) {\n                        currentVdata_1[ind_1] = _this.parent.currentViewData[rec];\n                        ind_1++;\n                    });\n                    if (!(_this.parent.rowDropSettings.targetID && selectedIndexes.length)) {\n                        currentVdata_1[ind_1] = _this.parent.currentViewData[fromIdx];\n                    }\n                    var draggedData = _this.parent.getSelectedRecords().length ? _this.parent.getSelectedRecords() : (currentVdata_1);\n                    var changeRecords = {\n                        addedRecords: [],\n                        deletedRecords: draggedData,\n                        changedRecords: []\n                    };\n                    var toIdx = _this.dragTarget ? _this.dragTarget : args.dropIndex;\n                    toIdx = (toIdx - draggedData.length + 1) > 0 ? (toIdx - draggedData.length + 1) : toIdx;\n                    var dragDropDestinationIndex = 'dragDropDestinationIndex';\n                    var query = new Query;\n                    query[dragDropDestinationIndex] = toIdx;\n                    _this.saveChange(changeRecords, query);\n                    changeRecords.deletedRecords = [];\n                    changeRecords.addedRecords = draggedData;\n                    _this.saveChange(changeRecords, query);\n                }\n                _this.dragTarget = null;\n                if (!gObj.rowDropSettings.targetID) {\n                    remove(e.helper);\n                    gObj.refresh();\n                }\n            }\n            _this.isRefresh = true;\n        };\n        this.removeCell = function (targetRow, className) {\n            return [].slice.call(targetRow.querySelectorAll('td')).filter(function (cell) {\n                if (cell.classList.contains(className)) {\n                    targetRow.deleteCell(cell.cellIndex);\n                }\n            });\n        };\n        this.parent = parent;\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.initialEnd, this.initializeDrag, this);\n        this.parent.on(events.columnDrop, this.columnDrop, this);\n        this.onDataBoundFn = this.onDataBound.bind(this);\n        this.parent.addEventListener(events.dataBound, this.onDataBoundFn);\n        this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n    }\n    RowDD.prototype.saveChange = function (changeRecords, query) {\n        var _this = this;\n        this.parent.getDataModule().saveChanges(changeRecords, this.parent.getPrimaryKeyFieldNames()[0], {}, query)\n            .then(function () {\n            _this.parent.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n        }).catch(function (e) {\n            _this.parent.trigger(events.actionFailure, { error: e });\n        });\n    };\n    RowDD.prototype.reorderRows = function (fromIndexes, toIndex) {\n        var selectedIndexes = this.parent.getSelectedRowIndexes();\n        var selectedRecords = [];\n        var draggedRecords = [];\n        var currentViewData = this.parent.renderModule.data.dataManager.dataSource.json;\n        var dropIdx = toIndex;\n        var actualIdx = fromIndexes[0];\n        for (var i = 0, len = fromIndexes.length; i < len; i++) {\n            draggedRecords[i] = currentViewData[fromIndexes[i]];\n        }\n        for (var i = 0, len = selectedIndexes.length; i < len; i++) {\n            selectedRecords[i] = currentViewData[selectedIndexes[i]];\n        }\n        for (var i = 0, len = draggedRecords.length; i < len; i++) {\n            if (i !== 0) {\n                for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                    if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) ===\n                        JSON.stringify(draggedRecords[i])) {\n                        actualIdx = j;\n                        break;\n                    }\n                }\n                for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                    if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i - 1])) {\n                        if (actualIdx > j) {\n                            dropIdx = j + 1;\n                        }\n                        break;\n                    }\n                }\n            }\n            this.reorderRow(actualIdx, dropIdx);\n        }\n        if (this.isRefresh) {\n            this.parent.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n        }\n        for (var i = 0, len = selectedRecords.length; i < len; i++) {\n            for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(selectedRecords[i])) {\n                    selectedIndexes[i] = j;\n                    break;\n                }\n            }\n        }\n        this.selectedRowColls = selectedIndexes;\n    };\n    RowDD.prototype.stopTimer = function () {\n        window.clearInterval(this.timer);\n    };\n    RowDD.prototype.initializeDrag = function () {\n        var gObj = this.parent;\n        this.draggable = new Draggable(gObj.getContent(), {\n            dragTarget: '.e-rowcelldrag, .e-rowdragdrop, .e-rowcell',\n            distance: 5,\n            helper: this.helper,\n            dragStart: this.dragStart,\n            drag: this.drag,\n            dragStop: this.dragStop\n        });\n    };\n    RowDD.prototype.updateScrollPostion = function (e, target) {\n        var _this = this;\n        var frzCols = this.parent.getFrozenColumns();\n        var y = getPosition(e).y;\n        var cliRect = this.parent.getContent().getBoundingClientRect();\n        var rowHeight = this.parent.getRowHeight() - 15;\n        var scrollElem = frzCols ? this.parent.getContent().querySelector('.e-movablecontent')\n            : this.parent.getContent().firstElementChild;\n        if (cliRect.top + rowHeight >= y) {\n            var scrollPixel_1 = -(this.parent.getRowHeight());\n            this.isOverflowBorder = false;\n            this.timer = window.setInterval(function () { _this.setScrollDown(scrollElem, scrollPixel_1, true); }, 200);\n        }\n        else if (cliRect.top + this.parent.getContent().clientHeight - rowHeight - 33 <= y) {\n            var scrollPixel_2 = (this.parent.getRowHeight());\n            this.isOverflowBorder = false;\n            this.timer = window.setInterval(function () { _this.setScrollDown(scrollElem, scrollPixel_2, true); }, 200);\n        }\n    };\n    RowDD.prototype.setScrollDown = function (scrollElem, scrollPixel, isLeft) {\n        scrollElem.scrollTop = scrollElem.scrollTop + scrollPixel;\n    };\n    RowDD.prototype.moveDragRows = function (e, startedRow, targetRow) {\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        var element = closestElement(e.target, 'tr');\n        if (parentsUntil(element, 'e-gridcontent') && parentsUntil(cloneElement.parentElement, 'e-grid').id ===\n            parentsUntil(element, 'e-grid').id) {\n            var targetElement = element ?\n                element : this.startedRow;\n            this.setBorder(targetElement, e.event, startedRow, targetRow);\n        }\n    };\n    RowDD.prototype.setBorder = function (element, event, startedRow, targetRow) {\n        var node = this.parent.element;\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        this.removeFirstRowBorder(element);\n        this.removeLastRowBorder(element);\n        if (parentsUntil(element, 'e-gridcontent') && parentsUntil(cloneElement.parentElement, 'e-grid').id ===\n            parentsUntil(element, 'e-grid').id) {\n            removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop'), ['e-dragborder']);\n            var rowElement = [];\n            if (targetRow && targetRow.rowIndex === 0) {\n                var div = this.parent.createElement('div', { className: 'e-firstrow-dragborder' });\n                var gridheaderEle = this.parent.getHeaderContent();\n                gridheaderEle.classList.add('e-grid-relative');\n                div.style.width = node.offsetWidth - this.getScrollWidth() + 'px';\n                if (!gridheaderEle.querySelectorAll('.e-firstrow-dragborder').length) {\n                    gridheaderEle.appendChild(div);\n                }\n            }\n            else if (targetRow && parseInt(startedRow.getAttribute('aria-rowindex'), 10) > targetRow.rowIndex) {\n                element = this.parent.getRowByIndex(targetRow.rowIndex - 1);\n                rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n            }\n            else {\n                rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n            }\n            if (rowElement.length > 0) {\n                addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n            }\n        }\n    };\n    RowDD.prototype.getScrollWidth = function () {\n        var scrollElem = this.parent.getContent().firstElementChild;\n        return scrollElem.scrollWidth > scrollElem.offsetWidth ? Scroll.getScrollBarWidth() : 0;\n    };\n    RowDD.prototype.removeFirstRowBorder = function (element) {\n        if (this.parent.element.getElementsByClassName('e-firstrow-dragborder').length > 0 && element &&\n            element.rowIndex !== 0) {\n            this.parent.element.getElementsByClassName('e-firstrow-dragborder')[0].remove();\n        }\n    };\n    RowDD.prototype.removeLastRowBorder = function (element) {\n        var islastRowIndex = element &&\n            this.parent.getRowByIndex(this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') !==\n                element.getAttribute('data-uid');\n        if (this.parent.element.getElementsByClassName('e-lastrow-dragborder').length > 0 && element && islastRowIndex) {\n            this.parent.element.getElementsByClassName('e-lastrow-dragborder')[0].remove();\n        }\n    };\n    RowDD.prototype.removeBorder = function (element) {\n        this.removeFirstRowBorder(element);\n        this.removeLastRowBorder(element);\n        element = this.parent.getRows().filter(function (row) {\n            return row.querySelector('td.e-dragborder');\n        })[0];\n        if (element) {\n            var rowElement = [].slice.call(element.querySelectorAll('.e-dragborder'));\n            addRemoveActiveClasses(rowElement, false, 'e-dragborder');\n        }\n    };\n    RowDD.prototype.getElementFromPosition = function (element, event) {\n        var target;\n        var position = getPosition(event);\n        element.style.display = 'none';\n        target = document.elementFromPoint(position.x, position.y);\n        element.style.display = '';\n        return target;\n    };\n    RowDD.prototype.onDataBound = function (e) {\n        if (this.selectedRowColls.length > 0) {\n            this.parent.selectRows(this.selectedRowColls);\n            this.selectedRowColls = [];\n        }\n    };\n    RowDD.prototype.getTargetIdx = function (targetRow) {\n        return targetRow ? parseInt(targetRow.getAttribute('aria-rowindex'), 10) : 0;\n    };\n    RowDD.prototype.singleRowDrop = function (e) {\n        var targetRow = closestElement(e.target, 'tr');\n        var currentIndex;\n        var srcControl;\n        srcControl = e.droppedElement.parentElement.ej2_instances[0];\n        currentIndex = targetRow ? targetRow.rowIndex : srcControl.currentViewData.length - 1;\n        this.reorderRow(this.startedRowIndex, currentIndex);\n    };\n    RowDD.prototype.columnDrop = function (e) {\n        var gObj = this.parent;\n        var draggObj = e.droppedElement.parentElement.ej2_instances[0];\n        if (e.droppedElement.getAttribute('action') !== 'grouping') {\n            var targetRow = closestElement(e.target, 'tr');\n            var srcControl_1;\n            var currentIndex = void 0;\n            if ((e.droppedElement.querySelector('tr').getAttribute('single-dragrow') !== 'true' &&\n                e.droppedElement.parentElement.id === gObj.element.id)\n                || (e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true' &&\n                    e.droppedElement.parentElement.id !== gObj.element.id)) {\n                return;\n            }\n            if (e.droppedElement.parentElement.id !== gObj.element.id) {\n                srcControl_1 = e.droppedElement.parentElement.ej2_instances[0];\n            }\n            else if (this.isSingleRowDragDrop || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true') {\n                this.singleRowDrop(e);\n                return;\n            }\n            if (srcControl_1.element.id !== gObj.element.id && srcControl_1.rowDropSettings.targetID !== gObj.element.id) {\n                return;\n            }\n            var records = srcControl_1.getSelectedRecords();\n            var targetIndex = currentIndex = this.getTargetIdx(targetRow);\n            var count = 0;\n            if (isNaN(targetIndex)) {\n                targetIndex = currentIndex = 0;\n            }\n            if (gObj.allowPaging) {\n                targetIndex = targetIndex + (gObj.pageSettings.currentPage * gObj.pageSettings.pageSize) - gObj.pageSettings.pageSize;\n            }\n            //Todo: drag and drop mapper & BatchChanges\n            if (!isBlazor()) {\n                gObj.notify(events.rowsAdded, { toIndex: targetIndex, records: records });\n                gObj.notify(events.modelChanged, {\n                    type: events.actionBegin, requestType: 'rowdraganddrop'\n                });\n                var selectedRows = srcControl_1.getSelectedRowIndexes();\n                var skip = srcControl_1.allowPaging ?\n                    (srcControl_1.pageSettings.currentPage * srcControl_1.pageSettings.pageSize) - srcControl_1.pageSettings.pageSize : 0;\n                this.selectedRows = [];\n                for (var i = 0, len = records.length; i < len; i++) {\n                    this.selectedRows.push(skip + selectedRows[i]);\n                }\n                srcControl_1.notify(events.rowsRemoved, { indexes: this.selectedRows, records: records });\n                srcControl_1.notify(events.modelChanged, {\n                    type: events.actionBegin, requestType: 'rowdraganddrop'\n                });\n            }\n            else {\n                var currentVdata_2 = [];\n                var ind_2 = 0;\n                var selectedIndex = srcControl_1.getSelectedRowIndexes();\n                selectedIndex.forEach(function (rec) {\n                    currentVdata_2[ind_2] = srcControl_1.currentViewData[rec];\n                    ind_2++;\n                });\n                records = currentVdata_2;\n                var changes = {\n                    addedRecords: records,\n                    deletedRecords: [],\n                    changedRecords: []\n                };\n                var dragDropDestinationIndex = 'dragDropDestinationIndex';\n                var query = new Query;\n                query[dragDropDestinationIndex] = targetIndex;\n                gObj.getDataModule().saveChanges(changes, gObj.getPrimaryKeyFieldNames()[0], {}, query)\n                    .then(function () {\n                    gObj.notify(events.modelChanged, {\n                        type: events.actionBegin, requestType: 'rowdraganddrop'\n                    });\n                }).catch(function (e) {\n                    gObj.trigger(events.actionFailure, { error: e });\n                });\n                changes.deletedRecords = records;\n                changes.addedRecords = [];\n                srcControl_1.getDataModule().saveChanges(changes, srcControl_1.getPrimaryKeyFieldNames()[0], {}, query)\n                    .then(function () {\n                    srcControl_1.notify(events.modelChanged, {\n                        type: events.actionBegin, requestType: 'rowdraganddrop'\n                    });\n                }).catch(function (e) {\n                    srcControl_1.trigger(events.actionFailure, { error: e });\n                });\n            }\n        }\n    };\n    RowDD.prototype.reorderRow = function (fromIndexes, toIndex) {\n        var gObj = this.parent;\n        if (!gObj.sortSettings.columns.length && !gObj.groupSettings.columns.length && !gObj.filterSettings.columns.length) {\n            //Todo: drag and drop mapper & BatchChanges                 \n            var skip = gObj.allowPaging ?\n                (gObj.pageSettings.currentPage * gObj.pageSettings.pageSize) - gObj.pageSettings.pageSize : 0;\n            var fromIndex = fromIndexes;\n            toIndex = toIndex + skip;\n            this.selectedRows = gObj.getSelectedRowIndexes();\n            gObj.notify(events.rowPositionChanged, {\n                fromIndex: fromIndexes + skip,\n                toIndex: toIndex\n            });\n        }\n    };\n    RowDD.prototype.enableAfterRender = function (e) {\n        if (e.module === this.getModuleName() && e.enable) {\n            this.initializeDrag();\n        }\n    };\n    /**\n     * To destroy the print\n     * @return {void}\n     * @hidden\n     */\n    RowDD.prototype.destroy = function () {\n        var gridElement = this.parent.element;\n        if (this.parent.isDestroyed || !gridElement || (!gridElement.querySelector('.e-gridheader') &&\n            !gridElement.querySelector('.e-gridcontent'))) {\n            return;\n        }\n        this.draggable.destroy();\n        this.parent.off(events.initialEnd, this.initializeDrag);\n        this.parent.off(events.columnDrop, this.columnDrop);\n        this.parent.removeEventListener(events.dataBound, this.onDataBoundFn);\n        this.parent.off(events.uiUpdate, this.enableAfterRender);\n        //destory ejdrag and drop\n    };\n    /**\n     * For internal use only - Get the module name.\n     * @private\n     */\n    RowDD.prototype.getModuleName = function () {\n        return 'rowDragAndDrop';\n    };\n    RowDD.prototype.processArgs = function (target) {\n        var gObj = this.parent;\n        if ((gObj.getSelectedRecords().length > 0 && this.startedRow.cells[0].classList.contains('e-selectionbackground') === false)\n            || gObj.getSelectedRecords().length === 0) {\n            this.rows = [this.startedRow];\n            this.rowData = this.parent.getRowInfo((this.startedRow).querySelector('.e-rowcell')).rowData;\n        }\n        else {\n            this.rows = gObj.getSelectedRows();\n            this.rowData = gObj.getSelectedRecords();\n        }\n    };\n    return RowDD;\n}());\nexport { RowDD };\n"]},"metadata":{},"sourceType":"module"}