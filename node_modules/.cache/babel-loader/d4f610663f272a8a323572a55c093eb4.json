{"ast":null,"code":"import { isNullOrUndefined, closest, extend, updateBlazorTemplate } from '@syncfusion/ej2-base';\nimport { InlineEditRender } from './inline-edit-renderer';\nimport { BatchEditRender } from './batch-edit-renderer';\nimport { DialogEditRender } from './dialog-edit-renderer';\nimport { attributes, classList, isBlazor } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { getComplexFieldID, getObject, appendChildren } from '../base/util';\nimport * as events from '../base/constant';\n/**\n * Edit render module is used to render grid edit row.\n * @hidden\n */\n\nvar EditRender =\n/** @class */\nfunction () {\n  /**\n   * Constructor for render module\n   */\n  function EditRender(parent, serviceLocator) {\n    //Internal variables               \n    this.editType = {\n      'Inline': InlineEditRender,\n      'Normal': InlineEditRender,\n      'Batch': BatchEditRender,\n      'Dialog': DialogEditRender\n    };\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.renderer = new this.editType[this.parent.editSettings.mode](parent, serviceLocator);\n    this.focus = serviceLocator.getService('focus');\n  }\n\n  EditRender.prototype.addNew = function (args) {\n    this.renderer.addNew(this.getEditElements(args), args);\n    this.convertWidget(args);\n  };\n\n  EditRender.prototype.update = function (args) {\n    this.renderer.update(this.getEditElements(args), args);\n    this.parent.notify(events.beforeStartEdit, args);\n    this.convertWidget(args);\n  };\n\n  EditRender.prototype.convertWidget = function (args) {\n    var gObj = this.parent;\n    var isFocused;\n    var cell;\n    var value;\n    var fForm;\n    var frzCols = gObj.getFrozenColumns();\n    var form = gObj.editSettings.mode === 'Dialog' ? document.querySelector('#' + gObj.element.id + '_dialogEdit_wrapper').querySelector('.e-gridform') : gObj.element.querySelector('.e-gridform');\n\n    if (frzCols && gObj.editSettings.mode === 'Normal') {\n      var rowIndex = parseInt(args.row.getAttribute('aria-rowindex'), 10);\n\n      if (gObj.frozenRows && (args.requestType === 'add' && gObj.editSettings.newRowPosition === 'Top' || rowIndex < gObj.frozenRows)) {\n        fForm = gObj.element.querySelector('.e-movableheader').querySelector('.e-gridform');\n      } else {\n        fForm = gObj.element.querySelector('.e-movablecontent').querySelector('.e-gridform');\n      }\n    }\n\n    var cols = gObj.editSettings.mode !== 'Batch' ? gObj.getColumns() : [gObj.getColumnByField(args.columnName)];\n\n    for (var _i = 0, cols_1 = cols; _i < cols_1.length; _i++) {\n      var col = cols_1[_i];\n\n      if (this.parent.editSettings.template && !isNullOrUndefined(col.field)) {\n        var cellArgs = extend({}, args);\n        cellArgs.element = form.querySelector('[name=' + getComplexFieldID(col.field) + ']');\n\n        if (isNullOrUndefined(cellArgs.element) && frzCols) {\n          cellArgs.element = fForm.querySelector('[name=' + getComplexFieldID(col.field) + ']');\n        }\n\n        if (typeof col.edit.write === 'string') {\n          getObject(col.edit.write, window)(cellArgs);\n        } else {\n          col.edit.write(cellArgs);\n        }\n\n        continue;\n      }\n\n      if (this.parent.editModule.checkColumnIsGrouped(col) || col.commands) {\n        continue;\n      }\n\n      value = col.valueAccessor(col.field, args.rowData, col);\n\n      if (frzCols && cols.indexOf(col) >= frzCols && gObj.editSettings.mode === 'Normal') {\n        cell = fForm.querySelector('[e-mappinguid=' + col.uid + ']');\n      } else {\n        cell = form.querySelector('[e-mappinguid=' + col.uid + ']');\n      }\n\n      var temp = col.edit.write;\n\n      if (!isNullOrUndefined(cell)) {\n        if (typeof temp === 'string') {\n          temp = getObject(temp, window);\n          temp({\n            rowData: args.rowData,\n            element: cell,\n            column: col,\n            requestType: args.requestType,\n            row: args.row,\n            foreignKeyData: col.isForeignColumn() && getObject(col.field, args.foreignKeyData)\n          });\n        } else {\n          col.edit.write({\n            rowData: args.rowData,\n            element: cell,\n            column: col,\n            requestType: args.requestType,\n            row: args.row,\n            foreignKeyData: col.isForeignColumn() && getObject(col.field, args.foreignKeyData)\n          });\n        }\n\n        if (!isFocused && !cell.getAttribute('disabled')) {\n          this.focusElement(cell, args.type);\n          isFocused = true;\n        }\n      }\n    }\n\n    if (frzCols !== 0 && !this.parent.allowTextWrap && (args.requestType === 'add' || args.requestType === 'beginEdit') && this.parent.editSettings.mode !== 'Dialog' && !isNullOrUndefined(form) && !isNullOrUndefined(fForm)) {\n      var mTdElement = fForm.querySelector('tr').children[0];\n      var fTdElement = form.querySelector('tr').children[0];\n\n      if (fTdElement.offsetHeight > mTdElement.offsetHeight) {\n        mTdElement.style.height = fTdElement.offsetHeight + 'px';\n      } else {\n        fTdElement.style.height = mTdElement.offsetHeight + 'px';\n      }\n    }\n  };\n\n  EditRender.prototype.focusElement = function (elem, type) {\n    var chkBox = this.parent.element.querySelector('.e-edit-checkselect');\n\n    if (!isNullOrUndefined(chkBox)) {\n      chkBox.nextElementSibling.classList.add('e-focus');\n    }\n\n    if (this.parent.editSettings.mode === 'Batch') {\n      this.focus.onClick({\n        target: closest(elem, 'td')\n      }, true);\n    } else {\n      elem.focus();\n    }\n\n    if (elem.classList.contains('e-defaultcell')) {\n      elem.setSelectionRange(elem.value.length, elem.value.length);\n    }\n  };\n\n  EditRender.prototype.getEditElements = function (args) {\n    var _this = this;\n\n    var gObj = this.parent;\n    var elements = {};\n    var cols = gObj.editSettings.mode !== 'Batch' ? gObj.getColumns() : [gObj.getColumnByField(args.columnName)];\n\n    if (this.parent.editSettings.template) {\n      return {};\n    }\n\n    for (var i = 0, len = cols.length; i < len; i++) {\n      var col = cols[i];\n\n      if (this.parent.editModule.checkColumnIsGrouped(col)) {\n        continue;\n      }\n\n      if (col.commands || col.commandsTemplate) {\n        var cells = void 0;\n        var cellRendererFact = this.serviceLocator.getService('cellRendererFactory');\n        var model = new RowModelGenerator(this.parent);\n        var cellRenderer = cellRendererFact.getCellRenderer(CellType.CommandColumn);\n        cells = model.generateRows(args.rowData)[0].cells;\n        var cell = cells.filter(function (cell) {\n          return cell.rowID;\n        });\n        var td = cellRenderer.render(cell[i], args.rowData, {\n          'index': args.row ? args.row.getAttribute('aria-rowindex') : 0\n        });\n        var div = td.firstElementChild;\n        div.setAttribute('textAlign', td.getAttribute('textAlign'));\n        elements[col.uid] = div;\n        continue;\n      }\n\n      var value = col.valueAccessor(col.field, args.rowData, col);\n      var tArgs = {\n        column: col,\n        value: value,\n        type: args.requestType,\n        data: args.rowData\n      };\n      var temp = col.edit.create;\n      var input = void 0;\n\n      if (col.editTemplate) {\n        input = this.parent.createElement('span', {\n          attrs: {\n            'e-mappinguid': col.uid\n          }\n        });\n        var tempID = this.parent.element.id + col.uid + 'editTemplate';\n        var tempData = extend({}, {}, args.rowData, true);\n        appendChildren(input, col.getEditTemplate()(tempData, this.parent, 'editTemplate', tempID));\n\n        if (isBlazor()) {\n          var setRules = function (ruleColumn) {\n            var column = ruleColumn;\n\n            var func = function () {\n              _this.parent.editModule.formObj.rules[column.field] = column.validationRules;\n            };\n\n            return func;\n          };\n\n          updateBlazorTemplate(tempID, 'EditTemplate', col, true, setRules(col));\n        }\n      } else {\n        if (typeof temp === 'string') {\n          temp = getObject(temp, window);\n          input = temp(tArgs);\n        } else {\n          input = col.edit.create(tArgs);\n        }\n\n        if (typeof input === 'string') {\n          var div = this.parent.createElement('div');\n          div.innerHTML = input;\n          input = div.firstChild;\n        }\n\n        var isInput = input.tagName !== 'input' && input.querySelectorAll('input').length;\n        var complexFieldName = getComplexFieldID(col.field);\n        attributes(isInput ? input.querySelector('input') : input, {\n          name: complexFieldName,\n          'e-mappinguid': col.uid,\n          id: gObj.element.id + complexFieldName\n        });\n        classList(input, ['e-input', 'e-field'], []);\n\n        if (col.textAlign === 'Right') {\n          input.classList.add('e-ralign');\n        }\n\n        if ((col.isPrimaryKey || col.isIdentity) && args.requestType === 'beginEdit' || col.isIdentity && args.requestType === 'add') {\n          // already disabled in cell plugins\n          input.setAttribute('disabled', '');\n        }\n      }\n\n      elements[col.uid] = input;\n    }\n\n    return elements;\n  };\n\n  EditRender.prototype.destroy = function () {\n    this.renderer.removeEventListener();\n  };\n\n  return EditRender;\n}();\n\nexport { EditRender };","map":{"version":3,"sources":["C:/CN2/workspace-trunk/kain-front-end/node_modules/@syncfusion/ej2-grids/src/grid/renderer/edit-renderer.js"],"names":["isNullOrUndefined","closest","extend","updateBlazorTemplate","InlineEditRender","BatchEditRender","DialogEditRender","attributes","classList","isBlazor","CellType","RowModelGenerator","getComplexFieldID","getObject","appendChildren","events","EditRender","parent","serviceLocator","editType","renderer","editSettings","mode","focus","getService","prototype","addNew","args","getEditElements","convertWidget","update","notify","beforeStartEdit","gObj","isFocused","cell","value","fForm","frzCols","getFrozenColumns","form","document","querySelector","element","id","rowIndex","parseInt","row","getAttribute","frozenRows","requestType","newRowPosition","cols","getColumns","getColumnByField","columnName","_i","cols_1","length","col","template","field","cellArgs","edit","write","window","editModule","checkColumnIsGrouped","commands","valueAccessor","rowData","indexOf","uid","temp","column","foreignKeyData","isForeignColumn","focusElement","type","allowTextWrap","mTdElement","children","fTdElement","offsetHeight","style","height","elem","chkBox","nextElementSibling","add","onClick","target","contains","setSelectionRange","_this","elements","i","len","commandsTemplate","cells","cellRendererFact","model","cellRenderer","getCellRenderer","CommandColumn","generateRows","filter","rowID","td","render","div","firstElementChild","setAttribute","tArgs","data","create","input","editTemplate","createElement","attrs","tempID","tempData","getEditTemplate","setRules","ruleColumn","func","formObj","rules","validationRules","innerHTML","firstChild","isInput","tagName","querySelectorAll","complexFieldName","name","textAlign","isPrimaryKey","isIdentity","destroy","removeEventListener"],"mappings":"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","sourcesContent":["import { isNullOrUndefined, closest, extend, updateBlazorTemplate } from '@syncfusion/ej2-base';\nimport { InlineEditRender } from './inline-edit-renderer';\nimport { BatchEditRender } from './batch-edit-renderer';\nimport { DialogEditRender } from './dialog-edit-renderer';\nimport { attributes, classList, isBlazor } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { getComplexFieldID, getObject, appendChildren } from '../base/util';\nimport * as events from '../base/constant';\n/**\n * Edit render module is used to render grid edit row.\n * @hidden\n */\nvar EditRender = /** @class */ (function () {\n    /**\n     * Constructor for render module\n     */\n    function EditRender(parent, serviceLocator) {\n        //Internal variables               \n        this.editType = {\n            'Inline': InlineEditRender,\n            'Normal': InlineEditRender, 'Batch': BatchEditRender, 'Dialog': DialogEditRender\n        };\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.renderer = new this.editType[this.parent.editSettings.mode](parent, serviceLocator);\n        this.focus = serviceLocator.getService('focus');\n    }\n    EditRender.prototype.addNew = function (args) {\n        this.renderer.addNew(this.getEditElements(args), args);\n        this.convertWidget(args);\n    };\n    EditRender.prototype.update = function (args) {\n        this.renderer.update(this.getEditElements(args), args);\n        this.parent.notify(events.beforeStartEdit, args);\n        this.convertWidget(args);\n    };\n    EditRender.prototype.convertWidget = function (args) {\n        var gObj = this.parent;\n        var isFocused;\n        var cell;\n        var value;\n        var fForm;\n        var frzCols = gObj.getFrozenColumns();\n        var form = gObj.editSettings.mode === 'Dialog' ?\n            document.querySelector('#' + gObj.element.id + '_dialogEdit_wrapper').querySelector('.e-gridform') :\n            gObj.element.querySelector('.e-gridform');\n        if (frzCols && gObj.editSettings.mode === 'Normal') {\n            var rowIndex = parseInt(args.row.getAttribute('aria-rowindex'), 10);\n            if (gObj.frozenRows && ((args.requestType === 'add' && gObj.editSettings.newRowPosition === 'Top')\n                || rowIndex < gObj.frozenRows)) {\n                fForm = gObj.element.querySelector('.e-movableheader').querySelector('.e-gridform');\n            }\n            else {\n                fForm = gObj.element.querySelector('.e-movablecontent').querySelector('.e-gridform');\n            }\n        }\n        var cols = gObj.editSettings.mode !== 'Batch' ? gObj.getColumns() : [gObj.getColumnByField(args.columnName)];\n        for (var _i = 0, cols_1 = cols; _i < cols_1.length; _i++) {\n            var col = cols_1[_i];\n            if (this.parent.editSettings.template && !isNullOrUndefined(col.field)) {\n                var cellArgs = extend({}, args);\n                cellArgs.element = form.querySelector('[name=' + getComplexFieldID(col.field) + ']');\n                if (isNullOrUndefined(cellArgs.element) && frzCols) {\n                    cellArgs.element = fForm.querySelector('[name=' + getComplexFieldID(col.field) + ']');\n                }\n                if (typeof col.edit.write === 'string') {\n                    getObject(col.edit.write, window)(cellArgs);\n                }\n                else {\n                    col.edit.write(cellArgs);\n                }\n                continue;\n            }\n            if (this.parent.editModule.checkColumnIsGrouped(col) || col.commands) {\n                continue;\n            }\n            value = (col.valueAccessor(col.field, args.rowData, col));\n            if (frzCols && cols.indexOf(col) >= frzCols && gObj.editSettings.mode === 'Normal') {\n                cell = fForm.querySelector('[e-mappinguid=' + col.uid + ']');\n            }\n            else {\n                cell = form.querySelector('[e-mappinguid=' + col.uid + ']');\n            }\n            var temp = col.edit.write;\n            if (!isNullOrUndefined(cell)) {\n                if (typeof temp === 'string') {\n                    temp = getObject(temp, window);\n                    temp({\n                        rowData: args.rowData, element: cell, column: col, requestType: args.requestType, row: args.row,\n                        foreignKeyData: col.isForeignColumn() && getObject(col.field, args.foreignKeyData)\n                    });\n                }\n                else {\n                    col.edit.write({\n                        rowData: args.rowData, element: cell, column: col, requestType: args.requestType, row: args.row,\n                        foreignKeyData: col.isForeignColumn() && getObject(col.field, args.foreignKeyData)\n                    });\n                }\n                if (!isFocused && !cell.getAttribute('disabled')) {\n                    this.focusElement(cell, args.type);\n                    isFocused = true;\n                }\n            }\n        }\n        if (frzCols !== 0 && !this.parent.allowTextWrap && ((args.requestType === 'add') || args.requestType === 'beginEdit')\n            && this.parent.editSettings.mode !== 'Dialog' && !isNullOrUndefined(form) && !isNullOrUndefined(fForm)) {\n            var mTdElement = (fForm.querySelector('tr').children[0]);\n            var fTdElement = (form.querySelector('tr').children[0]);\n            if (fTdElement.offsetHeight > mTdElement.offsetHeight) {\n                mTdElement.style.height = fTdElement.offsetHeight + 'px';\n            }\n            else {\n                fTdElement.style.height = mTdElement.offsetHeight + 'px';\n            }\n        }\n    };\n    EditRender.prototype.focusElement = function (elem, type) {\n        var chkBox = this.parent.element.querySelector('.e-edit-checkselect');\n        if (!isNullOrUndefined(chkBox)) {\n            chkBox.nextElementSibling.classList.add('e-focus');\n        }\n        if (this.parent.editSettings.mode === 'Batch') {\n            this.focus.onClick({ target: closest(elem, 'td') }, true);\n        }\n        else {\n            elem.focus();\n        }\n        if (elem.classList.contains('e-defaultcell')) {\n            elem.setSelectionRange(elem.value.length, elem.value.length);\n        }\n    };\n    EditRender.prototype.getEditElements = function (args) {\n        var _this = this;\n        var gObj = this.parent;\n        var elements = {};\n        var cols = gObj.editSettings.mode !== 'Batch' ? gObj.getColumns() : [gObj.getColumnByField(args.columnName)];\n        if (this.parent.editSettings.template) {\n            return {};\n        }\n        for (var i = 0, len = cols.length; i < len; i++) {\n            var col = cols[i];\n            if (this.parent.editModule.checkColumnIsGrouped(col)) {\n                continue;\n            }\n            if (col.commands || col.commandsTemplate) {\n                var cells = void 0;\n                var cellRendererFact = this.serviceLocator.getService('cellRendererFactory');\n                var model = new RowModelGenerator(this.parent);\n                var cellRenderer = cellRendererFact.getCellRenderer(CellType.CommandColumn);\n                cells = model.generateRows(args.rowData)[0].cells;\n                var cell = cells.filter(function (cell) { return cell.rowID; });\n                var td = cellRenderer.render(cell[i], args.rowData, { 'index': args.row ? args.row.getAttribute('aria-rowindex') : 0 });\n                var div = td.firstElementChild;\n                div.setAttribute('textAlign', td.getAttribute('textAlign'));\n                elements[col.uid] = div;\n                continue;\n            }\n            var value = (col.valueAccessor(col.field, args.rowData, col));\n            var tArgs = { column: col, value: value, type: args.requestType, data: args.rowData };\n            var temp = col.edit.create;\n            var input = void 0;\n            if (col.editTemplate) {\n                input = this.parent.createElement('span', { attrs: { 'e-mappinguid': col.uid } });\n                var tempID = this.parent.element.id + col.uid + 'editTemplate';\n                var tempData = extend({}, {}, args.rowData, true);\n                appendChildren(input, col.getEditTemplate()(tempData, this.parent, 'editTemplate', tempID));\n                if (isBlazor()) {\n                    var setRules = function (ruleColumn) {\n                        var column = ruleColumn;\n                        var func = function () {\n                            _this.parent.editModule.formObj.rules[column.field] = column.validationRules;\n                        };\n                        return func;\n                    };\n                    updateBlazorTemplate(tempID, 'EditTemplate', col, true, setRules(col));\n                }\n            }\n            else {\n                if (typeof temp === 'string') {\n                    temp = getObject(temp, window);\n                    input = temp(tArgs);\n                }\n                else {\n                    input = col.edit.create(tArgs);\n                }\n                if (typeof input === 'string') {\n                    var div = this.parent.createElement('div');\n                    div.innerHTML = input;\n                    input = div.firstChild;\n                }\n                var isInput = input.tagName !== 'input' && input.querySelectorAll('input').length;\n                var complexFieldName = getComplexFieldID(col.field);\n                attributes(isInput ? input.querySelector('input') : input, {\n                    name: complexFieldName, 'e-mappinguid': col.uid,\n                    id: gObj.element.id + complexFieldName\n                });\n                classList(input, ['e-input', 'e-field'], []);\n                if (col.textAlign === 'Right') {\n                    input.classList.add('e-ralign');\n                }\n                if ((col.isPrimaryKey || col.isIdentity) && args.requestType === 'beginEdit' ||\n                    (col.isIdentity && args.requestType === 'add')) { // already disabled in cell plugins\n                    input.setAttribute('disabled', '');\n                }\n            }\n            elements[col.uid] = input;\n        }\n        return elements;\n    };\n    EditRender.prototype.destroy = function () {\n        this.renderer.removeEventListener();\n    };\n    return EditRender;\n}());\nexport { EditRender };\n"]},"metadata":{},"sourceType":"module"}