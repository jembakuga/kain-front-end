{"ast":null,"code":"import { extend, addClass, removeClass, setValue, isBlazor } from '@syncfusion/ej2-base';\nimport { remove, classList, updateBlazorTemplate, blazorTemplates, resetBlazorTemplate } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { parentsUntil, inArray, refreshForeignData, getObject } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * `BatchEdit` module is used to handle batch editing actions.\n * @hidden\n */\n\nvar BatchEdit =\n/** @class */\nfunction () {\n  function BatchEdit(parent, serviceLocator, renderer) {\n    this.cellDetails = {};\n    this.originalCell = {};\n    this.cloneCell = {};\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.renderer = renderer;\n    this.focus = serviceLocator.getService('focus');\n    this.addEventListener();\n  }\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.click, this.clickHandler, this);\n    this.parent.on(events.dblclick, this.dblClickHandler, this);\n    this.parent.on(events.beforeCellFocused, this.onBeforeCellFocused, this);\n    this.parent.on(events.cellFocused, this.onCellFocused, this);\n    this.dataBoundFunction = this.dataBound.bind(this);\n    this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n    this.parent.on(events.doubleTap, this.dblClickHandler, this);\n    this.parent.on(events.keyPressed, this.keyDownHandler, this);\n    this.parent.on(events.editNextValCell, this.editNextValCell, this);\n    this.parent.on('closebatch', this.closeForm, this);\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.click, this.clickHandler);\n    this.parent.off(events.dblclick, this.dblClickHandler);\n    this.parent.off(events.beforeCellFocused, this.onBeforeCellFocused);\n    this.parent.off(events.cellFocused, this.onCellFocused);\n    this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n    this.parent.off(events.doubleTap, this.dblClickHandler);\n    this.parent.off(events.keyPressed, this.keyDownHandler);\n    this.parent.off(events.editNextValCell, this.editNextValCell);\n    this.parent.off('closebatch', this.closeForm);\n  };\n\n  BatchEdit.prototype.dataBound = function () {\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  BatchEdit.prototype.clickHandler = function (e) {\n    if (!parentsUntil(e.target, this.parent.element.id + '_add', true)) {\n      if (this.parent.isEdit) {\n        this.saveCell();\n        this.editNextValCell();\n      }\n\n      if (parentsUntil(e.target, 'e-rowcell') && !this.parent.isEdit) {\n        this.setCellIdx(e.target);\n      }\n    }\n  };\n\n  BatchEdit.prototype.dblClickHandler = function (e) {\n    var target = parentsUntil(e.target, 'e-rowcell');\n    var tr = parentsUntil(e.target, 'e-row');\n\n    if (target && tr && !isNaN(parseInt(target.getAttribute('aria-colindex'), 10)) && !target.parentElement.classList.contains('e-editedrow')) {\n      this.editCell(parseInt(tr.getAttribute('aria-rowindex'), 10), this.parent.getColumns()[parseInt(target.getAttribute('aria-colindex'), 10)].field, this.isAddRow(parseInt(tr.getAttribute('aria-rowindex'), 10)));\n    }\n  };\n\n  BatchEdit.prototype.onBeforeCellFocused = function (e) {\n    if (this.parent.isEdit && this.validateFormObj() && (e.byClick || ['tab', 'shiftTab', 'enter', 'shiftEnter'].indexOf(e.keyArgs.action) > -1)) {\n      e.cancel = true;\n\n      if (e.byClick) {\n        e.clickArgs.preventDefault();\n      } else {\n        e.keyArgs.preventDefault();\n      }\n    }\n  };\n\n  BatchEdit.prototype.onCellFocused = function (e) {\n    var frzCols = this.parent.getFrozenColumns();\n    var mCont = this.parent.getContent().querySelector('.e-movablecontent');\n    var mHdr = this.parent.getHeaderContent().querySelector('.e-movableheader');\n    var clear = (!e.container.isContent || !e.container.isDataCell) && !(this.parent.frozenRows && e.container.isHeader);\n\n    if (!e.byKey || clear) {\n      if (this.parent.isEdit && clear) {\n        this.saveCell();\n      }\n\n      return;\n    }\n\n    var _a = e.container.indexes,\n        rowIndex = _a[0],\n        cellIndex = _a[1];\n\n    if (frzCols && (mCont.contains(e.element) || this.parent.frozenRows && mHdr.contains(e.element))) {\n      cellIndex += frzCols;\n    }\n\n    if (this.parent.frozenRows && e.container.isContent) {\n      rowIndex += this.parent.frozenRows;\n    }\n\n    var isEdit = this.parent.isEdit;\n\n    if (!this.parent.element.querySelectorAll('.e-popup-open').length) {\n      isEdit = isEdit && !this.validateFormObj();\n\n      switch (e.keyArgs.action) {\n        case 'tab':\n        case 'shiftTab':\n          if (isEdit || this.parent.isLastCellPrimaryKey) {\n            this.editCellFromIndex(rowIndex, cellIndex);\n          }\n\n          break;\n\n        case 'enter':\n        case 'shiftEnter':\n          e.keyArgs.preventDefault();\n\n          if (isEdit) {\n            this.editCell(rowIndex, this.cellDetails.column.field);\n          }\n\n          break;\n\n        case 'f2':\n          this.editCellFromIndex(rowIndex, cellIndex);\n          this.focus.focus();\n          break;\n      }\n    }\n  };\n\n  BatchEdit.prototype.isAddRow = function (index) {\n    return this.parent.getDataRows()[index].classList.contains('e-insertedrow');\n  };\n\n  BatchEdit.prototype.editCellFromIndex = function (rowIdx, cellIdx) {\n    this.cellDetails.rowIndex = rowIdx;\n    this.cellDetails.cellIndex = cellIdx;\n    this.editCell(rowIdx, this.parent.getColumns()[cellIdx].field, this.isAddRow(rowIdx));\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  BatchEdit.prototype.closeEdit = function () {\n    var gObj = this.parent;\n    var rows = this.parent.getRowsObject();\n    var argument = {\n      cancel: false,\n      batchChanges: this.getBatchChanges()\n    };\n    gObj.notify(events.beforeBatchCancel, argument);\n\n    if (argument.cancel) {\n      return;\n    }\n\n    if (gObj.frozenColumns && rows.length < this.parent.currentViewData.length * 2 && !(isBlazor() && gObj.isServerRendered)) {\n      rows.push.apply(rows, this.parent.getMovableRowsObject());\n    }\n\n    var cols = this.parent.getColumns();\n\n    if (isBlazor()) {\n      for (var i = 0; i < cols.length; i++) {\n        var col = cols[i];\n\n        if (col.template) {\n          updateBlazorTemplate(this.parent.element.id + col.uid, 'Template', col, false);\n        }\n      }\n    }\n\n    var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n    var tr;\n    var mTr;\n    var movObj;\n\n    if (gObj.isEdit) {\n      this.saveCell(true);\n    }\n\n    this.isAdded = false;\n    gObj.clearSelection();\n\n    for (var i = 0; i < rows.length; i++) {\n      if (rows[i].isDirty) {\n        if (gObj.frozenColumns) {\n          movObj = gObj.getMovableRowsObject()[rows[i].index];\n          movObj.isDirty = true;\n        }\n\n        tr = gObj.getContentTable().querySelector('[data-uid=' + rows[i].uid + ']');\n\n        if (gObj.frozenRows && !tr) {\n          tr = gObj.getHeaderContent().querySelector('[data-uid=' + rows[i].uid + ']');\n        }\n\n        if (gObj.frozenColumns) {\n          if (gObj.frozenRows) {\n            mTr = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('[data-uid=' + rows[i].uid + ']');\n\n            if (!mTr) {\n              mTr = gObj.getContent().querySelector('.e-movablecontent').querySelector('[data-uid=' + rows[i].uid + ']');\n            }\n          } else {\n            mTr = gObj.getContent().querySelector('.e-movablecontent').querySelector('[data-uid=' + rows[i].uid + ']');\n          }\n        }\n\n        if (tr || mTr) {\n          if (tr && tr.classList.contains('e-insertedrow') || mTr && mTr.classList.contains('e-insertedrow')) {\n            if (tr) {\n              remove(tr);\n            }\n\n            if (mTr && (gObj.frozenColumns || gObj.frozenRows)) {\n              remove(mTr);\n            }\n\n            this.removeRowObjectFromUID(rows[i].uid);\n            i--;\n          } else {\n            refreshForeignData(rows[i], this.parent.getForeignKeyColumns(), rows[i].data);\n            delete rows[i].changes;\n            delete rows[i].edit;\n            rows[i].isDirty = false;\n            var ftr = mTr ? mTr : tr;\n\n            if (isBlazor() && gObj.isServerRendered) {\n              if (gObj.getFrozenColumns()) {\n                this.removeHideAndSelection(mTr);\n              }\n\n              this.removeHideAndSelection(tr);\n              this.closeForm();\n            } else {\n              classList(ftr, [], ['e-hiddenrow', 'e-updatedtd']);\n              rowRenderer.refresh(rows[i], gObj.getColumns(), false);\n            }\n\n            if (this.parent.aggregates.length > 0) {\n              var type = 'type';\n              var editType = [];\n              editType[type] = 'cancel';\n              this.parent.notify(events.refreshFooterRenderer, editType);\n\n              if (this.parent.groupSettings.columns.length > 0) {\n                this.parent.notify(events.groupAggregates, editType);\n              }\n            }\n          }\n        }\n      }\n    }\n\n    if (isBlazor() && gObj.isServerRendered) {\n      gObj.selectRow(gObj.selectionModule.prevRowIndex);\n    }\n\n    if (!gObj.getContentTable().querySelector('tr.e-row')) {\n      gObj.renderModule.renderEmptyRow();\n    }\n\n    var args = {\n      requestType: 'batchCancel',\n      rows: this.parent.getRowsObject()\n    };\n    gObj.notify(events.batchCancel, {\n      rows: this.parent.getRowsObject().length ? this.parent.getRowsObject() : [new Row({\n        isDataRow: true,\n        cells: [new Cell({\n          isDataCell: true,\n          visible: true\n        })]\n      })]\n    });\n    gObj.selectRow(this.cellDetails.rowIndex);\n    this.refreshRowIdx();\n    gObj.notify(events.toolbarRefresh, {});\n    this.parent.notify(events.tooltipDestroy, {});\n    args = {\n      requestType: 'batchCancel',\n      rows: this.parent.getRowsObject()\n    };\n    gObj.trigger(events.batchCancel, args);\n\n    if (gObj.frozenColumns) {\n      rows.splice(this.parent.getMovableRowsObject().length, rows.length);\n    }\n  };\n\n  BatchEdit.prototype.removeHideAndSelection = function (tr) {\n    if (tr.classList.contains('e-hiddenrow')) {\n      tr.removeAttribute('aria-selected');\n      tr.querySelectorAll('.e-selectionbackground').forEach(function (td) {\n        removeClass([td], ['e-selectionbackground', 'e-active']);\n      });\n    }\n\n    classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n  };\n\n  BatchEdit.prototype.deleteRecord = function (fieldname, data) {\n    this.saveCell();\n\n    if (this.validateFormObj()) {\n      this.saveCell(true);\n    }\n\n    this.isAdded = false;\n    this.bulkDelete(fieldname, data);\n\n    if (this.parent.aggregates.length > 0) {\n      this.parent.notify(events.refreshFooterRenderer, {});\n\n      if (this.parent.groupSettings.columns.length > 0) {\n        this.parent.notify(events.groupAggregates, {});\n      }\n    }\n  };\n\n  BatchEdit.prototype.addRecord = function (data) {\n    this.bulkAddRow(data);\n  };\n\n  BatchEdit.prototype.endEdit = function (data) {\n    if (this.parent.isEdit && this.validateFormObj()) {\n      return;\n    }\n\n    if (isBlazor() && this.parent.isServerRendered) {\n      var content = this.parent.getContent();\n      this.closeForm();\n      removeClass(content.querySelectorAll('.e-updatedtd'), ['e-updatedtd']);\n\n      if (content.querySelector('.e-insertedrow, .e-hiddenrow')) {\n        removeClass(content.querySelectorAll('.e-hiddenrow'), ['e-hiddenrow']);\n        content.querySelectorAll('.e-insertedrow').forEach(function (el) {\n          return el.remove();\n        });\n      }\n\n      this.refreshRowIdx();\n    }\n\n    this.batchSave();\n  };\n\n  BatchEdit.prototype.closeForm = function () {\n    for (var i = 0; i < Object.keys(this.originalCell).length; i++) {\n      for (var j = 0; j < Object.keys(this.cloneCell).length; j++) {\n        if (Object.keys(this.originalCell)[i] === Object.keys(this.cloneCell)[j]) {\n          this.cloneCell[Object.keys(this.cloneCell)[j]].replaceWith(this.originalCell[Object.keys(this.originalCell)[i]]);\n\n          if (this.originalCell[Object.keys(this.originalCell)[i]].classList.contains('e-selectionbackground')) {\n            this.originalCell[Object.keys(this.originalCell)[i]].classList.remove('e-selectionbackground', 'e-active');\n          }\n        }\n      }\n    }\n\n    this.cloneCell = {};\n    this.originalCell = {};\n  };\n\n  BatchEdit.prototype.validateFormObj = function () {\n    return this.parent.editModule.formObj && !this.parent.editModule.formObj.validate();\n  };\n\n  BatchEdit.prototype.batchSave = function () {\n    var gObj = this.parent;\n    var deletedRecords = 'deletedRecords';\n\n    if (gObj.isCheckBoxSelection) {\n      var checkAllBox = gObj.element.querySelector('.e-checkselectall').parentElement;\n\n      if (checkAllBox.classList.contains('e-checkbox-disabled') && gObj.pageSettings.totalRecordsCount > gObj.currentViewData.length) {\n        removeClass([checkAllBox], ['e-checkbox-disabled']);\n      }\n    }\n\n    var cols = this.parent.getColumns();\n\n    if (isBlazor()) {\n      for (var i = 0; i < cols.length; i++) {\n        var col = cols[i];\n\n        if (col.template) {\n          blazorTemplates[this.parent.element.id + col.uid] = [];\n          resetBlazorTemplate(this.parent.element.id + col.uid, 'Template');\n        }\n      }\n    }\n\n    this.saveCell();\n\n    if (gObj.isEdit || this.editNextValCell() || gObj.isEdit) {\n      return;\n    }\n\n    var changes = this.getBatchChanges();\n\n    if (this.parent.selectionSettings.type === 'Multiple' && changes[deletedRecords].length && this.parent.selectionSettings.persistSelection) {\n      changes[deletedRecords] = this.removeSelectedData;\n      this.removeSelectedData = [];\n    }\n\n    var original = {\n      changedRecords: this.parent.getRowsObject().filter(function (row) {\n        return row.isDirty && ['add', 'delete'].indexOf(row.edit) === -1;\n      }).map(function (row) {\n        return row.data;\n      })\n    };\n    var args = {\n      batchChanges: changes,\n      cancel: false\n    };\n    gObj.trigger(events.beforeBatchSave, args, function (beforeBatchSaveArgs) {\n      if (beforeBatchSaveArgs.cancel) {\n        return;\n      }\n\n      gObj.showSpinner();\n      gObj.notify(events.bulkSave, {\n        changes: changes,\n        original: original\n      });\n    });\n  };\n\n  BatchEdit.prototype.getBatchChanges = function () {\n    var changes = {\n      addedRecords: [],\n      deletedRecords: [],\n      changedRecords: []\n    };\n    var rows = this.parent.getRowsObject();\n\n    for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n      var row = rows_1[_i];\n\n      if (row.isDirty) {\n        switch (row.edit) {\n          case 'add':\n            changes.addedRecords.push(row.changes);\n            break;\n\n          case 'delete':\n            changes.deletedRecords.push(row.data);\n            break;\n\n          default:\n            changes.changedRecords.push(row.changes);\n        }\n      }\n    }\n\n    return changes;\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.removeRowObjectFromUID = function (uid) {\n    var rows = this.parent.getRowsObject();\n    var i = 0;\n\n    for (var len = rows.length; i < len; i++) {\n      if (rows[i].uid === uid) {\n        break;\n      }\n    }\n\n    rows.splice(i, 1);\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addRowObject = function (row) {\n    var isTop = this.parent.editSettings.newRowPosition === 'Top';\n    isTop ? this.parent.getRowsObject().unshift(row) : this.parent.getRowsObject().push(row);\n    var mRow = this.parent.getMovableRowsObject();\n\n    if (this.parent.getFrozenColumns() && !mRow.length) {\n      isTop ? mRow.unshift(row) : mRow.push(row);\n    }\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  BatchEdit.prototype.bulkDelete = function (fieldname, data) {\n    var _this = this;\n\n    this.removeSelectedData = [];\n    var gObj = this.parent;\n    var index = gObj.selectedRowIndex;\n    var selectedRows = gObj.getSelectedRows();\n    var args = {\n      primaryKey: this.parent.getPrimaryKeyFieldNames(),\n      rowIndex: index,\n      rowData: data ? data : gObj.getSelectedRecords()[0],\n      cancel: false\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      if (data) {\n        args.row = gObj.editModule.deleteRowUid ? gObj.getRowElementByUID(gObj.editModule.deleteRowUid) : gObj.getRows()[gObj.getCurrentViewRecords().indexOf(data)];\n      } else {\n        args.row = data ? gObj.getRows()[index] : selectedRows[0];\n      }\n\n      if (!args.row) {\n        return;\n      }\n    }\n\n    gObj.trigger(events.beforeBatchDelete, args, function (beforeBatchDeleteArgs) {\n      if (beforeBatchDeleteArgs.cancel) {\n        return;\n      }\n\n      beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row ? beforeBatchDeleteArgs.row : data ? gObj.getRows()[index] : selectedRows[0];\n\n      if (_this.parent.getFrozenColumns()) {\n        if (data) {\n          index = parseInt(beforeBatchDeleteArgs.row.getAttribute('aria-rowindex'), 10);\n          selectedRows = [beforeBatchDeleteArgs.row];\n\n          if (parentsUntil(beforeBatchDeleteArgs.row, 'e-frozencontent') || parentsUntil(beforeBatchDeleteArgs.row, 'e-frozenheader')) {\n            selectedRows = selectedRows.concat(gObj.getMovableRowByIndex(index));\n          } else if (parentsUntil(beforeBatchDeleteArgs.row, 'e-movablecontent') || parentsUntil(beforeBatchDeleteArgs.row, 'e-movableheader')) {\n            selectedRows = selectedRows.concat(gObj.getFrozenRowByIndex(index));\n          }\n        }\n\n        for (var i = 0; i < selectedRows.length; i++) {\n          var uid = selectedRows[i].getAttribute('data-uid');\n\n          if (selectedRows[i].classList.contains('e-insertedrow')) {\n            _this.removeRowObjectFromUID(uid);\n\n            remove(selectedRows[i]);\n          } else {\n            var rowObj = gObj.getRowObjectFromUID(uid);\n            rowObj.isDirty = true;\n            rowObj.edit = 'delete';\n            classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n\n            if (gObj.frozenRows && index < gObj.frozenRows && gObj.getMovableDataRows().length >= gObj.frozenRows) {\n              gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody').appendChild(gObj.getMovableRowByIndex(gObj.frozenRows - 1));\n              gObj.getHeaderContent().querySelector('.e-frozenheader').querySelector('tbody').appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n            }\n\n            if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n              gObj.getHeaderContent().querySelector('tbody').appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n            }\n          }\n\n          delete selectedRows[i];\n        }\n      } else if (!_this.parent.getFrozenColumns() && (selectedRows.length === 1 || data)) {\n        var uid = beforeBatchDeleteArgs.row.getAttribute('data-uid');\n        uid = data && _this.parent.editModule.deleteRowUid ? uid = _this.parent.editModule.deleteRowUid : uid;\n\n        if (beforeBatchDeleteArgs.row.classList.contains('e-insertedrow')) {\n          _this.removeRowObjectFromUID(uid);\n\n          remove(beforeBatchDeleteArgs.row);\n        } else {\n          var rowObj = gObj.getRowObjectFromUID(uid);\n          rowObj.isDirty = true;\n          rowObj.edit = 'delete';\n          classList(beforeBatchDeleteArgs.row, ['e-hiddenrow', 'e-updatedtd'], []);\n        }\n\n        delete beforeBatchDeleteArgs.row;\n      } else {\n        for (var i = 0; i < selectedRows.length; i++) {\n          var uniqueid = selectedRows[i].getAttribute('data-uid');\n\n          if (selectedRows[i].classList.contains('e-insertedrow')) {\n            _this.removeRowObjectFromUID(uniqueid);\n\n            remove(selectedRows[i]);\n          } else {\n            classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n            var selectedRow = gObj.getRowObjectFromUID(uniqueid);\n            selectedRow.isDirty = true;\n            selectedRow.edit = 'delete';\n            delete selectedRows[i];\n          }\n        }\n      }\n\n      _this.refreshRowIdx();\n\n      _this.removeSelectedData = gObj.getSelectedRecords();\n\n      if (data) {\n        gObj.editModule.deleteRowUid = undefined;\n\n        if (gObj.getSelectedRows().length) {\n          index = parseInt(gObj.getSelectedRows()[0].getAttribute('aria-rowindex'), 10);\n        }\n      }\n\n      if (gObj.getSelectedRows().length) {\n        gObj.clearSelection();\n        gObj.selectRow(index);\n      }\n\n      gObj.trigger(events.batchDelete, beforeBatchDeleteArgs);\n      gObj.notify(events.batchDelete, {\n        rows: _this.parent.getRowsObject()\n      });\n      gObj.notify(events.toolbarRefresh, {});\n    });\n  };\n\n  BatchEdit.prototype.refreshRowIdx = function () {\n    var rows = [];\n    var mRows = [];\n    var nonMovableRows = [];\n    var frzCols = this.parent.getFrozenColumns();\n\n    if (this.parent.frozenRows) {\n      rows = [].slice.call(this.parent.getHeaderTable().querySelector('tbody').children);\n\n      if (frzCols) {\n        mRows = [].slice.call(this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody').children);\n\n        for (var i = 0; i < mRows.length; i++) {\n          nonMovableRows[i] = this.parent.createElement('tr', {\n            className: 'emptynonmv'\n          });\n        }\n      }\n    }\n\n    if (frzCols) {\n      mRows = mRows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));\n      nonMovableRows = nonMovableRows.concat([].slice.call(this.parent.element.querySelector('.e-movablecontent').querySelector('tbody').children));\n    }\n\n    rows = rows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));\n\n    for (var i = 0, j = 0, len = rows.length; i < len; i++) {\n      if (rows[i].classList.contains('e-row') && !rows[i].classList.contains('e-hiddenrow')) {\n        rows[i].setAttribute('aria-rowindex', j.toString());\n\n        if (frzCols) {\n          mRows[i].setAttribute('aria-rowindex', j.toString());\n\n          if (nonMovableRows[i].classList.contains('e-row')) {\n            nonMovableRows[i].setAttribute('aria-rowindex', j.toString());\n          }\n        }\n\n        j++;\n      } else {\n        rows[i].removeAttribute('aria-rowindex');\n\n        if (frzCols) {\n          mRows[i].removeAttribute('aria-rowindex');\n        }\n      }\n    }\n  };\n\n  BatchEdit.prototype.getIndexFromData = function (data) {\n    return inArray(data, this.parent.getCurrentViewRecords());\n  };\n\n  BatchEdit.prototype.bulkAddRow = function (data) {\n    var _this = this;\n\n    var gObj = this.parent;\n\n    if (!gObj.editSettings.allowAdding) {\n      return;\n    }\n\n    if (gObj.isEdit) {\n      this.saveCell();\n      this.parent.notify(events.editNextValCell, {});\n    }\n\n    if (gObj.isEdit) {\n      return;\n    }\n\n    this.parent.element.classList.add('e-editing');\n    var defaultData = data ? data : this.getDefaultData();\n    var args = {\n      defaultData: defaultData,\n      primaryKey: gObj.getPrimaryKeyFieldNames(),\n      cancel: false\n    };\n    gObj.trigger(events.beforeBatchAdd, args, function (beforeBatchAddArgs) {\n      if (beforeBatchAddArgs.cancel) {\n        return;\n      }\n\n      _this.isAdded = true;\n      gObj.clearSelection();\n      var mTr;\n      var mTbody;\n      var row = new RowRenderer(_this.serviceLocator, null, _this.parent);\n      var model = new RowModelGenerator(_this.parent);\n      var modelData = model.generateRows([beforeBatchAddArgs.defaultData]);\n      var tr = row.render(modelData[0], gObj.getColumns());\n      var col;\n      var index;\n\n      for (var i = 0; i < _this.parent.groupSettings.columns.length; i++) {\n        tr.insertBefore(_this.parent.createElement('td', {\n          className: 'e-indentcell'\n        }), tr.firstChild);\n        modelData[0].cells.unshift(new Cell({\n          cellType: CellType.Indent\n        }));\n      }\n\n      var tbody = gObj.getContentTable().querySelector('tbody');\n      tr.classList.add('e-insertedrow');\n\n      if (tbody.querySelector('.e-emptyrow')) {\n        tbody.querySelector('.e-emptyrow').remove();\n      }\n\n      if (gObj.getFrozenColumns()) {\n        mTr = _this.renderMovable(tr);\n\n        if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n          mTbody = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody');\n        } else {\n          mTbody = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n        }\n\n        _this.parent.editSettings.newRowPosition === 'Top' ? mTbody.insertBefore(mTr, mTbody.firstChild) : mTbody.appendChild(mTr);\n        addClass(mTr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n\n        if (_this.parent.height === 'auto') {\n          _this.parent.notify(events.frozenHeight, {});\n        }\n      }\n\n      if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n        tbody = gObj.getHeaderContent().querySelector('tbody');\n      } else {\n        tbody = gObj.getContent().querySelector('tbody');\n      }\n\n      _this.parent.editSettings.newRowPosition === 'Top' ? tbody.insertBefore(tr, tbody.firstChild) : tbody.appendChild(tr);\n      addClass(tr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n      modelData[0].isDirty = true;\n      modelData[0].changes = extend({}, {}, modelData[0].data, true);\n      modelData[0].edit = 'add';\n\n      _this.addRowObject(modelData[0]);\n\n      _this.refreshRowIdx();\n\n      _this.focus.forgetPrevious();\n\n      gObj.notify(events.batchAdd, {\n        rows: _this.parent.getRowsObject(),\n        args: {\n          isFrozen: _this.parent.getFrozenColumns()\n        }\n      });\n\n      var changes = _this.getBatchChanges();\n\n      var addedRecords = 'addedRecords';\n      _this.parent.editSettings.newRowPosition === 'Top' ? gObj.selectRow(0) : gObj.selectRow(_this.parent.getCurrentViewRecords().length + changes[addedRecords].length - 1);\n\n      if (!data) {\n        index = _this.findNextEditableCell(0, true);\n        col = gObj.getColumns()[index];\n        _this.parent.editSettings.newRowPosition === 'Top' ? _this.editCell(0, col.field, true) : _this.editCell(_this.parent.getCurrentViewRecords().length + changes[addedRecords].length - 1, col.field, true);\n      }\n\n      if (_this.parent.aggregates.length > 0 && data) {\n        _this.parent.notify(events.refreshFooterRenderer, {});\n      }\n\n      var args1 = {\n        defaultData: beforeBatchAddArgs.defaultData,\n        row: tr,\n        columnObject: col,\n        columnIndex: index,\n        primaryKey: beforeBatchAddArgs.primaryKey,\n        cell: tr.cells[index]\n      };\n      gObj.trigger(events.batchAdd, args1);\n\n      if (isBlazor()) {\n        _this.parent.notify(events.toolbarRefresh, {});\n\n        _this.parent.notify('start-add', {});\n      }\n    });\n  };\n\n  BatchEdit.prototype.renderMovable = function (ele) {\n    var mEle = ele.cloneNode(true);\n\n    for (var i = 0; i < this.parent.getFrozenColumns(); i++) {\n      mEle.removeChild(mEle.children[0]);\n    }\n\n    for (var i = this.parent.getFrozenColumns(), len = ele.childElementCount; i < len; i++) {\n      ele.removeChild(ele.children[ele.childElementCount - 1]);\n    }\n\n    return mEle;\n  };\n\n  BatchEdit.prototype.findNextEditableCell = function (columnIndex, isAdd, isValOnly) {\n    var cols = this.parent.getColumns();\n    var endIndex = cols.length;\n    var validation;\n\n    for (var i = columnIndex; i < endIndex; i++) {\n      validation = isValOnly ? isNullOrUndefined(cols[i].validationRules) : false;\n\n      if (!isAdd && this.checkNPCell(cols[i])) {\n        return i;\n      } else if (isAdd && !cols[i].template && cols[i].visible && cols[i].allowEditing && !(cols[i].isIdentity && cols[i].isPrimaryKey) && !validation) {\n        return i;\n      }\n    }\n\n    return -1;\n  };\n\n  BatchEdit.prototype.checkNPCell = function (col) {\n    return !col.template && col.visible && !col.isPrimaryKey && !col.isIdentity && col.allowEditing;\n  };\n\n  BatchEdit.prototype.getDefaultData = function () {\n    var gObj = this.parent;\n    var data = {};\n    var dValues = {\n      'number': 0,\n      'string': null,\n      'boolean': false,\n      'date': null,\n      'datetime': null\n    };\n\n    for (var _i = 0, _a = gObj.columnModel; _i < _a.length; _i++) {\n      var col = _a[_i];\n\n      if (col.field) {\n        setValue(col.field, col.defaultValue ? col.defaultValue : dValues[col.type], data);\n      }\n    }\n\n    return data;\n  };\n\n  BatchEdit.prototype.setCellIdx = function (target) {\n    var gLen = 0;\n\n    if (this.parent.allowGrouping) {\n      gLen = this.parent.groupSettings.columns.length;\n    }\n\n    this.cellDetails.cellIndex = target.cellIndex - gLen;\n    this.cellDetails.rowIndex = parseInt(target.getAttribute('index'), 10);\n  };\n\n  BatchEdit.prototype.editCell = function (index, field, isAdd) {\n    var _this = this;\n\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    var keys = gObj.getPrimaryKeyFieldNames();\n    this.parent.element.classList.add('e-editing');\n\n    if (isBlazor() && col.template && !isAdd) {\n      resetBlazorTemplate(this.parent.element.id + col.uid, 'Template', index);\n    }\n\n    if (gObj.editSettings.allowEditing && col.allowEditing) {\n      if (gObj.isEdit && !(this.cellDetails.column.field === field && this.cellDetails.rowIndex === index && this.parent.getDataRows().length - 1 !== index)) {\n        this.saveCell();\n\n        if (this.cellDetails.rowIndex === index && this.cellDetails.column.field === field) {\n          return;\n        }\n      }\n\n      if (gObj.isEdit) {\n        return;\n      }\n\n      var row_1;\n      var rowData_1;\n      var mRowData = void 0;\n      var colIdx = gObj.getColumnIndexByField(field);\n      var frzCols = gObj.getFrozenColumns();\n\n      if (frzCols && colIdx >= frzCols) {\n        row_1 = gObj.getMovableDataRows()[index];\n        mRowData = this.parent.getRowObjectFromUID(this.parent.getMovableDataRows()[index].getAttribute('data-uid'));\n        rowData_1 = mRowData.changes ? extend({}, {}, mRowData.changes, true) : extend({}, {}, this.getDataByIndex(index), true);\n      } else {\n        row_1 = gObj.getDataRows()[index];\n        rowData_1 = extend({}, {}, this.getDataByIndex(index), true);\n      }\n\n      if (keys[0] === col.field && !row_1.classList.contains('e-insertedrow') || col.columns || col.isPrimaryKey && col.isIdentity) {\n        this.parent.isLastCellPrimaryKey = true;\n        return;\n      }\n\n      this.parent.isLastCellPrimaryKey = false;\n      var rowObj = gObj.getRowObjectFromUID(row_1.getAttribute('data-uid'));\n      var cells_1 = [].slice.apply(row_1.cells);\n      var args = {\n        columnName: col.field,\n        columnObject: col,\n        isForeignKey: !isNullOrUndefined(col.foreignKeyValue),\n        primaryKey: keys,\n        rowData: rowData_1,\n        validationRules: extend({}, col.validationRules ? col.validationRules : {}),\n        value: getObject(col.field, rowData_1),\n        type: !isAdd ? 'edit' : 'add',\n        cancel: false,\n        foreignKeyData: rowObj && rowObj.foreignKeyData\n      };\n\n      if (!isBlazor() || this.parent.isJsComponent) {\n        args.cell = cells_1[this.getColIndex(cells_1, this.getCellIdx(col.uid))];\n        args.row = row_1;\n\n        if (!args.cell) {\n          return;\n        }\n      }\n\n      gObj.trigger(events.cellEdit, args, function (cellEditArgs) {\n        if (cellEditArgs.cancel) {\n          return;\n        }\n\n        cellEditArgs.cell = cellEditArgs.cell ? cellEditArgs.cell : cells_1[_this.getColIndex(cells_1, _this.getCellIdx(col.uid))];\n        cellEditArgs.row = cellEditArgs.row ? cellEditArgs.row : row_1;\n        _this.cellDetails = {\n          rowData: rowData_1,\n          column: col,\n          value: cellEditArgs.value,\n          isForeignKey: cellEditArgs.isForeignKey,\n          rowIndex: index,\n          cellIndex: parseInt(cellEditArgs.cell.getAttribute('aria-colindex'), 10),\n          foreignKeyData: cellEditArgs.foreignKeyData\n        };\n\n        if (cellEditArgs.cell.classList.contains('e-updatedtd')) {\n          _this.isColored = true;\n          cellEditArgs.cell.classList.remove('e-updatedtd');\n        }\n\n        if (isBlazor() && gObj.isServerRendered) {\n          var cell = 'cells';\n          var cloneCell = 'cloneCell';\n          var indent = cellEditArgs.row.querySelectorAll('.e-indentcell, .e-detailrowcollapse, .e-detailrowexpand, .e-rowdragdrop').length;\n          _this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] = cellEditArgs[cloneCell] = cellEditArgs.cell.cloneNode(true);\n\n          if (parentsUntil(cellEditArgs.cell, 'e-movableheader') || parentsUntil(cellEditArgs.cell, 'e-movablecontent')) {\n            cellEditArgs.row.insertCell(cellEditArgs.columnObject.index - gObj.getFrozenColumns());\n            cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index - gObj.getFrozenColumns()]);\n          } else {\n            cellEditArgs.row.insertCell(cellEditArgs.columnObject.index + indent);\n            cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index + indent]);\n          }\n\n          _this.originalCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] = cellEditArgs.cell.parentElement.removeChild(cellEditArgs.cell);\n          removeClass([_this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index]], ['e-focus', 'e-focused']);\n        }\n\n        gObj.isEdit = true;\n        gObj.clearSelection();\n\n        if (!gObj.isCheckBoxSelection || !gObj.isPersistSelection) {\n          gObj.selectRow(_this.cellDetails.rowIndex, true);\n        }\n\n        _this.renderer.update(cellEditArgs);\n\n        _this.parent.notify(events.batchEditFormRendered, cellEditArgs);\n\n        _this.form = gObj.element.querySelector('#' + gObj.element.id + 'EditForm');\n        gObj.editModule.applyFormValidation([col]);\n        _this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n      });\n    }\n  };\n\n  BatchEdit.prototype.updateCell = function (rowIndex, field, value) {\n    var col = this.parent.getColumnByField(field);\n    var index = this.parent.getColumnIndexByField(field);\n\n    if (col && !col.isPrimaryKey) {\n      var td = this.parent.getDataRows()[rowIndex].querySelectorAll('.e-rowcell')[index];\n\n      if (this.parent.getFrozenColumns()) {\n        var cells = [].slice.call(this.parent.getDataRows()[rowIndex].querySelectorAll('.e-rowcell')).concat([].slice.call(this.parent.getMovableDataRows()[rowIndex].querySelectorAll('.e-rowcell')));\n        td = cells[index];\n      }\n\n      var rowObj = this.parent.getRowObjectFromUID(td.parentElement.getAttribute('data-uid'));\n      this.refreshTD(td, col, rowObj, value);\n      this.parent.trigger(events.queryCellInfo, {\n        cell: td,\n        column: col,\n        data: rowObj.changes\n      });\n    }\n  };\n\n  BatchEdit.prototype.setChanges = function (rowObj, field, value, td) {\n    var currentRowObj;\n\n    if (!this.parent.getFrozenColumns()) {\n      if (!rowObj.changes) {\n        rowObj.changes = extend({}, {}, rowObj.data, true);\n      }\n\n      if (!isNullOrUndefined(field)) {\n        DataUtil.setValue(field, value, rowObj.changes);\n      }\n\n      if (rowObj.data[field] !== value) {\n        rowObj.isDirty = true;\n      }\n    } else {\n      var rowEle = this.parent.getRowElementByUID(rowObj.uid);\n      var rowIndex = parseInt(rowEle.getAttribute('aria-rowindex'), 10);\n      currentRowObj = this.parent.getRowsObject()[rowIndex];\n\n      if (!currentRowObj.changes) {\n        currentRowObj.changes = extend({}, {}, rowObj.data, true);\n      }\n\n      setValue(field, value, currentRowObj.changes);\n      var movableRowObject = void 0;\n\n      if (isBlazor() && this.parent.isServerRendered && (parentsUntil(td, 'e-movableheader') || parentsUntil(td, 'e-movablecontent'))) {\n        var movRowEle = this.parent.getMovableRowByIndex(this.cellDetails.rowIndex);\n        var movRowIndex = parseInt(movRowEle.getAttribute('aria-rowindex'), 10);\n        movableRowObject = this.parent.getMovableRowsObject()[movRowIndex];\n      } else {\n        movableRowObject = this.parent.getRowObjectFromUID(rowObj.uid);\n      }\n\n      movableRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n\n      if (rowObj.data[field] !== value) {\n        movableRowObject.isDirty = true;\n        currentRowObj.isDirty = true;\n      }\n    }\n  };\n\n  BatchEdit.prototype.updateRow = function (index, data) {\n    var keys = Object.keys(data);\n\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n      var col = keys_1[_i];\n      this.updateCell(index, col, data[col]);\n    }\n  };\n\n  BatchEdit.prototype.getCellIdx = function (uid) {\n    var cIdx = this.parent.getColumnIndexByUid(uid) + this.parent.groupSettings.columns.length;\n\n    if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n      cIdx++;\n    }\n\n    if (this.parent.isRowDragable()) {\n      cIdx++;\n    }\n\n    return cIdx;\n  };\n\n  BatchEdit.prototype.refreshTD = function (td, column, rowObj, value) {\n    var cell = new CellRenderer(this.parent, this.serviceLocator);\n    var rowcell;\n    this.setChanges(rowObj, column.field, value, td);\n    var frzCols = this.parent.getFrozenColumns();\n    refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n\n    if (frzCols && this.getCellIdx(column.uid) >= frzCols && this.parent.getColumns().length === rowObj.cells.length) {\n      rowcell = rowObj.cells.slice(frzCols, rowObj.cells.length);\n    } else {\n      rowcell = rowObj.cells;\n    }\n\n    cell.refreshTD(td, rowcell[this.getCellIdx(column.uid) - (this.getCellIdx(column.uid) >= frzCols ? frzCols : 0)], rowObj.changes, {\n      'index': this.getCellIdx(column.uid)\n    });\n    td.classList.add('e-updatedtd');\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n\n  BatchEdit.prototype.getColIndex = function (cells, index) {\n    var cIdx = 0;\n\n    if (this.parent.allowGrouping && this.parent.groupSettings.columns) {\n      cIdx = this.parent.groupSettings.columns.length;\n    }\n\n    if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n      cIdx++;\n    }\n\n    if (this.parent.isRowDragable()) {\n      cIdx++;\n    }\n\n    for (var m = 0; m < cells.length; m++) {\n      var colIndex = parseInt(cells[m].getAttribute('aria-colindex'), 10);\n\n      if (colIndex === index - cIdx) {\n        return m;\n      }\n    }\n\n    return -1;\n  };\n\n  BatchEdit.prototype.editNextValCell = function () {\n    var gObj = this.parent;\n\n    if (this.isAdded && !gObj.isEdit) {\n      for (var i = this.cellDetails.cellIndex; i < gObj.getColumns().length; i++) {\n        if (gObj.isEdit) {\n          return;\n        }\n\n        var index = this.findNextEditableCell(this.cellDetails.cellIndex + 1, true, true);\n        var col = gObj.getColumns()[index];\n\n        if (col) {\n          this.editCell(0, col.field, true);\n          this.saveCell();\n        }\n      }\n\n      if (!gObj.isEdit) {\n        this.isAdded = false;\n      }\n    }\n  };\n\n  BatchEdit.prototype.saveCell = function (isForceSave) {\n    var gObj = this.parent;\n\n    if (!isForceSave && (!gObj.isEdit || this.validateFormObj())) {\n      return;\n    }\n\n    this.parent.element.classList.remove('e-editing');\n    var tr = parentsUntil(this.form, 'e-row');\n    var column = this.cellDetails.column;\n    var obj = {};\n    obj[column.field] = this.cellDetails.rowData[column.field];\n    var editedData = gObj.editModule.getCurrentEditedData(this.form, obj);\n    var cloneEditedData = extend({}, editedData);\n    editedData = extend({}, editedData, this.cellDetails.rowData);\n    var value = getObject(column.field, cloneEditedData);\n\n    if (!isNullOrUndefined(column.field)) {\n      setValue(column.field, value, editedData);\n    }\n\n    var args = {\n      columnName: column.field,\n      value: getObject(column.field, editedData),\n      rowData: this.cellDetails.rowData,\n      previousValue: this.cellDetails.value,\n      columnObject: column,\n      isForeignKey: this.cellDetails.isForeignKey,\n      cancel: false\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      args.cell = this.form.parentElement;\n    }\n\n    if (!isForceSave) {\n      gObj.trigger(events.cellSave, args, this.successCallBack(args, tr, column));\n      gObj.notify(events.batchForm, {\n        formObj: this.form\n      });\n    } else {\n      this.successCallBack(args, tr, column)(args);\n    }\n  };\n\n  BatchEdit.prototype.successCallBack = function (cellSaveArgs, tr, column) {\n    var _this = this;\n\n    return function (cellSaveArgs) {\n      var gObj = _this.parent;\n      cellSaveArgs.cell = cellSaveArgs.cell ? cellSaveArgs.cell : _this.form.parentElement;\n\n      if (cellSaveArgs.cancel) {\n        return;\n      }\n\n      gObj.editModule.destroyForm();\n      gObj.isEdit = false;\n      gObj.editModule.destroyWidgets([column]);\n\n      if (isBlazor() && column.template && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n        updateBlazorTemplate(gObj.element.id + column.uid, 'Template', column, false);\n      }\n\n      _this.parent.notify(events.tooltipDestroy, {});\n\n      if (isBlazor() && gObj.isServerRendered && (parentsUntil(cellSaveArgs.cell, 'e-movableheader') || parentsUntil(cellSaveArgs.cell, 'e-movablecontent'))) {\n        _this.refreshTD(cellSaveArgs.cell, column, gObj.getMovableRowsObject()[_this.cellDetails.rowIndex], cellSaveArgs.value);\n      } else {\n        _this.refreshTD(cellSaveArgs.cell, column, gObj.getRowObjectFromUID(tr.getAttribute('data-uid')), cellSaveArgs.value);\n      }\n\n      removeClass([tr], ['e-editedrow', 'e-batchrow']);\n      removeClass([cellSaveArgs.cell], ['e-editedbatchcell', 'e-boolcell']);\n\n      if (!isNullOrUndefined(cellSaveArgs.value) && cellSaveArgs.value.toString() === (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString() && !_this.isColored || isNullOrUndefined(cellSaveArgs.value) && isNullOrUndefined(_this.cellDetails.value) && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n        cellSaveArgs.cell.classList.remove('e-updatedtd');\n\n        if (isBlazor() && gObj.isServerRendered && cellSaveArgs.value.toString() === (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString()) {\n          if (_this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellSaveArgs.columnObject.index].classList.contains('e-selectionbackground')) {\n            _this.originalCell[\"\" + _this.cellDetails.rowIndex + cellSaveArgs.columnObject.index].classList.add('e-selectionbackground', 'e-active');\n          } else {\n            _this.originalCell[\"\" + _this.cellDetails.rowIndex + cellSaveArgs.columnObject.index].classList.remove('e-selectionbackground', 'e-active');\n          }\n\n          _this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellSaveArgs.columnObject.index].replaceWith(_this.originalCell[\"\" + _this.cellDetails.rowIndex + cellSaveArgs.columnObject.index]);\n        }\n      }\n\n      gObj.trigger(events.cellSaved, cellSaveArgs);\n      gObj.notify(events.toolbarRefresh, {});\n      _this.isColored = false;\n\n      if (_this.parent.aggregates.length > 0) {\n        _this.parent.notify(events.refreshFooterRenderer, {});\n\n        if (_this.parent.groupSettings.columns.length > 0 && !_this.isAddRow(_this.cellDetails.rowIndex)) {\n          _this.parent.notify(events.groupAggregates, {});\n        }\n      }\n    };\n  };\n\n  BatchEdit.prototype.getDataByIndex = function (index) {\n    var row = this.parent.getRowObjectFromUID(this.parent.getDataRows()[index].getAttribute('data-uid'));\n    return row.changes ? row.changes : row.data;\n  };\n\n  BatchEdit.prototype.keyDownHandler = function (e) {\n    if ((e.action === 'tab' || e.action === 'shiftTab') && this.parent.isEdit) {\n      var gObj = this.parent;\n      var rowcell = parentsUntil(e.target, 'e-rowcell');\n\n      if (rowcell) {\n        var cell = rowcell.querySelector('.e-field');\n\n        if (cell) {\n          var visibleColumns = this.parent.getVisibleColumns();\n          var columnIndex = e.action === 'tab' ? visibleColumns.length - 1 : 0;\n\n          if (visibleColumns[columnIndex].field === cell.getAttribute('id').slice(this.parent.element.id.length)) {\n            if (this.cellDetails.rowIndex !== gObj.getRows().length - 1) {\n              this.saveCell();\n            } else {\n              if (gObj.editSettings.newRowPosition === 'Top') {\n                gObj.editSettings.newRowPosition = 'Bottom';\n                this.addRecord();\n                gObj.editSettings.newRowPosition = 'Top';\n              } else {\n                this.addRecord();\n              }\n            }\n          }\n        }\n      }\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addCancelWhilePaging = function () {\n    if (this.validateFormObj()) {\n      this.parent.notify(events.destroyForm, {});\n      this.parent.isEdit = false;\n      this.isColored = false;\n    }\n  };\n\n  return BatchEdit;\n}();\n\nexport { BatchEdit };","map":{"version":3,"sources":["C:/CN2/workspace-trunk/kain-front-end/node_modules/@syncfusion/ej2-grids/src/grid/actions/batch-edit.js"],"names":["extend","addClass","removeClass","setValue","isBlazor","remove","classList","updateBlazorTemplate","blazorTemplates","resetBlazorTemplate","isNullOrUndefined","CellType","parentsUntil","inArray","refreshForeignData","getObject","events","RowRenderer","CellRenderer","Row","Cell","RowModelGenerator","DataUtil","BatchEdit","parent","serviceLocator","renderer","cellDetails","originalCell","cloneCell","focus","getService","addEventListener","prototype","isDestroyed","on","click","clickHandler","dblclick","dblClickHandler","beforeCellFocused","onBeforeCellFocused","cellFocused","onCellFocused","dataBoundFunction","dataBound","bind","doubleTap","keyPressed","keyDownHandler","editNextValCell","closeForm","removeEventListener","off","notify","toolbarRefresh","destroy","e","target","element","id","isEdit","saveCell","setCellIdx","tr","isNaN","parseInt","getAttribute","parentElement","contains","editCell","getColumns","field","isAddRow","validateFormObj","byClick","indexOf","keyArgs","action","cancel","clickArgs","preventDefault","frzCols","getFrozenColumns","mCont","getContent","querySelector","mHdr","getHeaderContent","clear","container","isContent","isDataCell","frozenRows","isHeader","byKey","_a","indexes","rowIndex","cellIndex","querySelectorAll","length","isLastCellPrimaryKey","editCellFromIndex","column","index","getDataRows","rowIdx","cellIdx","closeEdit","gObj","rows","getRowsObject","argument","batchChanges","getBatchChanges","beforeBatchCancel","frozenColumns","currentViewData","isServerRendered","push","apply","getMovableRowsObject","cols","i","col","template","uid","rowRenderer","mTr","movObj","isAdded","clearSelection","isDirty","getContentTable","removeRowObjectFromUID","getForeignKeyColumns","data","changes","edit","ftr","removeHideAndSelection","refresh","aggregates","type","editType","refreshFooterRenderer","groupSettings","columns","groupAggregates","selectRow","selectionModule","prevRowIndex","renderModule","renderEmptyRow","args","requestType","batchCancel","isDataRow","cells","visible","refreshRowIdx","tooltipDestroy","trigger","splice","removeAttribute","forEach","td","deleteRecord","fieldname","bulkDelete","addRecord","bulkAddRow","endEdit","content","el","batchSave","Object","keys","j","replaceWith","editModule","formObj","validate","deletedRecords","isCheckBoxSelection","checkAllBox","pageSettings","totalRecordsCount","selectionSettings","persistSelection","removeSelectedData","original","changedRecords","filter","row","map","beforeBatchSave","beforeBatchSaveArgs","showSpinner","bulkSave","addedRecords","_i","rows_1","len","addRowObject","isTop","editSettings","newRowPosition","unshift","mRow","_this","selectedRowIndex","selectedRows","getSelectedRows","primaryKey","getPrimaryKeyFieldNames","rowData","getSelectedRecords","isJsComponent","deleteRowUid","getRowElementByUID","getRows","getCurrentViewRecords","beforeBatchDelete","beforeBatchDeleteArgs","concat","getMovableRowByIndex","getFrozenRowByIndex","rowObj","getRowObjectFromUID","getMovableDataRows","appendChild","getRowByIndex","uniqueid","selectedRow","undefined","batchDelete","mRows","nonMovableRows","slice","call","getHeaderTable","children","createElement","className","setAttribute","toString","getIndexFromData","allowAdding","add","defaultData","getDefaultData","beforeBatchAdd","beforeBatchAddArgs","mTbody","model","modelData","generateRows","render","insertBefore","firstChild","cellType","Indent","tbody","renderMovable","height","frozenHeight","forgetPrevious","batchAdd","isFrozen","findNextEditableCell","args1","columnObject","columnIndex","cell","ele","mEle","cloneNode","removeChild","childElementCount","isAdd","isValOnly","endIndex","validation","validationRules","checkNPCell","allowEditing","isIdentity","isPrimaryKey","dValues","columnModel","defaultValue","gLen","allowGrouping","getColumnByField","row_1","rowData_1","mRowData","colIdx","getColumnIndexByField","getDataByIndex","cells_1","columnName","isForeignKey","foreignKeyValue","value","foreignKeyData","getColIndex","getCellIdx","cellEdit","cellEditArgs","isColored","indent","insertCell","replaceChild","isPersistSelection","update","batchEditFormRendered","form","applyFormValidation","style","display","updateCell","refreshTD","queryCellInfo","setChanges","currentRowObj","rowEle","movableRowObject","movRowEle","movRowIndex","updateRow","keys_1","cIdx","getColumnIndexByUid","detailTemplate","childGrid","isRowDragable","rowcell","m","colIndex","isForceSave","obj","editedData","getCurrentEditedData","cloneEditedData","previousValue","cellSave","successCallBack","batchForm","cellSaveArgs","destroyForm","destroyWidgets","cellSaved","visibleColumns","getVisibleColumns","addCancelWhilePaging"],"mappings":"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","sourcesContent":["import { extend, addClass, removeClass, setValue, isBlazor } from '@syncfusion/ej2-base';\nimport { remove, classList, updateBlazorTemplate, blazorTemplates, resetBlazorTemplate } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { parentsUntil, inArray, refreshForeignData, getObject } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * `BatchEdit` module is used to handle batch editing actions.\n * @hidden\n */\nvar BatchEdit = /** @class */ (function () {\n    function BatchEdit(parent, serviceLocator, renderer) {\n        this.cellDetails = {};\n        this.originalCell = {};\n        this.cloneCell = {};\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.renderer = renderer;\n        this.focus = serviceLocator.getService('focus');\n        this.addEventListener();\n    }\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.click, this.clickHandler, this);\n        this.parent.on(events.dblclick, this.dblClickHandler, this);\n        this.parent.on(events.beforeCellFocused, this.onBeforeCellFocused, this);\n        this.parent.on(events.cellFocused, this.onCellFocused, this);\n        this.dataBoundFunction = this.dataBound.bind(this);\n        this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n        this.parent.on(events.doubleTap, this.dblClickHandler, this);\n        this.parent.on(events.keyPressed, this.keyDownHandler, this);\n        this.parent.on(events.editNextValCell, this.editNextValCell, this);\n        this.parent.on('closebatch', this.closeForm, this);\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.click, this.clickHandler);\n        this.parent.off(events.dblclick, this.dblClickHandler);\n        this.parent.off(events.beforeCellFocused, this.onBeforeCellFocused);\n        this.parent.off(events.cellFocused, this.onCellFocused);\n        this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n        this.parent.off(events.doubleTap, this.dblClickHandler);\n        this.parent.off(events.keyPressed, this.keyDownHandler);\n        this.parent.off(events.editNextValCell, this.editNextValCell);\n        this.parent.off('closebatch', this.closeForm);\n    };\n    BatchEdit.prototype.dataBound = function () {\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    BatchEdit.prototype.clickHandler = function (e) {\n        if (!parentsUntil(e.target, this.parent.element.id + '_add', true)) {\n            if (this.parent.isEdit) {\n                this.saveCell();\n                this.editNextValCell();\n            }\n            if (parentsUntil(e.target, 'e-rowcell') && !this.parent.isEdit) {\n                this.setCellIdx(e.target);\n            }\n        }\n    };\n    BatchEdit.prototype.dblClickHandler = function (e) {\n        var target = parentsUntil(e.target, 'e-rowcell');\n        var tr = parentsUntil(e.target, 'e-row');\n        if (target && tr && !isNaN(parseInt(target.getAttribute('aria-colindex'), 10))\n            && !target.parentElement.classList.contains('e-editedrow')) {\n            this.editCell(parseInt(tr.getAttribute('aria-rowindex'), 10), this.parent.getColumns()[parseInt(target.getAttribute('aria-colindex'), 10)].field, this.isAddRow(parseInt(tr.getAttribute('aria-rowindex'), 10)));\n        }\n    };\n    BatchEdit.prototype.onBeforeCellFocused = function (e) {\n        if (this.parent.isEdit && this.validateFormObj() &&\n            (e.byClick || (['tab', 'shiftTab', 'enter', 'shiftEnter'].indexOf(e.keyArgs.action) > -1))) {\n            e.cancel = true;\n            if (e.byClick) {\n                e.clickArgs.preventDefault();\n            }\n            else {\n                e.keyArgs.preventDefault();\n            }\n        }\n    };\n    BatchEdit.prototype.onCellFocused = function (e) {\n        var frzCols = this.parent.getFrozenColumns();\n        var mCont = this.parent.getContent().querySelector('.e-movablecontent');\n        var mHdr = this.parent.getHeaderContent().querySelector('.e-movableheader');\n        var clear = (!e.container.isContent || !e.container.isDataCell) && !(this.parent.frozenRows && e.container.isHeader);\n        if (!e.byKey || clear) {\n            if (this.parent.isEdit && clear) {\n                this.saveCell();\n            }\n            return;\n        }\n        var _a = e.container.indexes, rowIndex = _a[0], cellIndex = _a[1];\n        if (frzCols && (mCont.contains(e.element) || (this.parent.frozenRows && mHdr.contains(e.element)))) {\n            cellIndex += frzCols;\n        }\n        if (this.parent.frozenRows && e.container.isContent) {\n            rowIndex += this.parent.frozenRows;\n        }\n        var isEdit = this.parent.isEdit;\n        if (!this.parent.element.querySelectorAll('.e-popup-open').length) {\n            isEdit = isEdit && !this.validateFormObj();\n            switch (e.keyArgs.action) {\n                case 'tab':\n                case 'shiftTab':\n                    if (isEdit || this.parent.isLastCellPrimaryKey) {\n                        this.editCellFromIndex(rowIndex, cellIndex);\n                    }\n                    break;\n                case 'enter':\n                case 'shiftEnter':\n                    e.keyArgs.preventDefault();\n                    if (isEdit) {\n                        this.editCell(rowIndex, this.cellDetails.column.field);\n                    }\n                    break;\n                case 'f2':\n                    this.editCellFromIndex(rowIndex, cellIndex);\n                    this.focus.focus();\n                    break;\n            }\n        }\n    };\n    BatchEdit.prototype.isAddRow = function (index) {\n        return this.parent.getDataRows()[index].classList.contains('e-insertedrow');\n    };\n    BatchEdit.prototype.editCellFromIndex = function (rowIdx, cellIdx) {\n        this.cellDetails.rowIndex = rowIdx;\n        this.cellDetails.cellIndex = cellIdx;\n        this.editCell(rowIdx, this.parent.getColumns()[cellIdx].field, this.isAddRow(rowIdx));\n    };\n    // tslint:disable-next-line:max-func-body-length\n    BatchEdit.prototype.closeEdit = function () {\n        var gObj = this.parent;\n        var rows = this.parent.getRowsObject();\n        var argument = { cancel: false, batchChanges: this.getBatchChanges() };\n        gObj.notify(events.beforeBatchCancel, argument);\n        if (argument.cancel) {\n            return;\n        }\n        if (gObj.frozenColumns && rows.length < this.parent.currentViewData.length * 2 && !(isBlazor() && gObj.isServerRendered)) {\n            rows.push.apply(rows, this.parent.getMovableRowsObject());\n        }\n        var cols = this.parent.getColumns();\n        if (isBlazor()) {\n            for (var i = 0; i < cols.length; i++) {\n                var col = cols[i];\n                if (col.template) {\n                    updateBlazorTemplate(this.parent.element.id + col.uid, 'Template', col, false);\n                }\n            }\n        }\n        var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n        var tr;\n        var mTr;\n        var movObj;\n        if (gObj.isEdit) {\n            this.saveCell(true);\n        }\n        this.isAdded = false;\n        gObj.clearSelection();\n        for (var i = 0; i < rows.length; i++) {\n            if (rows[i].isDirty) {\n                if (gObj.frozenColumns) {\n                    movObj = gObj.getMovableRowsObject()[rows[i].index];\n                    movObj.isDirty = true;\n                }\n                tr = gObj.getContentTable().querySelector('[data-uid=' + rows[i].uid + ']');\n                if (gObj.frozenRows && !tr) {\n                    tr = gObj.getHeaderContent().querySelector('[data-uid=' + rows[i].uid + ']');\n                }\n                if (gObj.frozenColumns) {\n                    if (gObj.frozenRows) {\n                        mTr = gObj.getHeaderContent().querySelector('.e-movableheader')\n                            .querySelector('[data-uid=' + rows[i].uid + ']');\n                        if (!mTr) {\n                            mTr = gObj.getContent().querySelector('.e-movablecontent')\n                                .querySelector('[data-uid=' + rows[i].uid + ']');\n                        }\n                    }\n                    else {\n                        mTr = gObj.getContent().querySelector('.e-movablecontent')\n                            .querySelector('[data-uid=' + rows[i].uid + ']');\n                    }\n                }\n                if (tr || mTr) {\n                    if (tr && tr.classList.contains('e-insertedrow') || mTr && mTr.classList.contains('e-insertedrow')) {\n                        if (tr) {\n                            remove(tr);\n                        }\n                        if (mTr && (gObj.frozenColumns || gObj.frozenRows)) {\n                            remove(mTr);\n                        }\n                        this.removeRowObjectFromUID(rows[i].uid);\n                        i--;\n                    }\n                    else {\n                        refreshForeignData(rows[i], this.parent.getForeignKeyColumns(), rows[i].data);\n                        delete rows[i].changes;\n                        delete rows[i].edit;\n                        rows[i].isDirty = false;\n                        var ftr = mTr ? mTr : tr;\n                        if (isBlazor() && gObj.isServerRendered) {\n                            if (gObj.getFrozenColumns()) {\n                                this.removeHideAndSelection(mTr);\n                            }\n                            this.removeHideAndSelection(tr);\n                            this.closeForm();\n                        }\n                        else {\n                            classList(ftr, [], ['e-hiddenrow', 'e-updatedtd']);\n                            rowRenderer.refresh(rows[i], gObj.getColumns(), false);\n                        }\n                        if (this.parent.aggregates.length > 0) {\n                            var type = 'type';\n                            var editType = [];\n                            editType[type] = 'cancel';\n                            this.parent.notify(events.refreshFooterRenderer, editType);\n                            if (this.parent.groupSettings.columns.length > 0) {\n                                this.parent.notify(events.groupAggregates, editType);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        if (isBlazor() && gObj.isServerRendered) {\n            gObj.selectRow(gObj.selectionModule.prevRowIndex);\n        }\n        if (!gObj.getContentTable().querySelector('tr.e-row')) {\n            gObj.renderModule.renderEmptyRow();\n        }\n        var args = {\n            requestType: 'batchCancel', rows: this.parent.getRowsObject()\n        };\n        gObj.notify(events.batchCancel, {\n            rows: this.parent.getRowsObject().length ? this.parent.getRowsObject() :\n                [new Row({ isDataRow: true, cells: [new Cell({ isDataCell: true, visible: true })] })]\n        });\n        gObj.selectRow(this.cellDetails.rowIndex);\n        this.refreshRowIdx();\n        gObj.notify(events.toolbarRefresh, {});\n        this.parent.notify(events.tooltipDestroy, {});\n        args = { requestType: 'batchCancel', rows: this.parent.getRowsObject() };\n        gObj.trigger(events.batchCancel, args);\n        if (gObj.frozenColumns) {\n            rows.splice(this.parent.getMovableRowsObject().length, rows.length);\n        }\n    };\n    BatchEdit.prototype.removeHideAndSelection = function (tr) {\n        if (tr.classList.contains('e-hiddenrow')) {\n            tr.removeAttribute('aria-selected');\n            tr.querySelectorAll('.e-selectionbackground').forEach(function (td) {\n                removeClass([td], ['e-selectionbackground', 'e-active']);\n            });\n        }\n        classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n    };\n    BatchEdit.prototype.deleteRecord = function (fieldname, data) {\n        this.saveCell();\n        if (this.validateFormObj()) {\n            this.saveCell(true);\n        }\n        this.isAdded = false;\n        this.bulkDelete(fieldname, data);\n        if (this.parent.aggregates.length > 0) {\n            this.parent.notify(events.refreshFooterRenderer, {});\n            if (this.parent.groupSettings.columns.length > 0) {\n                this.parent.notify(events.groupAggregates, {});\n            }\n        }\n    };\n    BatchEdit.prototype.addRecord = function (data) {\n        this.bulkAddRow(data);\n    };\n    BatchEdit.prototype.endEdit = function (data) {\n        if (this.parent.isEdit && this.validateFormObj()) {\n            return;\n        }\n        if (isBlazor() && this.parent.isServerRendered) {\n            var content = this.parent.getContent();\n            this.closeForm();\n            removeClass(content.querySelectorAll('.e-updatedtd'), ['e-updatedtd']);\n            if (content.querySelector('.e-insertedrow, .e-hiddenrow')) {\n                removeClass(content.querySelectorAll('.e-hiddenrow'), ['e-hiddenrow']);\n                content.querySelectorAll('.e-insertedrow').forEach(function (el) { return el.remove(); });\n            }\n            this.refreshRowIdx();\n        }\n        this.batchSave();\n    };\n    BatchEdit.prototype.closeForm = function () {\n        for (var i = 0; i < Object.keys(this.originalCell).length; i++) {\n            for (var j = 0; j < Object.keys(this.cloneCell).length; j++) {\n                if (Object.keys(this.originalCell)[i] === Object.keys(this.cloneCell)[j]) {\n                    this.cloneCell[Object.keys(this.cloneCell)[j]].replaceWith(this.originalCell[Object.keys(this.originalCell)[i]]);\n                    if (this.originalCell[Object.keys(this.originalCell)[i]].classList.contains('e-selectionbackground')) {\n                        this.originalCell[Object.keys(this.originalCell)[i]].classList.remove('e-selectionbackground', 'e-active');\n                    }\n                }\n            }\n        }\n        this.cloneCell = {};\n        this.originalCell = {};\n    };\n    BatchEdit.prototype.validateFormObj = function () {\n        return this.parent.editModule.formObj && !this.parent.editModule.formObj.validate();\n    };\n    BatchEdit.prototype.batchSave = function () {\n        var gObj = this.parent;\n        var deletedRecords = 'deletedRecords';\n        if (gObj.isCheckBoxSelection) {\n            var checkAllBox = gObj.element.querySelector('.e-checkselectall').parentElement;\n            if (checkAllBox.classList.contains('e-checkbox-disabled') &&\n                gObj.pageSettings.totalRecordsCount > gObj.currentViewData.length) {\n                removeClass([checkAllBox], ['e-checkbox-disabled']);\n            }\n        }\n        var cols = this.parent.getColumns();\n        if (isBlazor()) {\n            for (var i = 0; i < cols.length; i++) {\n                var col = cols[i];\n                if (col.template) {\n                    blazorTemplates[this.parent.element.id + col.uid] = [];\n                    resetBlazorTemplate(this.parent.element.id + col.uid, 'Template');\n                }\n            }\n        }\n        this.saveCell();\n        if (gObj.isEdit || this.editNextValCell() || gObj.isEdit) {\n            return;\n        }\n        var changes = this.getBatchChanges();\n        if (this.parent.selectionSettings.type === 'Multiple' && changes[deletedRecords].length &&\n            this.parent.selectionSettings.persistSelection) {\n            changes[deletedRecords] = this.removeSelectedData;\n            this.removeSelectedData = [];\n        }\n        var original = {\n            changedRecords: this.parent.getRowsObject()\n                .filter(function (row) { return row.isDirty && ['add', 'delete'].indexOf(row.edit) === -1; })\n                .map(function (row) { return row.data; })\n        };\n        var args = { batchChanges: changes, cancel: false };\n        gObj.trigger(events.beforeBatchSave, args, function (beforeBatchSaveArgs) {\n            if (beforeBatchSaveArgs.cancel) {\n                return;\n            }\n            gObj.showSpinner();\n            gObj.notify(events.bulkSave, { changes: changes, original: original });\n        });\n    };\n    BatchEdit.prototype.getBatchChanges = function () {\n        var changes = {\n            addedRecords: [],\n            deletedRecords: [],\n            changedRecords: []\n        };\n        var rows = this.parent.getRowsObject();\n        for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n            var row = rows_1[_i];\n            if (row.isDirty) {\n                switch (row.edit) {\n                    case 'add':\n                        changes.addedRecords.push(row.changes);\n                        break;\n                    case 'delete':\n                        changes.deletedRecords.push(row.data);\n                        break;\n                    default:\n                        changes.changedRecords.push(row.changes);\n                }\n            }\n        }\n        return changes;\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.removeRowObjectFromUID = function (uid) {\n        var rows = this.parent.getRowsObject();\n        var i = 0;\n        for (var len = rows.length; i < len; i++) {\n            if (rows[i].uid === uid) {\n                break;\n            }\n        }\n        rows.splice(i, 1);\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.addRowObject = function (row) {\n        var isTop = this.parent.editSettings.newRowPosition === 'Top';\n        isTop ? this.parent.getRowsObject().unshift(row) :\n            this.parent.getRowsObject().push(row);\n        var mRow = this.parent.getMovableRowsObject();\n        if (this.parent.getFrozenColumns() && !mRow.length) {\n            isTop ? mRow.unshift(row) : mRow.push(row);\n        }\n    };\n    // tslint:disable-next-line:max-func-body-length\n    BatchEdit.prototype.bulkDelete = function (fieldname, data) {\n        var _this = this;\n        this.removeSelectedData = [];\n        var gObj = this.parent;\n        var index = gObj.selectedRowIndex;\n        var selectedRows = gObj.getSelectedRows();\n        var args = {\n            primaryKey: this.parent.getPrimaryKeyFieldNames(),\n            rowIndex: index,\n            rowData: data ? data : gObj.getSelectedRecords()[0],\n            cancel: false\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            if (data) {\n                args.row = gObj.editModule.deleteRowUid ? gObj.getRowElementByUID(gObj.editModule.deleteRowUid)\n                    : gObj.getRows()[gObj.getCurrentViewRecords().indexOf(data)];\n            }\n            else {\n                args.row = data ? gObj.getRows()[index] : selectedRows[0];\n            }\n            if (!args.row) {\n                return;\n            }\n        }\n        gObj.trigger(events.beforeBatchDelete, args, function (beforeBatchDeleteArgs) {\n            if (beforeBatchDeleteArgs.cancel) {\n                return;\n            }\n            beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row ?\n                beforeBatchDeleteArgs.row : data ? gObj.getRows()[index] : selectedRows[0];\n            if (_this.parent.getFrozenColumns()) {\n                if (data) {\n                    index = parseInt(beforeBatchDeleteArgs.row.getAttribute('aria-rowindex'), 10);\n                    selectedRows = [beforeBatchDeleteArgs.row];\n                    if (parentsUntil(beforeBatchDeleteArgs.row, 'e-frozencontent')\n                        || parentsUntil(beforeBatchDeleteArgs.row, 'e-frozenheader')) {\n                        selectedRows = selectedRows.concat(gObj.getMovableRowByIndex(index));\n                    }\n                    else if (parentsUntil(beforeBatchDeleteArgs.row, 'e-movablecontent')\n                        || (parentsUntil(beforeBatchDeleteArgs.row, 'e-movableheader'))) {\n                        selectedRows = selectedRows.concat(gObj.getFrozenRowByIndex(index));\n                    }\n                }\n                for (var i = 0; i < selectedRows.length; i++) {\n                    var uid = selectedRows[i].getAttribute('data-uid');\n                    if (selectedRows[i].classList.contains('e-insertedrow')) {\n                        _this.removeRowObjectFromUID(uid);\n                        remove(selectedRows[i]);\n                    }\n                    else {\n                        var rowObj = gObj.getRowObjectFromUID(uid);\n                        rowObj.isDirty = true;\n                        rowObj.edit = 'delete';\n                        classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n                        if (gObj.frozenRows && index < gObj.frozenRows && gObj.getMovableDataRows().length >= gObj.frozenRows) {\n                            gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody')\n                                .appendChild(gObj.getMovableRowByIndex(gObj.frozenRows - 1));\n                            gObj.getHeaderContent().querySelector('.e-frozenheader').querySelector('tbody')\n                                .appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n                        }\n                        if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n                            gObj.getHeaderContent().querySelector('tbody').appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n                        }\n                    }\n                    delete selectedRows[i];\n                }\n            }\n            else if (!_this.parent.getFrozenColumns() && (selectedRows.length === 1 || data)) {\n                var uid = beforeBatchDeleteArgs.row.getAttribute('data-uid');\n                uid = data && _this.parent.editModule.deleteRowUid ? uid = _this.parent.editModule.deleteRowUid : uid;\n                if (beforeBatchDeleteArgs.row.classList.contains('e-insertedrow')) {\n                    _this.removeRowObjectFromUID(uid);\n                    remove(beforeBatchDeleteArgs.row);\n                }\n                else {\n                    var rowObj = gObj.getRowObjectFromUID(uid);\n                    rowObj.isDirty = true;\n                    rowObj.edit = 'delete';\n                    classList(beforeBatchDeleteArgs.row, ['e-hiddenrow', 'e-updatedtd'], []);\n                }\n                delete beforeBatchDeleteArgs.row;\n            }\n            else {\n                for (var i = 0; i < selectedRows.length; i++) {\n                    var uniqueid = selectedRows[i].getAttribute('data-uid');\n                    if (selectedRows[i].classList.contains('e-insertedrow')) {\n                        _this.removeRowObjectFromUID(uniqueid);\n                        remove(selectedRows[i]);\n                    }\n                    else {\n                        classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n                        var selectedRow = gObj.getRowObjectFromUID(uniqueid);\n                        selectedRow.isDirty = true;\n                        selectedRow.edit = 'delete';\n                        delete selectedRows[i];\n                    }\n                }\n            }\n            _this.refreshRowIdx();\n            _this.removeSelectedData = gObj.getSelectedRecords();\n            if (data) {\n                gObj.editModule.deleteRowUid = undefined;\n                if (gObj.getSelectedRows().length) {\n                    index = parseInt(gObj.getSelectedRows()[0].getAttribute('aria-rowindex'), 10);\n                }\n            }\n            if (gObj.getSelectedRows().length) {\n                gObj.clearSelection();\n                gObj.selectRow(index);\n            }\n            gObj.trigger(events.batchDelete, beforeBatchDeleteArgs);\n            gObj.notify(events.batchDelete, { rows: _this.parent.getRowsObject() });\n            gObj.notify(events.toolbarRefresh, {});\n        });\n    };\n    BatchEdit.prototype.refreshRowIdx = function () {\n        var rows = [];\n        var mRows = [];\n        var nonMovableRows = [];\n        var frzCols = this.parent.getFrozenColumns();\n        if (this.parent.frozenRows) {\n            rows = [].slice.call(this.parent.getHeaderTable().querySelector('tbody').children);\n            if (frzCols) {\n                mRows = [].slice.call(this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody').children);\n                for (var i = 0; i < mRows.length; i++) {\n                    nonMovableRows[i] = this.parent.createElement('tr', { className: 'emptynonmv' });\n                }\n            }\n        }\n        if (frzCols) {\n            mRows = mRows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));\n            nonMovableRows = nonMovableRows.concat([].slice.call(this.parent.element.querySelector('.e-movablecontent').querySelector('tbody').children));\n        }\n        rows = rows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));\n        for (var i = 0, j = 0, len = rows.length; i < len; i++) {\n            if (rows[i].classList.contains('e-row') && !rows[i].classList.contains('e-hiddenrow')) {\n                rows[i].setAttribute('aria-rowindex', j.toString());\n                if (frzCols) {\n                    mRows[i].setAttribute('aria-rowindex', j.toString());\n                    if (nonMovableRows[i].classList.contains('e-row')) {\n                        nonMovableRows[i].setAttribute('aria-rowindex', j.toString());\n                    }\n                }\n                j++;\n            }\n            else {\n                rows[i].removeAttribute('aria-rowindex');\n                if (frzCols) {\n                    mRows[i].removeAttribute('aria-rowindex');\n                }\n            }\n        }\n    };\n    BatchEdit.prototype.getIndexFromData = function (data) {\n        return inArray(data, this.parent.getCurrentViewRecords());\n    };\n    BatchEdit.prototype.bulkAddRow = function (data) {\n        var _this = this;\n        var gObj = this.parent;\n        if (!gObj.editSettings.allowAdding) {\n            return;\n        }\n        if (gObj.isEdit) {\n            this.saveCell();\n            this.parent.notify(events.editNextValCell, {});\n        }\n        if (gObj.isEdit) {\n            return;\n        }\n        this.parent.element.classList.add('e-editing');\n        var defaultData = data ? data : this.getDefaultData();\n        var args = {\n            defaultData: defaultData,\n            primaryKey: gObj.getPrimaryKeyFieldNames(),\n            cancel: false\n        };\n        gObj.trigger(events.beforeBatchAdd, args, function (beforeBatchAddArgs) {\n            if (beforeBatchAddArgs.cancel) {\n                return;\n            }\n            _this.isAdded = true;\n            gObj.clearSelection();\n            var mTr;\n            var mTbody;\n            var row = new RowRenderer(_this.serviceLocator, null, _this.parent);\n            var model = new RowModelGenerator(_this.parent);\n            var modelData = model.generateRows([beforeBatchAddArgs.defaultData]);\n            var tr = row.render(modelData[0], gObj.getColumns());\n            var col;\n            var index;\n            for (var i = 0; i < _this.parent.groupSettings.columns.length; i++) {\n                tr.insertBefore(_this.parent.createElement('td', { className: 'e-indentcell' }), tr.firstChild);\n                modelData[0].cells.unshift(new Cell({ cellType: CellType.Indent }));\n            }\n            var tbody = gObj.getContentTable().querySelector('tbody');\n            tr.classList.add('e-insertedrow');\n            if (tbody.querySelector('.e-emptyrow')) {\n                tbody.querySelector('.e-emptyrow').remove();\n            }\n            if (gObj.getFrozenColumns()) {\n                mTr = _this.renderMovable(tr);\n                if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n                    mTbody = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody');\n                }\n                else {\n                    mTbody = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n                }\n                _this.parent.editSettings.newRowPosition === 'Top' ? mTbody.insertBefore(mTr, mTbody.firstChild) : mTbody.appendChild(mTr);\n                addClass(mTr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n                if (_this.parent.height === 'auto') {\n                    _this.parent.notify(events.frozenHeight, {});\n                }\n            }\n            if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n                tbody = gObj.getHeaderContent().querySelector('tbody');\n            }\n            else {\n                tbody = gObj.getContent().querySelector('tbody');\n            }\n            _this.parent.editSettings.newRowPosition === 'Top' ? tbody.insertBefore(tr, tbody.firstChild) : tbody.appendChild(tr);\n            addClass(tr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n            modelData[0].isDirty = true;\n            modelData[0].changes = extend({}, {}, modelData[0].data, true);\n            modelData[0].edit = 'add';\n            _this.addRowObject(modelData[0]);\n            _this.refreshRowIdx();\n            _this.focus.forgetPrevious();\n            gObj.notify(events.batchAdd, { rows: _this.parent.getRowsObject(), args: { isFrozen: _this.parent.getFrozenColumns() } });\n            var changes = _this.getBatchChanges();\n            var addedRecords = 'addedRecords';\n            _this.parent.editSettings.newRowPosition === 'Top' ? gObj.selectRow(0) :\n                gObj.selectRow(_this.parent.getCurrentViewRecords().length + changes[addedRecords].length - 1);\n            if (!data) {\n                index = _this.findNextEditableCell(0, true);\n                col = gObj.getColumns()[index];\n                _this.parent.editSettings.newRowPosition === 'Top' ? _this.editCell(0, col.field, true) :\n                    _this.editCell(_this.parent.getCurrentViewRecords().length + changes[addedRecords].length - 1, col.field, true);\n            }\n            if (_this.parent.aggregates.length > 0 && data) {\n                _this.parent.notify(events.refreshFooterRenderer, {});\n            }\n            var args1 = {\n                defaultData: beforeBatchAddArgs.defaultData, row: tr,\n                columnObject: col, columnIndex: index, primaryKey: beforeBatchAddArgs.primaryKey, cell: tr.cells[index]\n            };\n            gObj.trigger(events.batchAdd, args1);\n            if (isBlazor()) {\n                _this.parent.notify(events.toolbarRefresh, {});\n                _this.parent.notify('start-add', {});\n            }\n        });\n    };\n    BatchEdit.prototype.renderMovable = function (ele) {\n        var mEle = ele.cloneNode(true);\n        for (var i = 0; i < this.parent.getFrozenColumns(); i++) {\n            mEle.removeChild(mEle.children[0]);\n        }\n        for (var i = this.parent.getFrozenColumns(), len = ele.childElementCount; i < len; i++) {\n            ele.removeChild(ele.children[ele.childElementCount - 1]);\n        }\n        return mEle;\n    };\n    BatchEdit.prototype.findNextEditableCell = function (columnIndex, isAdd, isValOnly) {\n        var cols = this.parent.getColumns();\n        var endIndex = cols.length;\n        var validation;\n        for (var i = columnIndex; i < endIndex; i++) {\n            validation = isValOnly ? isNullOrUndefined(cols[i].validationRules) : false;\n            if (!isAdd && this.checkNPCell(cols[i])) {\n                return i;\n            }\n            else if (isAdd && !cols[i].template && cols[i].visible && cols[i].allowEditing &&\n                !(cols[i].isIdentity && cols[i].isPrimaryKey) && !validation) {\n                return i;\n            }\n        }\n        return -1;\n    };\n    BatchEdit.prototype.checkNPCell = function (col) {\n        return !col.template && col.visible && !col.isPrimaryKey && !col.isIdentity && col.allowEditing;\n    };\n    BatchEdit.prototype.getDefaultData = function () {\n        var gObj = this.parent;\n        var data = {};\n        var dValues = { 'number': 0, 'string': null, 'boolean': false, 'date': null, 'datetime': null };\n        for (var _i = 0, _a = (gObj.columnModel); _i < _a.length; _i++) {\n            var col = _a[_i];\n            if (col.field) {\n                setValue(col.field, col.defaultValue ? col.defaultValue : dValues[col.type], data);\n            }\n        }\n        return data;\n    };\n    BatchEdit.prototype.setCellIdx = function (target) {\n        var gLen = 0;\n        if (this.parent.allowGrouping) {\n            gLen = this.parent.groupSettings.columns.length;\n        }\n        this.cellDetails.cellIndex = target.cellIndex - gLen;\n        this.cellDetails.rowIndex = parseInt(target.getAttribute('index'), 10);\n    };\n    BatchEdit.prototype.editCell = function (index, field, isAdd) {\n        var _this = this;\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        var keys = gObj.getPrimaryKeyFieldNames();\n        this.parent.element.classList.add('e-editing');\n        if (isBlazor() && col.template && !isAdd) {\n            resetBlazorTemplate(this.parent.element.id + col.uid, 'Template', index);\n        }\n        if (gObj.editSettings.allowEditing && col.allowEditing) {\n            if (gObj.isEdit && !(this.cellDetails.column.field === field\n                && (this.cellDetails.rowIndex === index && this.parent.getDataRows().length - 1 !== index))) {\n                this.saveCell();\n                if (this.cellDetails.rowIndex === index && this.cellDetails.column.field === field) {\n                    return;\n                }\n            }\n            if (gObj.isEdit) {\n                return;\n            }\n            var row_1;\n            var rowData_1;\n            var mRowData = void 0;\n            var colIdx = gObj.getColumnIndexByField(field);\n            var frzCols = gObj.getFrozenColumns();\n            if (frzCols && colIdx >= frzCols) {\n                row_1 = gObj.getMovableDataRows()[index];\n                mRowData = this.parent.getRowObjectFromUID(this.parent.getMovableDataRows()[index].getAttribute('data-uid'));\n                rowData_1 = mRowData.changes ? extend({}, {}, mRowData.changes, true) : extend({}, {}, this.getDataByIndex(index), true);\n            }\n            else {\n                row_1 = gObj.getDataRows()[index];\n                rowData_1 = extend({}, {}, this.getDataByIndex(index), true);\n            }\n            if ((keys[0] === col.field && !row_1.classList.contains('e-insertedrow')) || col.columns ||\n                (col.isPrimaryKey && col.isIdentity)) {\n                this.parent.isLastCellPrimaryKey = true;\n                return;\n            }\n            this.parent.isLastCellPrimaryKey = false;\n            var rowObj = gObj.getRowObjectFromUID(row_1.getAttribute('data-uid'));\n            var cells_1 = [].slice.apply(row_1.cells);\n            var args = {\n                columnName: col.field, columnObject: col, isForeignKey: !isNullOrUndefined(col.foreignKeyValue),\n                primaryKey: keys, rowData: rowData_1,\n                validationRules: extend({}, col.validationRules ? col.validationRules : {}),\n                value: getObject(col.field, rowData_1),\n                type: !isAdd ? 'edit' : 'add', cancel: false,\n                foreignKeyData: rowObj && rowObj.foreignKeyData\n            };\n            if (!isBlazor() || this.parent.isJsComponent) {\n                args.cell = cells_1[this.getColIndex(cells_1, this.getCellIdx(col.uid))];\n                args.row = row_1;\n                if (!args.cell) {\n                    return;\n                }\n            }\n            gObj.trigger(events.cellEdit, args, function (cellEditArgs) {\n                if (cellEditArgs.cancel) {\n                    return;\n                }\n                cellEditArgs.cell = cellEditArgs.cell ? cellEditArgs.cell : cells_1[_this.getColIndex(cells_1, _this.getCellIdx(col.uid))];\n                cellEditArgs.row = cellEditArgs.row ? cellEditArgs.row : row_1;\n                _this.cellDetails = {\n                    rowData: rowData_1, column: col, value: cellEditArgs.value, isForeignKey: cellEditArgs.isForeignKey, rowIndex: index,\n                    cellIndex: parseInt(cellEditArgs.cell.getAttribute('aria-colindex'), 10),\n                    foreignKeyData: cellEditArgs.foreignKeyData\n                };\n                if (cellEditArgs.cell.classList.contains('e-updatedtd')) {\n                    _this.isColored = true;\n                    cellEditArgs.cell.classList.remove('e-updatedtd');\n                }\n                if (isBlazor() && gObj.isServerRendered) {\n                    var cell = 'cells';\n                    var cloneCell = 'cloneCell';\n                    var indent = cellEditArgs.row.querySelectorAll('.e-indentcell, .e-detailrowcollapse, .e-detailrowexpand, .e-rowdragdrop').length;\n                    _this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] =\n                        cellEditArgs[cloneCell] = cellEditArgs.cell.cloneNode(true);\n                    if ((parentsUntil(cellEditArgs.cell, 'e-movableheader') || parentsUntil(cellEditArgs.cell, 'e-movablecontent'))) {\n                        cellEditArgs.row.insertCell(cellEditArgs.columnObject.index - gObj.getFrozenColumns());\n                        cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index - gObj.getFrozenColumns()]);\n                    }\n                    else {\n                        cellEditArgs.row.insertCell(cellEditArgs.columnObject.index + indent);\n                        cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index + indent]);\n                    }\n                    _this.originalCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] =\n                        cellEditArgs.cell.parentElement.removeChild(cellEditArgs.cell);\n                    removeClass([_this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index]], ['e-focus', 'e-focused']);\n                }\n                gObj.isEdit = true;\n                gObj.clearSelection();\n                if (!gObj.isCheckBoxSelection || !gObj.isPersistSelection) {\n                    gObj.selectRow(_this.cellDetails.rowIndex, true);\n                }\n                _this.renderer.update(cellEditArgs);\n                _this.parent.notify(events.batchEditFormRendered, cellEditArgs);\n                _this.form = gObj.element.querySelector('#' + gObj.element.id + 'EditForm');\n                gObj.editModule.applyFormValidation([col]);\n                _this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n            });\n        }\n    };\n    BatchEdit.prototype.updateCell = function (rowIndex, field, value) {\n        var col = this.parent.getColumnByField(field);\n        var index = this.parent.getColumnIndexByField(field);\n        if (col && !col.isPrimaryKey) {\n            var td = this.parent.getDataRows()[rowIndex].querySelectorAll('.e-rowcell')[index];\n            if (this.parent.getFrozenColumns()) {\n                var cells = [].slice.call(this.parent.getDataRows()[rowIndex].querySelectorAll('.e-rowcell')).concat([].slice.call(this.parent.getMovableDataRows()[rowIndex].querySelectorAll('.e-rowcell')));\n                td = cells[index];\n            }\n            var rowObj = this.parent.getRowObjectFromUID(td.parentElement.getAttribute('data-uid'));\n            this.refreshTD(td, col, rowObj, value);\n            this.parent.trigger(events.queryCellInfo, {\n                cell: td, column: col, data: rowObj.changes\n            });\n        }\n    };\n    BatchEdit.prototype.setChanges = function (rowObj, field, value, td) {\n        var currentRowObj;\n        if (!this.parent.getFrozenColumns()) {\n            if (!rowObj.changes) {\n                rowObj.changes = extend({}, {}, rowObj.data, true);\n            }\n            if (!isNullOrUndefined(field)) {\n                DataUtil.setValue(field, value, rowObj.changes);\n            }\n            if (rowObj.data[field] !== value) {\n                rowObj.isDirty = true;\n            }\n        }\n        else {\n            var rowEle = this.parent.getRowElementByUID(rowObj.uid);\n            var rowIndex = parseInt(rowEle.getAttribute('aria-rowindex'), 10);\n            currentRowObj = this.parent.getRowsObject()[rowIndex];\n            if (!currentRowObj.changes) {\n                currentRowObj.changes = extend({}, {}, rowObj.data, true);\n            }\n            setValue(field, value, currentRowObj.changes);\n            var movableRowObject = void 0;\n            if (isBlazor() && this.parent.isServerRendered && (parentsUntil(td, 'e-movableheader') ||\n                parentsUntil(td, 'e-movablecontent'))) {\n                var movRowEle = this.parent.getMovableRowByIndex(this.cellDetails.rowIndex);\n                var movRowIndex = parseInt(movRowEle.getAttribute('aria-rowindex'), 10);\n                movableRowObject = this.parent.getMovableRowsObject()[movRowIndex];\n            }\n            else {\n                movableRowObject = this.parent.getRowObjectFromUID(rowObj.uid);\n            }\n            movableRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n            if (rowObj.data[field] !== value) {\n                movableRowObject.isDirty = true;\n                currentRowObj.isDirty = true;\n            }\n        }\n    };\n    BatchEdit.prototype.updateRow = function (index, data) {\n        var keys = Object.keys(data);\n        for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n            var col = keys_1[_i];\n            this.updateCell(index, col, data[col]);\n        }\n    };\n    BatchEdit.prototype.getCellIdx = function (uid) {\n        var cIdx = this.parent.getColumnIndexByUid(uid) + this.parent.groupSettings.columns.length;\n        if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n            cIdx++;\n        }\n        if (this.parent.isRowDragable()) {\n            cIdx++;\n        }\n        return cIdx;\n    };\n    BatchEdit.prototype.refreshTD = function (td, column, rowObj, value) {\n        var cell = new CellRenderer(this.parent, this.serviceLocator);\n        var rowcell;\n        this.setChanges(rowObj, column.field, value, td);\n        var frzCols = this.parent.getFrozenColumns();\n        refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n        if (frzCols && this.getCellIdx(column.uid) >= frzCols && this.parent.getColumns().length === rowObj.cells.length) {\n            rowcell = rowObj.cells.slice(frzCols, rowObj.cells.length);\n        }\n        else {\n            rowcell = rowObj.cells;\n        }\n        cell.refreshTD(td, rowcell[this.getCellIdx(column.uid) - (this.getCellIdx(column.uid) >= frzCols ? frzCols : 0)], rowObj.changes, { 'index': this.getCellIdx(column.uid) });\n        td.classList.add('e-updatedtd');\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    BatchEdit.prototype.getColIndex = function (cells, index) {\n        var cIdx = 0;\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns) {\n            cIdx = this.parent.groupSettings.columns.length;\n        }\n        if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n            cIdx++;\n        }\n        if (this.parent.isRowDragable()) {\n            cIdx++;\n        }\n        for (var m = 0; m < cells.length; m++) {\n            var colIndex = parseInt(cells[m].getAttribute('aria-colindex'), 10);\n            if (colIndex === index - cIdx) {\n                return m;\n            }\n        }\n        return -1;\n    };\n    BatchEdit.prototype.editNextValCell = function () {\n        var gObj = this.parent;\n        if (this.isAdded && !gObj.isEdit) {\n            for (var i = this.cellDetails.cellIndex; i < gObj.getColumns().length; i++) {\n                if (gObj.isEdit) {\n                    return;\n                }\n                var index = this.findNextEditableCell(this.cellDetails.cellIndex + 1, true, true);\n                var col = gObj.getColumns()[index];\n                if (col) {\n                    this.editCell(0, col.field, true);\n                    this.saveCell();\n                }\n            }\n            if (!gObj.isEdit) {\n                this.isAdded = false;\n            }\n        }\n    };\n    BatchEdit.prototype.saveCell = function (isForceSave) {\n        var gObj = this.parent;\n        if (!isForceSave && (!gObj.isEdit || this.validateFormObj())) {\n            return;\n        }\n        this.parent.element.classList.remove('e-editing');\n        var tr = parentsUntil(this.form, 'e-row');\n        var column = this.cellDetails.column;\n        var obj = {};\n        obj[column.field] = this.cellDetails.rowData[column.field];\n        var editedData = gObj.editModule.getCurrentEditedData(this.form, obj);\n        var cloneEditedData = extend({}, editedData);\n        editedData = extend({}, editedData, this.cellDetails.rowData);\n        var value = getObject(column.field, cloneEditedData);\n        if (!isNullOrUndefined(column.field)) {\n            setValue(column.field, value, editedData);\n        }\n        var args = {\n            columnName: column.field,\n            value: getObject(column.field, editedData),\n            rowData: this.cellDetails.rowData,\n            previousValue: this.cellDetails.value,\n            columnObject: column,\n            isForeignKey: this.cellDetails.isForeignKey, cancel: false\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            args.cell = this.form.parentElement;\n        }\n        if (!isForceSave) {\n            gObj.trigger(events.cellSave, args, this.successCallBack(args, tr, column));\n            gObj.notify(events.batchForm, { formObj: this.form });\n        }\n        else {\n            this.successCallBack(args, tr, column)(args);\n        }\n    };\n    BatchEdit.prototype.successCallBack = function (cellSaveArgs, tr, column) {\n        var _this = this;\n        return function (cellSaveArgs) {\n            var gObj = _this.parent;\n            cellSaveArgs.cell = cellSaveArgs.cell ? cellSaveArgs.cell : _this.form.parentElement;\n            if (cellSaveArgs.cancel) {\n                return;\n            }\n            gObj.editModule.destroyForm();\n            gObj.isEdit = false;\n            gObj.editModule.destroyWidgets([column]);\n            if (isBlazor() && column.template && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n                updateBlazorTemplate(gObj.element.id + column.uid, 'Template', column, false);\n            }\n            _this.parent.notify(events.tooltipDestroy, {});\n            if (isBlazor() && gObj.isServerRendered && (parentsUntil(cellSaveArgs.cell, 'e-movableheader') ||\n                parentsUntil(cellSaveArgs.cell, 'e-movablecontent'))) {\n                _this.refreshTD(cellSaveArgs.cell, column, gObj.getMovableRowsObject()[_this.cellDetails.rowIndex], cellSaveArgs.value);\n            }\n            else {\n                _this.refreshTD(cellSaveArgs.cell, column, gObj.getRowObjectFromUID(tr.getAttribute('data-uid')), cellSaveArgs.value);\n            }\n            removeClass([tr], ['e-editedrow', 'e-batchrow']);\n            removeClass([cellSaveArgs.cell], ['e-editedbatchcell', 'e-boolcell']);\n            if (!isNullOrUndefined(cellSaveArgs.value) && cellSaveArgs.value.toString() ===\n                (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString() && !_this.isColored\n                || (isNullOrUndefined(cellSaveArgs.value) && isNullOrUndefined(_this.cellDetails.value) &&\n                    !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow'))) {\n                cellSaveArgs.cell.classList.remove('e-updatedtd');\n                if (isBlazor() && gObj.isServerRendered && cellSaveArgs.value.toString() ===\n                    (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString()) {\n                    if (_this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellSaveArgs.columnObject.index].\n                        classList.contains('e-selectionbackground')) {\n                        _this.originalCell[\"\" + _this.cellDetails.rowIndex + cellSaveArgs.columnObject.index].\n                            classList.add('e-selectionbackground', 'e-active');\n                    }\n                    else {\n                        _this.originalCell[\"\" + _this.cellDetails.rowIndex + cellSaveArgs.columnObject.index].\n                            classList.remove('e-selectionbackground', 'e-active');\n                    }\n                    _this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellSaveArgs.columnObject.index]\n                        .replaceWith(_this.originalCell[\"\" + _this.cellDetails.rowIndex + cellSaveArgs.columnObject.index]);\n                }\n            }\n            gObj.trigger(events.cellSaved, cellSaveArgs);\n            gObj.notify(events.toolbarRefresh, {});\n            _this.isColored = false;\n            if (_this.parent.aggregates.length > 0) {\n                _this.parent.notify(events.refreshFooterRenderer, {});\n                if (_this.parent.groupSettings.columns.length > 0 && !_this.isAddRow(_this.cellDetails.rowIndex)) {\n                    _this.parent.notify(events.groupAggregates, {});\n                }\n            }\n        };\n    };\n    BatchEdit.prototype.getDataByIndex = function (index) {\n        var row = this.parent.getRowObjectFromUID(this.parent.getDataRows()[index].getAttribute('data-uid'));\n        return row.changes ? row.changes : row.data;\n    };\n    BatchEdit.prototype.keyDownHandler = function (e) {\n        if ((e.action === 'tab' || e.action === 'shiftTab') && this.parent.isEdit) {\n            var gObj = this.parent;\n            var rowcell = parentsUntil(e.target, 'e-rowcell');\n            if (rowcell) {\n                var cell = rowcell.querySelector('.e-field');\n                if (cell) {\n                    var visibleColumns = this.parent.getVisibleColumns();\n                    var columnIndex = e.action === 'tab' ? visibleColumns.length - 1 : 0;\n                    if (visibleColumns[columnIndex].field === cell.getAttribute('id').slice(this.parent.element.id.length)) {\n                        if (this.cellDetails.rowIndex !== gObj.getRows().length - 1) {\n                            this.saveCell();\n                        }\n                        else {\n                            if (gObj.editSettings.newRowPosition === 'Top') {\n                                gObj.editSettings.newRowPosition = 'Bottom';\n                                this.addRecord();\n                                gObj.editSettings.newRowPosition = 'Top';\n                            }\n                            else {\n                                this.addRecord();\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.addCancelWhilePaging = function () {\n        if (this.validateFormObj()) {\n            this.parent.notify(events.destroyForm, {});\n            this.parent.isEdit = false;\n            this.isColored = false;\n        }\n    };\n    return BatchEdit;\n}());\nexport { BatchEdit };\n"]},"metadata":{},"sourceType":"module"}