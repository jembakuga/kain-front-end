{"ast":null,"code":"import { remove, isBlazor } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { uiUpdate, initialEnd, dataReady, modelChanged, refreshAggregates, refreshFooterRenderer, groupAggregates } from '../base/constant';\nimport { FooterRenderer } from '../renderer/footer-renderer';\nimport { SummaryCellRenderer } from '../renderer/summary-cell-renderer';\nimport { GroupSummaryModelGenerator, CaptionSummaryModelGenerator } from '../services/summary-model-generator';\n/**\n * Summary Action controller.\n */\n\nvar Aggregate =\n/** @class */\nfunction () {\n  function Aggregate(parent, locator) {\n    this.parent = parent;\n    this.locator = locator;\n    this.addEventListener();\n  }\n\n  Aggregate.prototype.getModuleName = function () {\n    return 'aggregate';\n  };\n\n  Aggregate.prototype.initiateRender = function () {\n    var _this = this;\n\n    var cellFac = this.locator.getService('cellRendererFactory');\n    var instance = new SummaryCellRenderer(this.parent, this.locator);\n    [CellType.Summary, CellType.CaptionSummary, CellType.GroupSummary].forEach(function (type) {\n      return cellFac.addCellRenderer(type, instance);\n    });\n    this.footerRenderer = new FooterRenderer(this.parent, this.locator);\n    this.footerRenderer.renderPanel();\n    this.footerRenderer.renderTable();\n    this.locator.register('footerRenderer', this.footerRenderer);\n\n    var fn = function () {\n      _this.prepareSummaryInfo();\n\n      _this.parent.off(dataReady, fn);\n    };\n\n    this.parent.on(dataReady, fn, this);\n    this.parent.on(dataReady, this.footerRenderer.refresh, this.footerRenderer);\n  };\n  /**\n   * @hidden\n   */\n\n\n  Aggregate.prototype.prepareSummaryInfo = function () {\n    var _this = this;\n\n    summaryIterator(this.parent.aggregates, function (column) {\n      var dataColumn = _this.parent.getColumnByField(column.field) || {};\n      var type = dataColumn.type;\n      var cFormat = 'customFormat';\n\n      if (!isNullOrUndefined(column[cFormat])) {\n        column.setPropertiesSilent({\n          format: column[cFormat]\n        });\n      }\n\n      column.setPropertiesSilent({\n        format: _this.getFormatFromType(column.format, type)\n      });\n      column.setFormatter(_this.parent.locale);\n      column.setPropertiesSilent({\n        columnName: column.columnName || column.field\n      });\n    });\n\n    if (isBlazor() && this.parent.isServerRendered) {\n      var bulkChanges_1 = 'bulkChanges';\n      var aggregates_1 = 'aggregates';\n      Object.keys(this.parent[bulkChanges_1]).forEach(function (prop) {\n        if (prop.startsWith(aggregates_1)) {\n          delete _this.parent[bulkChanges_1][prop];\n        }\n      });\n    }\n  };\n\n  Aggregate.prototype.getFormatFromType = function (format, type) {\n    if (isNullOrUndefined(type) || typeof format !== 'string') {\n      return format;\n    }\n\n    var obj;\n\n    switch (type) {\n      case 'number':\n        obj = {\n          format: format\n        };\n        break;\n\n      case 'date':\n        obj = {\n          type: type,\n          skeleton: format\n        };\n        break;\n\n      case 'datetime':\n        obj = {\n          type: 'dateTime',\n          skeleton: format\n        };\n        break;\n    }\n\n    return obj;\n  };\n\n  Aggregate.prototype.onPropertyChanged = function (e) {\n    if (e.module !== this.getModuleName()) {\n      return;\n    }\n\n    if (isNullOrUndefined(this.footerRenderer)) {\n      this.initiateRender();\n    }\n\n    this.prepareSummaryInfo();\n    this.footerRenderer.refresh();\n    var cModel = new CaptionSummaryModelGenerator(this.parent);\n    var gModel = new GroupSummaryModelGenerator(this.parent);\n\n    if (gModel.getData().length !== 0 || !cModel.isEmpty()) {\n      this.parent.notify(modelChanged, {});\n    }\n  };\n\n  Aggregate.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(initialEnd, this.initiateRender, this);\n    this.parent.on(uiUpdate, this.onPropertyChanged, this);\n    this.parent.on(refreshAggregates, this.refresh, this);\n  };\n\n  Aggregate.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.footerRenderer.removeEventListener();\n    this.parent.off(initialEnd, this.initiateRender);\n    this.parent.off(dataReady, this.footerRenderer.refresh);\n    this.parent.off(uiUpdate, this.onPropertyChanged);\n    this.parent.off(refreshAggregates, this.refresh);\n  };\n\n  Aggregate.prototype.destroy = function () {\n    this.removeEventListener();\n    remove(this.parent.element.querySelector('.e-gridfooter'));\n  };\n\n  Aggregate.prototype.refresh = function (data) {\n    var editedData = data instanceof Array ? data : [data];\n    this.parent.notify(refreshFooterRenderer, editedData);\n\n    if (this.parent.groupSettings.columns.length > 0) {\n      this.parent.notify(groupAggregates, editedData);\n    }\n  };\n\n  return Aggregate;\n}();\n\nexport { Aggregate };\n/**\n * @private\n */\n\nexport function summaryIterator(aggregates, callback) {\n  aggregates.forEach(function (row) {\n    row.columns.forEach(function (column) {\n      callback(column, row);\n    });\n  });\n}","map":{"version":3,"sources":["C:/CN2/workspace-trunk/kain-front-end/node_modules/@syncfusion/ej2-grids/src/grid/actions/aggregate.js"],"names":["remove","isBlazor","isNullOrUndefined","CellType","uiUpdate","initialEnd","dataReady","modelChanged","refreshAggregates","refreshFooterRenderer","groupAggregates","FooterRenderer","SummaryCellRenderer","GroupSummaryModelGenerator","CaptionSummaryModelGenerator","Aggregate","parent","locator","addEventListener","prototype","getModuleName","initiateRender","_this","cellFac","getService","instance","Summary","CaptionSummary","GroupSummary","forEach","type","addCellRenderer","footerRenderer","renderPanel","renderTable","register","fn","prepareSummaryInfo","off","on","refresh","summaryIterator","aggregates","column","dataColumn","getColumnByField","field","cFormat","setPropertiesSilent","format","getFormatFromType","setFormatter","locale","columnName","isServerRendered","bulkChanges_1","aggregates_1","Object","keys","prop","startsWith","obj","skeleton","onPropertyChanged","e","module","cModel","gModel","getData","length","isEmpty","notify","isDestroyed","removeEventListener","destroy","element","querySelector","data","editedData","Array","groupSettings","columns","callback","row"],"mappings":"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","sourcesContent":["import { remove, isBlazor } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { uiUpdate, initialEnd, dataReady, modelChanged, refreshAggregates, refreshFooterRenderer, groupAggregates } from '../base/constant';\nimport { FooterRenderer } from '../renderer/footer-renderer';\nimport { SummaryCellRenderer } from '../renderer/summary-cell-renderer';\nimport { GroupSummaryModelGenerator, CaptionSummaryModelGenerator } from '../services/summary-model-generator';\n/**\n * Summary Action controller.\n */\nvar Aggregate = /** @class */ (function () {\n    function Aggregate(parent, locator) {\n        this.parent = parent;\n        this.locator = locator;\n        this.addEventListener();\n    }\n    Aggregate.prototype.getModuleName = function () {\n        return 'aggregate';\n    };\n    Aggregate.prototype.initiateRender = function () {\n        var _this = this;\n        var cellFac = this.locator.getService('cellRendererFactory');\n        var instance = new SummaryCellRenderer(this.parent, this.locator);\n        [CellType.Summary, CellType.CaptionSummary, CellType.GroupSummary].forEach(function (type) {\n            return cellFac.addCellRenderer(type, instance);\n        });\n        this.footerRenderer = new FooterRenderer(this.parent, this.locator);\n        this.footerRenderer.renderPanel();\n        this.footerRenderer.renderTable();\n        this.locator.register('footerRenderer', this.footerRenderer);\n        var fn = function () {\n            _this.prepareSummaryInfo();\n            _this.parent.off(dataReady, fn);\n        };\n        this.parent.on(dataReady, fn, this);\n        this.parent.on(dataReady, this.footerRenderer.refresh, this.footerRenderer);\n    };\n    /**\n     * @hidden\n     */\n    Aggregate.prototype.prepareSummaryInfo = function () {\n        var _this = this;\n        summaryIterator(this.parent.aggregates, function (column) {\n            var dataColumn = _this.parent.getColumnByField(column.field) || {};\n            var type = dataColumn.type;\n            var cFormat = 'customFormat';\n            if (!isNullOrUndefined(column[cFormat])) {\n                column.setPropertiesSilent({ format: column[cFormat] });\n            }\n            column.setPropertiesSilent({ format: _this.getFormatFromType(column.format, type) });\n            column.setFormatter(_this.parent.locale);\n            column.setPropertiesSilent({ columnName: column.columnName || column.field });\n        });\n        if (isBlazor() && this.parent.isServerRendered) {\n            var bulkChanges_1 = 'bulkChanges';\n            var aggregates_1 = 'aggregates';\n            Object.keys(this.parent[bulkChanges_1]).forEach(function (prop) {\n                if (prop.startsWith(aggregates_1)) {\n                    delete _this.parent[bulkChanges_1][prop];\n                }\n            });\n        }\n    };\n    Aggregate.prototype.getFormatFromType = function (format, type) {\n        if (isNullOrUndefined(type) || typeof format !== 'string') {\n            return format;\n        }\n        var obj;\n        switch (type) {\n            case 'number':\n                obj = { format: format };\n                break;\n            case 'date':\n                obj = { type: type, skeleton: format };\n                break;\n            case 'datetime':\n                obj = { type: 'dateTime', skeleton: format };\n                break;\n        }\n        return obj;\n    };\n    Aggregate.prototype.onPropertyChanged = function (e) {\n        if (e.module !== this.getModuleName()) {\n            return;\n        }\n        if (isNullOrUndefined(this.footerRenderer)) {\n            this.initiateRender();\n        }\n        this.prepareSummaryInfo();\n        this.footerRenderer.refresh();\n        var cModel = new CaptionSummaryModelGenerator(this.parent);\n        var gModel = new GroupSummaryModelGenerator(this.parent);\n        if (gModel.getData().length !== 0 || !cModel.isEmpty()) {\n            this.parent.notify(modelChanged, {});\n        }\n    };\n    Aggregate.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(initialEnd, this.initiateRender, this);\n        this.parent.on(uiUpdate, this.onPropertyChanged, this);\n        this.parent.on(refreshAggregates, this.refresh, this);\n    };\n    Aggregate.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.footerRenderer.removeEventListener();\n        this.parent.off(initialEnd, this.initiateRender);\n        this.parent.off(dataReady, this.footerRenderer.refresh);\n        this.parent.off(uiUpdate, this.onPropertyChanged);\n        this.parent.off(refreshAggregates, this.refresh);\n    };\n    Aggregate.prototype.destroy = function () {\n        this.removeEventListener();\n        remove(this.parent.element.querySelector('.e-gridfooter'));\n    };\n    Aggregate.prototype.refresh = function (data) {\n        var editedData = data instanceof Array ? data : [data];\n        this.parent.notify(refreshFooterRenderer, editedData);\n        if (this.parent.groupSettings.columns.length > 0) {\n            this.parent.notify(groupAggregates, editedData);\n        }\n    };\n    return Aggregate;\n}());\nexport { Aggregate };\n/**\n * @private\n */\nexport function summaryIterator(aggregates, callback) {\n    aggregates.forEach(function (row) {\n        row.columns.forEach(function (column) {\n            callback(column, row);\n        });\n    });\n}\n"]},"metadata":{},"sourceType":"module"}