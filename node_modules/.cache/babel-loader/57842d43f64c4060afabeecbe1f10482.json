{"ast":null,"code":"import { Draggable, Droppable, isBlazor } from '@syncfusion/ej2-base';\nimport { createElement, closest, remove, classList, addClass, removeClass } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { parentsUntil, isActionPrevent, isGroupAdaptive, updatecloneRow } from '../base/util';\nimport * as events from '../base/constant';\nimport { AriaService } from '../services/aria-service';\nimport { GroupModelGenerator } from '../services/group-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n *\n * The `Group` module is used to handle group action.\n */\n\nvar Group =\n/** @class */\nfunction () {\n  /**\n   * Constructor for Grid group module\n   * @hidden\n   */\n  function Group(parent, groupSettings, sortedColumns, serviceLocator) {\n    var _this = this;\n\n    this.isAppliedGroup = false;\n    this.isAppliedUnGroup = false;\n    this.visualElement = createElement('div', {\n      className: 'e-cloneproperties e-dragclone e-gdclone',\n      styles: 'line-height:23px',\n      attrs: {\n        action: 'grouping'\n      }\n    });\n\n    this.helper = function (e) {\n      var gObj = _this.parent;\n      var target = e.sender.target;\n      var element = target.classList.contains('e-groupheadercell') ? target : parentsUntil(target, 'e-groupheadercell');\n\n      if (!element) {\n        return false;\n      }\n\n      _this.column = gObj.getColumnByField(element.firstElementChild.getAttribute('ej-mappingname'));\n      _this.visualElement.textContent = element.textContent;\n      _this.visualElement.style.width = element.offsetWidth + 2 + 'px';\n      _this.visualElement.style.height = element.offsetHeight + 2 + 'px';\n\n      _this.visualElement.setAttribute('e-mappinguid', _this.column.uid);\n\n      gObj.element.appendChild(_this.visualElement);\n      return _this.visualElement;\n    };\n\n    this.dragStart = function (e) {\n      _this.parent.element.classList.add('e-ungroupdrag');\n\n      if (isBlazor()) {\n        e.bindEvents(e.dragElement);\n      }\n    };\n\n    this.drag = function (e) {\n      var target = e.target;\n\n      var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n\n      _this.parent.trigger(events.columnDrag, {\n        target: target,\n        draggableType: 'headercell',\n        column: _this.column\n      });\n\n      classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n\n      if (!(parentsUntil(target, 'e-gridcontent') || parentsUntil(target, 'e-headercell'))) {\n        classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n      }\n    };\n\n    this.dragStop = function (e) {\n      _this.parent.element.classList.remove('e-ungroupdrag');\n\n      if (!(parentsUntil(e.target, 'e-gridcontent') || parentsUntil(e.target, 'e-gridheader'))) {\n        remove(e.helper);\n        return;\n      }\n    };\n\n    this.drop = function (e) {\n      var gObj = _this.parent;\n      var column = gObj.getColumnByUid(e.droppedElement.getAttribute('e-mappinguid'));\n\n      _this.element.classList.remove('e-hover');\n\n      remove(e.droppedElement);\n\n      _this.aria.setDropTarget(_this.parent.element.querySelector('.e-groupdroparea'), false);\n\n      _this.aria.setGrabbed(_this.parent.getHeaderTable().querySelector('[aria-grabbed=true]'), false);\n\n      if (isNullOrUndefined(column) || column.allowGrouping === false || parentsUntil(gObj.getColumnHeaderByUid(column.uid), 'e-grid').getAttribute('id') !== gObj.element.getAttribute('id')) {\n        _this.parent.log('action_disabled_column', {\n          moduleName: _this.getModuleName(),\n          columnName: column.headerText\n        });\n\n        return;\n      }\n\n      _this.groupColumn(column.field);\n    };\n\n    this.contentRefresh = true;\n    this.aria = new AriaService();\n    this.parent = parent;\n    this.groupSettings = groupSettings;\n    this.serviceLocator = serviceLocator;\n    this.sortedColumns = sortedColumns;\n    this.focus = serviceLocator.getService('focus');\n    this.addEventListener();\n    this.groupGenerator = new GroupModelGenerator(this.parent);\n  }\n\n  Group.prototype.columnDrag = function (e) {\n    var gObj = this.parent;\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n\n    if (!parentsUntil(e.target, 'e-groupdroparea') && !(this.parent.allowReordering && parentsUntil(e.target, 'e-headercell'))) {\n      classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n    }\n\n    e.target.classList.contains('e-groupdroparea') ? this.element.classList.add('e-hover') : this.element.classList.remove('e-hover');\n  };\n\n  Group.prototype.columnDragStart = function (e) {\n    if (e.target.classList.contains('e-stackedheadercell')) {\n      return;\n    }\n\n    var gObj = this.parent;\n    var dropArea = this.parent.element.querySelector('.e-groupdroparea');\n    this.aria.setDropTarget(dropArea, e.column.allowGrouping);\n    var element = e.target.classList.contains('e-headercell') ? e.target : parentsUntil(e.target, 'e-headercell');\n    this.aria.setGrabbed(element, true, !e.column.allowGrouping);\n  };\n\n  Group.prototype.columnDrop = function (e) {\n    var gObj = this.parent;\n\n    if (e.droppedElement.getAttribute('action') === 'grouping') {\n      var column = gObj.getColumnByUid(e.droppedElement.getAttribute('e-mappinguid'));\n\n      if (isNullOrUndefined(column) || column.allowGrouping === false || parentsUntil(gObj.getColumnHeaderByUid(column.uid), 'e-grid').getAttribute('id') !== gObj.element.getAttribute('id')) {\n        return;\n      }\n\n      this.ungroupColumn(column.field);\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  Group.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n    this.parent.on(events.groupComplete, this.onActionComplete, this);\n    this.parent.on(events.ungroupComplete, this.onActionComplete, this);\n    this.parent.on(events.inBoundModelChanged, this.onPropertyChanged, this);\n    this.parent.on(events.click, this.clickHandler, this);\n    this.parent.on(events.columnDrag, this.columnDrag, this);\n    this.parent.on(events.columnDragStart, this.columnDragStart, this);\n    this.parent.on(events.columnDrop, this.columnDrop, this);\n    this.parent.on(events.headerRefreshed, this.refreshSortIcons, this);\n    this.parent.on(events.sortComplete, this.refreshSortIcons, this);\n    this.parent.on(events.keyPressed, this.keyPressHandler, this);\n    this.parent.on(events.contentReady, this.initialEnd, this);\n    this.parent.on(events.onEmpty, this.initialEnd, this);\n    this.parent.on(events.initialEnd, this.render, this);\n    this.parent.on(events.groupAggregates, this.onGroupAggregates, this);\n    this.parent.on('blazor-action-begin', this.blazorActionBegin, this);\n  };\n  /**\n   * @hidden\n   */\n\n\n  Group.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.initialEnd, this.render);\n    this.parent.off(events.uiUpdate, this.enableAfterRender);\n    this.parent.off(events.groupComplete, this.onActionComplete);\n    this.parent.off(events.ungroupComplete, this.onActionComplete);\n    this.parent.off(events.inBoundModelChanged, this.onPropertyChanged);\n    this.parent.off(events.click, this.clickHandler);\n    this.parent.off(events.columnDrag, this.columnDrag);\n    this.parent.off(events.columnDragStart, this.columnDragStart);\n    this.parent.off(events.columnDrop, this.columnDrop);\n    this.parent.off(events.headerRefreshed, this.refreshSortIcons);\n    this.parent.off(events.sortComplete, this.refreshSortIcons);\n    this.parent.off(events.keyPressed, this.keyPressHandler);\n    this.parent.off(events.groupAggregates, this.onGroupAggregates);\n    this.parent.off('blazor-action-begin', this.blazorActionBegin);\n  };\n\n  Group.prototype.blazorActionBegin = function () {\n    if (this.parent.allowGrouping) {\n      this.expandAll();\n    }\n  };\n\n  Group.prototype.initialEnd = function () {\n    var gObj = this.parent;\n    this.parent.off(events.contentReady, this.initialEnd);\n    this.parent.off(events.onEmpty, this.initialEnd);\n\n    if (this.parent.getColumns().length && this.groupSettings.columns.length) {\n      this.contentRefresh = false;\n\n      for (var _i = 0, _a = gObj.groupSettings.columns; _i < _a.length; _i++) {\n        var col = _a[_i];\n        this.groupColumn(col);\n      }\n\n      this.contentRefresh = true;\n    }\n  };\n\n  Group.prototype.keyPressHandler = function (e) {\n    var gObj = this.parent;\n\n    if (e.action !== 'ctrlSpace' && (!this.groupSettings.columns.length || ['altDownArrow', 'altUpArrow', 'ctrlDownArrow', 'ctrlUpArrow', 'enter'].indexOf(e.action) === -1)) {\n      return;\n    }\n\n    e.preventDefault();\n\n    switch (e.action) {\n      case 'altDownArrow':\n      case 'altUpArrow':\n        var selected = gObj.allowSelection ? gObj.getSelectedRowIndexes() : [];\n\n        if (selected.length) {\n          var rows = gObj.getContentTable().querySelector('tbody').children;\n          var dataRow = gObj.getDataRows()[selected[selected.length - 1]];\n          var grpRow = void 0;\n\n          for (var i = dataRow.rowIndex; i >= 0; i--) {\n            if (!rows[i].classList.contains('e-row') && !rows[i].classList.contains('e-detailrow')) {\n              grpRow = rows[i];\n              break;\n            }\n          }\n\n          this.expandCollapseRows(grpRow.querySelector(e.action === 'altUpArrow' ? '.e-recordplusexpand' : '.e-recordpluscollapse'));\n        }\n\n        break;\n\n      case 'ctrlDownArrow':\n        this.expandAll();\n        break;\n\n      case 'ctrlUpArrow':\n        this.collapseAll();\n        break;\n\n      case 'enter':\n        if (this.parent.isEdit || closest(e.target, '#' + this.parent.element.id + '_searchbar') !== null) {\n          return;\n        }\n\n        var element = this.focus.getFocusedElement();\n        var row = element ? element.parentElement.querySelector('[class^=\"e-record\"]') : null;\n\n        if (!row) {\n          break;\n        }\n\n        this.expandCollapseRows(row);\n        break;\n\n      case 'ctrlSpace':\n        var elem = gObj.focusModule.currentInfo.element;\n\n        if (elem && elem.classList.contains('e-headercell')) {\n          var column = gObj.getColumnByUid(elem.firstElementChild.getAttribute('e-mappinguid'));\n          column.field && gObj.groupSettings.columns.indexOf(column.field) < 0 ? this.groupColumn(column.field) : this.ungroupColumn(column.field);\n        }\n\n        break;\n    }\n  };\n\n  Group.prototype.clickHandler = function (e) {\n    this.expandCollapseRows(e.target);\n    this.applySortFromTarget(e.target);\n    this.unGroupFromTarget(e.target);\n    this.toogleGroupFromHeader(e.target);\n  };\n\n  Group.prototype.unGroupFromTarget = function (target) {\n    if (target.classList.contains('e-ungroupbutton')) {\n      this.ungroupColumn(target.parentElement.getAttribute('ej-mappingname'));\n    }\n  };\n\n  Group.prototype.toogleGroupFromHeader = function (target) {\n    if (this.groupSettings.showToggleButton) {\n      if (target.classList.contains('e-grptogglebtn')) {\n        if (target.classList.contains('e-toggleungroup')) {\n          this.ungroupColumn(this.parent.getColumnByUid(target.parentElement.getAttribute('e-mappinguid')).field);\n        } else {\n          this.groupColumn(this.parent.getColumnByUid(target.parentElement.getAttribute('e-mappinguid')).field);\n        }\n      } else {\n        if (target.classList.contains('e-toggleungroup')) {\n          this.ungroupColumn(target.parentElement.getAttribute('ej-mappingname'));\n        }\n      }\n    }\n  };\n\n  Group.prototype.applySortFromTarget = function (target) {\n    var gObj = this.parent;\n    var gHeader = closest(target, '.e-groupheadercell');\n\n    if (gObj.allowSorting && gHeader && !target.classList.contains('e-ungroupbutton') && !target.classList.contains('e-toggleungroup')) {\n      var field = gHeader.firstElementChild.getAttribute('ej-mappingname');\n\n      if (gObj.getColumnHeaderByField(field).querySelectorAll('.e-ascending').length) {\n        gObj.sortColumn(field, 'Descending', true);\n      } else {\n        gObj.sortColumn(field, 'Ascending', true);\n      }\n    }\n  };\n  /**\n   * Expands or collapses grouped rows by target element.\n   * @param  {Element} target - Defines the target element of the grouped row.\n   * @return {void}\n   */\n\n\n  Group.prototype.expandCollapseRows = function (target) {\n    var trgt = parentsUntil(target, 'e-recordplusexpand') || parentsUntil(target, 'e-recordpluscollapse');\n\n    if (trgt) {\n      var cellIdx = trgt.cellIndex;\n      var rowIdx = trgt.parentElement.rowIndex;\n      var rowNodes = this.parent.getContentTable().querySelector('tbody').children;\n      var rows = [].slice.call(rowNodes).slice(rowIdx + 1, rowNodes.length);\n      var isHide = void 0;\n      var expandElem = void 0;\n      var dataManager = void 0;\n      var query = void 0;\n      var toExpand = [];\n      var gObj = this.parent;\n      var indent = trgt.parentElement.querySelectorAll('.e-indentcell').length;\n      var expand = false;\n\n      if (trgt.classList.contains('e-recordpluscollapse')) {\n        addClass([trgt], 'e-recordplusexpand');\n        removeClass([trgt], 'e-recordpluscollapse');\n        trgt.firstElementChild.className = 'e-icons e-gdiagonaldown e-icon-gdownarrow';\n        expand = true;\n\n        if (isGroupAdaptive(gObj)) {\n          this.updateVirtualRows(gObj, target, expand, query, dataManager);\n        }\n      } else {\n        isHide = true;\n        removeClass([trgt], 'e-recordplusexpand');\n        addClass([trgt], 'e-recordpluscollapse');\n        trgt.firstElementChild.className = 'e-icons e-gnextforward e-icon-grightarrow';\n\n        if (isGroupAdaptive(gObj)) {\n          this.updateVirtualRows(gObj, target, !isHide, query, dataManager);\n        }\n      }\n\n      this.aria.setExpand(trgt, expand);\n\n      if (!isGroupAdaptive(gObj)) {\n        for (var i = 0, len = rows.length; i < len; i++) {\n          if (rows[i].querySelectorAll('td')[cellIdx] && rows[i].querySelectorAll('td')[cellIdx].classList.contains('e-indentcell') && rows) {\n            if (isHide) {\n              rows[i].style.display = 'none';\n            } else {\n              if (rows[i].querySelectorAll('.e-indentcell').length === indent + 1) {\n                rows[i].style.display = '';\n                expandElem = rows[i].querySelector('.e-recordplusexpand');\n\n                if (expandElem) {\n                  toExpand.push(expandElem);\n                }\n\n                if (rows[i].classList.contains('e-detailrow')) {\n                  if (rows[i - 1].querySelectorAll('.e-detailrowcollapse').length) {\n                    rows[i].style.display = 'none';\n                  }\n                }\n              }\n            }\n          } else {\n            break;\n          }\n        }\n      }\n\n      for (var i = 0, len = toExpand.length; i < len; i++) {\n        removeClass([toExpand[i]], 'e-recordplusexpand');\n        addClass([toExpand[i]], 'e-recordpluscollapse');\n        toExpand[i].firstElementChild.className = 'e-icons e-gnextforward e-icon-grightarrow';\n        this.expandCollapseRows(toExpand[i]);\n      }\n    }\n  };\n\n  Group.prototype.updateVirtualRows = function (gObj, target, isExpand, query, dataManager) {\n    var rObj = gObj.getRowObjectFromUID(target.closest('tr').getAttribute('data-uid'));\n    rObj.isExpand = isExpand;\n    updatecloneRow(gObj);\n    query = gObj.getDataModule().generateQuery(false);\n    query.queries = [];\n    var args = {\n      requestType: 'virtualscroll',\n      rowObject: rObj\n    };\n    dataManager = gObj.getDataModule().getData(args, query.requiresCount());\n    dataManager.then(function (e) {\n      return gObj.renderModule.dataManagerSuccess(e, args);\n    });\n  };\n\n  Group.prototype.expandCollapse = function (isExpand) {\n    var rowNodes = this.parent.getContentTable().querySelector('tbody').children;\n    var row;\n\n    for (var i = 0, len = rowNodes.length; i < len; i++) {\n      if (rowNodes[i].querySelectorAll('.e-recordplusexpand, .e-recordpluscollapse').length) {\n        row = rowNodes[i].querySelector(isExpand ? '.e-recordpluscollapse' : '.e-recordplusexpand');\n\n        if (row) {\n          row.className = isExpand ? 'e-recordplusexpand' : 'e-recordpluscollapse';\n          row.firstElementChild.className = isExpand ? 'e-icons e-gdiagonaldown e-icon-gdownarrow' : 'e-icons e-gnextforward e-icon-grightarrow';\n        }\n\n        if (!(rowNodes[i].firstElementChild.classList.contains('e-recordplusexpand') || rowNodes[i].firstElementChild.classList.contains('e-recordpluscollapse'))) {\n          rowNodes[i].style.display = isExpand ? '' : 'none';\n        }\n      } else {\n        rowNodes[i].style.display = isExpand ? '' : 'none';\n      }\n    }\n  };\n  /**\n   * Expands all the grouped rows of the Grid.\n   * @return {void}\n   */\n\n\n  Group.prototype.expandAll = function () {\n    this.expandCollapse(true);\n  };\n  /**\n   * Collapses all the grouped rows of the Grid.\n   * @return {void}\n   */\n\n\n  Group.prototype.collapseAll = function () {\n    this.expandCollapse(false);\n  };\n  /**\n   * The function is used to render grouping\n   * @return {Element}\n   * @hidden\n   */\n\n\n  Group.prototype.render = function () {\n    this.l10n = this.serviceLocator.getService('localization');\n    this.renderGroupDropArea();\n    this.initDragAndDrop();\n    this.refreshToggleBtn();\n  };\n\n  Group.prototype.renderGroupDropArea = function () {\n    var groupElem = this.parent.element.querySelector('.e-groupdroparea');\n\n    if (groupElem) {\n      remove(groupElem);\n    }\n\n    this.element = this.parent.createElement('div', {\n      className: 'e-groupdroparea',\n      attrs: {\n        'tabindex': '-1'\n      }\n    });\n    this.updateGroupDropArea();\n    this.parent.element.insertBefore(this.element, this.parent.element.firstChild);\n\n    if (!this.groupSettings.showDropArea) {\n      this.element.style.display = 'none';\n    }\n  };\n\n  Group.prototype.updateGroupDropArea = function (clear) {\n    if (this.groupSettings.showDropArea && !this.groupSettings.columns.length) {\n      var dragLabel = this.l10n.getConstant('GroupDropArea');\n      this.element.innerHTML = dragLabel;\n      this.element.classList.remove('e-grouped');\n    } else {\n      if (this.element.innerHTML === this.l10n.getConstant('GroupDropArea') && (this.groupSettings.columns.length === 1 || !this.isAppliedGroup && !this.isAppliedUnGroup) || clear) {\n        this.element.innerHTML = '';\n      }\n\n      this.element.classList.add('e-grouped');\n    }\n  };\n\n  Group.prototype.initDragAndDrop = function () {\n    this.initializeGHeaderDrop();\n    this.initializeGHeaderDrag();\n  };\n\n  Group.prototype.initializeGHeaderDrag = function () {\n    var drag = new Draggable(this.element, {\n      dragTarget: '.e-groupheadercell',\n      distance: 5,\n      helper: this.helper,\n      dragStart: this.dragStart,\n      drag: this.drag,\n      dragStop: this.dragStop\n    });\n  };\n\n  Group.prototype.initializeGHeaderDrop = function () {\n    var gObj = this.parent;\n    var drop = new Droppable(this.element, {\n      accept: '.e-dragclone',\n      drop: this.drop\n    });\n  };\n  /**\n   * Groups a column by column name.\n   * @param  {string} columnName - Defines the column name to group.\n   * @return {void}\n   */\n\n\n  Group.prototype.groupColumn = function (columnName) {\n    var gObj = this.parent;\n    var column = gObj.getColumnByField(columnName);\n\n    if (isNullOrUndefined(column) || column.allowGrouping === false || this.contentRefresh && this.groupSettings.columns.indexOf(columnName) > -1) {\n      this.parent.log('action_disabled_column', {\n        moduleName: this.getModuleName(),\n        columnName: column.headerText\n      });\n      return;\n    }\n\n    if (isActionPrevent(gObj)) {\n      gObj.notify(events.preventBatch, {\n        instance: this,\n        handler: this.groupColumn,\n        arg1: columnName\n      });\n      return;\n    }\n\n    column.visible = gObj.groupSettings.showGroupedColumn;\n    this.colName = columnName;\n    this.isAppliedGroup = true;\n\n    if (this.contentRefresh) {\n      this.updateModel();\n    } else {\n      this.addColToGroupDrop(columnName);\n    }\n\n    this.updateGroupDropArea();\n    this.isAppliedGroup = false;\n  };\n  /**\n   * Ungroups a column by column name.\n   * @param  {string} columnName - Defines the column name to ungroup.\n   * @return {void}\n   */\n\n\n  Group.prototype.ungroupColumn = function (columnName) {\n    var gObj = this.parent;\n    var column = this.parent.enableColumnVirtualization ? this.parent.columns.filter(function (c) {\n      return c.field === columnName;\n    })[0] : gObj.getColumnByField(columnName);\n\n    if (isNullOrUndefined(column) || column.allowGrouping === false || this.groupSettings.columns.indexOf(columnName) < 0) {\n      return;\n    }\n\n    if (isActionPrevent(gObj)) {\n      gObj.notify(events.preventBatch, {\n        instance: this,\n        handler: this.ungroupColumn,\n        arg1: columnName\n      });\n      return;\n    }\n\n    column.visible = true;\n    this.colName = column.field;\n    var columns = JSON.parse(JSON.stringify(this.groupSettings.columns));\n    columns.splice(columns.indexOf(this.colName), 1);\n\n    if (this.sortedColumns.indexOf(columnName) < 0) {\n      for (var i = 0, len = gObj.sortSettings.columns.length; i < len; i++) {\n        if (columnName === gObj.sortSettings.columns[i].field) {\n          gObj.sortSettings.columns.splice(i, 1);\n          break;\n        }\n      }\n    }\n\n    var isServerRendered = 'isServerRendered';\n\n    if (isBlazor() && this.parent[isServerRendered]) {\n      gObj.sortSettings.columns = gObj.sortSettings.columns;\n    }\n\n    this.groupSettings.columns = columns;\n\n    if (gObj.allowGrouping) {\n      this.isAppliedUnGroup = true;\n      this.parent.dataBind();\n    }\n  };\n  /**\n   * The function used to update groupSettings\n   * @return {void}\n   * @hidden\n   */\n\n\n  Group.prototype.updateModel = function () {\n    var gObj = this.parent;\n    var i = 0;\n    var columns = JSON.parse(JSON.stringify(this.groupSettings.columns));\n    columns.push(this.colName);\n    this.groupAddSortingQuery(this.colName);\n    this.groupSettings.columns = columns;\n    this.parent.dataBind();\n  };\n  /**\n   * The function used to trigger onActionComplete\n   * @return {void}\n   * @hidden\n   */\n\n\n  Group.prototype.onActionComplete = function (e) {\n    if (isBlazor() && !this.parent.isJsComponent) {\n      e.rows = null;\n    }\n\n    var gObj = this.parent;\n\n    if (e.requestType === 'grouping') {\n      this.addColToGroupDrop(this.colName);\n    } else {\n      this.removeColFromGroupDrop(this.colName);\n    }\n\n    var args = this.groupSettings.columns.indexOf(this.colName) > -1 ? {\n      columnName: this.colName,\n      requestType: 'grouping',\n      type: events.actionComplete\n    } : {\n      requestType: 'ungrouping',\n      type: events.actionComplete\n    };\n    this.parent.trigger(events.actionComplete, extend(e, args));\n    this.colName = null;\n  };\n\n  Group.prototype.groupAddSortingQuery = function (colName) {\n    var i = 0;\n\n    while (i < this.parent.sortSettings.columns.length) {\n      if (this.parent.sortSettings.columns[i].field === colName) {\n        break;\n      }\n\n      i++;\n    }\n\n    if (this.parent.sortSettings.columns.length === i) {\n      this.parent.sortSettings.columns.push({\n        field: colName,\n        direction: 'Ascending',\n        isFromGroup: true\n      });\n      var isServerRendered = 'isServerRendered';\n\n      if (isBlazor() && this.parent[isServerRendered]) {\n        this.parent.sortSettings.columns = this.parent.sortSettings.columns;\n      }\n    } else if (!this.parent.allowSorting) {\n      this.parent.sortSettings.columns[i].direction = 'Ascending';\n    }\n  };\n\n  Group.prototype.addColToGroupDrop = function (field) {\n    var gObj = this.parent;\n    var direction = 'Ascending';\n    var groupedColumn = this.parent.createElement('div', {\n      className: 'e-grid-icon e-groupheadercell'\n    });\n    var childDiv = this.parent.createElement('div', {\n      attrs: {\n        'ej-mappingname': field\n      }\n    });\n    var column = this.parent.getColumnByField(field);\n\n    if (isNullOrUndefined(column)) {\n      return;\n    } //Todo headerTemplateID for grouped column, disableHtmlEncode                          \n\n\n    var headerCell = gObj.getColumnHeaderByUid(column.uid); // if (!isNullOrUndefined(column.headerTemplate)) {\n    //     if (column.headerTemplate.indexOf('#') !== -1) {\n    //         childDiv.innerHTML = document.querySelector(column.headerTemplate).innerHTML.trim();\n    //     } else {\n    //         childDiv.innerHTML = column.headerTemplate;\n    //     }\n    //     childDiv.firstElementChild.classList.add('e-grouptext');\n    // } else {\n\n    childDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-grouptext',\n      innerHTML: column.headerText,\n      attrs: {\n        tabindex: '-1',\n        'aria-label': 'sort the grouped column'\n      }\n    })); // }\n\n    if (this.groupSettings.showToggleButton) {\n      childDiv.appendChild(this.parent.createElement('span', {\n        className: 'e-togglegroupbutton e-icons e-icon-ungroup e-toggleungroup',\n        innerHTML: '&nbsp;',\n        attrs: {\n          tabindex: '-1',\n          'aria-label': 'ungroup button'\n        }\n      }));\n    }\n\n    if (headerCell.querySelectorAll('.e-ascending,.e-descending').length) {\n      direction = headerCell.querySelector('.e-ascending') ? 'Ascending' : 'Descending';\n    }\n\n    childDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-groupsort e-icons ' + ('e-' + direction.toLowerCase() + ' e-icon-' + direction.toLowerCase()),\n      innerHTML: '&nbsp;',\n      attrs: {\n        tabindex: '-1',\n        'aria-label': 'sort the grouped column'\n      }\n    }));\n    childDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-ungroupbutton e-icons e-icon-hide',\n      innerHTML: '&nbsp;',\n      attrs: {\n        title: this.l10n.getConstant('UnGroup'),\n        tabindex: '-1',\n        'aria-label': 'ungroup the grouped column'\n      },\n      styles: this.groupSettings.showUngroupButton ? '' : 'display:none'\n    }));\n    groupedColumn.appendChild(childDiv);\n    this.element.appendChild(groupedColumn); //Todo:  rtl \n  };\n\n  Group.prototype.refreshToggleBtn = function (isRemove) {\n    if (this.groupSettings.showToggleButton) {\n      var headers = [].slice.call(this.parent.element.getElementsByClassName('e-headercelldiv'));\n\n      for (var i = 0, len = headers.length; i < len; i++) {\n        if (!(headers[i].classList.contains('e-emptycell') || headers[i].classList.contains('e-headerchkcelldiv'))) {\n          var column = this.parent.getColumnByUid(headers[i].getAttribute('e-mappinguid'));\n\n          if (!this.parent.showColumnMenu || this.parent.showColumnMenu && !column.showColumnMenu) {\n            if (headers[i].querySelectorAll('.e-grptogglebtn').length) {\n              remove(headers[i].querySelectorAll('.e-grptogglebtn')[0]);\n            }\n\n            if (!isRemove) {\n              headers[i].appendChild(this.parent.createElement('span', {\n                className: 'e-grptogglebtn e-icons ' + (this.groupSettings.columns.indexOf(column.field) > -1 ? 'e-toggleungroup e-icon-ungroup' : 'e-togglegroup e-icon-group'),\n                attrs: {\n                  tabindex: '-1',\n                  'aria-label': 'Group button'\n                }\n              }));\n            }\n          }\n        }\n      }\n    }\n  };\n\n  Group.prototype.removeColFromGroupDrop = function (field) {\n    if (!isNullOrUndefined(this.getGHeaderCell(field))) {\n      remove(this.getGHeaderCell(field));\n      this.updateGroupDropArea();\n    }\n\n    this.isAppliedUnGroup = false;\n  };\n\n  Group.prototype.onPropertyChanged = function (e) {\n    var _this = this;\n\n    if (e.module !== this.getModuleName()) {\n      return;\n    }\n\n    var _loop_1 = function (prop) {\n      switch (prop) {\n        case 'columns':\n          var args = void 0;\n\n          if (this_1.contentRefresh) {\n            if (!this_1.isAppliedUnGroup) {\n              if (!this_1.isAppliedGroup) {\n                this_1.updateGroupDropArea(true);\n\n                for (var i = 0; i < this_1.groupSettings.columns.length; i++) {\n                  this_1.colName = this_1.groupSettings.columns[i];\n                  var col = this_1.parent.getColumnByField(this_1.colName);\n                  col.visible = this_1.parent.groupSettings.showGroupedColumn;\n                  this_1.groupAddSortingQuery(this_1.colName);\n\n                  if (i < this_1.groupSettings.columns.length - 1) {\n                    this_1.addColToGroupDrop(this_1.groupSettings.columns[i]);\n                  }\n                }\n              }\n\n              args = {\n                columnName: this_1.colName,\n                requestType: e.properties[prop].length ? 'grouping' : 'ungrouping',\n                type: events.actionBegin\n              };\n            } else {\n              args = {\n                requestType: 'ungrouping',\n                type: events.actionBegin\n              };\n            }\n\n            if (!this_1.groupSettings.showGroupedColumn) {\n              e.oldProperties[prop].forEach(function (column) {\n                if (e.properties[prop].indexOf(column) === -1) {\n                  _this.parent.getColumnByField(column).visible = true;\n                }\n              });\n            }\n\n            this_1.parent.notify(events.modelChanged, args);\n          }\n\n          break;\n\n        case 'showDropArea':\n          this_1.updateGroupDropArea();\n          this_1.groupSettings.showDropArea ? this_1.element.style.display = '' : this_1.element.style.display = 'none';\n          break;\n\n        case 'showGroupedColumn':\n          this_1.updateGroupedColumn(this_1.groupSettings.showGroupedColumn);\n          this_1.parent.notify(events.modelChanged, {\n            requestType: 'refresh'\n          });\n          break;\n\n        case 'showUngroupButton':\n          this_1.updateButtonVisibility(this_1.groupSettings.showUngroupButton, 'e-ungroupbutton');\n          break;\n\n        case 'showToggleButton':\n          this_1.updateButtonVisibility(this_1.groupSettings.showToggleButton, 'e-togglegroupbutton ');\n          this_1.parent.refreshHeader();\n          break;\n      }\n    };\n\n    var this_1 = this;\n\n    for (var _i = 0, _a = Object.keys(e.properties); _i < _a.length; _i++) {\n      var prop = _a[_i];\n\n      _loop_1(prop);\n    }\n  };\n\n  Group.prototype.updateGroupedColumn = function (isVisible) {\n    for (var i = 0; i < this.groupSettings.columns.length; i++) {\n      this.parent.getColumnByField(this.groupSettings.columns[i]).visible = isVisible;\n    }\n  };\n\n  Group.prototype.updateButtonVisibility = function (isVisible, className) {\n    var gHeader = [].slice.call(this.element.querySelectorAll('.' + className));\n\n    for (var i = 0; i < gHeader.length; i++) {\n      gHeader[i].style.display = isVisible ? '' : 'none';\n    }\n  };\n\n  Group.prototype.enableAfterRender = function (e) {\n    if (e.module === this.getModuleName() && e.enable) {\n      this.render();\n    }\n  };\n  /**\n   * To destroy the reorder\n   * @return {void}\n   * @hidden\n   */\n\n\n  Group.prototype.destroy = function () {\n    var gridElement = this.parent.element;\n\n    if (!gridElement || !gridElement.querySelector('.e-gridheader') && !gridElement.querySelector('.e-gridcontent')) {\n      return;\n    } // tslint:disable-next-line:no-any\n\n\n    if (!this.parent.isDestroyed && !this.parent.refreshing) {\n      this.clearGrouping();\n    }\n\n    this.removeEventListener();\n    this.refreshToggleBtn(true);\n    remove(this.element); //call ejdrag and drop destroy\n  };\n  /**\n   * Clears all the grouped columns of the Grid.\n   * @return {void}\n   */\n\n\n  Group.prototype.clearGrouping = function () {\n    var cols = JSON.parse(JSON.stringify(this.groupSettings.columns));\n    this.contentRefresh = false;\n\n    for (var i = 0, len = cols.length; i < len; i++) {\n      if (i === len - 1) {\n        this.contentRefresh = true;\n      }\n\n      this.ungroupColumn(cols[i]);\n    }\n\n    this.contentRefresh = true;\n  };\n  /**\n   * For internal use only - Get the module name.\n   * @private\n   */\n\n\n  Group.prototype.getModuleName = function () {\n    return 'group';\n  };\n\n  Group.prototype.refreshSortIcons = function (e) {\n    var gObj = this.parent;\n    var header;\n    var cols = gObj.sortSettings.columns;\n    var gCols = gObj.groupSettings.columns;\n    var fieldNames = this.parent.getColumns().map(function (c) {\n      return c.field;\n    });\n    this.refreshToggleBtn();\n\n    for (var i = 0, len = cols.length; i < len; i++) {\n      if (fieldNames.indexOf(cols[i].field) === -1) {\n        continue;\n      }\n\n      header = gObj.getColumnHeaderByField(cols[i].field);\n\n      if (!gObj.allowSorting && (this.sortedColumns.indexOf(cols[i].field) > -1 || this.groupSettings.columns.indexOf(cols[i].field) > -1)) {\n        classList(header.querySelector('.e-sortfilterdiv'), ['e-ascending', 'e-icon-ascending'], []);\n\n        if (cols.length > 1) {\n          header.querySelector('.e-headercelldiv').appendChild(this.parent.createElement('span', {\n            className: 'e-sortnumber',\n            innerHTML: (i + 1).toString()\n          }));\n        }\n      } else if (this.getGHeaderCell(cols[i].field) && this.getGHeaderCell(cols[i].field).querySelectorAll('.e-groupsort').length) {\n        if (cols[i].direction === 'Ascending') {\n          classList(this.getGHeaderCell(cols[i].field).querySelector('.e-groupsort'), ['e-ascending', 'e-icon-ascending'], ['e-descending', 'e-icon-descending']);\n        } else {\n          classList(this.getGHeaderCell(cols[i].field).querySelector('.e-groupsort'), ['e-descending', 'e-icon-descending'], ['e-ascending', 'e-icon-ascending']);\n        }\n      }\n    }\n\n    for (var i = 0, len = gCols.length; i < len; i++) {\n      if (fieldNames.indexOf(gCols[i]) === -1) {\n        continue;\n      }\n\n      gObj.getColumnHeaderByField(gCols[i]).setAttribute('aria-grouped', 'true');\n    }\n  };\n\n  Group.prototype.getGHeaderCell = function (field) {\n    if (this.element && this.element.querySelector('[ej-mappingname=\"' + field + '\"]')) {\n      return this.element.querySelector('[ej-mappingname=\"' + field + '\"]').parentElement;\n    }\n\n    return null;\n  };\n\n  Group.prototype.onGroupAggregates = function (editedData) {\n    var _this = this;\n\n    var aggregates = this.iterateGroupAggregates(editedData);\n    var rowData = this.groupGenerator.generateRows(aggregates, {});\n    var summaryRows = this.parent.getRowsObject().filter(function (row) {\n      return !row.isDataRow;\n    });\n    var updateSummaryRows = rowData.filter(function (data) {\n      return !data.isDataRow;\n    });\n    updateSummaryRows.forEach(function (row, indx) {\n      var cells = row.cells.filter(function (cell) {\n        return cell.isDataCell;\n      });\n      var args = {\n        cells: cells,\n        data: row.data,\n        dataUid: summaryRows[indx] ? summaryRows[indx].uid : ''\n      };\n\n      _this.parent.notify(events.refreshAggregateCell, args);\n    });\n  };\n\n  Group.prototype.iterateGroupAggregates = function (editedData) {\n    var updatedData = editedData instanceof Array ? editedData : [];\n    var rows = this.parent.getRowsObject();\n    var initData = this.parent.getCurrentViewRecords();\n    var deletedCols = [];\n    var changeds = rows.map(function (row) {\n      if (row.edit === 'delete') {\n        deletedCols.push(row.data);\n      }\n\n      return row.changes instanceof Object ? row.changes : row.data;\n    });\n    var field = this.parent.getPrimaryKeyFieldNames()[0];\n    changeds = updatedData.length === 0 ? changeds : updatedData;\n    var mergeData = initData.map(function (item) {\n      var pKeyVal = DataUtil.getObject(field, item);\n      var value;\n      var hasVal = changeds.some(function (cItem) {\n        value = cItem;\n        return pKeyVal === DataUtil.getObject(field, cItem);\n      });\n      return hasVal ? value : item;\n    });\n    var eData = editedData;\n\n    if (!(eData.type && eData.type === 'cancel') && deletedCols.length > 0) {\n      deletedCols.forEach(function (row) {\n        var index = mergeData.indexOf(row);\n        mergeData.splice(index, 1);\n      });\n    }\n\n    var aggregates = [];\n    var aggregateRows = this.parent.aggregates;\n    aggregateRows.forEach(function (row) {\n      row.columns.forEach(function (col) {\n        var aggr = {};\n        var type = col.type.toString();\n        aggr = {\n          type: type.toLowerCase(),\n          field: col.field\n        };\n        aggregates.push(aggr);\n      });\n    });\n    var result;\n    var aggrds;\n    var groupedCols = this.parent.groupSettings.columns;\n    groupedCols.forEach(function (field) {\n      aggrds = result ? result : mergeData;\n      result = DataUtil.group(aggrds, field, aggregates, null, null);\n    });\n    return result;\n  };\n\n  return Group;\n}();\n\nexport { Group };","map":{"version":3,"sources":["C:/CN2/workspace-trunk/kain-front-end/node_modules/@syncfusion/ej2-grids/src/grid/actions/group.js"],"names":["Draggable","Droppable","isBlazor","createElement","closest","remove","classList","addClass","removeClass","isNullOrUndefined","extend","parentsUntil","isActionPrevent","isGroupAdaptive","updatecloneRow","events","AriaService","GroupModelGenerator","DataUtil","Group","parent","groupSettings","sortedColumns","serviceLocator","_this","isAppliedGroup","isAppliedUnGroup","visualElement","className","styles","attrs","action","helper","e","gObj","target","sender","element","contains","column","getColumnByField","firstElementChild","getAttribute","textContent","style","width","offsetWidth","height","offsetHeight","setAttribute","uid","appendChild","dragStart","add","bindEvents","dragElement","drag","cloneElement","querySelector","trigger","columnDrag","draggableType","dragStop","drop","getColumnByUid","droppedElement","aria","setDropTarget","setGrabbed","getHeaderTable","allowGrouping","getColumnHeaderByUid","log","moduleName","getModuleName","columnName","headerText","groupColumn","field","contentRefresh","focus","getService","addEventListener","groupGenerator","prototype","allowReordering","columnDragStart","dropArea","columnDrop","ungroupColumn","isDestroyed","on","uiUpdate","enableAfterRender","groupComplete","onActionComplete","ungroupComplete","inBoundModelChanged","onPropertyChanged","click","clickHandler","headerRefreshed","refreshSortIcons","sortComplete","keyPressed","keyPressHandler","contentReady","initialEnd","onEmpty","render","groupAggregates","onGroupAggregates","blazorActionBegin","removeEventListener","off","expandAll","getColumns","length","columns","_i","_a","col","indexOf","preventDefault","selected","allowSelection","getSelectedRowIndexes","rows","getContentTable","children","dataRow","getDataRows","grpRow","i","rowIndex","expandCollapseRows","collapseAll","isEdit","id","getFocusedElement","row","parentElement","elem","focusModule","currentInfo","applySortFromTarget","unGroupFromTarget","toogleGroupFromHeader","showToggleButton","gHeader","allowSorting","getColumnHeaderByField","querySelectorAll","sortColumn","trgt","cellIdx","cellIndex","rowIdx","rowNodes","slice","call","isHide","expandElem","dataManager","query","toExpand","indent","expand","updateVirtualRows","setExpand","len","display","push","isExpand","rObj","getRowObjectFromUID","getDataModule","generateQuery","queries","args","requestType","rowObject","getData","requiresCount","then","renderModule","dataManagerSuccess","expandCollapse","l10n","renderGroupDropArea","initDragAndDrop","refreshToggleBtn","groupElem","updateGroupDropArea","insertBefore","firstChild","showDropArea","clear","dragLabel","getConstant","innerHTML","initializeGHeaderDrop","initializeGHeaderDrag","dragTarget","distance","accept","notify","preventBatch","instance","handler","arg1","visible","showGroupedColumn","colName","updateModel","addColToGroupDrop","enableColumnVirtualization","filter","c","JSON","parse","stringify","splice","sortSettings","isServerRendered","dataBind","groupAddSortingQuery","isJsComponent","removeColFromGroupDrop","type","actionComplete","direction","isFromGroup","groupedColumn","childDiv","headerCell","tabindex","toLowerCase","title","showUngroupButton","isRemove","headers","getElementsByClassName","showColumnMenu","getGHeaderCell","module","_loop_1","prop","this_1","properties","actionBegin","oldProperties","forEach","modelChanged","updateGroupedColumn","updateButtonVisibility","refreshHeader","Object","keys","isVisible","enable","destroy","gridElement","refreshing","clearGrouping","cols","header","gCols","fieldNames","map","toString","editedData","aggregates","iterateGroupAggregates","rowData","generateRows","summaryRows","getRowsObject","isDataRow","updateSummaryRows","data","indx","cells","cell","isDataCell","dataUid","refreshAggregateCell","updatedData","Array","initData","getCurrentViewRecords","deletedCols","changeds","edit","changes","getPrimaryKeyFieldNames","mergeData","item","pKeyVal","getObject","value","hasVal","some","cItem","eData","index","aggregateRows","aggr","result","aggrds","groupedCols","group"],"mappings":"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","sourcesContent":["import { Draggable, Droppable, isBlazor } from '@syncfusion/ej2-base';\nimport { createElement, closest, remove, classList, addClass, removeClass } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { parentsUntil, isActionPrevent, isGroupAdaptive, updatecloneRow } from '../base/util';\nimport * as events from '../base/constant';\nimport { AriaService } from '../services/aria-service';\nimport { GroupModelGenerator } from '../services/group-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n *\n * The `Group` module is used to handle group action.\n */\nvar Group = /** @class */ (function () {\n    /**\n     * Constructor for Grid group module\n     * @hidden\n     */\n    function Group(parent, groupSettings, sortedColumns, serviceLocator) {\n        var _this = this;\n        this.isAppliedGroup = false;\n        this.isAppliedUnGroup = false;\n        this.visualElement = createElement('div', {\n            className: 'e-cloneproperties e-dragclone e-gdclone',\n            styles: 'line-height:23px', attrs: { action: 'grouping' }\n        });\n        this.helper = function (e) {\n            var gObj = _this.parent;\n            var target = e.sender.target;\n            var element = target.classList.contains('e-groupheadercell') ? target :\n                parentsUntil(target, 'e-groupheadercell');\n            if (!element) {\n                return false;\n            }\n            _this.column = gObj.getColumnByField(element.firstElementChild.getAttribute('ej-mappingname'));\n            _this.visualElement.textContent = element.textContent;\n            _this.visualElement.style.width = element.offsetWidth + 2 + 'px';\n            _this.visualElement.style.height = element.offsetHeight + 2 + 'px';\n            _this.visualElement.setAttribute('e-mappinguid', _this.column.uid);\n            gObj.element.appendChild(_this.visualElement);\n            return _this.visualElement;\n        };\n        this.dragStart = function (e) {\n            _this.parent.element.classList.add('e-ungroupdrag');\n            if (isBlazor()) {\n                e.bindEvents(e.dragElement);\n            }\n        };\n        this.drag = function (e) {\n            var target = e.target;\n            var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n            _this.parent.trigger(events.columnDrag, { target: target, draggableType: 'headercell', column: _this.column });\n            classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n            if (!(parentsUntil(target, 'e-gridcontent') || parentsUntil(target, 'e-headercell'))) {\n                classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n            }\n        };\n        this.dragStop = function (e) {\n            _this.parent.element.classList.remove('e-ungroupdrag');\n            if (!(parentsUntil(e.target, 'e-gridcontent') || parentsUntil(e.target, 'e-gridheader'))) {\n                remove(e.helper);\n                return;\n            }\n        };\n        this.drop = function (e) {\n            var gObj = _this.parent;\n            var column = gObj.getColumnByUid(e.droppedElement.getAttribute('e-mappinguid'));\n            _this.element.classList.remove('e-hover');\n            remove(e.droppedElement);\n            _this.aria.setDropTarget(_this.parent.element.querySelector('.e-groupdroparea'), false);\n            _this.aria.setGrabbed(_this.parent.getHeaderTable().querySelector('[aria-grabbed=true]'), false);\n            if (isNullOrUndefined(column) || column.allowGrouping === false ||\n                parentsUntil(gObj.getColumnHeaderByUid(column.uid), 'e-grid').getAttribute('id') !==\n                    gObj.element.getAttribute('id')) {\n                _this.parent.log('action_disabled_column', { moduleName: _this.getModuleName(), columnName: column.headerText });\n                return;\n            }\n            _this.groupColumn(column.field);\n        };\n        this.contentRefresh = true;\n        this.aria = new AriaService();\n        this.parent = parent;\n        this.groupSettings = groupSettings;\n        this.serviceLocator = serviceLocator;\n        this.sortedColumns = sortedColumns;\n        this.focus = serviceLocator.getService('focus');\n        this.addEventListener();\n        this.groupGenerator = new GroupModelGenerator(this.parent);\n    }\n    Group.prototype.columnDrag = function (e) {\n        var gObj = this.parent;\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n        if (!parentsUntil(e.target, 'e-groupdroparea') &&\n            !(this.parent.allowReordering && parentsUntil(e.target, 'e-headercell'))) {\n            classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n        }\n        e.target.classList.contains('e-groupdroparea') ? this.element.classList.add('e-hover') : this.element.classList.remove('e-hover');\n    };\n    Group.prototype.columnDragStart = function (e) {\n        if (e.target.classList.contains('e-stackedheadercell')) {\n            return;\n        }\n        var gObj = this.parent;\n        var dropArea = this.parent.element.querySelector('.e-groupdroparea');\n        this.aria.setDropTarget(dropArea, e.column.allowGrouping);\n        var element = e.target.classList.contains('e-headercell') ? e.target : parentsUntil(e.target, 'e-headercell');\n        this.aria.setGrabbed(element, true, !e.column.allowGrouping);\n    };\n    Group.prototype.columnDrop = function (e) {\n        var gObj = this.parent;\n        if (e.droppedElement.getAttribute('action') === 'grouping') {\n            var column = gObj.getColumnByUid(e.droppedElement.getAttribute('e-mappinguid'));\n            if (isNullOrUndefined(column) || column.allowGrouping === false ||\n                parentsUntil(gObj.getColumnHeaderByUid(column.uid), 'e-grid').getAttribute('id') !==\n                    gObj.element.getAttribute('id')) {\n                return;\n            }\n            this.ungroupColumn(column.field);\n        }\n    };\n    /**\n     * @hidden\n     */\n    Group.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n        this.parent.on(events.groupComplete, this.onActionComplete, this);\n        this.parent.on(events.ungroupComplete, this.onActionComplete, this);\n        this.parent.on(events.inBoundModelChanged, this.onPropertyChanged, this);\n        this.parent.on(events.click, this.clickHandler, this);\n        this.parent.on(events.columnDrag, this.columnDrag, this);\n        this.parent.on(events.columnDragStart, this.columnDragStart, this);\n        this.parent.on(events.columnDrop, this.columnDrop, this);\n        this.parent.on(events.headerRefreshed, this.refreshSortIcons, this);\n        this.parent.on(events.sortComplete, this.refreshSortIcons, this);\n        this.parent.on(events.keyPressed, this.keyPressHandler, this);\n        this.parent.on(events.contentReady, this.initialEnd, this);\n        this.parent.on(events.onEmpty, this.initialEnd, this);\n        this.parent.on(events.initialEnd, this.render, this);\n        this.parent.on(events.groupAggregates, this.onGroupAggregates, this);\n        this.parent.on('blazor-action-begin', this.blazorActionBegin, this);\n    };\n    /**\n     * @hidden\n     */\n    Group.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.initialEnd, this.render);\n        this.parent.off(events.uiUpdate, this.enableAfterRender);\n        this.parent.off(events.groupComplete, this.onActionComplete);\n        this.parent.off(events.ungroupComplete, this.onActionComplete);\n        this.parent.off(events.inBoundModelChanged, this.onPropertyChanged);\n        this.parent.off(events.click, this.clickHandler);\n        this.parent.off(events.columnDrag, this.columnDrag);\n        this.parent.off(events.columnDragStart, this.columnDragStart);\n        this.parent.off(events.columnDrop, this.columnDrop);\n        this.parent.off(events.headerRefreshed, this.refreshSortIcons);\n        this.parent.off(events.sortComplete, this.refreshSortIcons);\n        this.parent.off(events.keyPressed, this.keyPressHandler);\n        this.parent.off(events.groupAggregates, this.onGroupAggregates);\n        this.parent.off('blazor-action-begin', this.blazorActionBegin);\n    };\n    Group.prototype.blazorActionBegin = function () {\n        if (this.parent.allowGrouping) {\n            this.expandAll();\n        }\n    };\n    Group.prototype.initialEnd = function () {\n        var gObj = this.parent;\n        this.parent.off(events.contentReady, this.initialEnd);\n        this.parent.off(events.onEmpty, this.initialEnd);\n        if (this.parent.getColumns().length && this.groupSettings.columns.length) {\n            this.contentRefresh = false;\n            for (var _i = 0, _a = gObj.groupSettings.columns; _i < _a.length; _i++) {\n                var col = _a[_i];\n                this.groupColumn(col);\n            }\n            this.contentRefresh = true;\n        }\n    };\n    Group.prototype.keyPressHandler = function (e) {\n        var gObj = this.parent;\n        if (e.action !== 'ctrlSpace' && (!this.groupSettings.columns.length ||\n            ['altDownArrow', 'altUpArrow', 'ctrlDownArrow', 'ctrlUpArrow', 'enter'].indexOf(e.action) === -1)) {\n            return;\n        }\n        e.preventDefault();\n        switch (e.action) {\n            case 'altDownArrow':\n            case 'altUpArrow':\n                var selected = gObj.allowSelection ? gObj.getSelectedRowIndexes() : [];\n                if (selected.length) {\n                    var rows = gObj.getContentTable().querySelector('tbody').children;\n                    var dataRow = gObj.getDataRows()[selected[selected.length - 1]];\n                    var grpRow = void 0;\n                    for (var i = dataRow.rowIndex; i >= 0; i--) {\n                        if (!rows[i].classList.contains('e-row') && !rows[i].classList.contains('e-detailrow')) {\n                            grpRow = rows[i];\n                            break;\n                        }\n                    }\n                    this.expandCollapseRows(grpRow.querySelector(e.action === 'altUpArrow' ?\n                        '.e-recordplusexpand' : '.e-recordpluscollapse'));\n                }\n                break;\n            case 'ctrlDownArrow':\n                this.expandAll();\n                break;\n            case 'ctrlUpArrow':\n                this.collapseAll();\n                break;\n            case 'enter':\n                if (this.parent.isEdit || (closest(e.target, '#' + this.parent.element.id + '_searchbar') !== null)) {\n                    return;\n                }\n                var element = this.focus.getFocusedElement();\n                var row = element ? element.parentElement.querySelector('[class^=\"e-record\"]') : null;\n                if (!row) {\n                    break;\n                }\n                this.expandCollapseRows(row);\n                break;\n            case 'ctrlSpace':\n                var elem = gObj.focusModule.currentInfo.element;\n                if (elem && elem.classList.contains('e-headercell')) {\n                    var column = gObj.getColumnByUid(elem.firstElementChild.getAttribute('e-mappinguid'));\n                    column.field && gObj.groupSettings.columns.indexOf(column.field) < 0 ?\n                        this.groupColumn(column.field) : this.ungroupColumn(column.field);\n                }\n                break;\n        }\n    };\n    Group.prototype.clickHandler = function (e) {\n        this.expandCollapseRows(e.target);\n        this.applySortFromTarget(e.target);\n        this.unGroupFromTarget(e.target);\n        this.toogleGroupFromHeader(e.target);\n    };\n    Group.prototype.unGroupFromTarget = function (target) {\n        if (target.classList.contains('e-ungroupbutton')) {\n            this.ungroupColumn(target.parentElement.getAttribute('ej-mappingname'));\n        }\n    };\n    Group.prototype.toogleGroupFromHeader = function (target) {\n        if (this.groupSettings.showToggleButton) {\n            if (target.classList.contains('e-grptogglebtn')) {\n                if (target.classList.contains('e-toggleungroup')) {\n                    this.ungroupColumn(this.parent.getColumnByUid(target.parentElement.getAttribute('e-mappinguid')).field);\n                }\n                else {\n                    this.groupColumn(this.parent.getColumnByUid(target.parentElement.getAttribute('e-mappinguid')).field);\n                }\n            }\n            else {\n                if (target.classList.contains('e-toggleungroup')) {\n                    this.ungroupColumn(target.parentElement.getAttribute('ej-mappingname'));\n                }\n            }\n        }\n    };\n    Group.prototype.applySortFromTarget = function (target) {\n        var gObj = this.parent;\n        var gHeader = closest(target, '.e-groupheadercell');\n        if (gObj.allowSorting && gHeader && !target.classList.contains('e-ungroupbutton') &&\n            !target.classList.contains('e-toggleungroup')) {\n            var field = gHeader.firstElementChild.getAttribute('ej-mappingname');\n            if (gObj.getColumnHeaderByField(field).querySelectorAll('.e-ascending').length) {\n                gObj.sortColumn(field, 'Descending', true);\n            }\n            else {\n                gObj.sortColumn(field, 'Ascending', true);\n            }\n        }\n    };\n    /**\n     * Expands or collapses grouped rows by target element.\n     * @param  {Element} target - Defines the target element of the grouped row.\n     * @return {void}\n     */\n    Group.prototype.expandCollapseRows = function (target) {\n        var trgt = parentsUntil(target, 'e-recordplusexpand') ||\n            parentsUntil(target, 'e-recordpluscollapse');\n        if (trgt) {\n            var cellIdx = trgt.cellIndex;\n            var rowIdx = trgt.parentElement.rowIndex;\n            var rowNodes = this.parent.getContentTable().querySelector('tbody').children;\n            var rows = [].slice.call(rowNodes).slice(rowIdx + 1, rowNodes.length);\n            var isHide = void 0;\n            var expandElem = void 0;\n            var dataManager = void 0;\n            var query = void 0;\n            var toExpand = [];\n            var gObj = this.parent;\n            var indent = trgt.parentElement.querySelectorAll('.e-indentcell').length;\n            var expand = false;\n            if (trgt.classList.contains('e-recordpluscollapse')) {\n                addClass([trgt], 'e-recordplusexpand');\n                removeClass([trgt], 'e-recordpluscollapse');\n                trgt.firstElementChild.className = 'e-icons e-gdiagonaldown e-icon-gdownarrow';\n                expand = true;\n                if (isGroupAdaptive(gObj)) {\n                    this.updateVirtualRows(gObj, target, expand, query, dataManager);\n                }\n            }\n            else {\n                isHide = true;\n                removeClass([trgt], 'e-recordplusexpand');\n                addClass([trgt], 'e-recordpluscollapse');\n                trgt.firstElementChild.className = 'e-icons e-gnextforward e-icon-grightarrow';\n                if (isGroupAdaptive(gObj)) {\n                    this.updateVirtualRows(gObj, target, !isHide, query, dataManager);\n                }\n            }\n            this.aria.setExpand(trgt, expand);\n            if (!isGroupAdaptive(gObj)) {\n                for (var i = 0, len = rows.length; i < len; i++) {\n                    if (rows[i].querySelectorAll('td')[cellIdx] &&\n                        rows[i].querySelectorAll('td')[cellIdx].classList.contains('e-indentcell') && rows) {\n                        if (isHide) {\n                            rows[i].style.display = 'none';\n                        }\n                        else {\n                            if (rows[i].querySelectorAll('.e-indentcell').length === indent + 1) {\n                                rows[i].style.display = '';\n                                expandElem = rows[i].querySelector('.e-recordplusexpand');\n                                if (expandElem) {\n                                    toExpand.push(expandElem);\n                                }\n                                if (rows[i].classList.contains('e-detailrow')) {\n                                    if (rows[i - 1].querySelectorAll('.e-detailrowcollapse').length) {\n                                        rows[i].style.display = 'none';\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    else {\n                        break;\n                    }\n                }\n            }\n            for (var i = 0, len = toExpand.length; i < len; i++) {\n                removeClass([toExpand[i]], 'e-recordplusexpand');\n                addClass([toExpand[i]], 'e-recordpluscollapse');\n                toExpand[i].firstElementChild.className = 'e-icons e-gnextforward e-icon-grightarrow';\n                this.expandCollapseRows(toExpand[i]);\n            }\n        }\n    };\n    Group.prototype.updateVirtualRows = function (gObj, target, isExpand, query, dataManager) {\n        var rObj = gObj.getRowObjectFromUID(target.closest('tr').getAttribute('data-uid'));\n        rObj.isExpand = isExpand;\n        updatecloneRow(gObj);\n        query = gObj.getDataModule().generateQuery(false);\n        query.queries = [];\n        var args = { requestType: 'virtualscroll', rowObject: rObj };\n        dataManager = gObj.getDataModule().getData(args, query.requiresCount());\n        dataManager.then(function (e) { return gObj.renderModule.dataManagerSuccess(e, args); });\n    };\n    Group.prototype.expandCollapse = function (isExpand) {\n        var rowNodes = this.parent.getContentTable().querySelector('tbody').children;\n        var row;\n        for (var i = 0, len = rowNodes.length; i < len; i++) {\n            if (rowNodes[i].querySelectorAll('.e-recordplusexpand, .e-recordpluscollapse').length) {\n                row = rowNodes[i].querySelector(isExpand ? '.e-recordpluscollapse' : '.e-recordplusexpand');\n                if (row) {\n                    row.className = isExpand ? 'e-recordplusexpand' : 'e-recordpluscollapse';\n                    row.firstElementChild.className = isExpand ? 'e-icons e-gdiagonaldown e-icon-gdownarrow' :\n                        'e-icons e-gnextforward e-icon-grightarrow';\n                }\n                if (!(rowNodes[i].firstElementChild.classList.contains('e-recordplusexpand') ||\n                    rowNodes[i].firstElementChild.classList.contains('e-recordpluscollapse'))) {\n                    rowNodes[i].style.display = isExpand ? '' : 'none';\n                }\n            }\n            else {\n                rowNodes[i].style.display = isExpand ? '' : 'none';\n            }\n        }\n    };\n    /**\n     * Expands all the grouped rows of the Grid.\n     * @return {void}\n     */\n    Group.prototype.expandAll = function () {\n        this.expandCollapse(true);\n    };\n    /**\n     * Collapses all the grouped rows of the Grid.\n     * @return {void}\n     */\n    Group.prototype.collapseAll = function () {\n        this.expandCollapse(false);\n    };\n    /**\n     * The function is used to render grouping\n     * @return {Element}\n     * @hidden\n     */\n    Group.prototype.render = function () {\n        this.l10n = this.serviceLocator.getService('localization');\n        this.renderGroupDropArea();\n        this.initDragAndDrop();\n        this.refreshToggleBtn();\n    };\n    Group.prototype.renderGroupDropArea = function () {\n        var groupElem = this.parent.element.querySelector('.e-groupdroparea');\n        if (groupElem) {\n            remove(groupElem);\n        }\n        this.element = this.parent.createElement('div', { className: 'e-groupdroparea', attrs: { 'tabindex': '-1' } });\n        this.updateGroupDropArea();\n        this.parent.element.insertBefore(this.element, this.parent.element.firstChild);\n        if (!this.groupSettings.showDropArea) {\n            this.element.style.display = 'none';\n        }\n    };\n    Group.prototype.updateGroupDropArea = function (clear) {\n        if (this.groupSettings.showDropArea && !this.groupSettings.columns.length) {\n            var dragLabel = this.l10n.getConstant('GroupDropArea');\n            this.element.innerHTML = dragLabel;\n            this.element.classList.remove('e-grouped');\n        }\n        else {\n            if ((this.element.innerHTML === this.l10n.getConstant('GroupDropArea') && (this.groupSettings.columns.length === 1\n                || !this.isAppliedGroup && !this.isAppliedUnGroup)) || clear) {\n                this.element.innerHTML = '';\n            }\n            this.element.classList.add('e-grouped');\n        }\n    };\n    Group.prototype.initDragAndDrop = function () {\n        this.initializeGHeaderDrop();\n        this.initializeGHeaderDrag();\n    };\n    Group.prototype.initializeGHeaderDrag = function () {\n        var drag = new Draggable(this.element, {\n            dragTarget: '.e-groupheadercell',\n            distance: 5,\n            helper: this.helper,\n            dragStart: this.dragStart,\n            drag: this.drag,\n            dragStop: this.dragStop\n        });\n    };\n    Group.prototype.initializeGHeaderDrop = function () {\n        var gObj = this.parent;\n        var drop = new Droppable(this.element, {\n            accept: '.e-dragclone',\n            drop: this.drop\n        });\n    };\n    /**\n     * Groups a column by column name.\n     * @param  {string} columnName - Defines the column name to group.\n     * @return {void}\n     */\n    Group.prototype.groupColumn = function (columnName) {\n        var gObj = this.parent;\n        var column = gObj.getColumnByField(columnName);\n        if (isNullOrUndefined(column) || column.allowGrouping === false ||\n            (this.contentRefresh && this.groupSettings.columns.indexOf(columnName) > -1)) {\n            this.parent.log('action_disabled_column', { moduleName: this.getModuleName(), columnName: column.headerText });\n            return;\n        }\n        if (isActionPrevent(gObj)) {\n            gObj.notify(events.preventBatch, { instance: this, handler: this.groupColumn, arg1: columnName });\n            return;\n        }\n        column.visible = gObj.groupSettings.showGroupedColumn;\n        this.colName = columnName;\n        this.isAppliedGroup = true;\n        if (this.contentRefresh) {\n            this.updateModel();\n        }\n        else {\n            this.addColToGroupDrop(columnName);\n        }\n        this.updateGroupDropArea();\n        this.isAppliedGroup = false;\n    };\n    /**\n     * Ungroups a column by column name.\n     * @param  {string} columnName - Defines the column name to ungroup.\n     * @return {void}\n     */\n    Group.prototype.ungroupColumn = function (columnName) {\n        var gObj = this.parent;\n        var column = this.parent.enableColumnVirtualization ?\n            this.parent.columns.filter(function (c) { return c.field === columnName; })[0] : gObj.getColumnByField(columnName);\n        if (isNullOrUndefined(column) || column.allowGrouping === false || this.groupSettings.columns.indexOf(columnName) < 0) {\n            return;\n        }\n        if (isActionPrevent(gObj)) {\n            gObj.notify(events.preventBatch, { instance: this, handler: this.ungroupColumn, arg1: columnName });\n            return;\n        }\n        column.visible = true;\n        this.colName = column.field;\n        var columns = JSON.parse(JSON.stringify(this.groupSettings.columns));\n        columns.splice(columns.indexOf(this.colName), 1);\n        if (this.sortedColumns.indexOf(columnName) < 0) {\n            for (var i = 0, len = gObj.sortSettings.columns.length; i < len; i++) {\n                if (columnName === gObj.sortSettings.columns[i].field) {\n                    gObj.sortSettings.columns.splice(i, 1);\n                    break;\n                }\n            }\n        }\n        var isServerRendered = 'isServerRendered';\n        if (isBlazor() && this.parent[isServerRendered]) {\n            gObj.sortSettings.columns = gObj.sortSettings.columns;\n        }\n        this.groupSettings.columns = columns;\n        if (gObj.allowGrouping) {\n            this.isAppliedUnGroup = true;\n            this.parent.dataBind();\n        }\n    };\n    /**\n     * The function used to update groupSettings\n     * @return {void}\n     * @hidden\n     */\n    Group.prototype.updateModel = function () {\n        var gObj = this.parent;\n        var i = 0;\n        var columns = JSON.parse(JSON.stringify(this.groupSettings.columns));\n        columns.push(this.colName);\n        this.groupAddSortingQuery(this.colName);\n        this.groupSettings.columns = columns;\n        this.parent.dataBind();\n    };\n    /**\n     * The function used to trigger onActionComplete\n     * @return {void}\n     * @hidden\n     */\n    Group.prototype.onActionComplete = function (e) {\n        if (isBlazor() && !this.parent.isJsComponent) {\n            e.rows = null;\n        }\n        var gObj = this.parent;\n        if (e.requestType === 'grouping') {\n            this.addColToGroupDrop(this.colName);\n        }\n        else {\n            this.removeColFromGroupDrop(this.colName);\n        }\n        var args = this.groupSettings.columns.indexOf(this.colName) > -1 ? {\n            columnName: this.colName, requestType: 'grouping', type: events.actionComplete\n        } : { requestType: 'ungrouping', type: events.actionComplete };\n        this.parent.trigger(events.actionComplete, extend(e, args));\n        this.colName = null;\n    };\n    Group.prototype.groupAddSortingQuery = function (colName) {\n        var i = 0;\n        while (i < this.parent.sortSettings.columns.length) {\n            if (this.parent.sortSettings.columns[i].field === colName) {\n                break;\n            }\n            i++;\n        }\n        if (this.parent.sortSettings.columns.length === i) {\n            this.parent.sortSettings.columns.push({ field: colName, direction: 'Ascending', isFromGroup: true });\n            var isServerRendered = 'isServerRendered';\n            if (isBlazor() && this.parent[isServerRendered]) {\n                this.parent.sortSettings.columns = this.parent.sortSettings.columns;\n            }\n        }\n        else if (!this.parent.allowSorting) {\n            this.parent.sortSettings.columns[i].direction = 'Ascending';\n        }\n    };\n    Group.prototype.addColToGroupDrop = function (field) {\n        var gObj = this.parent;\n        var direction = 'Ascending';\n        var groupedColumn = this.parent.createElement('div', { className: 'e-grid-icon e-groupheadercell' });\n        var childDiv = this.parent.createElement('div', { attrs: { 'ej-mappingname': field } });\n        var column = this.parent.getColumnByField(field);\n        if (isNullOrUndefined(column)) {\n            return;\n        }\n        //Todo headerTemplateID for grouped column, disableHtmlEncode                          \n        var headerCell = gObj.getColumnHeaderByUid(column.uid);\n        // if (!isNullOrUndefined(column.headerTemplate)) {\n        //     if (column.headerTemplate.indexOf('#') !== -1) {\n        //         childDiv.innerHTML = document.querySelector(column.headerTemplate).innerHTML.trim();\n        //     } else {\n        //         childDiv.innerHTML = column.headerTemplate;\n        //     }\n        //     childDiv.firstElementChild.classList.add('e-grouptext');\n        // } else {\n        childDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-grouptext', innerHTML: column.headerText,\n            attrs: { tabindex: '-1', 'aria-label': 'sort the grouped column' }\n        }));\n        // }\n        if (this.groupSettings.showToggleButton) {\n            childDiv.appendChild(this.parent.createElement('span', {\n                className: 'e-togglegroupbutton e-icons e-icon-ungroup e-toggleungroup', innerHTML: '&nbsp;',\n                attrs: { tabindex: '-1', 'aria-label': 'ungroup button' }\n            }));\n        }\n        if (headerCell.querySelectorAll('.e-ascending,.e-descending').length) {\n            direction = headerCell.querySelector('.e-ascending') ? 'Ascending' : 'Descending';\n        }\n        childDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-groupsort e-icons ' +\n                ('e-' + direction.toLowerCase() + ' e-icon-' + direction.toLowerCase()), innerHTML: '&nbsp;',\n            attrs: { tabindex: '-1', 'aria-label': 'sort the grouped column' }\n        }));\n        childDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-ungroupbutton e-icons e-icon-hide', innerHTML: '&nbsp;',\n            attrs: { title: this.l10n.getConstant('UnGroup'), tabindex: '-1', 'aria-label': 'ungroup the grouped column' },\n            styles: this.groupSettings.showUngroupButton ? '' : 'display:none'\n        }));\n        groupedColumn.appendChild(childDiv);\n        this.element.appendChild(groupedColumn);\n        //Todo:  rtl \n    };\n    Group.prototype.refreshToggleBtn = function (isRemove) {\n        if (this.groupSettings.showToggleButton) {\n            var headers = [].slice.call(this.parent.element.getElementsByClassName('e-headercelldiv'));\n            for (var i = 0, len = headers.length; i < len; i++) {\n                if (!((headers[i].classList.contains('e-emptycell')) || (headers[i].classList.contains('e-headerchkcelldiv')))) {\n                    var column = this.parent.getColumnByUid(headers[i].getAttribute('e-mappinguid'));\n                    if (!this.parent.showColumnMenu || (this.parent.showColumnMenu && !column.showColumnMenu)) {\n                        if (headers[i].querySelectorAll('.e-grptogglebtn').length) {\n                            remove(headers[i].querySelectorAll('.e-grptogglebtn')[0]);\n                        }\n                        if (!isRemove) {\n                            headers[i].appendChild(this.parent.createElement('span', {\n                                className: 'e-grptogglebtn e-icons ' +\n                                    (this.groupSettings.columns.indexOf(column.field) > -1 ? 'e-toggleungroup e-icon-ungroup'\n                                        : 'e-togglegroup e-icon-group'), attrs: { tabindex: '-1', 'aria-label': 'Group button' }\n                            }));\n                        }\n                    }\n                }\n            }\n        }\n    };\n    Group.prototype.removeColFromGroupDrop = function (field) {\n        if (!isNullOrUndefined(this.getGHeaderCell(field))) {\n            remove(this.getGHeaderCell(field));\n            this.updateGroupDropArea();\n        }\n        this.isAppliedUnGroup = false;\n    };\n    Group.prototype.onPropertyChanged = function (e) {\n        var _this = this;\n        if (e.module !== this.getModuleName()) {\n            return;\n        }\n        var _loop_1 = function (prop) {\n            switch (prop) {\n                case 'columns':\n                    var args = void 0;\n                    if (this_1.contentRefresh) {\n                        if (!this_1.isAppliedUnGroup) {\n                            if (!this_1.isAppliedGroup) {\n                                this_1.updateGroupDropArea(true);\n                                for (var i = 0; i < this_1.groupSettings.columns.length; i++) {\n                                    this_1.colName = this_1.groupSettings.columns[i];\n                                    var col = this_1.parent.getColumnByField(this_1.colName);\n                                    col.visible = this_1.parent.groupSettings.showGroupedColumn;\n                                    this_1.groupAddSortingQuery(this_1.colName);\n                                    if (i < this_1.groupSettings.columns.length - 1) {\n                                        this_1.addColToGroupDrop(this_1.groupSettings.columns[i]);\n                                    }\n                                }\n                            }\n                            args = {\n                                columnName: this_1.colName, requestType: e.properties[prop].length ? 'grouping' : 'ungrouping',\n                                type: events.actionBegin\n                            };\n                        }\n                        else {\n                            args = { requestType: 'ungrouping', type: events.actionBegin };\n                        }\n                        if (!this_1.groupSettings.showGroupedColumn) {\n                            e.oldProperties[prop].forEach(function (column) {\n                                if (e.properties[prop].indexOf(column) === -1) {\n                                    _this.parent.getColumnByField(column).visible = true;\n                                }\n                            });\n                        }\n                        this_1.parent.notify(events.modelChanged, args);\n                    }\n                    break;\n                case 'showDropArea':\n                    this_1.updateGroupDropArea();\n                    this_1.groupSettings.showDropArea ? this_1.element.style.display = '' : this_1.element.style.display = 'none';\n                    break;\n                case 'showGroupedColumn':\n                    this_1.updateGroupedColumn(this_1.groupSettings.showGroupedColumn);\n                    this_1.parent.notify(events.modelChanged, { requestType: 'refresh' });\n                    break;\n                case 'showUngroupButton':\n                    this_1.updateButtonVisibility(this_1.groupSettings.showUngroupButton, 'e-ungroupbutton');\n                    break;\n                case 'showToggleButton':\n                    this_1.updateButtonVisibility(this_1.groupSettings.showToggleButton, 'e-togglegroupbutton ');\n                    this_1.parent.refreshHeader();\n                    break;\n            }\n        };\n        var this_1 = this;\n        for (var _i = 0, _a = Object.keys(e.properties); _i < _a.length; _i++) {\n            var prop = _a[_i];\n            _loop_1(prop);\n        }\n    };\n    Group.prototype.updateGroupedColumn = function (isVisible) {\n        for (var i = 0; i < this.groupSettings.columns.length; i++) {\n            this.parent.getColumnByField(this.groupSettings.columns[i]).visible = isVisible;\n        }\n    };\n    Group.prototype.updateButtonVisibility = function (isVisible, className) {\n        var gHeader = [].slice.call(this.element.querySelectorAll('.' + className));\n        for (var i = 0; i < gHeader.length; i++) {\n            gHeader[i].style.display = isVisible ? '' : 'none';\n        }\n    };\n    Group.prototype.enableAfterRender = function (e) {\n        if (e.module === this.getModuleName() && e.enable) {\n            this.render();\n        }\n    };\n    /**\n     * To destroy the reorder\n     * @return {void}\n     * @hidden\n     */\n    Group.prototype.destroy = function () {\n        var gridElement = this.parent.element;\n        if (!gridElement || (!gridElement.querySelector('.e-gridheader') && !gridElement.querySelector('.e-gridcontent'))) {\n            return;\n        }\n        // tslint:disable-next-line:no-any\n        if (!this.parent.isDestroyed && !this.parent.refreshing) {\n            this.clearGrouping();\n        }\n        this.removeEventListener();\n        this.refreshToggleBtn(true);\n        remove(this.element);\n        //call ejdrag and drop destroy\n    };\n    /**\n     * Clears all the grouped columns of the Grid.\n     * @return {void}\n     */\n    Group.prototype.clearGrouping = function () {\n        var cols = JSON.parse(JSON.stringify(this.groupSettings.columns));\n        this.contentRefresh = false;\n        for (var i = 0, len = cols.length; i < len; i++) {\n            if (i === (len - 1)) {\n                this.contentRefresh = true;\n            }\n            this.ungroupColumn(cols[i]);\n        }\n        this.contentRefresh = true;\n    };\n    /**\n     * For internal use only - Get the module name.\n     * @private\n     */\n    Group.prototype.getModuleName = function () {\n        return 'group';\n    };\n    Group.prototype.refreshSortIcons = function (e) {\n        var gObj = this.parent;\n        var header;\n        var cols = gObj.sortSettings.columns;\n        var gCols = gObj.groupSettings.columns;\n        var fieldNames = this.parent.getColumns().map(function (c) { return c.field; });\n        this.refreshToggleBtn();\n        for (var i = 0, len = cols.length; i < len; i++) {\n            if (fieldNames.indexOf(cols[i].field) === -1) {\n                continue;\n            }\n            header = gObj.getColumnHeaderByField(cols[i].field);\n            if (!gObj.allowSorting && (this.sortedColumns.indexOf(cols[i].field) > -1 ||\n                this.groupSettings.columns.indexOf(cols[i].field) > -1)) {\n                classList(header.querySelector('.e-sortfilterdiv'), ['e-ascending', 'e-icon-ascending'], []);\n                if (cols.length > 1) {\n                    header.querySelector('.e-headercelldiv').appendChild(this.parent.createElement('span', { className: 'e-sortnumber', innerHTML: (i + 1).toString() }));\n                }\n            }\n            else if (this.getGHeaderCell(cols[i].field) && this.getGHeaderCell(cols[i].field).querySelectorAll('.e-groupsort').length) {\n                if (cols[i].direction === 'Ascending') {\n                    classList(this.getGHeaderCell(cols[i].field).querySelector('.e-groupsort'), ['e-ascending', 'e-icon-ascending'], ['e-descending', 'e-icon-descending']);\n                }\n                else {\n                    classList(this.getGHeaderCell(cols[i].field).querySelector('.e-groupsort'), ['e-descending', 'e-icon-descending'], ['e-ascending', 'e-icon-ascending']);\n                }\n            }\n        }\n        for (var i = 0, len = gCols.length; i < len; i++) {\n            if (fieldNames.indexOf(gCols[i]) === -1) {\n                continue;\n            }\n            gObj.getColumnHeaderByField(gCols[i]).setAttribute('aria-grouped', 'true');\n        }\n    };\n    Group.prototype.getGHeaderCell = function (field) {\n        if (this.element && this.element.querySelector('[ej-mappingname=\"' + field + '\"]')) {\n            return this.element.querySelector('[ej-mappingname=\"' + field + '\"]').parentElement;\n        }\n        return null;\n    };\n    Group.prototype.onGroupAggregates = function (editedData) {\n        var _this = this;\n        var aggregates = this.iterateGroupAggregates(editedData);\n        var rowData = this.groupGenerator.generateRows(aggregates, {});\n        var summaryRows = this.parent.getRowsObject().filter(function (row) { return !row.isDataRow; });\n        var updateSummaryRows = rowData.filter(function (data) { return !data.isDataRow; });\n        updateSummaryRows.forEach(function (row, indx) {\n            var cells = row.cells.filter(function (cell) { return cell.isDataCell; });\n            var args = { cells: cells, data: row.data, dataUid: summaryRows[indx] ? summaryRows[indx].uid : '' };\n            _this.parent.notify(events.refreshAggregateCell, args);\n        });\n    };\n    Group.prototype.iterateGroupAggregates = function (editedData) {\n        var updatedData = editedData instanceof Array ? editedData : [];\n        var rows = this.parent.getRowsObject();\n        var initData = this.parent.getCurrentViewRecords();\n        var deletedCols = [];\n        var changeds = rows.map(function (row) {\n            if (row.edit === 'delete') {\n                deletedCols.push(row.data);\n            }\n            return row.changes instanceof Object ? row.changes : row.data;\n        });\n        var field = this.parent.getPrimaryKeyFieldNames()[0];\n        changeds = updatedData.length === 0 ? changeds : updatedData;\n        var mergeData = initData.map(function (item) {\n            var pKeyVal = DataUtil.getObject(field, item);\n            var value;\n            var hasVal = changeds.some(function (cItem) {\n                value = cItem;\n                return pKeyVal === DataUtil.getObject(field, cItem);\n            });\n            return hasVal ? value : item;\n        });\n        var eData = editedData;\n        if (!(eData.type && eData.type === 'cancel') && deletedCols.length > 0) {\n            deletedCols.forEach(function (row) {\n                var index = mergeData.indexOf(row);\n                mergeData.splice(index, 1);\n            });\n        }\n        var aggregates = [];\n        var aggregateRows = this.parent.aggregates;\n        aggregateRows.forEach(function (row) {\n            row.columns.forEach(function (col) {\n                var aggr = {};\n                var type = col.type.toString();\n                aggr = { type: type.toLowerCase(), field: col.field };\n                aggregates.push(aggr);\n            });\n        });\n        var result;\n        var aggrds;\n        var groupedCols = this.parent.groupSettings.columns;\n        groupedCols.forEach(function (field) {\n            aggrds = result ? result : mergeData;\n            result = DataUtil.group(aggrds, field, aggregates, null, null);\n        });\n        return result;\n    };\n    return Group;\n}());\nexport { Group };\n"]},"metadata":{},"sourceType":"module"}