{"ast":null,"code":"import { remove, resetBlazorTemplate, updateBlazorTemplate, blazorTemplates, isBlazor } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Deferred, Predicate, DataUtil } from '@syncfusion/ej2-data';\nimport { ValueFormatter } from '../services/value-formatter';\nimport { RenderType, CellType } from '../base/enum';\nimport { Data } from '../actions/data';\nimport { Column } from '../models/column';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport * as events from '../base/constant';\nimport { prepareColumns, setFormatter, isGroupAdaptive, getDatePredicate, getObject } from '../base/util';\nimport { ContentRender } from '../renderer/content-renderer';\nimport { HeaderRender } from '../renderer/header-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { HeaderCellRenderer } from '../renderer/header-cell-renderer';\nimport { StackedHeaderCellRenderer } from '../renderer/stacked-cell-renderer';\nimport { IndentCellRenderer } from '../renderer/indent-cell-renderer';\nimport { GroupCaptionCellRenderer, GroupCaptionEmptyCellRenderer } from '../renderer/caption-cell-renderer';\nimport { ExpandCellRenderer } from '../renderer/expand-cell-renderer';\nimport { HeaderIndentCellRenderer } from '../renderer/header-indent-renderer';\nimport { DetailHeaderIndentCellRenderer } from '../renderer/detail-header-indent-renderer';\nimport { DetailExpandCellRenderer } from '../renderer/detail-expand-cell-renderer';\nimport { RowDragDropRenderer } from './row-drag-drop-renderer';\nimport { RowDragDropHeaderRenderer } from '../renderer/row-drag-header-indent-render';\n/**\n * Content module is used to render grid content\n * @hidden\n */\n\nvar Render =\n/** @class */\nfunction () {\n  /**\n   * Constructor for render module\n   */\n  function Render(parent, locator) {\n    this.emptyGrid = false;\n    this.counter = 0;\n    this.parent = parent;\n    this.locator = locator;\n    this.data = new Data(parent, locator);\n    this.l10n = locator.getService('localization');\n    this.ariaService = this.locator.getService('ariaService');\n    this.renderer = this.locator.getService('rendererFactory');\n    this.addEventListener();\n  }\n  /**\n   * To initialize grid header, content and footer rendering\n   */\n\n\n  Render.prototype.render = function () {\n    var gObj = this.parent;\n    var isServerRendered = 'isServerRendered';\n    this.headerRenderer = this.renderer.getRenderer(RenderType.Header);\n    this.contentRenderer = this.renderer.getRenderer(RenderType.Content);\n    this.headerRenderer.renderPanel();\n    this.contentRenderer.renderPanel();\n\n    if (gObj.getColumns().length) {\n      this.isLayoutRendered = true;\n      this.headerRenderer.renderTable();\n      this.contentRenderer.renderTable();\n      this.emptyRow(false);\n    }\n\n    this.parent.scrollModule.setWidth();\n    this.parent.scrollModule.setHeight();\n\n    if (this.parent.height !== 'auto') {\n      this.parent.scrollModule.setPadding();\n    }\n\n    if (!(isBlazor() && this.parent[isServerRendered])) {\n      this.refreshDataManager();\n    }\n  };\n  /**\n   * Refresh the entire Grid.\n   * @return {void}\n   */\n\n\n  Render.prototype.refresh = function (e) {\n    var _this = this;\n\n    if (e === void 0) {\n      e = {\n        requestType: 'refresh'\n      };\n    }\n\n    var gObj = this.parent;\n    var preventUpdate = 'preventUpdate';\n    gObj.notify(e.requestType + \"-begin\", e);\n\n    if (isBlazor()) {\n      this.resetTemplates();\n    }\n\n    if (isBlazor() && gObj.isServerRendered) {\n      var bulkChanges = 'bulkChanges';\n\n      if (gObj[bulkChanges].dataSource) {\n        delete gObj[bulkChanges].dataSource;\n      }\n\n      gObj.notify('blazor-action-begin', e);\n\n      if (e.requestType === 'filtering') {\n        var columns = 'columns';\n        e[columns] = null;\n      }\n\n      if (e.requestType === 'sorting') {\n        var target = 'target';\n        e[target] = null;\n      }\n\n      if (gObj.editSettings.mode === 'Normal' && gObj.isEdit) {\n        gObj.notify('closeinline', {});\n      } else if (gObj.editSettings.mode === 'Batch' && !gObj.isEdit) {\n        gObj.notify('closebatch', {});\n      }\n    }\n\n    gObj.trigger(events.actionBegin, e, function (args) {\n      if (args === void 0) {\n        args = {\n          requestType: 'refresh'\n        };\n      }\n\n      if (args.requestType === 'delete' && isBlazor() && !gObj.isJsComponent) {\n        var data = 'data';\n        args[data] = gObj.getSelectedRecords();\n      }\n\n      if (args.cancel) {\n        gObj.notify(events.cancelBegin, args);\n        return;\n      }\n\n      if (args.requestType === 'delete' && gObj.allowPaging) {\n        var dataLength = args.data.length;\n        var count = gObj.pageSettings.totalRecordsCount - dataLength;\n\n        if (!(gObj.currentViewData.length - dataLength) && count) {\n          gObj.prevPageMoving = true;\n          gObj.setProperties({\n            pageSettings: {\n              totalRecordsCount: count,\n              currentPage: Math.ceil(count / gObj.pageSettings.pageSize)\n            }\n          }, true);\n          gObj.pagerModule.pagerObj.totalRecordsCount = count;\n        }\n      }\n\n      if (isBlazor() && _this.parent.isServerRendered) {\n        if (_this.parent[preventUpdate]) {\n          return;\n        }\n\n        if (e.requestType === 'refresh') {\n          _this.parent.currentAction = e;\n        }\n\n        if (args.requestType !== 'virtualscroll') {\n          _this.parent.showSpinner();\n        }\n\n        if (args.requestType === 'delete' || args.requestType === 'save') {\n          _this.parent.notify(events.addDeleteAction, args);\n\n          _this.parent.notify('add-delete-success', args);\n        } else {\n          _this.parent.allowServerDataBinding = true;\n\n          _this.parent.serverDataBind();\n\n          _this.parent.allowServerDataBinding = false;\n        }\n      } else {\n        _this.refreshDataManager(args);\n      }\n    });\n  };\n\n  Render.prototype.resetTemplates = function () {\n    var gObj = this.parent;\n    var gridColumns = gObj.getColumns();\n\n    if (gObj.detailTemplate) {\n      var detailTemplateID = gObj.element.id + 'detailTemplate';\n      blazorTemplates[detailTemplateID] = [];\n      resetBlazorTemplate(detailTemplateID, 'DetailTemplate');\n    }\n\n    if (gObj.groupSettings.captionTemplate) {\n      resetBlazorTemplate(gObj.element.id + 'captionTemplate', 'CaptionTemplate');\n    }\n\n    if (gObj.rowTemplate) {\n      resetBlazorTemplate(gObj.element.id + 'rowTemplate', 'RowTemplate');\n    }\n\n    if (gObj.toolbarTemplate) {\n      resetBlazorTemplate(gObj.element.id + 'toolbarTemplate', 'ToolbarTemplate');\n    }\n\n    if (gObj.pageSettings.template) {\n      resetBlazorTemplate(gObj.element.id + '_template', 'pageSettings');\n    }\n\n    for (var i = 0; i < gridColumns.length; i++) {\n      if (gridColumns[i].template) {\n        blazorTemplates[gObj.element.id + gridColumns[i].uid] = [];\n        resetBlazorTemplate(gObj.element.id + gridColumns[i].uid, 'Template');\n      }\n\n      if (gridColumns[i].headerTemplate) {\n        resetBlazorTemplate(gObj.element.id + gridColumns[i].uid + 'headerTemplate', 'HeaderTemplate');\n      }\n\n      if (gridColumns[i].filterTemplate) {\n        resetBlazorTemplate(gObj.element.id + gridColumns[i].uid + 'filterTemplate', 'FilterTemplate');\n      }\n    }\n\n    var guid = 'guid';\n\n    for (var k = 0; k < gObj.aggregates.length; k++) {\n      for (var j = 0; j < gObj.aggregates[k].columns.length; j++) {\n        if (gObj.aggregates[k].columns[j].footerTemplate) {\n          var tempID = gObj.element.id + gObj.aggregates[k].columns[j][guid] + 'footerTemplate';\n          resetBlazorTemplate(tempID, 'FooterTemplate');\n        }\n\n        if (gObj.aggregates[k].columns[j].groupFooterTemplate) {\n          var tempID = gObj.element.id + gObj.aggregates[k].columns[j][guid] + 'groupFooterTemplate';\n          resetBlazorTemplate(tempID, 'GroupFooterTemplate');\n        }\n\n        if (gObj.aggregates[k].columns[j].groupCaptionTemplate) {\n          var tempID = gObj.element.id + gObj.aggregates[k].columns[j][guid] + 'groupCaptionTemplate';\n          resetBlazorTemplate(tempID, 'GroupCaptionTemplate');\n        }\n      }\n    }\n  };\n\n  Render.prototype.refreshComplete = function (e) {\n    if (isBlazor() && !this.parent.isJsComponent) {\n      e.rows = null;\n    }\n\n    this.parent.trigger(events.actionComplete, e);\n  };\n  /**\n   * The function is used to refresh the dataManager\n   * @return {void}\n   */\n\n\n  Render.prototype.refreshDataManager = function (args) {\n    var _this = this;\n\n    if (args === void 0) {\n      args = {};\n    }\n\n    if (args.requestType !== 'virtualscroll') {\n      this.parent.showSpinner();\n    }\n\n    this.emptyGrid = false;\n    var dataManager;\n    var isFActon = this.isNeedForeignAction();\n    this.ariaService.setBusy(this.parent.getContent().querySelector('.e-content'), true);\n\n    if (isFActon) {\n      var deffered = new Deferred();\n      dataManager = this.getFData(deffered);\n    }\n\n    if (!dataManager) {\n      dataManager = this.data.getData(args, this.data.generateQuery().requiresCount());\n    } else {\n      dataManager = dataManager.then(function (e) {\n        var query = _this.data.generateQuery().requiresCount();\n\n        if (_this.emptyGrid) {\n          var def = new Deferred();\n          def.resolve({\n            result: [],\n            count: 0\n          });\n          return def.promise;\n        }\n\n        return _this.data.getData(args, query);\n      });\n    }\n\n    if (this.parent.getForeignKeyColumns().length && (!isFActon || this.parent.searchSettings.key.length)) {\n      var deffered_1 = new Deferred();\n      dataManager = dataManager.then(function (e) {\n        _this.parent.notify(events.getForeignKeyData, {\n          dataManager: dataManager,\n          result: e,\n          promise: deffered_1\n        });\n\n        return deffered_1.promise;\n      });\n    }\n\n    if (this.parent.groupSettings.disablePageWiseAggregates && this.parent.groupSettings.columns.length) {\n      dataManager = dataManager.then(function (e) {\n        return _this.validateGroupRecords(e);\n      });\n    }\n\n    dataManager.then(function (e) {\n      return _this.dataManagerSuccess(e, args);\n    }).catch(function (e) {\n      return _this.dataManagerFailure(e, args);\n    });\n  };\n\n  Render.prototype.getFData = function (deferred) {\n    this.parent.notify(events.getForeignKeyData, {\n      isComplex: true,\n      promise: deferred\n    });\n    return deferred.promise;\n  };\n\n  Render.prototype.isNeedForeignAction = function () {\n    var gObj = this.parent;\n    return !!(gObj.allowFiltering && gObj.filterSettings.columns.length || gObj.searchSettings.key.length) && this.foreignKey(this.parent.getForeignKeyColumns());\n  };\n\n  Render.prototype.foreignKey = function (columns) {\n    var _this = this;\n\n    return columns.some(function (col) {\n      var fbool = false;\n      fbool = _this.parent.filterSettings.columns.some(function (value) {\n        return col.uid === value.uid;\n      });\n      return !!(fbool || _this.parent.searchSettings.key.length);\n    });\n  };\n\n  Render.prototype.sendBulkRequest = function (args) {\n    var _this = this;\n\n    args.requestType = 'batchsave';\n    var promise = this.data.saveChanges(args.changes, this.parent.getPrimaryKeyFieldNames()[0], args.original);\n\n    if (isBlazor() && !this.parent.isJsComponent) {\n      promise.then(function (e) {\n        _this.parent.notify('editsuccess', args);\n      });\n    } else {\n      var query_1 = this.data.generateQuery().requiresCount();\n\n      if (this.data.dataManager.dataSource.offline) {\n        this.refreshDataManager({\n          requestType: 'batchsave'\n        });\n        return;\n      } else {\n        promise.then(function (e) {\n          _this.data.getData(args, query_1).then(function (e) {\n            return _this.dmSuccess(e, args);\n          }).catch(function (e) {\n            return _this.dmFailure(e, args);\n          });\n        }).catch(function (e) {\n          return _this.dmFailure(e, args);\n        });\n      }\n    }\n  };\n\n  Render.prototype.dmSuccess = function (e, args) {\n    this.dataManagerSuccess(e, args);\n  };\n\n  Render.prototype.dmFailure = function (e, args) {\n    this.dataManagerFailure(e, args);\n  };\n  /**\n   * Render empty row to Grid which is used at the time to represent to no records.\n   * @return {void}\n   * @hidden\n   */\n\n\n  Render.prototype.renderEmptyRow = function () {\n    this.emptyRow(true);\n  };\n\n  Render.prototype.emptyRow = function (isTrigger) {\n    var gObj = this.parent;\n    var tbody = this.contentRenderer.getTable().querySelector('tbody');\n    var tr;\n\n    if (!isNullOrUndefined(tbody)) {\n      remove(tbody);\n    }\n\n    tbody = this.parent.createElement('tbody');\n    var spanCount = 0;\n\n    if (gObj.detailTemplate || gObj.childGrid) {\n      ++spanCount;\n    }\n\n    tr = this.parent.createElement('tr', {\n      className: 'e-emptyrow'\n    });\n    tr.appendChild(this.parent.createElement('td', {\n      innerHTML: this.l10n.getConstant('EmptyRecord'),\n      attrs: {\n        colspan: (gObj.getColumns().length + spanCount).toString()\n      }\n    }));\n    tbody.appendChild(tr);\n    this.contentRenderer.renderEmpty(tbody);\n\n    if (isTrigger) {\n      this.parent.trigger(events.dataBound, {});\n      this.parent.notify(events.onEmpty, {\n        rows: [new Row({\n          isDataRow: true,\n          cells: [new Cell({\n            isDataCell: true,\n            visible: true\n          })]\n        })]\n      });\n    }\n  };\n\n  Render.prototype.dynamicColumnChange = function () {\n    if (this.parent.getCurrentViewRecords().length) {\n      this.updateColumnType(this.parent.getCurrentViewRecords()[0]);\n    }\n  };\n\n  Render.prototype.updateColumnType = function (record) {\n    var columns = this.parent.getColumns();\n    var value;\n    var cFormat = 'customFormat';\n    var equalTo = 'equalTo';\n    var data = record && record.items ? record.items[0] : record;\n    var fmtr = this.locator.getService('valueFormatter');\n\n    for (var i = 0, len = columns.length; i < len; i++) {\n      value = getObject(columns[i].field || '', data);\n\n      if (!isNullOrUndefined(columns[i][cFormat])) {\n        columns[i].format = columns[i][cFormat];\n      }\n\n      if (!isNullOrUndefined(columns[i].validationRules) && !isNullOrUndefined(columns[i].validationRules[equalTo])) {\n        columns[i].validationRules[equalTo][0] = this.parent.element.id + columns[i].validationRules[equalTo][0];\n      }\n\n      if (columns[i].isForeignColumn() && columns[i].columnData) {\n        value = getObject(columns[i].foreignKeyValue || '', columns[i].columnData[0]);\n      }\n\n      if (!isNullOrUndefined(value)) {\n        this.isColTypeDef = true;\n\n        if (!columns[i].type) {\n          columns[i].type = value.getDay ? value.getHours() > 0 || value.getMinutes() > 0 || value.getSeconds() > 0 || value.getMilliseconds() > 0 ? 'datetime' : 'date' : typeof value;\n        }\n      } else {\n        columns[i].type = columns[i].type || null;\n      }\n\n      var valueFormatter = new ValueFormatter();\n\n      if (columns[i].format && (columns[i].format.skeleton || columns[i].format.format)) {\n        columns[i].setFormatter(valueFormatter.getFormatFunction(columns[i].format));\n        columns[i].setParser(valueFormatter.getParserFunction(columns[i].format));\n      }\n\n      if (typeof columns[i].format === 'string') {\n        var isServerRendered = 'isServerRendered';\n        var isServerDateMap = this.parent[isServerRendered] || this.parent.printModule.isPrintGrid();\n        setFormatter(this.locator, columns[i], isServerDateMap);\n      } else if (!columns[i].format && columns[i].type === 'number') {\n        columns[i].setParser(fmtr.getParserFunction({\n          format: 'n2'\n        }));\n      }\n    }\n  };\n  /** @hidden */\n\n\n  Render.prototype.dataManagerSuccess = function (e, args) {\n    var _this = this;\n\n    var gObj = this.parent;\n    this.contentRenderer = this.renderer.getRenderer(RenderType.Content);\n    this.headerRenderer = this.renderer.getRenderer(RenderType.Header);\n    e.actionArgs = args;\n    gObj.trigger(events.beforeDataBound, e, function (dataArgs) {\n      if (dataArgs.cancel) {\n        return;\n      }\n\n      dataArgs.result = isNullOrUndefined(dataArgs.result) ? [] : dataArgs.result;\n      var len = Object.keys(dataArgs.result).length;\n\n      if (_this.parent.isDestroyed) {\n        return;\n      }\n\n      if (!gObj.getColumns().length && !len && !(gObj.columns.length && gObj.columns[0] instanceof Column)) {\n        gObj.hideSpinner();\n        return;\n      }\n\n      _this.parent.isEdit = false;\n\n      _this.parent.notify(events.tooltipDestroy, {});\n\n      gObj.currentViewData = dataArgs.result;\n\n      if (isBlazor() && gObj.filterSettings.type === 'FilterBar' && !isNullOrUndefined(args) && args.requestType === 'filtering' && !dataArgs.result.length) {\n        var gridColumns = gObj.getColumns();\n\n        for (var i = 0; i < gridColumns.length; i++) {\n          if (gridColumns[i].filterTemplate) {\n            var tempID = gObj.element.id + gridColumns[i].uid + 'filterTemplate';\n            resetBlazorTemplate(tempID, 'FilterTemplate');\n            var fieldName = gridColumns[i].field;\n            var filteredColumns = gObj.filterSettings.columns;\n\n            for (var k = 0; k < filteredColumns.length; k++) {\n              if (fieldName === filteredColumns[k].field) {\n                blazorTemplates[tempID][0][fieldName] = filteredColumns[k].value;\n              }\n            }\n\n            updateBlazorTemplate(tempID, 'FilterTemplate', gridColumns[i], false);\n          }\n        }\n      }\n\n      if (!len && dataArgs.count && gObj.allowPaging && args && args.requestType !== 'delete') {\n        gObj.prevPageMoving = true;\n        gObj.pageSettings.totalRecordsCount = dataArgs.count;\n\n        if (args.requestType !== 'paging') {\n          gObj.pageSettings.currentPage = Math.ceil(dataArgs.count / gObj.pageSettings.pageSize);\n        }\n\n        gObj.dataBind();\n        return;\n      }\n\n      if ((!gObj.getColumns().length && len || !_this.isLayoutRendered) && !isGroupAdaptive(gObj)) {\n        _this.updatesOnInitialRender(dataArgs);\n      }\n\n      if (!_this.isColTypeDef && gObj.getCurrentViewRecords()) {\n        _this.updateColumnType(gObj.getCurrentViewRecords()[0]);\n      }\n\n      if (!_this.parent.isInitialLoad && _this.parent.groupSettings.disablePageWiseAggregates && !_this.parent.groupSettings.columns.length) {\n        dataArgs.result = _this.parent.dataSource instanceof Array ? _this.parent.dataSource : _this.parent.currentViewData;\n      }\n\n      _this.parent.notify(events.dataReady, extend({\n        count: dataArgs.count,\n        result: dataArgs.result,\n        aggregates: dataArgs.aggregates\n      }, args));\n\n      if ((gObj.groupSettings.columns.length || args && args.requestType === 'ungrouping') && args && args.requestType !== 'filtering') {\n        _this.headerRenderer.refreshUI();\n      }\n\n      if (len) {\n        if (isGroupAdaptive(gObj)) {\n          var content = 'content';\n          args.scrollTop = {\n            top: _this.contentRenderer[content].scrollTop\n          };\n        }\n\n        _this.contentRenderer.refreshContentRows(args);\n      } else {\n        if (!gObj.getColumns().length) {\n          gObj.element.innerHTML = '';\n          alert(_this.l10n.getConstant('EmptyDataSourceError')); //ToDO: change this alert as dialog\n\n          return;\n        }\n\n        _this.contentRenderer.setRowElements([]);\n\n        _this.contentRenderer.setRowObjects([]);\n\n        _this.ariaService.setBusy(_this.parent.getContent().querySelector('.e-content'), false);\n\n        _this.renderEmptyRow();\n\n        if (args) {\n          var action = (args.requestType || '').toLowerCase() + '-complete';\n\n          _this.parent.notify(action, args);\n\n          if (args.requestType === 'batchsave') {\n            args.cancel = false;\n            args.rows = [];\n            args.isFrozen = _this.parent.getFrozenColumns() !== 0 && !args.isFrozen;\n\n            _this.parent.trigger(events.actionComplete, args);\n          }\n        }\n\n        _this.parent.hideSpinner();\n      }\n\n      _this.parent.notify(events.toolbarRefresh, {});\n    });\n  };\n  /** @hidden */\n\n\n  Render.prototype.dataManagerFailure = function (e, args) {\n    this.ariaService.setOptions(this.parent.getContent().querySelector('.e-content'), {\n      busy: false,\n      invalid: true\n    });\n    this.parent.trigger(events.actionFailure, {\n      error: e\n    });\n    this.parent.hideSpinner();\n\n    if (args.requestType === 'save' || args.requestType === 'delete' || args.name === 'bulk-save') {\n      return;\n    }\n\n    this.parent.currentViewData = [];\n    this.renderEmptyRow();\n    this.parent.log('actionfailure', {\n      error: e\n    });\n  };\n\n  Render.prototype.updatesOnInitialRender = function (e) {\n    this.isLayoutRendered = true;\n\n    if (this.parent.columns.length < 1) {\n      this.buildColumns(e.result[0]);\n    }\n\n    prepareColumns(this.parent.columns);\n    this.headerRenderer.renderTable();\n    this.contentRenderer.renderTable();\n    this.parent.isAutoGen = true;\n    this.parent.notify(events.autoCol, {});\n  };\n\n  Render.prototype.iterateComplexColumns = function (obj, field, split) {\n    var keys = Object.keys(obj);\n\n    for (var i = 0; i < keys.length; i++) {\n      var childKeys = typeof obj[keys[i]] === 'object' && obj[keys[i]] && !(obj[keys[i]] instanceof Date) ? Object.keys(obj[keys[i]]) : [];\n\n      if (childKeys.length) {\n        this.iterateComplexColumns(obj[keys[i]], field + (keys[i] + '.'), split);\n      } else {\n        split[this.counter] = field + keys[i];\n        this.counter++;\n      }\n    }\n  };\n\n  Render.prototype.buildColumns = function (record) {\n    var cols = [];\n    var complexCols = {};\n    this.iterateComplexColumns(record, '', complexCols);\n    var columns = Object.keys(complexCols).filter(function (e) {\n      return complexCols[e] !== 'BlazId';\n    }).map(function (field) {\n      return complexCols[field];\n    });\n\n    for (var i = 0, len = columns.length; i < len; i++) {\n      cols[i] = {\n        'field': columns[i]\n      };\n\n      if (this.parent.enableColumnVirtualization) {\n        cols[i].width = !isNullOrUndefined(cols[i].width) ? cols[i].width : 200;\n      }\n    }\n\n    this.parent.setProperties({\n      'columns': cols\n    }, true);\n  };\n\n  Render.prototype.instantiateRenderer = function () {\n    this.renderer.addRenderer(RenderType.Header, new HeaderRender(this.parent, this.locator));\n    this.renderer.addRenderer(RenderType.Content, new ContentRender(this.parent, this.locator));\n    var cellrender = this.locator.getService('cellRendererFactory');\n    cellrender.addCellRenderer(CellType.Header, new HeaderCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.Data, new CellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.StackedHeader, new StackedHeaderCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.Indent, new IndentCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.GroupCaption, new GroupCaptionCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.GroupCaptionEmpty, new GroupCaptionEmptyCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.Expand, new ExpandCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.HeaderIndent, new HeaderIndentCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.StackedHeader, new StackedHeaderCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.DetailHeader, new DetailHeaderIndentCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.RowDragHIcon, new RowDragDropHeaderRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.DetailExpand, new DetailExpandCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.DetailFooterIntent, new IndentCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.RowDragIcon, new RowDragDropRenderer(this.parent, this.locator));\n  };\n\n  Render.prototype.addEventListener = function () {\n    var _this = this;\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.initialLoad, this.instantiateRenderer, this);\n    this.parent.on('refreshdataSource', this.dataManagerSuccess, this);\n    this.parent.on(events.modelChanged, this.refresh, this);\n    this.parent.on(events.refreshComplete, this.refreshComplete, this);\n    this.parent.on(events.bulkSave, this.sendBulkRequest, this);\n    this.parent.on(events.showEmptyGrid, function () {\n      _this.emptyGrid = true;\n    }, this);\n    this.parent.on(events.autoCol, this.dynamicColumnChange, this);\n  };\n  /** @hidden */\n\n\n  Render.prototype.validateGroupRecords = function (e) {\n    var _this = this;\n\n    var index = e.result.length - 1;\n\n    if (index < 0) {\n      return Promise.resolve(e);\n    }\n\n    var group0 = e.result[0];\n    var groupN = e.result[index];\n    var predicate = [];\n\n    var addWhere = function (input) {\n      [group0, groupN].forEach(function (group) {\n        return predicate.push(new Predicate('field', '==', group.field).and(_this.getPredicate('key', 'equal', group.key)));\n      });\n      input.where(Predicate.or(predicate));\n    };\n\n    var query = new Query();\n    addWhere(query);\n    var curDm = new DataManager(e.result);\n    var curFilter = curDm.executeLocal(query);\n    var newQuery = this.data.generateQuery(true);\n    var rPredicate = [];\n\n    if (this.data.isRemote() || isBlazor()) {\n      [group0, groupN].forEach(function (group) {\n        return rPredicate.push(_this.getPredicate(group.field, 'equal', group.key));\n      });\n      newQuery.where(Predicate.or(rPredicate));\n    } else {\n      addWhere(newQuery);\n    }\n\n    var deferred = new Deferred();\n    this.data.getData({}, newQuery).then(function (r) {\n      _this.updateGroupInfo(curFilter, r.result);\n\n      deferred.resolve(e);\n    }).catch(function (e) {\n      return deferred.reject(e);\n    });\n    return deferred.promise;\n  };\n\n  Render.prototype.getPredicate = function (key, operator, value) {\n    if (value instanceof Date) {\n      return getDatePredicate({\n        field: key,\n        operator: operator,\n        value: value\n      });\n    }\n\n    return new Predicate(key, operator, value);\n  };\n\n  Render.prototype.updateGroupInfo = function (current, untouched) {\n    var _this = this;\n\n    var dm = new DataManager(untouched);\n    current.forEach(function (element, index, array) {\n      var uGroup = dm.executeLocal(new Query().where(new Predicate('field', '==', element.field).and(_this.getPredicate('key', 'equal', element.key))))[0];\n      element.count = uGroup.count;\n      var itemGroup = element.items;\n      var uGroupItem = uGroup.items;\n\n      if (itemGroup.GroupGuid) {\n        element.items = _this.updateGroupInfo(element.items, uGroup.items);\n      }\n\n      _this.parent.aggregates.forEach(function (row) {\n        return row.columns.forEach(function (column) {\n          var types = column.type instanceof Array ? column.type : [column.type];\n          types.forEach(function (type) {\n            var key = column.field + ' - ' + type.toLowerCase();\n            var data = itemGroup.level ? uGroupItem.records : uGroup.items;\n            var context = _this.parent;\n\n            if (type === 'Custom') {\n              var data_1 = itemGroup.level ? uGroupItem : uGroup;\n              element.aggregates[key] = column.customAggregate ? column.customAggregate.call(context, data_1, column) : '';\n            } else {\n              element.aggregates[key] = DataUtil.aggregates[type.toLowerCase()](data, column.field);\n            }\n          });\n        });\n      });\n    });\n    return current;\n  };\n\n  return Render;\n}();\n\nexport { Render };","map":{"version":3,"sources":["C:/CN2/workspace-trunk/kain-front-end/node_modules/@syncfusion/ej2-grids/src/grid/renderer/render.js"],"names":["remove","resetBlazorTemplate","updateBlazorTemplate","blazorTemplates","isBlazor","isNullOrUndefined","extend","DataManager","Query","Deferred","Predicate","DataUtil","ValueFormatter","RenderType","CellType","Data","Column","Row","Cell","events","prepareColumns","setFormatter","isGroupAdaptive","getDatePredicate","getObject","ContentRender","HeaderRender","CellRenderer","HeaderCellRenderer","StackedHeaderCellRenderer","IndentCellRenderer","GroupCaptionCellRenderer","GroupCaptionEmptyCellRenderer","ExpandCellRenderer","HeaderIndentCellRenderer","DetailHeaderIndentCellRenderer","DetailExpandCellRenderer","RowDragDropRenderer","RowDragDropHeaderRenderer","Render","parent","locator","emptyGrid","counter","data","l10n","getService","ariaService","renderer","addEventListener","prototype","render","gObj","isServerRendered","headerRenderer","getRenderer","Header","contentRenderer","Content","renderPanel","getColumns","length","isLayoutRendered","renderTable","emptyRow","scrollModule","setWidth","setHeight","height","setPadding","refreshDataManager","refresh","e","_this","requestType","preventUpdate","notify","resetTemplates","bulkChanges","dataSource","columns","target","editSettings","mode","isEdit","trigger","actionBegin","args","isJsComponent","getSelectedRecords","cancel","cancelBegin","allowPaging","dataLength","count","pageSettings","totalRecordsCount","currentViewData","prevPageMoving","setProperties","currentPage","Math","ceil","pageSize","pagerModule","pagerObj","currentAction","showSpinner","addDeleteAction","allowServerDataBinding","serverDataBind","gridColumns","detailTemplate","detailTemplateID","element","id","groupSettings","captionTemplate","rowTemplate","toolbarTemplate","template","i","uid","headerTemplate","filterTemplate","guid","k","aggregates","j","footerTemplate","tempID","groupFooterTemplate","groupCaptionTemplate","refreshComplete","rows","actionComplete","dataManager","isFActon","isNeedForeignAction","setBusy","getContent","querySelector","deffered","getFData","getData","generateQuery","requiresCount","then","query","def","resolve","result","promise","getForeignKeyColumns","searchSettings","key","deffered_1","getForeignKeyData","disablePageWiseAggregates","validateGroupRecords","dataManagerSuccess","catch","dataManagerFailure","deferred","isComplex","allowFiltering","filterSettings","foreignKey","some","col","fbool","value","sendBulkRequest","saveChanges","changes","getPrimaryKeyFieldNames","original","query_1","offline","dmSuccess","dmFailure","renderEmptyRow","isTrigger","tbody","getTable","tr","createElement","spanCount","childGrid","className","appendChild","innerHTML","getConstant","attrs","colspan","toString","renderEmpty","dataBound","onEmpty","isDataRow","cells","isDataCell","visible","dynamicColumnChange","getCurrentViewRecords","updateColumnType","record","cFormat","equalTo","items","fmtr","len","field","format","validationRules","isForeignColumn","columnData","foreignKeyValue","isColTypeDef","type","getDay","getHours","getMinutes","getSeconds","getMilliseconds","valueFormatter","skeleton","getFormatFunction","setParser","getParserFunction","isServerDateMap","printModule","isPrintGrid","actionArgs","beforeDataBound","dataArgs","Object","keys","isDestroyed","hideSpinner","tooltipDestroy","fieldName","filteredColumns","dataBind","updatesOnInitialRender","isInitialLoad","Array","dataReady","refreshUI","content","scrollTop","top","refreshContentRows","alert","setRowElements","setRowObjects","action","toLowerCase","isFrozen","getFrozenColumns","toolbarRefresh","setOptions","busy","invalid","actionFailure","error","name","log","buildColumns","isAutoGen","autoCol","iterateComplexColumns","obj","split","childKeys","Date","cols","complexCols","filter","map","enableColumnVirtualization","width","instantiateRenderer","addRenderer","cellrender","addCellRenderer","StackedHeader","Indent","GroupCaption","GroupCaptionEmpty","Expand","HeaderIndent","DetailHeader","RowDragHIcon","DetailExpand","DetailFooterIntent","RowDragIcon","on","initialLoad","modelChanged","bulkSave","showEmptyGrid","index","Promise","group0","groupN","predicate","addWhere","input","forEach","group","push","and","getPredicate","where","or","curDm","curFilter","executeLocal","newQuery","rPredicate","isRemote","r","updateGroupInfo","reject","operator","current","untouched","dm","array","uGroup","itemGroup","uGroupItem","GroupGuid","row","column","types","level","records","context","data_1","customAggregate","call"],"mappings":"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","sourcesContent":["import { remove, resetBlazorTemplate, updateBlazorTemplate, blazorTemplates, isBlazor } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Deferred, Predicate, DataUtil } from '@syncfusion/ej2-data';\nimport { ValueFormatter } from '../services/value-formatter';\nimport { RenderType, CellType } from '../base/enum';\nimport { Data } from '../actions/data';\nimport { Column } from '../models/column';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport * as events from '../base/constant';\nimport { prepareColumns, setFormatter, isGroupAdaptive, getDatePredicate, getObject } from '../base/util';\nimport { ContentRender } from '../renderer/content-renderer';\nimport { HeaderRender } from '../renderer/header-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { HeaderCellRenderer } from '../renderer/header-cell-renderer';\nimport { StackedHeaderCellRenderer } from '../renderer/stacked-cell-renderer';\nimport { IndentCellRenderer } from '../renderer/indent-cell-renderer';\nimport { GroupCaptionCellRenderer, GroupCaptionEmptyCellRenderer } from '../renderer/caption-cell-renderer';\nimport { ExpandCellRenderer } from '../renderer/expand-cell-renderer';\nimport { HeaderIndentCellRenderer } from '../renderer/header-indent-renderer';\nimport { DetailHeaderIndentCellRenderer } from '../renderer/detail-header-indent-renderer';\nimport { DetailExpandCellRenderer } from '../renderer/detail-expand-cell-renderer';\nimport { RowDragDropRenderer } from './row-drag-drop-renderer';\nimport { RowDragDropHeaderRenderer } from '../renderer/row-drag-header-indent-render';\n/**\n * Content module is used to render grid content\n * @hidden\n */\nvar Render = /** @class */ (function () {\n    /**\n     * Constructor for render module\n     */\n    function Render(parent, locator) {\n        this.emptyGrid = false;\n        this.counter = 0;\n        this.parent = parent;\n        this.locator = locator;\n        this.data = new Data(parent, locator);\n        this.l10n = locator.getService('localization');\n        this.ariaService = this.locator.getService('ariaService');\n        this.renderer = this.locator.getService('rendererFactory');\n        this.addEventListener();\n    }\n    /**\n     * To initialize grid header, content and footer rendering\n     */\n    Render.prototype.render = function () {\n        var gObj = this.parent;\n        var isServerRendered = 'isServerRendered';\n        this.headerRenderer = this.renderer.getRenderer(RenderType.Header);\n        this.contentRenderer = this.renderer.getRenderer(RenderType.Content);\n        this.headerRenderer.renderPanel();\n        this.contentRenderer.renderPanel();\n        if (gObj.getColumns().length) {\n            this.isLayoutRendered = true;\n            this.headerRenderer.renderTable();\n            this.contentRenderer.renderTable();\n            this.emptyRow(false);\n        }\n        this.parent.scrollModule.setWidth();\n        this.parent.scrollModule.setHeight();\n        if (this.parent.height !== 'auto') {\n            this.parent.scrollModule.setPadding();\n        }\n        if (!(isBlazor() && this.parent[isServerRendered])) {\n            this.refreshDataManager();\n        }\n    };\n    /**\n     * Refresh the entire Grid.\n     * @return {void}\n     */\n    Render.prototype.refresh = function (e) {\n        var _this = this;\n        if (e === void 0) { e = { requestType: 'refresh' }; }\n        var gObj = this.parent;\n        var preventUpdate = 'preventUpdate';\n        gObj.notify(e.requestType + \"-begin\", e);\n        if (isBlazor()) {\n            this.resetTemplates();\n        }\n        if (isBlazor() && gObj.isServerRendered) {\n            var bulkChanges = 'bulkChanges';\n            if (gObj[bulkChanges].dataSource) {\n                delete gObj[bulkChanges].dataSource;\n            }\n            gObj.notify('blazor-action-begin', e);\n            if (e.requestType === 'filtering') {\n                var columns = 'columns';\n                e[columns] = null;\n            }\n            if (e.requestType === 'sorting') {\n                var target = 'target';\n                e[target] = null;\n            }\n            if (gObj.editSettings.mode === 'Normal' && gObj.isEdit) {\n                gObj.notify('closeinline', {});\n            }\n            else if (gObj.editSettings.mode === 'Batch' && !gObj.isEdit) {\n                gObj.notify('closebatch', {});\n            }\n        }\n        gObj.trigger(events.actionBegin, e, function (args) {\n            if (args === void 0) { args = { requestType: 'refresh' }; }\n            if (args.requestType === 'delete' && isBlazor() && !gObj.isJsComponent) {\n                var data = 'data';\n                args[data] = gObj.getSelectedRecords();\n            }\n            if (args.cancel) {\n                gObj.notify(events.cancelBegin, args);\n                return;\n            }\n            if (args.requestType === 'delete' && gObj.allowPaging) {\n                var dataLength = args.data.length;\n                var count = gObj.pageSettings.totalRecordsCount - dataLength;\n                if (!(gObj.currentViewData.length - dataLength) && count) {\n                    gObj.prevPageMoving = true;\n                    gObj.setProperties({\n                        pageSettings: {\n                            totalRecordsCount: count, currentPage: Math.ceil(count / gObj.pageSettings.pageSize)\n                        }\n                    }, true);\n                    gObj.pagerModule.pagerObj.totalRecordsCount = count;\n                }\n            }\n            if (isBlazor() && _this.parent.isServerRendered) {\n                if (_this.parent[preventUpdate]) {\n                    return;\n                }\n                if (e.requestType === 'refresh') {\n                    _this.parent.currentAction = e;\n                }\n                if (args.requestType !== 'virtualscroll') {\n                    _this.parent.showSpinner();\n                }\n                if (args.requestType === 'delete' || args.requestType === 'save') {\n                    _this.parent.notify(events.addDeleteAction, args);\n                    _this.parent.notify('add-delete-success', args);\n                }\n                else {\n                    _this.parent.allowServerDataBinding = true;\n                    _this.parent.serverDataBind();\n                    _this.parent.allowServerDataBinding = false;\n                }\n            }\n            else {\n                _this.refreshDataManager(args);\n            }\n        });\n    };\n    Render.prototype.resetTemplates = function () {\n        var gObj = this.parent;\n        var gridColumns = gObj.getColumns();\n        if (gObj.detailTemplate) {\n            var detailTemplateID = gObj.element.id + 'detailTemplate';\n            blazorTemplates[detailTemplateID] = [];\n            resetBlazorTemplate(detailTemplateID, 'DetailTemplate');\n        }\n        if (gObj.groupSettings.captionTemplate) {\n            resetBlazorTemplate(gObj.element.id + 'captionTemplate', 'CaptionTemplate');\n        }\n        if (gObj.rowTemplate) {\n            resetBlazorTemplate(gObj.element.id + 'rowTemplate', 'RowTemplate');\n        }\n        if (gObj.toolbarTemplate) {\n            resetBlazorTemplate(gObj.element.id + 'toolbarTemplate', 'ToolbarTemplate');\n        }\n        if (gObj.pageSettings.template) {\n            resetBlazorTemplate(gObj.element.id + '_template', 'pageSettings');\n        }\n        for (var i = 0; i < gridColumns.length; i++) {\n            if (gridColumns[i].template) {\n                blazorTemplates[gObj.element.id + gridColumns[i].uid] = [];\n                resetBlazorTemplate(gObj.element.id + gridColumns[i].uid, 'Template');\n            }\n            if (gridColumns[i].headerTemplate) {\n                resetBlazorTemplate(gObj.element.id + gridColumns[i].uid + 'headerTemplate', 'HeaderTemplate');\n            }\n            if (gridColumns[i].filterTemplate) {\n                resetBlazorTemplate(gObj.element.id + gridColumns[i].uid + 'filterTemplate', 'FilterTemplate');\n            }\n        }\n        var guid = 'guid';\n        for (var k = 0; k < gObj.aggregates.length; k++) {\n            for (var j = 0; j < gObj.aggregates[k].columns.length; j++) {\n                if (gObj.aggregates[k].columns[j].footerTemplate) {\n                    var tempID = gObj.element.id + gObj.aggregates[k].columns[j][guid] + 'footerTemplate';\n                    resetBlazorTemplate(tempID, 'FooterTemplate');\n                }\n                if (gObj.aggregates[k].columns[j].groupFooterTemplate) {\n                    var tempID = gObj.element.id + gObj.aggregates[k].columns[j][guid] + 'groupFooterTemplate';\n                    resetBlazorTemplate(tempID, 'GroupFooterTemplate');\n                }\n                if (gObj.aggregates[k].columns[j].groupCaptionTemplate) {\n                    var tempID = gObj.element.id + gObj.aggregates[k].columns[j][guid] + 'groupCaptionTemplate';\n                    resetBlazorTemplate(tempID, 'GroupCaptionTemplate');\n                }\n            }\n        }\n    };\n    Render.prototype.refreshComplete = function (e) {\n        if (isBlazor() && !this.parent.isJsComponent) {\n            e.rows = null;\n        }\n        this.parent.trigger(events.actionComplete, e);\n    };\n    /**\n     * The function is used to refresh the dataManager\n     * @return {void}\n     */\n    Render.prototype.refreshDataManager = function (args) {\n        var _this = this;\n        if (args === void 0) { args = {}; }\n        if (args.requestType !== 'virtualscroll') {\n            this.parent.showSpinner();\n        }\n        this.emptyGrid = false;\n        var dataManager;\n        var isFActon = this.isNeedForeignAction();\n        this.ariaService.setBusy(this.parent.getContent().querySelector('.e-content'), true);\n        if (isFActon) {\n            var deffered = new Deferred();\n            dataManager = this.getFData(deffered);\n        }\n        if (!dataManager) {\n            dataManager = this.data.getData(args, this.data.generateQuery().requiresCount());\n        }\n        else {\n            dataManager = dataManager.then(function (e) {\n                var query = _this.data.generateQuery().requiresCount();\n                if (_this.emptyGrid) {\n                    var def = new Deferred();\n                    def.resolve({ result: [], count: 0 });\n                    return def.promise;\n                }\n                return _this.data.getData(args, query);\n            });\n        }\n        if (this.parent.getForeignKeyColumns().length && (!isFActon || this.parent.searchSettings.key.length)) {\n            var deffered_1 = new Deferred();\n            dataManager = dataManager.then(function (e) {\n                _this.parent.notify(events.getForeignKeyData, { dataManager: dataManager, result: e, promise: deffered_1 });\n                return deffered_1.promise;\n            });\n        }\n        if (this.parent.groupSettings.disablePageWiseAggregates && this.parent.groupSettings.columns.length) {\n            dataManager = dataManager.then(function (e) { return _this.validateGroupRecords(e); });\n        }\n        dataManager.then(function (e) { return _this.dataManagerSuccess(e, args); })\n            .catch(function (e) { return _this.dataManagerFailure(e, args); });\n    };\n    Render.prototype.getFData = function (deferred) {\n        this.parent.notify(events.getForeignKeyData, { isComplex: true, promise: deferred });\n        return deferred.promise;\n    };\n    Render.prototype.isNeedForeignAction = function () {\n        var gObj = this.parent;\n        return !!((gObj.allowFiltering && gObj.filterSettings.columns.length) ||\n            (gObj.searchSettings.key.length)) && this.foreignKey(this.parent.getForeignKeyColumns());\n    };\n    Render.prototype.foreignKey = function (columns) {\n        var _this = this;\n        return columns.some(function (col) {\n            var fbool = false;\n            fbool = _this.parent.filterSettings.columns.some(function (value) {\n                return col.uid === value.uid;\n            });\n            return !!(fbool || _this.parent.searchSettings.key.length);\n        });\n    };\n    Render.prototype.sendBulkRequest = function (args) {\n        var _this = this;\n        args.requestType = 'batchsave';\n        var promise = this.data.saveChanges(args.changes, this.parent.getPrimaryKeyFieldNames()[0], args.original);\n        if (isBlazor() && !this.parent.isJsComponent) {\n            promise.then(function (e) {\n                _this.parent.notify('editsuccess', args);\n            });\n        }\n        else {\n            var query_1 = this.data.generateQuery().requiresCount();\n            if (this.data.dataManager.dataSource.offline) {\n                this.refreshDataManager({ requestType: 'batchsave' });\n                return;\n            }\n            else {\n                promise.then(function (e) {\n                    _this.data.getData(args, query_1)\n                        .then(function (e) { return _this.dmSuccess(e, args); })\n                        .catch(function (e) { return _this.dmFailure(e, args); });\n                })\n                    .catch(function (e) { return _this.dmFailure(e, args); });\n            }\n        }\n    };\n    Render.prototype.dmSuccess = function (e, args) {\n        this.dataManagerSuccess(e, args);\n    };\n    Render.prototype.dmFailure = function (e, args) {\n        this.dataManagerFailure(e, args);\n    };\n    /**\n     * Render empty row to Grid which is used at the time to represent to no records.\n     * @return {void}\n     * @hidden\n     */\n    Render.prototype.renderEmptyRow = function () {\n        this.emptyRow(true);\n    };\n    Render.prototype.emptyRow = function (isTrigger) {\n        var gObj = this.parent;\n        var tbody = this.contentRenderer.getTable().querySelector('tbody');\n        var tr;\n        if (!isNullOrUndefined(tbody)) {\n            remove(tbody);\n        }\n        tbody = this.parent.createElement('tbody');\n        var spanCount = 0;\n        if (gObj.detailTemplate || gObj.childGrid) {\n            ++spanCount;\n        }\n        tr = this.parent.createElement('tr', { className: 'e-emptyrow' });\n        tr.appendChild(this.parent.createElement('td', {\n            innerHTML: this.l10n.getConstant('EmptyRecord'),\n            attrs: { colspan: (gObj.getColumns().length + spanCount).toString() }\n        }));\n        tbody.appendChild(tr);\n        this.contentRenderer.renderEmpty(tbody);\n        if (isTrigger) {\n            this.parent.trigger(events.dataBound, {});\n            this.parent.notify(events.onEmpty, { rows: [new Row({ isDataRow: true, cells: [new Cell({ isDataCell: true, visible: true })] })] });\n        }\n    };\n    Render.prototype.dynamicColumnChange = function () {\n        if (this.parent.getCurrentViewRecords().length) {\n            this.updateColumnType(this.parent.getCurrentViewRecords()[0]);\n        }\n    };\n    Render.prototype.updateColumnType = function (record) {\n        var columns = this.parent.getColumns();\n        var value;\n        var cFormat = 'customFormat';\n        var equalTo = 'equalTo';\n        var data = record && record.items ? record.items[0] : record;\n        var fmtr = this.locator.getService('valueFormatter');\n        for (var i = 0, len = columns.length; i < len; i++) {\n            value = getObject(columns[i].field || '', data);\n            if (!isNullOrUndefined(columns[i][cFormat])) {\n                columns[i].format = columns[i][cFormat];\n            }\n            if (!isNullOrUndefined(columns[i].validationRules) && !isNullOrUndefined(columns[i].validationRules[equalTo])) {\n                columns[i].validationRules[equalTo][0] = this.parent.element.id + columns[i].validationRules[equalTo][0];\n            }\n            if (columns[i].isForeignColumn() && columns[i].columnData) {\n                value = getObject(columns[i].foreignKeyValue || '', columns[i].columnData[0]);\n            }\n            if (!isNullOrUndefined(value)) {\n                this.isColTypeDef = true;\n                if (!columns[i].type) {\n                    columns[i].type = value.getDay ? (value.getHours() > 0 || value.getMinutes() > 0 ||\n                        value.getSeconds() > 0 || value.getMilliseconds() > 0 ? 'datetime' : 'date') : typeof (value);\n                }\n            }\n            else {\n                columns[i].type = columns[i].type || null;\n            }\n            var valueFormatter = new ValueFormatter();\n            if (columns[i].format && (columns[i].format.skeleton || columns[i].format.format)) {\n                columns[i].setFormatter(valueFormatter.getFormatFunction(columns[i].format));\n                columns[i].setParser(valueFormatter.getParserFunction(columns[i].format));\n            }\n            if (typeof (columns[i].format) === 'string') {\n                var isServerRendered = 'isServerRendered';\n                var isServerDateMap = this.parent[isServerRendered] || this.parent.printModule.isPrintGrid();\n                setFormatter(this.locator, columns[i], isServerDateMap);\n            }\n            else if (!columns[i].format && columns[i].type === 'number') {\n                columns[i].setParser(fmtr.getParserFunction({ format: 'n2' }));\n            }\n        }\n    };\n    /** @hidden */\n    Render.prototype.dataManagerSuccess = function (e, args) {\n        var _this = this;\n        var gObj = this.parent;\n        this.contentRenderer = this.renderer.getRenderer(RenderType.Content);\n        this.headerRenderer = this.renderer.getRenderer(RenderType.Header);\n        e.actionArgs = args;\n        gObj.trigger(events.beforeDataBound, e, function (dataArgs) {\n            if (dataArgs.cancel) {\n                return;\n            }\n            dataArgs.result = isNullOrUndefined(dataArgs.result) ? [] : dataArgs.result;\n            var len = Object.keys(dataArgs.result).length;\n            if (_this.parent.isDestroyed) {\n                return;\n            }\n            if ((!gObj.getColumns().length && !len) && !(gObj.columns.length && gObj.columns[0] instanceof Column)) {\n                gObj.hideSpinner();\n                return;\n            }\n            _this.parent.isEdit = false;\n            _this.parent.notify(events.tooltipDestroy, {});\n            gObj.currentViewData = dataArgs.result;\n            if (isBlazor() && gObj.filterSettings.type === 'FilterBar'\n                && !isNullOrUndefined(args) && args.requestType === 'filtering' && !dataArgs.result.length) {\n                var gridColumns = gObj.getColumns();\n                for (var i = 0; i < gridColumns.length; i++) {\n                    if (gridColumns[i].filterTemplate) {\n                        var tempID = gObj.element.id + gridColumns[i].uid + 'filterTemplate';\n                        resetBlazorTemplate(tempID, 'FilterTemplate');\n                        var fieldName = gridColumns[i].field;\n                        var filteredColumns = gObj.filterSettings.columns;\n                        for (var k = 0; k < filteredColumns.length; k++) {\n                            if (fieldName === filteredColumns[k].field) {\n                                blazorTemplates[tempID][0][fieldName] = filteredColumns[k].value;\n                            }\n                        }\n                        updateBlazorTemplate(tempID, 'FilterTemplate', gridColumns[i], false);\n                    }\n                }\n            }\n            if (!len && dataArgs.count && gObj.allowPaging && args && args.requestType !== 'delete') {\n                gObj.prevPageMoving = true;\n                gObj.pageSettings.totalRecordsCount = dataArgs.count;\n                if (args.requestType !== 'paging') {\n                    gObj.pageSettings.currentPage = Math.ceil(dataArgs.count / gObj.pageSettings.pageSize);\n                }\n                gObj.dataBind();\n                return;\n            }\n            if ((!gObj.getColumns().length && len || !_this.isLayoutRendered) && !isGroupAdaptive(gObj)) {\n                _this.updatesOnInitialRender(dataArgs);\n            }\n            if (!_this.isColTypeDef && gObj.getCurrentViewRecords()) {\n                _this.updateColumnType(gObj.getCurrentViewRecords()[0]);\n            }\n            if (!_this.parent.isInitialLoad && _this.parent.groupSettings.disablePageWiseAggregates &&\n                !_this.parent.groupSettings.columns.length) {\n                dataArgs.result = _this.parent.dataSource instanceof Array ? _this.parent.dataSource : _this.parent.currentViewData;\n            }\n            _this.parent.notify(events.dataReady, extend({ count: dataArgs.count, result: dataArgs.result, aggregates: dataArgs.aggregates }, args));\n            if ((gObj.groupSettings.columns.length || (args && args.requestType === 'ungrouping'))\n                && (args && args.requestType !== 'filtering')) {\n                _this.headerRenderer.refreshUI();\n            }\n            if (len) {\n                if (isGroupAdaptive(gObj)) {\n                    var content = 'content';\n                    args.scrollTop = { top: _this.contentRenderer[content].scrollTop };\n                }\n                _this.contentRenderer.refreshContentRows(args);\n            }\n            else {\n                if (!gObj.getColumns().length) {\n                    gObj.element.innerHTML = '';\n                    alert(_this.l10n.getConstant('EmptyDataSourceError')); //ToDO: change this alert as dialog\n                    return;\n                }\n                _this.contentRenderer.setRowElements([]);\n                _this.contentRenderer.setRowObjects([]);\n                _this.ariaService.setBusy(_this.parent.getContent().querySelector('.e-content'), false);\n                _this.renderEmptyRow();\n                if (args) {\n                    var action = (args.requestType || '').toLowerCase() + '-complete';\n                    _this.parent.notify(action, args);\n                    if (args.requestType === 'batchsave') {\n                        args.cancel = false;\n                        args.rows = [];\n                        args.isFrozen = _this.parent.getFrozenColumns() !== 0 && !args.isFrozen;\n                        _this.parent.trigger(events.actionComplete, args);\n                    }\n                }\n                _this.parent.hideSpinner();\n            }\n            _this.parent.notify(events.toolbarRefresh, {});\n        });\n    };\n    /** @hidden */\n    Render.prototype.dataManagerFailure = function (e, args) {\n        this.ariaService.setOptions(this.parent.getContent().querySelector('.e-content'), { busy: false, invalid: true });\n        this.parent.trigger(events.actionFailure, { error: e });\n        this.parent.hideSpinner();\n        if (args.requestType === 'save' || args.requestType === 'delete'\n            || args.name === 'bulk-save') {\n            return;\n        }\n        this.parent.currentViewData = [];\n        this.renderEmptyRow();\n        this.parent.log('actionfailure', { error: e });\n    };\n    Render.prototype.updatesOnInitialRender = function (e) {\n        this.isLayoutRendered = true;\n        if (this.parent.columns.length < 1) {\n            this.buildColumns(e.result[0]);\n        }\n        prepareColumns(this.parent.columns);\n        this.headerRenderer.renderTable();\n        this.contentRenderer.renderTable();\n        this.parent.isAutoGen = true;\n        this.parent.notify(events.autoCol, {});\n    };\n    Render.prototype.iterateComplexColumns = function (obj, field, split) {\n        var keys = Object.keys(obj);\n        for (var i = 0; i < keys.length; i++) {\n            var childKeys = typeof obj[keys[i]] === 'object' && obj[keys[i]] && !(obj[keys[i]] instanceof Date) ?\n                Object.keys(obj[keys[i]]) : [];\n            if (childKeys.length) {\n                this.iterateComplexColumns(obj[keys[i]], field + (keys[i] + '.'), split);\n            }\n            else {\n                split[this.counter] = field + keys[i];\n                this.counter++;\n            }\n        }\n    };\n    Render.prototype.buildColumns = function (record) {\n        var cols = [];\n        var complexCols = {};\n        this.iterateComplexColumns(record, '', complexCols);\n        var columns = Object.keys(complexCols).filter(function (e) { return complexCols[e] !== 'BlazId'; }).\n            map(function (field) { return complexCols[field]; });\n        for (var i = 0, len = columns.length; i < len; i++) {\n            cols[i] = { 'field': columns[i] };\n            if (this.parent.enableColumnVirtualization) {\n                cols[i].width = !isNullOrUndefined(cols[i].width) ? cols[i].width : 200;\n            }\n        }\n        this.parent.setProperties({ 'columns': cols }, true);\n    };\n    Render.prototype.instantiateRenderer = function () {\n        this.renderer.addRenderer(RenderType.Header, new HeaderRender(this.parent, this.locator));\n        this.renderer.addRenderer(RenderType.Content, new ContentRender(this.parent, this.locator));\n        var cellrender = this.locator.getService('cellRendererFactory');\n        cellrender.addCellRenderer(CellType.Header, new HeaderCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.Data, new CellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.StackedHeader, new StackedHeaderCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.Indent, new IndentCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.GroupCaption, new GroupCaptionCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.GroupCaptionEmpty, new GroupCaptionEmptyCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.Expand, new ExpandCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.HeaderIndent, new HeaderIndentCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.StackedHeader, new StackedHeaderCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.DetailHeader, new DetailHeaderIndentCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.RowDragHIcon, new RowDragDropHeaderRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.DetailExpand, new DetailExpandCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.DetailFooterIntent, new IndentCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.RowDragIcon, new RowDragDropRenderer(this.parent, this.locator));\n    };\n    Render.prototype.addEventListener = function () {\n        var _this = this;\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.initialLoad, this.instantiateRenderer, this);\n        this.parent.on('refreshdataSource', this.dataManagerSuccess, this);\n        this.parent.on(events.modelChanged, this.refresh, this);\n        this.parent.on(events.refreshComplete, this.refreshComplete, this);\n        this.parent.on(events.bulkSave, this.sendBulkRequest, this);\n        this.parent.on(events.showEmptyGrid, function () { _this.emptyGrid = true; }, this);\n        this.parent.on(events.autoCol, this.dynamicColumnChange, this);\n    };\n    /** @hidden */\n    Render.prototype.validateGroupRecords = function (e) {\n        var _this = this;\n        var index = e.result.length - 1;\n        if (index < 0) {\n            return Promise.resolve(e);\n        }\n        var group0 = e.result[0];\n        var groupN = e.result[index];\n        var predicate = [];\n        var addWhere = function (input) {\n            [group0, groupN].forEach(function (group) {\n                return predicate.push(new Predicate('field', '==', group.field).and(_this.getPredicate('key', 'equal', group.key)));\n            });\n            input.where(Predicate.or(predicate));\n        };\n        var query = new Query();\n        addWhere(query);\n        var curDm = new DataManager(e.result);\n        var curFilter = curDm.executeLocal(query);\n        var newQuery = this.data.generateQuery(true);\n        var rPredicate = [];\n        if (this.data.isRemote() || isBlazor()) {\n            [group0, groupN].forEach(function (group) {\n                return rPredicate.push(_this.getPredicate(group.field, 'equal', group.key));\n            });\n            newQuery.where(Predicate.or(rPredicate));\n        }\n        else {\n            addWhere(newQuery);\n        }\n        var deferred = new Deferred();\n        this.data.getData({}, newQuery).then(function (r) {\n            _this.updateGroupInfo(curFilter, r.result);\n            deferred.resolve(e);\n        }).catch(function (e) { return deferred.reject(e); });\n        return deferred.promise;\n    };\n    Render.prototype.getPredicate = function (key, operator, value) {\n        if (value instanceof Date) {\n            return getDatePredicate({ field: key, operator: operator, value: value });\n        }\n        return new Predicate(key, operator, value);\n    };\n    Render.prototype.updateGroupInfo = function (current, untouched) {\n        var _this = this;\n        var dm = new DataManager(untouched);\n        current.forEach(function (element, index, array) {\n            var uGroup = dm.executeLocal(new Query()\n                .where(new Predicate('field', '==', element.field).and(_this.getPredicate('key', 'equal', element.key))))[0];\n            element.count = uGroup.count;\n            var itemGroup = element.items;\n            var uGroupItem = uGroup.items;\n            if (itemGroup.GroupGuid) {\n                element.items = _this.updateGroupInfo(element.items, uGroup.items);\n            }\n            _this.parent.aggregates.forEach(function (row) {\n                return row.columns.forEach(function (column) {\n                    var types = column.type instanceof Array ? column.type : [column.type];\n                    types.forEach(function (type) {\n                        var key = column.field + ' - ' + type.toLowerCase();\n                        var data = itemGroup.level ? uGroupItem.records : uGroup.items;\n                        var context = _this.parent;\n                        if (type === 'Custom') {\n                            var data_1 = itemGroup.level ? uGroupItem : uGroup;\n                            element.aggregates[key] = column.customAggregate ?\n                                column.customAggregate.call(context, data_1, column) : '';\n                        }\n                        else {\n                            element.aggregates[key] = DataUtil.aggregates[type.toLowerCase()](data, column.field);\n                        }\n                    });\n                });\n            });\n        });\n        return current;\n    };\n    return Render;\n}());\nexport { Render };\n"]},"metadata":{},"sourceType":"module"}