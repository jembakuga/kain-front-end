{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { remove, createElement, closest, formatUnit, Browser } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { DataManager } from '@syncfusion/ej2-data';\nimport { dataReady, modelChanged, refreshVirtualBlock, contentReady } from '../base/constant';\nimport * as events from '../base/constant';\nimport { RenderType } from '../base/enum';\nimport { ContentRender } from './content-renderer';\nimport { HeaderRender } from './header-renderer';\nimport { InterSectionObserver } from '../services/intersection-observer';\nimport { VirtualRowModelGenerator } from '../services/virtual-row-model-generator';\nimport { isGroupAdaptive, getTransformValues } from '../base/util';\nimport { setStyleAttribute } from '@syncfusion/ej2-base';\n/**\n * VirtualContentRenderer\n * @hidden\n */\n\nvar VirtualContentRenderer =\n/** @class */\nfunction (_super) {\n  __extends(VirtualContentRenderer, _super);\n\n  function VirtualContentRenderer(parent, locator) {\n    var _this = _super.call(this, parent, locator) || this;\n\n    _this.prevHeight = 0;\n    _this.currentInfo = {};\n    _this.preventEvent = false;\n    _this.actions = ['filtering', 'searching', 'grouping', 'ungrouping'];\n    _this.offsets = {};\n    _this.tmpOffsets = {};\n    _this.virtualEle = new VirtualElementHandler();\n    _this.offsetKeys = [];\n    _this.isFocused = false;\n    _this.isSelection = false;\n    _this.isBottom = false;\n    _this.rndrCount = 0;\n    _this.locator = locator;\n\n    _this.eventListener('on');\n\n    _this.parent.on(events.columnVisibilityChanged, _this.setVisible, _this);\n\n    _this.vgenerator = _this.generator;\n    return _this;\n  }\n\n  VirtualContentRenderer.prototype.renderTable = function () {\n    this.header = this.locator.getService('rendererFactory').getRenderer(RenderType.Header);\n\n    _super.prototype.renderTable.call(this);\n\n    this.virtualEle.table = this.getTable();\n    this.virtualEle.content = this.content = this.getPanel().querySelector('.e-content');\n    this.virtualEle.renderWrapper(this.parent.height);\n    this.virtualEle.renderPlaceHolder();\n\n    if (!this.parent.getFrozenColumns()) {\n      this.virtualEle.wrapper.style.position = 'absolute';\n    }\n\n    var debounceEvent = this.parent.dataSource instanceof DataManager && !this.parent.dataSource.dataSource.offline;\n    var content = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent() : this.content;\n    var opt = {\n      container: content,\n      pageHeight: this.getBlockHeight() * 2,\n      debounceEvent: debounceEvent,\n      axes: this.parent.enableColumnVirtualization ? ['X', 'Y'] : ['Y']\n    };\n    this.observer = new InterSectionObserver(this.parent, this.virtualEle.wrapper, opt);\n  };\n\n  VirtualContentRenderer.prototype.renderEmpty = function (tbody) {\n    this.getTable().appendChild(tbody);\n    this.virtualEle.adjustTable(0, 0);\n  };\n\n  VirtualContentRenderer.prototype.refreshMvTbalTransform = function () {\n    var mCont = this.parent.getMovableVirtualContent();\n    var fCont = this.parent.getFrozenVirtualContent();\n    var mContTV = getTransformValues(mCont.firstElementChild);\n    var fContTV = getTransformValues(fCont.firstElementChild);\n    var top = mCont.scrollTop;\n\n    if (top > 0 && mContTV.height !== fContTV.height) {\n      mCont.firstElementChild.style.transform = \"translate(\" + mContTV.width + \"px, \" + fContTV.height + \"px)\";\n    }\n  };\n\n  VirtualContentRenderer.prototype.scrollListener = function (scrollArgs) {\n    if (this.parent.enablePersistence) {\n      this.parent.scrollPosition = scrollArgs.offset;\n    }\n\n    if (this.preventEvent || this.parent.isDestroyed) {\n      this.preventEvent = false;\n      return;\n    }\n\n    if (isNullOrUndefined(document.activeElement)) {\n      this.isFocused = false;\n    } else {\n      this.isFocused = this.content === closest(document.activeElement, '.e-content') || this.content === document.activeElement;\n    }\n\n    if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns() && scrollArgs.sentinel.axis === 'X') {\n      this.refreshMvTbalTransform();\n    }\n\n    var info = scrollArgs.sentinel;\n    var viewInfo = this.currentInfo = this.getInfoFromView(scrollArgs.direction, info, scrollArgs.offset);\n\n    if (isGroupAdaptive(this.parent)) {\n      if (info.axis === 'Y' && this.prevInfo.blockIndexes.toString() === viewInfo.blockIndexes.toString() && scrollArgs.direction === 'up' && viewInfo.blockIndexes[viewInfo.blockIndexes.length - 1] !== 2) {\n        return;\n      } else {\n        viewInfo.event = 'refresh-virtual-block';\n\n        if (!isNullOrUndefined(viewInfo.offsets)) {\n          viewInfo.offsets.top = this.content.scrollTop;\n        }\n\n        this.parent.notify(viewInfo.event, {\n          requestType: 'virtualscroll',\n          virtualInfo: viewInfo,\n          focusElement: scrollArgs.focusElement\n        });\n        return;\n      }\n    }\n\n    if (this.prevInfo && (info.axis === 'Y' && this.prevInfo.blockIndexes.toString() === viewInfo.blockIndexes.toString() || info.axis === 'X' && this.prevInfo.columnIndexes.toString() === viewInfo.columnIndexes.toString())) {\n      if (Browser.isIE) {\n        this.parent.hideSpinner();\n      }\n\n      return;\n    }\n\n    this.parent.setColumnIndexesInView(this.parent.enableColumnVirtualization ? viewInfo.columnIndexes : []);\n    this.parent.pageSettings.currentPage = viewInfo.loadNext && !viewInfo.loadSelf ? viewInfo.nextInfo.page : viewInfo.page;\n\n    if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization) {\n      var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n\n      if (this.parent.pageSettings.currentPage === lastPage && scrollArgs.sentinel.axis === 'Y') {\n        this.rndrCount++;\n      }\n\n      if (scrollArgs.sentinel.axis === 'Y') {\n        if (this.parent.pageSettings.currentPage === lastPage && this.rndrCount > 1) {\n          this.rndrCount = 0;\n          return;\n        } else if (this.parent.pageSettings.currentPage !== lastPage && this.parent.pageSettings.currentPage !== lastPage - 1) {\n          this.rndrCount = 0;\n        }\n      }\n    }\n\n    this.parent.notify(viewInfo.event, {\n      requestType: 'virtualscroll',\n      virtualInfo: viewInfo,\n      focusElement: scrollArgs.focusElement\n    });\n  };\n\n  VirtualContentRenderer.prototype.block = function (blk) {\n    return this.vgenerator.isBlockAvailable(blk);\n  };\n\n  VirtualContentRenderer.prototype.getInfoFromView = function (direction, info, e) {\n    var isBlockAdded = false;\n    var tempBlocks = [];\n    var infoType = {\n      direction: direction,\n      sentinelInfo: info,\n      offsets: e\n    };\n    var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.content.getBoundingClientRect().height : this.parent.element.getBoundingClientRect().height;\n    infoType.page = this.getPageFromTop(e.top + vHeight, infoType);\n    infoType.blockIndexes = tempBlocks = this.vgenerator.getBlockIndexes(infoType.page);\n    infoType.loadSelf = !this.vgenerator.isBlockAvailable(tempBlocks[infoType.block]);\n    var blocks = this.ensureBlocks(infoType);\n\n    if (this.activeKey === 'upArrow' && infoType.blockIndexes.toString() !== blocks.toString()) {\n      // To avoid dupilcate row index problem in key focus support\n      var newBlock = blocks[blocks.length - 1];\n\n      if (infoType.blockIndexes.indexOf(newBlock) === -1) {\n        isBlockAdded = true;\n      }\n    }\n\n    infoType.blockIndexes = blocks;\n    infoType.loadNext = !blocks.filter(function (val) {\n      return tempBlocks.indexOf(val) === -1;\n    }).every(this.block.bind(this));\n    infoType.event = infoType.loadNext || infoType.loadSelf ? modelChanged : refreshVirtualBlock;\n    infoType.nextInfo = infoType.loadNext ? {\n      page: Math.max(1, infoType.page + (direction === 'down' ? 1 : -1))\n    } : {};\n\n    if (isBlockAdded) {\n      infoType.blockIndexes = [infoType.blockIndexes[0] - 1, infoType.blockIndexes[0], infoType.blockIndexes[0] + 1];\n    }\n\n    infoType.columnIndexes = info.axis === 'X' ? this.vgenerator.getColumnIndexes() : this.parent.getColumnIndexesInView();\n\n    if (this.parent.enableColumnVirtualization && info.axis === 'X') {\n      infoType.event = refreshVirtualBlock;\n    }\n\n    return infoType;\n  };\n\n  VirtualContentRenderer.prototype.ensureBlocks = function (info) {\n    var _this = this;\n\n    var index = info.blockIndexes[info.block];\n    var mIdx;\n    var old = index;\n    var max = Math.max;\n    var indexes = info.direction === 'down' ? [max(index, 1), ++index, ++index] : [max(index - 1, 1), index, index + 1];\n\n    if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns()) {\n      if (info.sentinelInfo.axis === 'X' || info.sentinelInfo.axis === 'Y' && info.page === this.prevInfo.page) {\n        indexes = this.prevInfo.blockIndexes;\n      }\n    }\n\n    indexes = indexes.filter(function (val, ind) {\n      return indexes.indexOf(val) === ind;\n    });\n\n    if (this.prevInfo.blockIndexes.toString() === indexes.toString()) {\n      return indexes;\n    }\n\n    if (info.loadSelf || info.direction === 'down' && this.isEndBlock(old)) {\n      indexes = this.vgenerator.getBlockIndexes(info.page);\n    }\n\n    indexes.some(function (val, ind) {\n      var result = val === (isGroupAdaptive(_this.parent) ? _this.getGroupedTotalBlocks() : _this.getTotalBlocks());\n\n      if (result) {\n        mIdx = ind;\n      }\n\n      return result;\n    });\n\n    if (mIdx !== undefined) {\n      indexes = indexes.slice(0, mIdx + 1);\n\n      if (info.block === 0 && indexes.length === 1 && this.vgenerator.isBlockAvailable(indexes[0] - 1)) {\n        indexes = [indexes[0] - 1, indexes[0]];\n      }\n    }\n\n    return indexes;\n  };\n  /**\n   * @hidden\n   */\n\n\n  VirtualContentRenderer.prototype.vfTblTransform = function (info, left, top, e, cOffset, translate) {\n    var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n    var isLastPage = lastPage === this.parent.pageSettings.currentPage && this.parent.enableColumnVirtualization;\n    var wrappers = [].slice.call(this.parent.getContent().querySelectorAll('.e-virtualtable'));\n\n    for (var i = 0; i < wrappers.length; i++) {\n      if (i === 0 && e.requestType === 'virtualscroll' && info.sentinelInfo.axis === 'X') {\n        continue;\n      }\n\n      if (lastPage !== this.parent.pageSettings.currentPage && this.parent.enableColumnVirtualization && (left > 0 || top > 0 && left === 0)) {\n        continue;\n      }\n\n      var cOff = isLastPage && i === 0 ? 0 : cOffset;\n      this.virtualEle.wrapper = wrappers[i];\n      this.virtualEle.adjustTable(cOff, translate);\n    }\n  };\n\n  VirtualContentRenderer.prototype.appendContent = function (target, newChild, e) {\n    // currentInfo value will be used if there are multiple dom updates happened due to mousewheel\n    var info = e.virtualInfo.sentinelInfo && e.virtualInfo.sentinelInfo.axis === 'Y' && this.currentInfo.page && this.currentInfo.page !== e.virtualInfo.page ? this.currentInfo : e.virtualInfo;\n    this.prevInfo = this.prevInfo || e.virtualInfo;\n    var cBlock = info.columnIndexes[0] - 1;\n    var cOffset = this.getColumnOffset(cBlock);\n    var width;\n    var blocks = info.blockIndexes;\n\n    if (this.parent.groupSettings.columns.length) {\n      this.refreshOffsets();\n    }\n\n    if (this.parent.height === '100%') {\n      this.parent.element.style.height = '100%';\n    }\n\n    var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.content.getBoundingClientRect().height : this.parent.element.getBoundingClientRect().height;\n    var translate = 0;\n\n    if (this.parent.getFrozenColumns()) {\n      var mCont = this.parent.getMovableVirtualContent();\n      var left = mCont.scrollLeft;\n      var top_1 = mCont.scrollTop;\n      translate = this.getTranslateY(mCont.scrollTop, vHeight, info);\n      this.vfTblTransform(info, left, top_1, e, cOffset, translate);\n    } else {\n      translate = this.getTranslateY(this.content.scrollTop, vHeight, info);\n      this.virtualEle.adjustTable(cOffset, translate);\n    }\n\n    if (this.parent.enableColumnVirtualization && !this.parent.getFrozenColumns()) {\n      this.header.virtualEle.adjustTable(cOffset, 0);\n    }\n\n    if (this.parent.enableColumnVirtualization) {\n      var cIndex = info.columnIndexes;\n      width = this.getColumnOffset(cIndex[cIndex.length - 1]) - this.getColumnOffset(cIndex[0] - 1) + '';\n      this.header.virtualEle.setWrapperWidth(width);\n    }\n\n    this.virtualEle.setWrapperWidth(width, Browser.isIE || Browser.info.name === 'edge');\n\n    if (!isNullOrUndefined(target.parentNode)) {\n      remove(target);\n    }\n\n    var tbody;\n\n    if (this.parent.getFrozenColumns() && !e.renderMovableContent) {\n      tbody = this.parent.getFrozenVirtualContent().querySelector('tbody');\n    } else if (this.parent.getFrozenColumns() && e.renderMovableContent) {\n      tbody = this.parent.getMovableVirtualContent().querySelector('tbody');\n    } else {\n      tbody = this.parent.element.querySelector('.e-content').querySelector('tbody');\n    }\n\n    if (tbody) {\n      remove(tbody);\n      target = null;\n    }\n\n    target = this.parent.createElement('tbody');\n    target.appendChild(newChild);\n\n    if (this.parent.frozenRows && e.requestType === 'virtualscroll' && this.parent.pageSettings.currentPage === 1) {\n      for (var i = 0; i < this.parent.frozenRows; i++) {\n        target.children[0].remove();\n      }\n    }\n\n    if (this.parent.getFrozenColumns()) {\n      if (!e.renderMovableContent) {\n        this.parent.getFrozenVirtualContent().querySelector('.e-table').appendChild(target);\n      } else {\n        this.parent.getMovableVirtualContent().querySelector('.e-table').appendChild(target);\n      }\n    } else {\n      this.getTable().appendChild(target);\n    }\n\n    if (this.parent.groupSettings.columns.length) {\n      if (!isGroupAdaptive(this.parent) && info.direction === 'up') {\n        var blk = this.offsets[this.getTotalBlocks()] - this.prevHeight;\n        this.preventEvent = true;\n        var sTop = this.content.scrollTop;\n        this.content.scrollTop = sTop + blk;\n      }\n\n      this.setVirtualHeight();\n      this.observer.setPageHeight(this.getOffset(blocks[blocks.length - 1]) - this.getOffset(blocks[0] - 1));\n    }\n\n    this.prevInfo = info;\n\n    if (this.isFocused && this.activeKey !== 'downArrow' && this.activeKey !== 'upArrow') {\n      this.content.focus();\n    }\n\n    var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n\n    if (this.isBottom) {\n      this.isBottom = false;\n      this.parent.getContent().firstElementChild.scrollTop = this.offsets[this.offsetKeys.length - 1];\n    }\n\n    if (this.parent.pageSettings.currentPage === lastPage && blocks.length === 1) {\n      this.isBottom = true;\n      this.parent.getContent().firstElementChild.scrollTop = this.offsets[this.offsetKeys.length - 2];\n    }\n\n    if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns() && e.requestType === 'virtualscroll' && e.virtualInfo.sentinelInfo.axis === 'X') {\n      this.refreshMvTbalTransform();\n    }\n\n    this.focusCell(e, cOffset);\n  };\n\n  VirtualContentRenderer.prototype.focusCell = function (e, cOffset) {\n    if (this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n      return;\n    }\n\n    var row = this.parent.getRowByIndex(this.rowIndex);\n    var firstRow;\n    var lastRow;\n    var rows = this.parent.getRows();\n    var rowHeight = this.parent.getRowHeight();\n    var scrollEleHeight = this.parent.getContent().firstElementChild.getBoundingClientRect().height;\n    var transform = getTransformValues(this.getTable().parentElement);\n\n    if (isNullOrUndefined(row)) {\n      var firstRowTop = rows[0].getBoundingClientRect().top;\n      var lastRowTop = rows[rows.length - 1].getBoundingClientRect().top;\n\n      if (this.parent.pageSettings.currentPage !== 1) {\n        if (firstRowTop > rowHeight) {\n          // adjusted the table transform to avoid the white space in top\n          var value = transform.height + this.parent.getRowHeight() - firstRowTop;\n          this.virtualEle.adjustTable(cOffset, value);\n        }\n\n        if (lastRowTop < scrollEleHeight) {\n          // adjusted the table transform to avoid the white space in bottom\n          var value = scrollEleHeight - lastRowTop + transform.height;\n          this.virtualEle.adjustTable(cOffset, value);\n        }\n      }\n\n      for (var i = 0; i < rows.length; i++) {\n        if (this.isViewPortFirstRow(rows[i], rowHeight)) {\n          firstRow = rows[i];\n          break;\n        }\n      }\n\n      for (var i = rows.length - 1; i >= 0; i--) {\n        if (this.isViewPortLastRow(rows[i], scrollEleHeight)) {\n          lastRow = rows[i];\n          break;\n        }\n      }\n    }\n\n    var virtualRow = this.activeKey === 'downArrow' ? firstRow : lastRow;\n    var target = !isNullOrUndefined(row) ? row.cells[this.cellIndex] : virtualRow.cells[this.cellIndex];\n    this.parent.focusModule.onClick({\n      target: target\n    }, true);\n    this.parent.selectRow(parseInt(target.parentElement.getAttribute('aria-rowindex'), 10));\n    this.activeKey = this.parent.allowSelection ? this.activeKey : undefined;\n  };\n\n  VirtualContentRenderer.prototype.onDataReady = function (e) {\n    if (!isNullOrUndefined(e.count)) {\n      this.count = e.count;\n      this.maxPage = Math.ceil(e.count / this.parent.pageSettings.pageSize);\n    }\n\n    this.vgenerator.checkAndResetCache(e.requestType);\n\n    if (['refresh', 'filtering', 'searching', 'grouping', 'ungrouping', 'reorder', undefined].some(function (value) {\n      return e.requestType === value;\n    })) {\n      this.refreshOffsets();\n    }\n\n    if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization) {\n      var hdrTbls = [].slice.call(this.parent.getHeaderContent().querySelectorAll('.e-table'));\n      this.header.virtualEle.table = hdrTbls[1];\n    }\n\n    this.setVirtualHeight();\n    this.resetScrollPosition(e.requestType);\n  };\n\n  VirtualContentRenderer.prototype.setVirtualHeight = function () {\n    var width = this.parent.enableColumnVirtualization ? this.getColumnOffset(this.parent.columns.length + this.parent.groupSettings.columns.length - 1) + 'px' : '100%';\n\n    if (this.parent.getFrozenColumns()) {\n      var fTblWidth = this.parent.enableColumnVirtualization ? 'auto' : width;\n      this.virtualEle.placeholder = this.parent.getFrozenVirtualContent().querySelector('.e-virtualtrack'); // To overcome the white space issue in last page (instead of position absolute)\n\n      this.virtualEle.setVirtualHeight(this.offsets[this.getTotalBlocks() - 2], fTblWidth);\n      this.virtualEle.placeholder = this.parent.getMovableVirtualContent().querySelector('.e-virtualtrack'); // To overcome the white space issue in last page (instead of position absolute)\n\n      this.virtualEle.setVirtualHeight(this.offsets[this.getTotalBlocks() - 2], width);\n    } else {\n      this.virtualEle.setVirtualHeight(this.offsets[isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks()], width);\n    }\n\n    if (this.parent.enableColumnVirtualization) {\n      this.header.virtualEle.setVirtualHeight(1, width);\n    }\n  };\n\n  VirtualContentRenderer.prototype.getPageFromTop = function (sTop, info) {\n    var _this = this;\n\n    var total = isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();\n    var page = 0;\n    var extra = this.offsets[total] - this.prevHeight;\n    this.offsetKeys.some(function (offset) {\n      var iOffset = Number(offset);\n      var border = sTop <= _this.offsets[offset] || iOffset === total && sTop > _this.offsets[offset];\n\n      if (border) {\n        info.block = iOffset % 2 === 0 ? 1 : 0;\n        page = Math.max(1, Math.min(_this.vgenerator.getPage(iOffset), _this.maxPage));\n      }\n\n      return border;\n    });\n    return page;\n  };\n\n  VirtualContentRenderer.prototype.getTranslateY = function (sTop, cHeight, info, isOnenter) {\n    if (info === undefined) {\n      info = {\n        page: this.getPageFromTop(sTop + cHeight, {})\n      };\n      info.blockIndexes = this.vgenerator.getBlockIndexes(info.page);\n    }\n\n    var block = (info.blockIndexes[0] || 1) - 1;\n    var translate = this.getOffset(block);\n    var endTranslate = this.getOffset(info.blockIndexes[info.blockIndexes.length - 1]);\n\n    if (isOnenter) {\n      info = this.prevInfo;\n    }\n\n    var result = translate > sTop ? this.getOffset(block - 1) : endTranslate < sTop + cHeight ? this.getOffset(block + 1) : translate;\n    var blockHeight = this.offsets[info.blockIndexes[info.blockIndexes.length - 1]] - this.tmpOffsets[info.blockIndexes[0]];\n\n    if (result + blockHeight > this.offsets[isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks()]) {\n      result -= result + blockHeight - this.offsets[this.getTotalBlocks()];\n    }\n\n    return result;\n  };\n\n  VirtualContentRenderer.prototype.getOffset = function (block) {\n    return Math.min(this.offsets[block] | 0, this.offsets[this.maxBlock] | 0);\n  };\n\n  VirtualContentRenderer.prototype.onEntered = function () {\n    var _this = this;\n\n    return function (element, current, direction, e, isWheel, check) {\n      if (Browser.isIE && !isWheel && check && !_this.preventEvent) {\n        _this.parent.showSpinner();\n      }\n\n      var xAxis = current.axis === 'X';\n      var top = _this.prevInfo.offsets ? _this.prevInfo.offsets.top : null;\n\n      var height = _this.content.getBoundingClientRect().height;\n\n      var x = _this.getColumnOffset(xAxis ? _this.vgenerator.getColumnIndexes()[0] - 1 : _this.prevInfo.columnIndexes[0] - 1);\n\n      var y = _this.getTranslateY(e.top, height, xAxis && top === e.top ? _this.prevInfo : undefined, true);\n\n      _this.virtualEle.adjustTable(x, Math.min(y, _this.offsets[_this.maxBlock]));\n\n      if (_this.parent.getFrozenColumns() && !xAxis) {\n        var left = _this.parent.getMovableVirtualContent().scrollLeft;\n\n        if (_this.parent.enableColumnVirtualization && left > 0) {\n          var fvTable = _this.parent.getFrozenVirtualContent().querySelector('.e-virtualtable');\n\n          fvTable.style.transform = \"translate(\" + 0 + \"px, \" + Math.min(y, _this.offsets[_this.maxBlock]) + \"px)\";\n        } else {\n          var fvTable = _this.parent.getFrozenVirtualContent().querySelector('.e-virtualtable');\n\n          fvTable.style.transform = \"translate(\" + x + \"px, \" + Math.min(y, _this.offsets[_this.maxBlock]) + \"px)\";\n        }\n      }\n\n      if (_this.parent.enableColumnVirtualization) {\n        _this.header.virtualEle.adjustTable(x, 0);\n      }\n    };\n  };\n\n  VirtualContentRenderer.prototype.dataBound = function () {\n    if (this.isSelection && this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n      this.isSelection = false;\n      this.parent.selectRow(this.selectedRowIndex);\n    } else {\n      this.activeKey = undefined;\n    }\n  };\n\n  VirtualContentRenderer.prototype.eventListener = function (action) {\n    var _this = this;\n\n    this.parent[action](dataReady, this.onDataReady, this);\n    this.parent.addEventListener(events.dataBound, this.dataBound.bind(this));\n    this.parent[action](refreshVirtualBlock, this.refreshContentRows, this);\n    this.parent[action](events.selectVirtualRow, this.selectVirtualRow, this);\n    this.parent[action](events.virtaulKeyHandler, this.virtualKeyHandler, this);\n    this.parent[action](events.keyPressed, this.virtualKeyHandler, this);\n    this.parent[action](events.virtaulCellFocus, this.virtualCellFocus, this);\n    this.actions.forEach(function (event) {\n      return _this.parent[action](event + \"-begin\", _this.onActionBegin, _this);\n    });\n\n    var fn = function () {\n      _this.observer.observe(function (scrollArgs) {\n        return _this.scrollListener(scrollArgs);\n      }, _this.onEntered());\n\n      var gObj = _this.parent;\n\n      if (gObj.enablePersistence && gObj.scrollPosition) {\n        _this.content.scrollTop = gObj.scrollPosition.top;\n        var scrollValues = {\n          direction: 'down',\n          sentinel: _this.observer.sentinelInfo.down,\n          offset: gObj.scrollPosition,\n          focusElement: gObj.element\n        };\n\n        _this.scrollListener(scrollValues);\n\n        if (gObj.enableColumnVirtualization) {\n          _this.content.scrollLeft = gObj.scrollPosition.left;\n        }\n      }\n\n      _this.parent.off(contentReady, fn);\n    };\n\n    this.parent.on(contentReady, fn, this);\n  };\n\n  VirtualContentRenderer.prototype.virtualCellFocus = function (e) {\n    // To decide the action (select or scroll), when using arrow keys for cell focus\n    var ele = document.activeElement;\n\n    if (ele.classList.contains('e-rowcell') && e && (e.action === 'upArrow' || e.action === 'downArrow')) {\n      var rowIndex = parseInt(ele.parentElement.getAttribute('aria-rowindex'), 10);\n\n      if (e && (e.action === 'downArrow' || e.action === 'upArrow')) {\n        e.action === 'downArrow' ? rowIndex += 1 : rowIndex -= 1;\n        this.rowIndex = rowIndex;\n        this.cellIndex = parseInt(ele.getAttribute('aria-colindex'), 10);\n        var row = this.parent.getRowByIndex(rowIndex);\n        var top_2 = this.parent.getContent().firstElementChild.scrollTop;\n\n        if (isNullOrUndefined(row)) {\n          this.parent.getContent().firstElementChild.scrollTop = e.action === 'downArrow' ? top_2 + this.parent.getRowHeight() : top_2 - this.parent.getRowHeight();\n        } else {\n          this.parent.selectRow(rowIndex);\n        }\n      }\n    }\n  };\n\n  VirtualContentRenderer.prototype.virtualKeyHandler = function (args) {\n    if (args && (args.action === 'upArrow' || args.action === 'downArrow') && isNullOrUndefined(this.activeKey)) {\n      this.activeKey = args.action;\n    }\n  };\n\n  VirtualContentRenderer.prototype.getBlockSize = function () {\n    return this.parent.pageSettings.pageSize >> 1;\n  };\n\n  VirtualContentRenderer.prototype.getBlockHeight = function () {\n    return this.getBlockSize() * this.parent.getRowHeight();\n  };\n\n  VirtualContentRenderer.prototype.isEndBlock = function (index) {\n    var totalBlocks = this.getTotalBlocks();\n    return index >= totalBlocks || index === totalBlocks - 1;\n  };\n\n  VirtualContentRenderer.prototype.getGroupedTotalBlocks = function () {\n    var rows = this.parent.vcRows;\n    return Math.floor(rows.length / this.getBlockSize() < 1 ? 1 : rows.length / this.getBlockSize());\n  };\n\n  VirtualContentRenderer.prototype.getTotalBlocks = function () {\n    return Math.ceil(this.count / this.getBlockSize());\n  };\n\n  VirtualContentRenderer.prototype.getColumnOffset = function (block) {\n    return this.vgenerator.cOffsets[block] | 0;\n  };\n\n  VirtualContentRenderer.prototype.getModelGenerator = function () {\n    return new VirtualRowModelGenerator(this.parent);\n  };\n\n  VirtualContentRenderer.prototype.resetScrollPosition = function (action) {\n    if (this.actions.some(function (value) {\n      return value === action;\n    })) {\n      this.preventEvent = this.content.scrollTop !== 0;\n      this.content.scrollTop = 0;\n    }\n  };\n\n  VirtualContentRenderer.prototype.onActionBegin = function (e) {\n    //Update property silently..\n    this.parent.setProperties({\n      pageSettings: {\n        currentPage: 1\n      }\n    }, true);\n  };\n\n  VirtualContentRenderer.prototype.getRows = function () {\n    return this.vgenerator.getRows();\n  };\n\n  VirtualContentRenderer.prototype.getRowByIndex = function (index) {\n    if (isGroupAdaptive(this.parent)) {\n      return this.parent.getDataRows()[index];\n    }\n\n    return this.getRowCollection(index, false);\n  };\n\n  VirtualContentRenderer.prototype.getMovableVirtualRowByIndex = function (index) {\n    return this.getRowCollection(index, true);\n  };\n\n  VirtualContentRenderer.prototype.getRowCollection = function (index, isMovable) {\n    var prev = this.prevInfo.blockIndexes;\n    var startIdx = (prev[0] - 1) * this.getBlockSize();\n    var rowCollection = isMovable ? this.parent.getMovableDataRows() : this.parent.getDataRows();\n    var selectedRow = rowCollection[index - startIdx];\n\n    if (this.parent.frozenRows && this.parent.pageSettings.currentPage > 1) {\n      selectedRow = index <= this.parent.frozenRows ? rowCollection[index] : rowCollection[index - startIdx + this.parent.frozenRows];\n    }\n\n    return selectedRow;\n  };\n\n  VirtualContentRenderer.prototype.getVirtualRowIndex = function (index) {\n    var prev = this.prevInfo.blockIndexes;\n    var startIdx = (prev[0] - 1) * this.getBlockSize();\n    return startIdx + index;\n  };\n\n  VirtualContentRenderer.prototype.refreshOffsets = function () {\n    var _this = this;\n\n    var gObj = this.parent;\n    var row = 0;\n    var bSize = this.getBlockSize();\n    var total = isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();\n    this.prevHeight = this.offsets[total];\n    this.maxBlock = total % 2 === 0 ? total - 2 : total - 1;\n    this.offsets = {}; //Row offset update\n\n    Array.apply(null, Array(total)).map(function () {\n      return ++row;\n    }).forEach(function (block) {\n      var tmp = (_this.vgenerator.cache[block] || []).length;\n      var rem = !isGroupAdaptive(_this.parent) ? _this.count % bSize : gObj.vcRows.length % bSize;\n      var size = !isGroupAdaptive(_this.parent) && block in _this.vgenerator.cache ? tmp * _this.parent.getRowHeight() : rem && block === total ? rem * _this.parent.getRowHeight() : _this.getBlockHeight(); // let size: number = this.parent.groupSettings.columns.length && block in this.vgenerator.cache ?\n      // tmp * getRowHeight() : this.getBlockHeight();\n\n      _this.offsets[block] = (_this.offsets[block - 1] | 0) + size;\n      _this.tmpOffsets[block] = _this.offsets[block - 1] | 0;\n    });\n    this.offsetKeys = Object.keys(this.offsets);\n\n    if (isGroupAdaptive(this.parent)) {\n      this.parent.vGroupOffsets = this.offsets;\n    } //Column offset update\n\n\n    if (this.parent.enableColumnVirtualization) {\n      this.vgenerator.refreshColOffsets();\n    }\n  };\n\n  VirtualContentRenderer.prototype.refreshVirtualElement = function () {\n    this.vgenerator.refreshColOffsets();\n    this.setVirtualHeight();\n  };\n\n  VirtualContentRenderer.prototype.setVisible = function (columns) {\n    var gObj = this.parent;\n    var rows = [];\n    rows = this.getRows();\n    var testRow;\n    rows.some(function (r) {\n      if (r.isDataRow) {\n        testRow = r;\n      }\n\n      return r.isDataRow;\n    });\n    var needFullRefresh = true;\n\n    if (!gObj.groupSettings.columns.length && testRow) {\n      needFullRefresh = false;\n    }\n\n    var tr = gObj.getDataRows();\n\n    for (var c = 0, clen = columns.length; c < clen; c++) {\n      var column = columns[c];\n      var idx = gObj.getNormalizedColumnIndex(column.uid);\n      var displayVal = column.visible === true ? '' : 'none';\n\n      if (idx !== -1 && testRow && idx < testRow.cells.length) {\n        setStyleAttribute(this.getColGroup().childNodes[idx], {\n          'display': displayVal\n        });\n      }\n\n      if (!needFullRefresh) {\n        var width = void 0;\n\n        if (column.visible) {\n          width = this.virtualEle.wrapper.offsetWidth + parseInt(column.width.toString(), 10);\n        } else {\n          width = this.virtualEle.wrapper.offsetWidth - parseInt(column.width.toString(), 10);\n        }\n\n        if (width > gObj.width) {\n          this.setDisplayNone(tr, idx, displayVal, rows);\n          this.virtualEle.setWrapperWidth(width + '');\n          this.vgenerator.refreshColOffsets();\n          this.refreshVirtualElement();\n        } else {\n          this.refreshContentRows({\n            requestType: 'refresh'\n          });\n        }\n      }\n\n      if (!this.parent.invokedFromMedia && column.hideAtMedia) {\n        this.parent.updateMediaColumns(column);\n      }\n\n      this.parent.invokedFromMedia = false;\n    }\n\n    if (needFullRefresh) {\n      this.refreshContentRows({\n        requestType: 'refresh'\n      });\n    } else {\n      this.parent.notify(events.partialRefresh, {\n        rows: rows,\n        args: {\n          isFrozen: false,\n          rows: rows\n        }\n      });\n    }\n  };\n\n  VirtualContentRenderer.prototype.selectVirtualRow = function (args) {\n    if (this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n      this.isSelection = true;\n      this.selectedRowIndex = args.selectedIndex;\n      var page = Math.ceil((args.selectedIndex + 1) / this.parent.pageSettings.pageSize);\n      var blockIndexes = this.vgenerator.getBlockIndexes(page);\n      var scrollTop = this.offsets[blockIndexes[0] - 1];\n      var ele = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent() : this.parent.getContent().firstElementChild;\n      ele.scrollTop = scrollTop;\n    }\n  };\n\n  VirtualContentRenderer.prototype.isViewPortFirstRow = function (row, rowHeight) {\n    var top = row.getBoundingClientRect().top;\n    return top > rowHeight;\n  };\n\n  VirtualContentRenderer.prototype.isViewPortLastRow = function (row, eleHeight) {\n    var top = row.getBoundingClientRect().top;\n    return top < eleHeight;\n  };\n\n  return VirtualContentRenderer;\n}(ContentRender);\n\nexport { VirtualContentRenderer };\n/**\n * @hidden\n */\n\nvar VirtualHeaderRenderer =\n/** @class */\nfunction (_super) {\n  __extends(VirtualHeaderRenderer, _super);\n\n  function VirtualHeaderRenderer(parent, locator) {\n    var _this = _super.call(this, parent, locator) || this;\n\n    _this.virtualEle = new VirtualElementHandler();\n    _this.gen = new VirtualRowModelGenerator(_this.parent);\n\n    _this.parent.on(events.columnVisibilityChanged, _this.setVisible, _this);\n\n    _this.parent.on(refreshVirtualBlock, function (e) {\n      return e.virtualInfo.sentinelInfo.axis === 'X' ? _this.refreshUI() : null;\n    }, _this);\n\n    return _this;\n  }\n\n  VirtualHeaderRenderer.prototype.renderTable = function () {\n    this.gen.refreshColOffsets();\n    this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().querySelector('.e-headercontent')));\n\n    _super.prototype.renderTable.call(this);\n\n    this.virtualEle.table = this.getTable();\n    this.virtualEle.content = this.getPanel().querySelector('.e-headercontent');\n    this.virtualEle.content.style.position = 'relative';\n    this.virtualEle.renderWrapper();\n    this.virtualEle.renderPlaceHolder('absolute');\n  };\n\n  VirtualHeaderRenderer.prototype.appendContent = function (table) {\n    this.virtualEle.wrapper.appendChild(table);\n  };\n\n  VirtualHeaderRenderer.prototype.refreshUI = function () {\n    if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization) {\n      this.parent.contentModule.setTable(this.parent.getMovableVirtualContent().querySelector('.e-table'));\n    }\n\n    this.gen.refreshColOffsets();\n    this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().querySelector('.e-headercontent')));\n\n    _super.prototype.refreshUI.call(this);\n\n    if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization) {\n      this.parent.contentModule.setTable(this.parent.getFrozenVirtualContent().querySelector('.e-table'));\n    }\n  };\n\n  VirtualHeaderRenderer.prototype.setVisible = function (columns) {\n    var gObj = this.parent;\n    var displayVal;\n    var idx;\n\n    for (var c = 0, clen = columns.length; c < clen; c++) {\n      var column = columns[c];\n      idx = gObj.getNormalizedColumnIndex(column.uid);\n      displayVal = column.visible ? '' : 'none';\n      setStyleAttribute(this.getColGroup().children[idx], {\n        'display': displayVal\n      });\n\n      if (gObj.enableColumnVirtualization && !gObj.groupSettings.columns.length) {\n        var tablewidth = void 0;\n\n        if (column.visible) {\n          tablewidth = this.virtualEle.wrapper.offsetWidth + parseInt(column.width.toString(), 10);\n        } else {\n          tablewidth = this.virtualEle.wrapper.offsetWidth - parseInt(column.width.toString(), 10);\n        }\n\n        if (tablewidth > gObj.width) {\n          this.setDisplayNone(column, displayVal);\n          this.virtualEle.setWrapperWidth(tablewidth + '');\n          this.gen.refreshColOffsets();\n        } else {\n          this.refreshUI();\n        }\n      } else {\n        this.refreshUI();\n      }\n    }\n  };\n\n  VirtualHeaderRenderer.prototype.setDisplayNone = function (col, displayVal) {\n    for (var _i = 0, _a = [].slice.apply(this.getTable().querySelectorAll('th.e-headercell')); _i < _a.length; _i++) {\n      var ele = _a[_i];\n\n      if (ele.querySelector('[e-mappinguid]') && ele.querySelector('[e-mappinguid]').getAttribute('e-mappinguid') === col.uid) {\n        setStyleAttribute(ele, {\n          'display': displayVal\n        });\n        break;\n      }\n    }\n  };\n\n  return VirtualHeaderRenderer;\n}(HeaderRender);\n\nexport { VirtualHeaderRenderer };\n/**\n * @hidden\n */\n\nvar VirtualElementHandler =\n/** @class */\nfunction () {\n  function VirtualElementHandler() {}\n\n  VirtualElementHandler.prototype.renderWrapper = function (height) {\n    this.wrapper = createElement('div', {\n      className: 'e-virtualtable',\n      styles: \"min-height:\" + formatUnit(height)\n    });\n    this.wrapper.appendChild(this.table);\n    this.content.appendChild(this.wrapper);\n  };\n\n  VirtualElementHandler.prototype.renderPlaceHolder = function (position) {\n    if (position === void 0) {\n      position = 'relative';\n    }\n\n    this.placeholder = createElement('div', {\n      className: 'e-virtualtrack',\n      styles: \"position:\" + position\n    });\n    this.content.appendChild(this.placeholder);\n  };\n\n  VirtualElementHandler.prototype.adjustTable = function (xValue, yValue) {\n    this.wrapper.style.transform = \"translate(\" + xValue + \"px, \" + yValue + \"px)\";\n  };\n\n  VirtualElementHandler.prototype.setWrapperWidth = function (width, full) {\n    this.wrapper.style.width = width ? width + \"px\" : full ? '100%' : '';\n  };\n\n  VirtualElementHandler.prototype.setVirtualHeight = function (height, width) {\n    this.placeholder.style.height = height + \"px\";\n    this.placeholder.style.width = width;\n  };\n\n  return VirtualElementHandler;\n}();\n\nexport { VirtualElementHandler };","map":{"version":3,"sources":["C:/CN2/workspace-trunk/kain-front-end/node_modules/@syncfusion/ej2-grids/src/grid/renderer/virtual-content-renderer.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","remove","createElement","closest","formatUnit","Browser","isNullOrUndefined","DataManager","dataReady","modelChanged","refreshVirtualBlock","contentReady","events","RenderType","ContentRender","HeaderRender","InterSectionObserver","VirtualRowModelGenerator","isGroupAdaptive","getTransformValues","setStyleAttribute","VirtualContentRenderer","_super","parent","locator","_this","call","prevHeight","currentInfo","preventEvent","actions","offsets","tmpOffsets","virtualEle","VirtualElementHandler","offsetKeys","isFocused","isSelection","isBottom","rndrCount","eventListener","on","columnVisibilityChanged","setVisible","vgenerator","generator","renderTable","header","getService","getRenderer","Header","table","getTable","content","getPanel","querySelector","renderWrapper","height","renderPlaceHolder","getFrozenColumns","wrapper","style","position","debounceEvent","dataSource","offline","getMovableVirtualContent","opt","container","pageHeight","getBlockHeight","axes","enableColumnVirtualization","observer","renderEmpty","tbody","appendChild","adjustTable","refreshMvTbalTransform","mCont","fCont","getFrozenVirtualContent","mContTV","firstElementChild","fContTV","top","scrollTop","transform","width","scrollListener","scrollArgs","enablePersistence","scrollPosition","offset","isDestroyed","document","activeElement","sentinel","axis","info","viewInfo","getInfoFromView","direction","prevInfo","blockIndexes","toString","length","event","notify","requestType","virtualInfo","focusElement","columnIndexes","isIE","hideSpinner","setColumnIndexesInView","pageSettings","currentPage","loadNext","loadSelf","nextInfo","page","lastPage","Math","ceil","getTotalBlocks","block","blk","isBlockAvailable","e","isBlockAdded","tempBlocks","infoType","sentinelInfo","vHeight","indexOf","getBoundingClientRect","element","getPageFromTop","getBlockIndexes","blocks","ensureBlocks","activeKey","newBlock","filter","val","every","bind","max","getColumnIndexes","getColumnIndexesInView","index","mIdx","old","indexes","ind","isEndBlock","some","result","getGroupedTotalBlocks","undefined","slice","vfTblTransform","left","cOffset","translate","isLastPage","wrappers","getContent","querySelectorAll","i","cOff","appendContent","target","newChild","cBlock","getColumnOffset","groupSettings","columns","refreshOffsets","scrollLeft","top_1","getTranslateY","cIndex","setWrapperWidth","name","parentNode","renderMovableContent","frozenRows","children","sTop","setVirtualHeight","setPageHeight","getOffset","focus","focusCell","row","getRowByIndex","rowIndex","firstRow","lastRow","rows","getRows","rowHeight","getRowHeight","scrollEleHeight","parentElement","firstRowTop","lastRowTop","value","isViewPortFirstRow","isViewPortLastRow","virtualRow","cells","cellIndex","focusModule","onClick","selectRow","parseInt","getAttribute","allowSelection","onDataReady","count","maxPage","pageSize","checkAndResetCache","hdrTbls","getHeaderContent","resetScrollPosition","fTblWidth","placeholder","total","extra","iOffset","Number","border","min","getPage","cHeight","isOnenter","endTranslate","blockHeight","maxBlock","onEntered","current","isWheel","check","showSpinner","xAxis","x","y","fvTable","dataBound","selectedRowIndex","action","addEventListener","refreshContentRows","selectVirtualRow","virtaulKeyHandler","virtualKeyHandler","keyPressed","virtaulCellFocus","virtualCellFocus","forEach","onActionBegin","fn","observe","gObj","scrollValues","down","off","ele","classList","contains","top_2","args","getBlockSize","totalBlocks","vcRows","floor","cOffsets","getModelGenerator","setProperties","getDataRows","getRowCollection","getMovableVirtualRowByIndex","isMovable","prev","startIdx","rowCollection","getMovableDataRows","selectedRow","getVirtualRowIndex","bSize","apply","map","tmp","cache","rem","size","keys","vGroupOffsets","refreshColOffsets","refreshVirtualElement","testRow","r","isDataRow","needFullRefresh","tr","c","clen","column","idx","getNormalizedColumnIndex","uid","displayVal","visible","getColGroup","childNodes","offsetWidth","setDisplayNone","invokedFromMedia","hideAtMedia","updateMediaColumns","partialRefresh","isFrozen","selectedIndex","eleHeight","VirtualHeaderRenderer","gen","refreshUI","contentModule","setTable","tablewidth","col","_i","_a","className","styles","xValue","yValue","full"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { remove, createElement, closest, formatUnit, Browser } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { DataManager } from '@syncfusion/ej2-data';\nimport { dataReady, modelChanged, refreshVirtualBlock, contentReady } from '../base/constant';\nimport * as events from '../base/constant';\nimport { RenderType } from '../base/enum';\nimport { ContentRender } from './content-renderer';\nimport { HeaderRender } from './header-renderer';\nimport { InterSectionObserver } from '../services/intersection-observer';\nimport { VirtualRowModelGenerator } from '../services/virtual-row-model-generator';\nimport { isGroupAdaptive, getTransformValues } from '../base/util';\nimport { setStyleAttribute } from '@syncfusion/ej2-base';\n/**\n * VirtualContentRenderer\n * @hidden\n */\nvar VirtualContentRenderer = /** @class */ (function (_super) {\n    __extends(VirtualContentRenderer, _super);\n    function VirtualContentRenderer(parent, locator) {\n        var _this = _super.call(this, parent, locator) || this;\n        _this.prevHeight = 0;\n        _this.currentInfo = {};\n        _this.preventEvent = false;\n        _this.actions = ['filtering', 'searching', 'grouping', 'ungrouping'];\n        _this.offsets = {};\n        _this.tmpOffsets = {};\n        _this.virtualEle = new VirtualElementHandler();\n        _this.offsetKeys = [];\n        _this.isFocused = false;\n        _this.isSelection = false;\n        _this.isBottom = false;\n        _this.rndrCount = 0;\n        _this.locator = locator;\n        _this.eventListener('on');\n        _this.parent.on(events.columnVisibilityChanged, _this.setVisible, _this);\n        _this.vgenerator = _this.generator;\n        return _this;\n    }\n    VirtualContentRenderer.prototype.renderTable = function () {\n        this.header = this.locator.getService('rendererFactory').getRenderer(RenderType.Header);\n        _super.prototype.renderTable.call(this);\n        this.virtualEle.table = this.getTable();\n        this.virtualEle.content = this.content = this.getPanel().querySelector('.e-content');\n        this.virtualEle.renderWrapper(this.parent.height);\n        this.virtualEle.renderPlaceHolder();\n        if (!this.parent.getFrozenColumns()) {\n            this.virtualEle.wrapper.style.position = 'absolute';\n        }\n        var debounceEvent = (this.parent.dataSource instanceof DataManager && !this.parent.dataSource.dataSource.offline);\n        var content = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent() : this.content;\n        var opt = {\n            container: content, pageHeight: this.getBlockHeight() * 2, debounceEvent: debounceEvent,\n            axes: this.parent.enableColumnVirtualization ? ['X', 'Y'] : ['Y']\n        };\n        this.observer = new InterSectionObserver(this.parent, this.virtualEle.wrapper, opt);\n    };\n    VirtualContentRenderer.prototype.renderEmpty = function (tbody) {\n        this.getTable().appendChild(tbody);\n        this.virtualEle.adjustTable(0, 0);\n    };\n    VirtualContentRenderer.prototype.refreshMvTbalTransform = function () {\n        var mCont = this.parent.getMovableVirtualContent();\n        var fCont = this.parent.getFrozenVirtualContent();\n        var mContTV = getTransformValues(mCont.firstElementChild);\n        var fContTV = getTransformValues(fCont.firstElementChild);\n        var top = mCont.scrollTop;\n        if (top > 0 && mContTV.height !== fContTV.height) {\n            mCont.firstElementChild.style.transform = \"translate(\" + mContTV.width + \"px, \" + fContTV.height + \"px)\";\n        }\n    };\n    VirtualContentRenderer.prototype.scrollListener = function (scrollArgs) {\n        if (this.parent.enablePersistence) {\n            this.parent.scrollPosition = scrollArgs.offset;\n        }\n        if (this.preventEvent || this.parent.isDestroyed) {\n            this.preventEvent = false;\n            return;\n        }\n        if (isNullOrUndefined(document.activeElement)) {\n            this.isFocused = false;\n        }\n        else {\n            this.isFocused = this.content === closest(document.activeElement, '.e-content') || this.content === document.activeElement;\n        }\n        if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns() && scrollArgs.sentinel.axis === 'X') {\n            this.refreshMvTbalTransform();\n        }\n        var info = scrollArgs.sentinel;\n        var viewInfo = this.currentInfo = this.getInfoFromView(scrollArgs.direction, info, scrollArgs.offset);\n        if (isGroupAdaptive(this.parent)) {\n            if ((info.axis === 'Y' && this.prevInfo.blockIndexes.toString() === viewInfo.blockIndexes.toString())\n                && scrollArgs.direction === 'up' && viewInfo.blockIndexes[viewInfo.blockIndexes.length - 1] !== 2) {\n                return;\n            }\n            else {\n                viewInfo.event = 'refresh-virtual-block';\n                if (!isNullOrUndefined(viewInfo.offsets)) {\n                    viewInfo.offsets.top = this.content.scrollTop;\n                }\n                this.parent.notify(viewInfo.event, { requestType: 'virtualscroll', virtualInfo: viewInfo, focusElement: scrollArgs.focusElement });\n                return;\n            }\n        }\n        if (this.prevInfo && ((info.axis === 'Y' && this.prevInfo.blockIndexes.toString() === viewInfo.blockIndexes.toString())\n            || (info.axis === 'X' && this.prevInfo.columnIndexes.toString() === viewInfo.columnIndexes.toString()))) {\n            if (Browser.isIE) {\n                this.parent.hideSpinner();\n            }\n            return;\n        }\n        this.parent.setColumnIndexesInView(this.parent.enableColumnVirtualization ? viewInfo.columnIndexes : []);\n        this.parent.pageSettings.currentPage = viewInfo.loadNext && !viewInfo.loadSelf ? viewInfo.nextInfo.page : viewInfo.page;\n        if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization) {\n            var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n            if (this.parent.pageSettings.currentPage === lastPage && scrollArgs.sentinel.axis === 'Y') {\n                this.rndrCount++;\n            }\n            if (scrollArgs.sentinel.axis === 'Y') {\n                if (this.parent.pageSettings.currentPage === lastPage && this.rndrCount > 1) {\n                    this.rndrCount = 0;\n                    return;\n                }\n                else if (this.parent.pageSettings.currentPage !== lastPage && this.parent.pageSettings.currentPage !== lastPage - 1) {\n                    this.rndrCount = 0;\n                }\n            }\n        }\n        this.parent.notify(viewInfo.event, { requestType: 'virtualscroll', virtualInfo: viewInfo, focusElement: scrollArgs.focusElement });\n    };\n    VirtualContentRenderer.prototype.block = function (blk) {\n        return this.vgenerator.isBlockAvailable(blk);\n    };\n    VirtualContentRenderer.prototype.getInfoFromView = function (direction, info, e) {\n        var isBlockAdded = false;\n        var tempBlocks = [];\n        var infoType = { direction: direction, sentinelInfo: info, offsets: e };\n        var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.content.getBoundingClientRect().height :\n            this.parent.element.getBoundingClientRect().height;\n        infoType.page = this.getPageFromTop(e.top + vHeight, infoType);\n        infoType.blockIndexes = tempBlocks = this.vgenerator.getBlockIndexes(infoType.page);\n        infoType.loadSelf = !this.vgenerator.isBlockAvailable(tempBlocks[infoType.block]);\n        var blocks = this.ensureBlocks(infoType);\n        if (this.activeKey === 'upArrow' && infoType.blockIndexes.toString() !== blocks.toString()) {\n            // To avoid dupilcate row index problem in key focus support\n            var newBlock = blocks[blocks.length - 1];\n            if (infoType.blockIndexes.indexOf(newBlock) === -1) {\n                isBlockAdded = true;\n            }\n        }\n        infoType.blockIndexes = blocks;\n        infoType.loadNext = !blocks.filter(function (val) { return tempBlocks.indexOf(val) === -1; })\n            .every(this.block.bind(this));\n        infoType.event = (infoType.loadNext || infoType.loadSelf) ? modelChanged : refreshVirtualBlock;\n        infoType.nextInfo = infoType.loadNext ? { page: Math.max(1, infoType.page + (direction === 'down' ? 1 : -1)) } : {};\n        if (isBlockAdded) {\n            infoType.blockIndexes = [infoType.blockIndexes[0] - 1, infoType.blockIndexes[0], infoType.blockIndexes[0] + 1];\n        }\n        infoType.columnIndexes = info.axis === 'X' ? this.vgenerator.getColumnIndexes() : this.parent.getColumnIndexesInView();\n        if (this.parent.enableColumnVirtualization && info.axis === 'X') {\n            infoType.event = refreshVirtualBlock;\n        }\n        return infoType;\n    };\n    VirtualContentRenderer.prototype.ensureBlocks = function (info) {\n        var _this = this;\n        var index = info.blockIndexes[info.block];\n        var mIdx;\n        var old = index;\n        var max = Math.max;\n        var indexes = info.direction === 'down' ? [max(index, 1), ++index, ++index] : [max(index - 1, 1), index, index + 1];\n        if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns()) {\n            if (info.sentinelInfo.axis === 'X' || (info.sentinelInfo.axis === 'Y' && (info.page === this.prevInfo.page))) {\n                indexes = this.prevInfo.blockIndexes;\n            }\n        }\n        indexes = indexes.filter(function (val, ind) { return indexes.indexOf(val) === ind; });\n        if (this.prevInfo.blockIndexes.toString() === indexes.toString()) {\n            return indexes;\n        }\n        if (info.loadSelf || (info.direction === 'down' && this.isEndBlock(old))) {\n            indexes = this.vgenerator.getBlockIndexes(info.page);\n        }\n        indexes.some(function (val, ind) {\n            var result = val === (isGroupAdaptive(_this.parent) ? _this.getGroupedTotalBlocks() : _this.getTotalBlocks());\n            if (result) {\n                mIdx = ind;\n            }\n            return result;\n        });\n        if (mIdx !== undefined) {\n            indexes = indexes.slice(0, mIdx + 1);\n            if (info.block === 0 && indexes.length === 1 && this.vgenerator.isBlockAvailable(indexes[0] - 1)) {\n                indexes = [indexes[0] - 1, indexes[0]];\n            }\n        }\n        return indexes;\n    };\n    /**\n     * @hidden\n     */\n    VirtualContentRenderer.prototype.vfTblTransform = function (info, left, top, e, cOffset, translate) {\n        var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n        var isLastPage = lastPage === this.parent.pageSettings.currentPage && this.parent.enableColumnVirtualization;\n        var wrappers = [].slice.call(this.parent.getContent().querySelectorAll('.e-virtualtable'));\n        for (var i = 0; i < wrappers.length; i++) {\n            if (i === 0 && e.requestType === 'virtualscroll' && info.sentinelInfo.axis === 'X') {\n                continue;\n            }\n            if (lastPage !== this.parent.pageSettings.currentPage && this.parent.enableColumnVirtualization\n                && (left > 0 || (top > 0 && left === 0))) {\n                continue;\n            }\n            var cOff = isLastPage && i === 0 ? 0 : cOffset;\n            this.virtualEle.wrapper = wrappers[i];\n            this.virtualEle.adjustTable(cOff, translate);\n        }\n    };\n    VirtualContentRenderer.prototype.appendContent = function (target, newChild, e) {\n        // currentInfo value will be used if there are multiple dom updates happened due to mousewheel\n        var info = e.virtualInfo.sentinelInfo && e.virtualInfo.sentinelInfo.axis === 'Y' && this.currentInfo.page &&\n            this.currentInfo.page !== e.virtualInfo.page ? this.currentInfo : e.virtualInfo;\n        this.prevInfo = this.prevInfo || e.virtualInfo;\n        var cBlock = (info.columnIndexes[0]) - 1;\n        var cOffset = this.getColumnOffset(cBlock);\n        var width;\n        var blocks = info.blockIndexes;\n        if (this.parent.groupSettings.columns.length) {\n            this.refreshOffsets();\n        }\n        if (this.parent.height === '100%') {\n            this.parent.element.style.height = '100%';\n        }\n        var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.content.getBoundingClientRect().height :\n            this.parent.element.getBoundingClientRect().height;\n        var translate = 0;\n        if (this.parent.getFrozenColumns()) {\n            var mCont = this.parent.getMovableVirtualContent();\n            var left = mCont.scrollLeft;\n            var top_1 = mCont.scrollTop;\n            translate = this.getTranslateY(mCont.scrollTop, vHeight, info);\n            this.vfTblTransform(info, left, top_1, e, cOffset, translate);\n        }\n        else {\n            translate = this.getTranslateY(this.content.scrollTop, vHeight, info);\n            this.virtualEle.adjustTable(cOffset, translate);\n        }\n        if (this.parent.enableColumnVirtualization && !this.parent.getFrozenColumns()) {\n            this.header.virtualEle.adjustTable(cOffset, 0);\n        }\n        if (this.parent.enableColumnVirtualization) {\n            var cIndex = info.columnIndexes;\n            width = this.getColumnOffset(cIndex[cIndex.length - 1]) - this.getColumnOffset(cIndex[0] - 1) + '';\n            this.header.virtualEle.setWrapperWidth(width);\n        }\n        this.virtualEle.setWrapperWidth(width, Browser.isIE || Browser.info.name === 'edge');\n        if (!isNullOrUndefined(target.parentNode)) {\n            remove(target);\n        }\n        var tbody;\n        if (this.parent.getFrozenColumns() && !e.renderMovableContent) {\n            tbody = this.parent.getFrozenVirtualContent().querySelector('tbody');\n        }\n        else if (this.parent.getFrozenColumns() && e.renderMovableContent) {\n            tbody = this.parent.getMovableVirtualContent().querySelector('tbody');\n        }\n        else {\n            tbody = this.parent.element.querySelector('.e-content').querySelector('tbody');\n        }\n        if (tbody) {\n            remove(tbody);\n            target = null;\n        }\n        target = this.parent.createElement('tbody');\n        target.appendChild(newChild);\n        if (this.parent.frozenRows && e.requestType === 'virtualscroll' && this.parent.pageSettings.currentPage === 1) {\n            for (var i = 0; i < this.parent.frozenRows; i++) {\n                target.children[0].remove();\n            }\n        }\n        if (this.parent.getFrozenColumns()) {\n            if (!e.renderMovableContent) {\n                this.parent.getFrozenVirtualContent().querySelector('.e-table').appendChild(target);\n            }\n            else {\n                this.parent.getMovableVirtualContent().querySelector('.e-table').appendChild(target);\n            }\n        }\n        else {\n            this.getTable().appendChild(target);\n        }\n        if (this.parent.groupSettings.columns.length) {\n            if (!isGroupAdaptive(this.parent) && info.direction === 'up') {\n                var blk = this.offsets[this.getTotalBlocks()] - this.prevHeight;\n                this.preventEvent = true;\n                var sTop = this.content.scrollTop;\n                this.content.scrollTop = sTop + blk;\n            }\n            this.setVirtualHeight();\n            this.observer.setPageHeight(this.getOffset(blocks[blocks.length - 1]) - this.getOffset(blocks[0] - 1));\n        }\n        this.prevInfo = info;\n        if (this.isFocused && this.activeKey !== 'downArrow' && this.activeKey !== 'upArrow') {\n            this.content.focus();\n        }\n        var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n        if (this.isBottom) {\n            this.isBottom = false;\n            this.parent.getContent().firstElementChild.scrollTop = this.offsets[this.offsetKeys.length - 1];\n        }\n        if ((this.parent.pageSettings.currentPage === lastPage) && blocks.length === 1) {\n            this.isBottom = true;\n            this.parent.getContent().firstElementChild.scrollTop = this.offsets[this.offsetKeys.length - 2];\n        }\n        if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns()\n            && e.requestType === 'virtualscroll' && e.virtualInfo.sentinelInfo.axis === 'X') {\n            this.refreshMvTbalTransform();\n        }\n        this.focusCell(e, cOffset);\n    };\n    VirtualContentRenderer.prototype.focusCell = function (e, cOffset) {\n        if (this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n            return;\n        }\n        var row = this.parent.getRowByIndex(this.rowIndex);\n        var firstRow;\n        var lastRow;\n        var rows = this.parent.getRows();\n        var rowHeight = this.parent.getRowHeight();\n        var scrollEleHeight = this.parent.getContent().firstElementChild.getBoundingClientRect().height;\n        var transform = getTransformValues(this.getTable().parentElement);\n        if (isNullOrUndefined(row)) {\n            var firstRowTop = rows[0].getBoundingClientRect().top;\n            var lastRowTop = rows[rows.length - 1].getBoundingClientRect().top;\n            if (this.parent.pageSettings.currentPage !== 1) {\n                if (firstRowTop > rowHeight) { // adjusted the table transform to avoid the white space in top\n                    var value = (transform.height + this.parent.getRowHeight()) - firstRowTop;\n                    this.virtualEle.adjustTable(cOffset, value);\n                }\n                if (lastRowTop < scrollEleHeight) { // adjusted the table transform to avoid the white space in bottom\n                    var value = (scrollEleHeight - lastRowTop) + transform.height;\n                    this.virtualEle.adjustTable(cOffset, value);\n                }\n            }\n            for (var i = 0; i < rows.length; i++) {\n                if (this.isViewPortFirstRow(rows[i], rowHeight)) {\n                    firstRow = rows[i];\n                    break;\n                }\n            }\n            for (var i = rows.length - 1; i >= 0; i--) {\n                if (this.isViewPortLastRow(rows[i], scrollEleHeight)) {\n                    lastRow = rows[i];\n                    break;\n                }\n            }\n        }\n        var virtualRow = this.activeKey === 'downArrow' ? firstRow : lastRow;\n        var target = !isNullOrUndefined(row) ? row.cells[this.cellIndex]\n            : virtualRow.cells[this.cellIndex];\n        this.parent.focusModule.onClick({ target: target }, true);\n        this.parent.selectRow(parseInt(target.parentElement.getAttribute('aria-rowindex'), 10));\n        this.activeKey = this.parent.allowSelection ? this.activeKey : undefined;\n    };\n    VirtualContentRenderer.prototype.onDataReady = function (e) {\n        if (!isNullOrUndefined(e.count)) {\n            this.count = e.count;\n            this.maxPage = Math.ceil(e.count / this.parent.pageSettings.pageSize);\n        }\n        this.vgenerator.checkAndResetCache(e.requestType);\n        if (['refresh', 'filtering', 'searching', 'grouping', 'ungrouping', 'reorder', undefined]\n            .some(function (value) { return e.requestType === value; })) {\n            this.refreshOffsets();\n        }\n        if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization) {\n            var hdrTbls = [].slice.call(this.parent.getHeaderContent().querySelectorAll('.e-table'));\n            this.header.virtualEle.table = hdrTbls[1];\n        }\n        this.setVirtualHeight();\n        this.resetScrollPosition(e.requestType);\n    };\n    VirtualContentRenderer.prototype.setVirtualHeight = function () {\n        var width = this.parent.enableColumnVirtualization ?\n            this.getColumnOffset(this.parent.columns.length + this.parent.groupSettings.columns.length - 1) + 'px' : '100%';\n        if (this.parent.getFrozenColumns()) {\n            var fTblWidth = this.parent.enableColumnVirtualization ? 'auto' : width;\n            this.virtualEle.placeholder = this.parent.getFrozenVirtualContent().querySelector('.e-virtualtrack');\n            // To overcome the white space issue in last page (instead of position absolute)\n            this.virtualEle.setVirtualHeight(this.offsets[this.getTotalBlocks() - 2], fTblWidth);\n            this.virtualEle.placeholder = this.parent.getMovableVirtualContent().querySelector('.e-virtualtrack');\n            // To overcome the white space issue in last page (instead of position absolute)\n            this.virtualEle.setVirtualHeight(this.offsets[this.getTotalBlocks() - 2], width);\n        }\n        else {\n            this.virtualEle.setVirtualHeight(this.offsets[isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks()], width);\n        }\n        if (this.parent.enableColumnVirtualization) {\n            this.header.virtualEle.setVirtualHeight(1, width);\n        }\n    };\n    VirtualContentRenderer.prototype.getPageFromTop = function (sTop, info) {\n        var _this = this;\n        var total = (isGroupAdaptive(this.parent)) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();\n        var page = 0;\n        var extra = this.offsets[total] - this.prevHeight;\n        this.offsetKeys.some(function (offset) {\n            var iOffset = Number(offset);\n            var border = sTop <= _this.offsets[offset] || (iOffset === total && sTop > _this.offsets[offset]);\n            if (border) {\n                info.block = iOffset % 2 === 0 ? 1 : 0;\n                page = Math.max(1, Math.min(_this.vgenerator.getPage(iOffset), _this.maxPage));\n            }\n            return border;\n        });\n        return page;\n    };\n    VirtualContentRenderer.prototype.getTranslateY = function (sTop, cHeight, info, isOnenter) {\n        if (info === undefined) {\n            info = { page: this.getPageFromTop(sTop + cHeight, {}) };\n            info.blockIndexes = this.vgenerator.getBlockIndexes(info.page);\n        }\n        var block = (info.blockIndexes[0] || 1) - 1;\n        var translate = this.getOffset(block);\n        var endTranslate = this.getOffset(info.blockIndexes[info.blockIndexes.length - 1]);\n        if (isOnenter) {\n            info = this.prevInfo;\n        }\n        var result = translate > sTop ?\n            this.getOffset(block - 1) : endTranslate < (sTop + cHeight) ? this.getOffset(block + 1) : translate;\n        var blockHeight = this.offsets[info.blockIndexes[info.blockIndexes.length - 1]] -\n            this.tmpOffsets[info.blockIndexes[0]];\n        if (result + blockHeight > this.offsets[isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks()]) {\n            result -= (result + blockHeight) - this.offsets[this.getTotalBlocks()];\n        }\n        return result;\n    };\n    VirtualContentRenderer.prototype.getOffset = function (block) {\n        return Math.min(this.offsets[block] | 0, this.offsets[this.maxBlock] | 0);\n    };\n    VirtualContentRenderer.prototype.onEntered = function () {\n        var _this = this;\n        return function (element, current, direction, e, isWheel, check) {\n            if (Browser.isIE && !isWheel && check && !_this.preventEvent) {\n                _this.parent.showSpinner();\n            }\n            var xAxis = current.axis === 'X';\n            var top = _this.prevInfo.offsets ? _this.prevInfo.offsets.top : null;\n            var height = _this.content.getBoundingClientRect().height;\n            var x = _this.getColumnOffset(xAxis ? _this.vgenerator.getColumnIndexes()[0] - 1 : _this.prevInfo.columnIndexes[0] - 1);\n            var y = _this.getTranslateY(e.top, height, xAxis && top === e.top ? _this.prevInfo : undefined, true);\n            _this.virtualEle.adjustTable(x, Math.min(y, _this.offsets[_this.maxBlock]));\n            if (_this.parent.getFrozenColumns() && !xAxis) {\n                var left = _this.parent.getMovableVirtualContent().scrollLeft;\n                if (_this.parent.enableColumnVirtualization && left > 0) {\n                    var fvTable = _this.parent.getFrozenVirtualContent().querySelector('.e-virtualtable');\n                    fvTable.style.transform = \"translate(\" + 0 + \"px, \" + Math.min(y, _this.offsets[_this.maxBlock]) + \"px)\";\n                }\n                else {\n                    var fvTable = _this.parent.getFrozenVirtualContent().querySelector('.e-virtualtable');\n                    fvTable.style.transform = \"translate(\" + x + \"px, \" + Math.min(y, _this.offsets[_this.maxBlock]) + \"px)\";\n                }\n            }\n            if (_this.parent.enableColumnVirtualization) {\n                _this.header.virtualEle.adjustTable(x, 0);\n            }\n        };\n    };\n    VirtualContentRenderer.prototype.dataBound = function () {\n        if (this.isSelection && this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n            this.isSelection = false;\n            this.parent.selectRow(this.selectedRowIndex);\n        }\n        else {\n            this.activeKey = undefined;\n        }\n    };\n    VirtualContentRenderer.prototype.eventListener = function (action) {\n        var _this = this;\n        this.parent[action](dataReady, this.onDataReady, this);\n        this.parent.addEventListener(events.dataBound, this.dataBound.bind(this));\n        this.parent[action](refreshVirtualBlock, this.refreshContentRows, this);\n        this.parent[action](events.selectVirtualRow, this.selectVirtualRow, this);\n        this.parent[action](events.virtaulKeyHandler, this.virtualKeyHandler, this);\n        this.parent[action](events.keyPressed, this.virtualKeyHandler, this);\n        this.parent[action](events.virtaulCellFocus, this.virtualCellFocus, this);\n        this.actions.forEach(function (event) { return _this.parent[action](event + \"-begin\", _this.onActionBegin, _this); });\n        var fn = function () {\n            _this.observer.observe(function (scrollArgs) { return _this.scrollListener(scrollArgs); }, _this.onEntered());\n            var gObj = _this.parent;\n            if (gObj.enablePersistence && gObj.scrollPosition) {\n                _this.content.scrollTop = gObj.scrollPosition.top;\n                var scrollValues = { direction: 'down', sentinel: _this.observer.sentinelInfo.down,\n                    offset: gObj.scrollPosition, focusElement: gObj.element };\n                _this.scrollListener(scrollValues);\n                if (gObj.enableColumnVirtualization) {\n                    _this.content.scrollLeft = gObj.scrollPosition.left;\n                }\n            }\n            _this.parent.off(contentReady, fn);\n        };\n        this.parent.on(contentReady, fn, this);\n    };\n    VirtualContentRenderer.prototype.virtualCellFocus = function (e) {\n        // To decide the action (select or scroll), when using arrow keys for cell focus\n        var ele = document.activeElement;\n        if (ele.classList.contains('e-rowcell')\n            && e && (e.action === 'upArrow' || e.action === 'downArrow')) {\n            var rowIndex = parseInt(ele.parentElement.getAttribute('aria-rowindex'), 10);\n            if (e && (e.action === 'downArrow' || e.action === 'upArrow')) {\n                e.action === 'downArrow' ? rowIndex += 1 : rowIndex -= 1;\n                this.rowIndex = rowIndex;\n                this.cellIndex = parseInt(ele.getAttribute('aria-colindex'), 10);\n                var row = this.parent.getRowByIndex(rowIndex);\n                var top_2 = this.parent.getContent().firstElementChild.scrollTop;\n                if (isNullOrUndefined(row)) {\n                    this.parent.getContent().firstElementChild.scrollTop = e.action === 'downArrow' ?\n                        top_2 + this.parent.getRowHeight() : top_2 - this.parent.getRowHeight();\n                }\n                else {\n                    this.parent.selectRow(rowIndex);\n                }\n            }\n        }\n    };\n    VirtualContentRenderer.prototype.virtualKeyHandler = function (args) {\n        if (args && (args.action === 'upArrow' || args.action === 'downArrow')\n            && isNullOrUndefined(this.activeKey)) {\n            this.activeKey = args.action;\n        }\n    };\n    VirtualContentRenderer.prototype.getBlockSize = function () {\n        return this.parent.pageSettings.pageSize >> 1;\n    };\n    VirtualContentRenderer.prototype.getBlockHeight = function () {\n        return this.getBlockSize() * this.parent.getRowHeight();\n    };\n    VirtualContentRenderer.prototype.isEndBlock = function (index) {\n        var totalBlocks = this.getTotalBlocks();\n        return index >= totalBlocks || index === totalBlocks - 1;\n    };\n    VirtualContentRenderer.prototype.getGroupedTotalBlocks = function () {\n        var rows = this.parent.vcRows;\n        return Math.floor((rows.length / this.getBlockSize()) < 1 ? 1 : rows.length / this.getBlockSize());\n    };\n    VirtualContentRenderer.prototype.getTotalBlocks = function () {\n        return Math.ceil(this.count / this.getBlockSize());\n    };\n    VirtualContentRenderer.prototype.getColumnOffset = function (block) {\n        return this.vgenerator.cOffsets[block] | 0;\n    };\n    VirtualContentRenderer.prototype.getModelGenerator = function () {\n        return new VirtualRowModelGenerator(this.parent);\n    };\n    VirtualContentRenderer.prototype.resetScrollPosition = function (action) {\n        if (this.actions.some(function (value) { return value === action; })) {\n            this.preventEvent = this.content.scrollTop !== 0;\n            this.content.scrollTop = 0;\n        }\n    };\n    VirtualContentRenderer.prototype.onActionBegin = function (e) {\n        //Update property silently..\n        this.parent.setProperties({ pageSettings: { currentPage: 1 } }, true);\n    };\n    VirtualContentRenderer.prototype.getRows = function () {\n        return this.vgenerator.getRows();\n    };\n    VirtualContentRenderer.prototype.getRowByIndex = function (index) {\n        if (isGroupAdaptive(this.parent)) {\n            return this.parent.getDataRows()[index];\n        }\n        return this.getRowCollection(index, false);\n    };\n    VirtualContentRenderer.prototype.getMovableVirtualRowByIndex = function (index) {\n        return this.getRowCollection(index, true);\n    };\n    VirtualContentRenderer.prototype.getRowCollection = function (index, isMovable) {\n        var prev = this.prevInfo.blockIndexes;\n        var startIdx = (prev[0] - 1) * this.getBlockSize();\n        var rowCollection = isMovable ? this.parent.getMovableDataRows() : this.parent.getDataRows();\n        var selectedRow = rowCollection[index - startIdx];\n        if (this.parent.frozenRows && this.parent.pageSettings.currentPage > 1) {\n            selectedRow = index <= this.parent.frozenRows ? rowCollection[index]\n                : rowCollection[(index - startIdx) + this.parent.frozenRows];\n        }\n        return selectedRow;\n    };\n    VirtualContentRenderer.prototype.getVirtualRowIndex = function (index) {\n        var prev = this.prevInfo.blockIndexes;\n        var startIdx = (prev[0] - 1) * this.getBlockSize();\n        return startIdx + index;\n    };\n    VirtualContentRenderer.prototype.refreshOffsets = function () {\n        var _this = this;\n        var gObj = this.parent;\n        var row = 0;\n        var bSize = this.getBlockSize();\n        var total = isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();\n        this.prevHeight = this.offsets[total];\n        this.maxBlock = total % 2 === 0 ? total - 2 : total - 1;\n        this.offsets = {};\n        //Row offset update\n        Array.apply(null, Array(total)).map(function () { return ++row; })\n            .forEach(function (block) {\n            var tmp = (_this.vgenerator.cache[block] || []).length;\n            var rem = !isGroupAdaptive(_this.parent) ? _this.count % bSize : (gObj.vcRows.length % bSize);\n            var size = !isGroupAdaptive(_this.parent) && block in _this.vgenerator.cache ?\n                tmp * _this.parent.getRowHeight() : rem && block === total ? rem * _this.parent.getRowHeight() : _this.getBlockHeight();\n            // let size: number = this.parent.groupSettings.columns.length && block in this.vgenerator.cache ?\n            // tmp * getRowHeight() : this.getBlockHeight();\n            _this.offsets[block] = (_this.offsets[block - 1] | 0) + size;\n            _this.tmpOffsets[block] = _this.offsets[block - 1] | 0;\n        });\n        this.offsetKeys = Object.keys(this.offsets);\n        if (isGroupAdaptive(this.parent)) {\n            this.parent.vGroupOffsets = this.offsets;\n        }\n        //Column offset update\n        if (this.parent.enableColumnVirtualization) {\n            this.vgenerator.refreshColOffsets();\n        }\n    };\n    VirtualContentRenderer.prototype.refreshVirtualElement = function () {\n        this.vgenerator.refreshColOffsets();\n        this.setVirtualHeight();\n    };\n    VirtualContentRenderer.prototype.setVisible = function (columns) {\n        var gObj = this.parent;\n        var rows = [];\n        rows = this.getRows();\n        var testRow;\n        rows.some(function (r) { if (r.isDataRow) {\n            testRow = r;\n        } return r.isDataRow; });\n        var needFullRefresh = true;\n        if (!gObj.groupSettings.columns.length && testRow) {\n            needFullRefresh = false;\n        }\n        var tr = gObj.getDataRows();\n        for (var c = 0, clen = columns.length; c < clen; c++) {\n            var column = columns[c];\n            var idx = gObj.getNormalizedColumnIndex(column.uid);\n            var displayVal = column.visible === true ? '' : 'none';\n            if (idx !== -1 && testRow && idx < testRow.cells.length) {\n                setStyleAttribute(this.getColGroup().childNodes[idx], { 'display': displayVal });\n            }\n            if (!needFullRefresh) {\n                var width = void 0;\n                if (column.visible) {\n                    width = this.virtualEle.wrapper.offsetWidth + parseInt(column.width.toString(), 10);\n                }\n                else {\n                    width = this.virtualEle.wrapper.offsetWidth - parseInt(column.width.toString(), 10);\n                }\n                if (width > gObj.width) {\n                    this.setDisplayNone(tr, idx, displayVal, rows);\n                    this.virtualEle.setWrapperWidth(width + '');\n                    this.vgenerator.refreshColOffsets();\n                    this.refreshVirtualElement();\n                }\n                else {\n                    this.refreshContentRows({ requestType: 'refresh' });\n                }\n            }\n            if (!this.parent.invokedFromMedia && column.hideAtMedia) {\n                this.parent.updateMediaColumns(column);\n            }\n            this.parent.invokedFromMedia = false;\n        }\n        if (needFullRefresh) {\n            this.refreshContentRows({ requestType: 'refresh' });\n        }\n        else {\n            this.parent.notify(events.partialRefresh, { rows: rows, args: { isFrozen: false, rows: rows } });\n        }\n    };\n    VirtualContentRenderer.prototype.selectVirtualRow = function (args) {\n        if (this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n            this.isSelection = true;\n            this.selectedRowIndex = args.selectedIndex;\n            var page = Math.ceil((args.selectedIndex + 1) / this.parent.pageSettings.pageSize);\n            var blockIndexes = this.vgenerator.getBlockIndexes(page);\n            var scrollTop = this.offsets[blockIndexes[0] - 1];\n            var ele = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent()\n                : this.parent.getContent().firstElementChild;\n            ele.scrollTop = scrollTop;\n        }\n    };\n    VirtualContentRenderer.prototype.isViewPortFirstRow = function (row, rowHeight) {\n        var top = row.getBoundingClientRect().top;\n        return top > rowHeight;\n    };\n    VirtualContentRenderer.prototype.isViewPortLastRow = function (row, eleHeight) {\n        var top = row.getBoundingClientRect().top;\n        return top < eleHeight;\n    };\n    return VirtualContentRenderer;\n}(ContentRender));\nexport { VirtualContentRenderer };\n/**\n * @hidden\n */\nvar VirtualHeaderRenderer = /** @class */ (function (_super) {\n    __extends(VirtualHeaderRenderer, _super);\n    function VirtualHeaderRenderer(parent, locator) {\n        var _this = _super.call(this, parent, locator) || this;\n        _this.virtualEle = new VirtualElementHandler();\n        _this.gen = new VirtualRowModelGenerator(_this.parent);\n        _this.parent.on(events.columnVisibilityChanged, _this.setVisible, _this);\n        _this.parent.on(refreshVirtualBlock, function (e) { return e.virtualInfo.sentinelInfo.axis === 'X' ? _this.refreshUI() : null; }, _this);\n        return _this;\n    }\n    VirtualHeaderRenderer.prototype.renderTable = function () {\n        this.gen.refreshColOffsets();\n        this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().querySelector('.e-headercontent')));\n        _super.prototype.renderTable.call(this);\n        this.virtualEle.table = this.getTable();\n        this.virtualEle.content = this.getPanel().querySelector('.e-headercontent');\n        this.virtualEle.content.style.position = 'relative';\n        this.virtualEle.renderWrapper();\n        this.virtualEle.renderPlaceHolder('absolute');\n    };\n    VirtualHeaderRenderer.prototype.appendContent = function (table) {\n        this.virtualEle.wrapper.appendChild(table);\n    };\n    VirtualHeaderRenderer.prototype.refreshUI = function () {\n        if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization) {\n            this.parent.contentModule\n                .setTable(this.parent.getMovableVirtualContent().querySelector('.e-table'));\n        }\n        this.gen.refreshColOffsets();\n        this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().querySelector('.e-headercontent')));\n        _super.prototype.refreshUI.call(this);\n        if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization) {\n            this.parent.contentModule.setTable(this.parent.getFrozenVirtualContent()\n                .querySelector('.e-table'));\n        }\n    };\n    VirtualHeaderRenderer.prototype.setVisible = function (columns) {\n        var gObj = this.parent;\n        var displayVal;\n        var idx;\n        for (var c = 0, clen = columns.length; c < clen; c++) {\n            var column = columns[c];\n            idx = gObj.getNormalizedColumnIndex(column.uid);\n            displayVal = column.visible ? '' : 'none';\n            setStyleAttribute(this.getColGroup().children[idx], { 'display': displayVal });\n            if (gObj.enableColumnVirtualization && !gObj.groupSettings.columns.length) {\n                var tablewidth = void 0;\n                if (column.visible) {\n                    tablewidth = this.virtualEle.wrapper.offsetWidth + parseInt(column.width.toString(), 10);\n                }\n                else {\n                    tablewidth = this.virtualEle.wrapper.offsetWidth - parseInt(column.width.toString(), 10);\n                }\n                if (tablewidth > gObj.width) {\n                    this.setDisplayNone(column, displayVal);\n                    this.virtualEle.setWrapperWidth(tablewidth + '');\n                    this.gen.refreshColOffsets();\n                }\n                else {\n                    this.refreshUI();\n                }\n            }\n            else {\n                this.refreshUI();\n            }\n        }\n    };\n    VirtualHeaderRenderer.prototype.setDisplayNone = function (col, displayVal) {\n        for (var _i = 0, _a = [].slice.apply(this.getTable().querySelectorAll('th.e-headercell')); _i < _a.length; _i++) {\n            var ele = _a[_i];\n            if (ele.querySelector('[e-mappinguid]') &&\n                ele.querySelector('[e-mappinguid]').getAttribute('e-mappinguid') === col.uid) {\n                setStyleAttribute(ele, { 'display': displayVal });\n                break;\n            }\n        }\n    };\n    return VirtualHeaderRenderer;\n}(HeaderRender));\nexport { VirtualHeaderRenderer };\n/**\n * @hidden\n */\nvar VirtualElementHandler = /** @class */ (function () {\n    function VirtualElementHandler() {\n    }\n    VirtualElementHandler.prototype.renderWrapper = function (height) {\n        this.wrapper = createElement('div', { className: 'e-virtualtable', styles: \"min-height:\" + formatUnit(height) });\n        this.wrapper.appendChild(this.table);\n        this.content.appendChild(this.wrapper);\n    };\n    VirtualElementHandler.prototype.renderPlaceHolder = function (position) {\n        if (position === void 0) { position = 'relative'; }\n        this.placeholder = createElement('div', { className: 'e-virtualtrack', styles: \"position:\" + position });\n        this.content.appendChild(this.placeholder);\n    };\n    VirtualElementHandler.prototype.adjustTable = function (xValue, yValue) {\n        this.wrapper.style.transform = \"translate(\" + xValue + \"px, \" + yValue + \"px)\";\n    };\n    VirtualElementHandler.prototype.setWrapperWidth = function (width, full) {\n        this.wrapper.style.width = width ? width + \"px\" : full ? '100%' : '';\n    };\n    VirtualElementHandler.prototype.setVirtualHeight = function (height, width) {\n        this.placeholder.style.height = height + \"px\";\n        this.placeholder.style.width = width;\n    };\n    return VirtualElementHandler;\n}());\nexport { VirtualElementHandler };\n"]},"metadata":{},"sourceType":"module"}