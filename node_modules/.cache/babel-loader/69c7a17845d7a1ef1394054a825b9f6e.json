{"ast":null,"code":"import { closest, addClass } from '@syncfusion/ej2-base';\nimport { extend, getValue, resetBlazorTemplate, isBlazor } from '@syncfusion/ej2-base';\nimport { remove } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport { EditRender } from '../renderer/edit-renderer';\nimport { BooleanEditCell } from '../renderer/boolean-edit-cell';\nimport { DropDownEditCell } from '../renderer/dropdown-edit-cell';\nimport { NumericEditCell } from '../renderer/numeric-edit-cell';\nimport { DefaultEditCell } from '../renderer/default-edit-cell';\nimport { InlineEdit } from './inline-edit';\nimport { BatchEdit } from './batch-edit';\nimport { DialogEdit } from './dialog-edit';\nimport { Dialog } from '@syncfusion/ej2-popups';\nimport { parentsUntil, getComplexFieldID, setComplexFieldID, getScrollBarWidth } from '../base/util';\nimport { FormValidator } from '@syncfusion/ej2-inputs';\nimport { DatePickerEditCell } from '../renderer/datepicker-edit-cell';\nimport { calculateRelativeBasedPosition } from '@syncfusion/ej2-popups';\nimport { TemplateEditCell } from '../renderer/template-edit-cell';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * The `Edit` module is used to handle editing actions.\n */\n\nvar Edit =\n/** @class */\nfunction () {\n  /**\n   * Constructor for the Grid editing module\n   * @hidden\n   */\n  function Edit(parent, serviceLocator) {\n    this.editType = {\n      'Inline': InlineEdit,\n      'Normal': InlineEdit,\n      'Batch': BatchEdit,\n      'Dialog': DialogEdit\n    };\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.l10n = this.serviceLocator.getService('localization');\n    this.addEventListener();\n    this.updateEditObj();\n    this.createAlertDlg();\n    this.createConfirmDlg();\n  }\n\n  Edit.prototype.updateColTypeObj = function () {\n    var _this = this;\n\n    this.parent.columnModel.forEach(function (col) {\n      if (_this.parent.editSettings.template || col.editTemplate) {\n        var templteCell = 'templateedit';\n        col.edit = extend(new Edit.editCellType[templteCell](_this.parent), col.edit || {});\n      } else {\n        col.edit = extend(new Edit.editCellType[col.editType && Edit.editCellType[col.editType] ? col.editType : 'defaultedit'](_this.parent, _this.serviceLocator), col.edit || {});\n      }\n    });\n    this.parent.log('primary_column_missing');\n  };\n  /**\n   * For internal use only - Get the module name.\n   * @private\n   */\n\n\n  Edit.prototype.getModuleName = function () {\n    return 'edit';\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.onPropertyChanged = function (e) {\n    if (e.module !== this.getModuleName()) {\n      return;\n    }\n\n    var gObj = this.parent;\n    var newProp = e.properties;\n\n    for (var _i = 0, _a = Object.keys(e.properties); _i < _a.length; _i++) {\n      var prop = _a[_i];\n\n      switch (prop) {\n        case 'allowAdding':\n        case 'allowDeleting':\n        case 'allowEditing':\n          if (gObj.editSettings.allowAdding || gObj.editSettings.allowEditing || gObj.editSettings.allowDeleting) {\n            this.initialEnd();\n          }\n\n          break;\n\n        case 'mode':\n          this.updateEditObj();\n          gObj.isEdit = false;\n          gObj.refresh();\n          break;\n      }\n    }\n  };\n\n  Edit.prototype.updateEditObj = function () {\n    if (this.editModule) {\n      this.editModule.destroy();\n    }\n\n    this.renderer = new EditRender(this.parent, this.serviceLocator);\n    this.editModule = new this.editType[this.parent.editSettings.mode](this.parent, this.serviceLocator, this.renderer);\n  };\n\n  Edit.prototype.initialEnd = function () {\n    this.updateColTypeObj();\n  };\n  /**\n   * Edits any bound record in the Grid by TR element.\n   * @param {HTMLTableRowElement} tr - Defines the table row to be edited.\n   */\n\n\n  Edit.prototype.startEdit = function (tr) {\n    var gObj = this.parent;\n\n    if (!gObj.editSettings.allowEditing || gObj.isEdit || gObj.editSettings.mode === 'Batch') {\n      return;\n    }\n\n    this.parent.element.classList.add('e-editing');\n\n    if (!gObj.getSelectedRows().length) {\n      if (!tr) {\n        this.showDialog('EditOperationAlert', this.alertDObj);\n        return;\n      }\n    } else if (!tr) {\n      tr = gObj.getSelectedRows()[0];\n    }\n\n    this.isLastRow = tr.rowIndex === this.parent.getContent().querySelector('tr:last-child').rowIndex;\n\n    if (tr.style.display === 'none') {\n      return;\n    }\n\n    this.editModule.startEdit(tr);\n\n    if (!isBlazor()) {\n      this.refreshToolbar();\n      gObj.element.querySelector('.e-gridpopup').style.display = 'none';\n      this.parent.notify('start-edit', {});\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.checkLastRow = function (tr, args) {\n    var checkLastRow = this.isLastRow;\n\n    if (this.parent.height !== 'auto' && this.parent.editSettings.newRowPosition === 'Bottom' && args && args.requestType === 'add') {\n      addClass(tr.querySelectorAll('.e-rowcell'), 'e-lastrowadded');\n    } else if (checkLastRow) {\n      addClass(tr.querySelectorAll('.e-rowcell'), 'e-lastrowcell');\n    }\n  };\n  /**\n   * Cancels edited state.\n   */\n\n\n  Edit.prototype.closeEdit = function () {\n    if (this.parent.editSettings.mode === 'Batch' && this.parent.editSettings.showConfirmDialog && this.parent.element.querySelectorAll('.e-updatedtd').length) {\n      this.showDialog('CancelEdit', this.dialogObj);\n      return;\n    }\n\n    this.editModule.closeEdit();\n\n    if (!isBlazor()) {\n      this.refreshToolbar();\n      this.parent.notify('close-edit', {});\n    }\n  };\n\n  Edit.prototype.refreshToolbar = function () {\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n  /**\n   * To adds a new row at the top with the given data. When data is not passed, it will add empty rows.\n   * > `editSettings.allowEditing` should be true.\n   * @param {Object} data - Defines the new add record data.\n   * @param {number} index - Defines the row index to be added\n   */\n\n\n  Edit.prototype.addRecord = function (data, index) {\n    if (!this.parent.editSettings.allowAdding) {\n      return;\n    }\n\n    this.parent.element.classList.add('e-editing');\n    this.editModule.addRecord(data, index);\n\n    if (!isBlazor()) {\n      this.refreshToolbar();\n      this.parent.notify('start-add', {});\n    }\n  };\n  /**\n   * Deletes a record with the given options. If fieldname and data are not given, the Grid will delete the selected record.\n   * > `editSettings.allowDeleting` should be true.\n   * @param {string} fieldname - Defines the primary key field name of the column.\n   * @param {Object} data - Defines the JSON data record to be deleted.\n   */\n\n\n  Edit.prototype.deleteRecord = function (fieldname, data) {\n    var gObj = this.parent;\n\n    if (!gObj.editSettings.allowDeleting) {\n      return;\n    }\n\n    if (!data) {\n      if (!gObj.getSelectedRecords().length) {\n        this.showDialog('DeleteOperationAlert', this.alertDObj);\n        return;\n      }\n    }\n\n    if (gObj.editSettings.showDeleteConfirmDialog) {\n      this.showDialog('ConfirmDelete', this.dialogObj);\n      return;\n    }\n\n    this.editModule.deleteRecord(fieldname, data);\n  };\n  /**\n   * Deletes a visible row by TR element.\n   * @param {HTMLTableRowElement} tr - Defines the table row element.\n   */\n\n\n  Edit.prototype.deleteRow = function (tr) {\n    this.deleteRowUid = tr.getAttribute('data-uid');\n    var rowObj = this.parent.getRowObjectFromUID(this.deleteRowUid);\n\n    if (!isNullOrUndefined(rowObj)) {\n      this.deleteRecord(null, rowObj.data);\n    }\n  };\n  /**\n   * If Grid is in editable state, you can save a record by invoking endEdit.\n   */\n\n\n  Edit.prototype.endEdit = function () {\n    if (this.parent.editSettings.mode === 'Batch' && this.parent.editSettings.showConfirmDialog && (isNullOrUndefined(this.formObj) || this.formObj.validate())) {\n      this.parent.editModule.saveCell();\n      this.parent.notify(events.editNextValCell, {});\n\n      if (isNullOrUndefined(this.formObj) || this.formObj.validate()) {\n        this.showDialog('BatchSaveConfirm', this.dialogObj);\n        return;\n      }\n    }\n\n    this.endEditing();\n  };\n  /**\n   * To update the specified cell by given value without changing into edited state.\n   * @param {number} rowIndex Defines the row index.\n   * @param {string} field Defines the column field.\n   * @param {string | number | boolean | Date} value - Defines the value to be changed.\n   */\n\n\n  Edit.prototype.updateCell = function (rowIndex, field, value) {\n    this.editModule.updateCell(rowIndex, field, value);\n  };\n  /**\n   * To update the specified row by given values without changing into edited state.\n   * @param {number} index Defines the row index.\n   * @param {Object} data Defines the data object to be updated.\n   */\n\n\n  Edit.prototype.updateRow = function (index, data) {\n    this.editModule.updateRow(index, data);\n  };\n  /**\n   * Resets added, edited, and deleted records in the batch mode.\n   */\n\n\n  Edit.prototype.batchCancel = function () {\n    this.closeEdit();\n  };\n  /**\n   * Bulk saves added, edited, and deleted records in the batch mode.\n   */\n\n\n  Edit.prototype.batchSave = function () {\n    this.endEdit();\n  };\n  /**\n   * Changes a particular cell into edited state based on the row index and field name provided in the `batch` mode.\n   * @param {number} index - Defines row index to edit a particular cell.\n   * @param {string} field - Defines the field name of the column to perform batch edit.\n   */\n\n\n  Edit.prototype.editCell = function (index, field) {\n    this.editModule.editCell(index, field);\n  };\n  /**\n   * Checks the status of validation at the time of editing. If validation is passed, it returns true.\n   * @return {boolean}\n   */\n\n\n  Edit.prototype.editFormValidate = function () {\n    if (this.formObj) {\n      return this.formObj.validate();\n    }\n\n    return false;\n  };\n  /**\n   * Gets the added, edited,and deleted data before bulk save to the DataSource in batch mode.\n   * @return {Object}\n   */\n\n\n  Edit.prototype.getBatchChanges = function () {\n    return this.editModule.getBatchChanges ? this.editModule.getBatchChanges() : {};\n  };\n  /**\n   * Gets the current value of the edited component.\n   */\n\n\n  Edit.prototype.getCurrentEditCellData = function () {\n    var obj = this.getCurrentEditedData(this.formObj.element, {});\n    return obj[Object.keys(obj)[0]];\n  };\n  /**\n   * Saves the cell that is currently edited. It does not save the value to the DataSource.\n   */\n\n\n  Edit.prototype.saveCell = function () {\n    this.editModule.saveCell();\n  };\n\n  Edit.prototype.endEditing = function () {\n    this.parent.element.classList.remove('e-editing');\n    this.editModule.endEdit();\n    this.refreshToolbar();\n  };\n\n  Edit.prototype.showDialog = function (content, obj) {\n    obj.content = '<div>' + this.l10n.getConstant(content) + '</div>';\n    obj.dataBind();\n    obj.show();\n  };\n\n  Edit.prototype.getValueFromType = function (col, value) {\n    var val = value;\n\n    switch (col.type) {\n      case 'number':\n        val = !isNaN(parseFloat(value)) ? parseFloat(value) : null;\n        break;\n\n      case 'boolean':\n        if (col.editType !== 'booleanedit') {\n          val = value === this.l10n.getConstant('True') || value === true ? true : false;\n        }\n\n        break;\n\n      case 'date':\n      case 'datetime':\n        if (col.editType !== 'datepickeredit' && col.editType !== 'datetimepickeredit' && value && value.length) {\n          val = new Date(value);\n        } else if (value === '') {\n          val = null;\n        }\n\n        break;\n    }\n\n    return val;\n  };\n\n  Edit.prototype.destroyToolTip = function () {\n    var elements = [].slice.call(this.parent.element.querySelectorAll('.e-griderror'));\n\n    for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n      var elem = elements_1[_i];\n      remove(elem);\n    }\n\n    this.parent.getContent().firstElementChild.style.position = 'relative';\n  };\n\n  Edit.prototype.createConfirmDlg = function () {\n    this.dialogObj = this.dlgWidget([{\n      click: this.dlgOk.bind(this),\n      buttonModel: {\n        content: this.l10n.getConstant('OKButton'),\n        cssClass: 'e-primary',\n        isPrimary: true\n      }\n    }, {\n      click: this.dlgCancel.bind(this),\n      buttonModel: {\n        cssClass: 'e-flat',\n        content: this.l10n.getConstant('CancelButton')\n      }\n    }], 'EditConfirm');\n  };\n\n  Edit.prototype.createAlertDlg = function () {\n    this.alertDObj = this.dlgWidget([{\n      click: this.alertClick.bind(this),\n      buttonModel: {\n        content: this.l10n.getConstant('OKButton'),\n        cssClass: 'e-flat',\n        isPrimary: true\n      }\n    }], 'EditAlert');\n  };\n\n  Edit.prototype.alertClick = function () {\n    this.alertDObj.hide();\n  };\n\n  Edit.prototype.dlgWidget = function (btnOptions, name) {\n    var div = this.parent.createElement('div', {\n      id: this.parent.element.id + name\n    });\n    this.parent.element.appendChild(div);\n    var options = {\n      showCloseIcon: false,\n      isModal: true,\n      visible: false,\n      closeOnEscape: true,\n      target: this.parent.element,\n      width: '320px',\n      animationSettings: {\n        effect: 'None'\n      }\n    };\n    options.buttons = btnOptions;\n    var obj = new Dialog(options);\n    var isStringTemplate = 'isStringTemplate';\n    obj[isStringTemplate] = true;\n    obj.appendTo(div);\n    return obj;\n  };\n\n  Edit.prototype.dlgCancel = function () {\n    this.dialogObj.hide();\n  };\n\n  Edit.prototype.dlgOk = function (e) {\n    switch (this.dialogObj.element.querySelector('.e-dlg-content').firstElementChild.innerText) {\n      case this.l10n.getConstant('ConfirmDelete'):\n        this.editModule.deleteRecord();\n        break;\n\n      case this.l10n.getConstant('CancelEdit'):\n        this.editModule.closeEdit();\n        break;\n\n      case this.l10n.getConstant('BatchSaveConfirm'):\n        this.endEditing();\n        break;\n\n      case this.l10n.getConstant('BatchSaveLostChanges'):\n        if (this.parent.editSettings.mode === 'Batch') {\n          this.editModule.addCancelWhilePaging();\n\n          if (isBlazor() && this.parent.isServerRendered) {\n            this.editModule.closeEdit();\n          }\n        }\n\n        this.executeAction();\n        break;\n    }\n\n    this.dlgCancel();\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.inBoundModelChanged, this.onPropertyChanged, this);\n    this.parent.on(events.initialEnd, this.initialEnd, this);\n    this.parent.on(events.keyPressed, this.keyPressHandler, this);\n    this.parent.on(events.autoCol, this.updateColTypeObj, this);\n    this.parent.on(events.tooltipDestroy, this.destroyToolTip, this);\n    this.parent.on(events.preventBatch, this.preventBatch, this);\n    this.parent.on(events.destroyForm, this.destroyForm, this);\n    this.actionBeginFunction = this.onActionBegin.bind(this);\n    this.actionCompleteFunction = this.actionComplete.bind(this);\n    this.parent.addEventListener(events.actionBegin, this.actionBeginFunction);\n    this.parent.addEventListener(events.actionComplete, this.actionCompleteFunction);\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.inBoundModelChanged, this.onPropertyChanged);\n    this.parent.off(events.initialEnd, this.initialEnd);\n    this.parent.off(events.keyPressed, this.keyPressHandler);\n    this.parent.off(events.autoCol, this.updateColTypeObj);\n    this.parent.off(events.tooltipDestroy, this.destroyToolTip);\n    this.parent.off(events.preventBatch, this.preventBatch);\n    this.parent.off(events.destroyForm, this.destroyForm);\n    this.parent.removeEventListener(events.actionComplete, this.actionCompleteFunction);\n    this.parent.removeEventListener(events.actionBegin, this.actionBeginFunction);\n  };\n\n  Edit.prototype.actionComplete = function (e) {\n    var actions = ['add', 'beginEdit', 'save', 'delete', 'cancel'];\n\n    if (actions.indexOf(e.requestType) < 0) {\n      this.parent.isEdit = false;\n    }\n\n    this.refreshToolbar();\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.getCurrentEditedData = function (form, editedData) {\n    var _this = this;\n\n    var gObj = this.parent;\n\n    if (gObj.editSettings.template) {\n      [].slice.call(form.elements).forEach(function (element) {\n        if (element.hasAttribute('name')) {\n          var field = setComplexFieldID(element.getAttribute('name'));\n          var column = gObj.getColumnByField(field) || {\n            field: field,\n            type: element.getAttribute('type')\n          };\n          var value = void 0;\n\n          if (column.type === 'checkbox' || column.type === 'boolean') {\n            value = element.checked;\n          } else if (element.value) {\n            value = element.value;\n\n            if (element.ej2_instances && element.ej2_instances.length && !isNullOrUndefined(element.ej2_instances[0].value)) {\n              element.blur();\n              value = element.ej2_instances[0].value;\n\n              if ((column.type === 'date' || column.type === 'dateTime') && element.ej2_instances[0].isServerRendered) {\n                value = element.value;\n              }\n            }\n          }\n\n          if (column.edit && typeof column.edit.read === 'string') {\n            value = getValue(column.edit.read, window)(element, value);\n          } else if (column.edit && column.edit.read) {\n            value = column.edit.read(element, value);\n          }\n\n          value = gObj.editModule.getValueFromType(column, value);\n          DataUtil.setValue(column.field, value, editedData);\n        }\n      });\n      return editedData;\n    }\n\n    gObj.columnModel.filter(function (col) {\n      return col.editTemplate;\n    }).forEach(function (col) {\n      if (form[getComplexFieldID(col.field)]) {\n        var inputElements = [].slice.call(form[getComplexFieldID(col.field)]);\n        inputElements = inputElements.length ? inputElements : [form[getComplexFieldID(col.field)]];\n        inputElements.forEach(function (input) {\n          var value = _this.getValue(col, input, editedData);\n\n          DataUtil.setValue(col.field, value, editedData);\n        });\n      }\n    });\n    var inputs = [].slice.call(form.querySelectorAll('.e-field'));\n\n    for (var i = 0, len = inputs.length; i < len; i++) {\n      var col = gObj.getColumnByUid(inputs[i].getAttribute('e-mappinguid'));\n\n      if (col && col.field) {\n        var value = this.getValue(col, inputs[i], editedData);\n        DataUtil.setValue(col.field, value, editedData);\n      }\n    }\n\n    return editedData;\n  };\n\n  Edit.prototype.getValue = function (col, input, editedData) {\n    var value = col.isForeignColumn() ? input.ej2_instances ? input.ej2_instances[0].value : input.value : input.value;\n    var gObj = this.parent;\n    var temp = col.edit.read;\n\n    if (col.type === 'checkbox' || col.type === 'boolean') {\n      value = input.checked;\n    }\n\n    if (typeof temp === 'string') {\n      temp = getValue(temp, window);\n      value = gObj.editModule.getValueFromType(col, temp(input, value));\n    } else {\n      value = gObj.editModule.getValueFromType(col, col.edit.read(input, value));\n    }\n\n    if (isNullOrUndefined(editedData[col.field]) && value === '') {\n      value = editedData[col.field];\n    }\n\n    return value;\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.onActionBegin = function (e) {\n    var restrictedRequestTypes = ['filterafteropen', 'filterbeforeopen', 'filterchoicerequest', 'save'];\n\n    if (this.parent.editSettings.mode !== 'Batch' && this.formObj && !this.formObj.isDestroyed && restrictedRequestTypes.indexOf(e.requestType) === -1) {\n      this.destroyWidgets();\n      this.destroyForm();\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.destroyWidgets = function (cols) {\n    var gObj = this.parent;\n\n    if (gObj.editSettings.template) {\n      this.parent.destroyTemplate(['editSettingsTemplate']);\n    }\n\n    cols = cols ? cols : this.parent.getColumns();\n\n    if (cols.some(function (column) {\n      return !isNullOrUndefined(column.editTemplate);\n    })) {\n      this.parent.destroyTemplate(['editTemplate']);\n    }\n\n    for (var _i = 0, cols_1 = cols; _i < cols_1.length; _i++) {\n      var col = cols_1[_i];\n      var temp = col.edit.destroy;\n\n      if (isBlazor() && col.editTemplate) {\n        resetBlazorTemplate(this.parent.element.id + col.uid + 'editTemplate', 'EditTemplate');\n      }\n\n      if (col.edit.destroy) {\n        if (typeof temp === 'string') {\n          temp = getValue(temp, window);\n          temp();\n        } else {\n          col.edit.destroy();\n        }\n      }\n    }\n\n    [].slice.call(this.formObj.element.elements).forEach(function (element) {\n      if (element.hasAttribute('name')) {\n        if (element.ej2_instances && element.ej2_instances.length && !element.ej2_instances[0].isDestroyed) {\n          element.ej2_instances[0].destroy();\n        }\n      }\n    });\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.destroyForm = function () {\n    this.destroyToolTip();\n\n    if (this.formObj && !this.formObj.isDestroyed) {\n      this.formObj.destroy();\n    }\n\n    this.destroyToolTip();\n  };\n  /**\n   * To destroy the editing.\n   * @return {void}\n   * @hidden\n   */\n\n\n  Edit.prototype.destroy = function () {\n    var gridElement = this.parent.element;\n\n    if (!gridElement) {\n      return;\n    }\n\n    var hasGridChild = gridElement.querySelector('.e-gridheader') && gridElement.querySelector('.e-gridcontent') ? true : false;\n\n    if (hasGridChild) {\n      this.destroyForm();\n    }\n\n    this.removeEventListener();\n    var elem = this.dialogObj.element;\n\n    if (elem.childElementCount > 0) {\n      this.dialogObj.destroy();\n      remove(elem);\n    }\n\n    elem = this.alertDObj.element;\n\n    if (elem.childElementCount > 0) {\n      this.alertDObj.destroy();\n      remove(elem);\n    }\n\n    if (!hasGridChild) {\n      return;\n    }\n\n    if (this.editModule) {\n      this.editModule.destroy();\n    }\n  };\n\n  Edit.prototype.keyPressHandler = function (e) {\n    switch (e.action) {\n      case 'insert':\n        this.addRecord();\n        break;\n\n      case 'delete':\n        if ((e.target.tagName !== 'INPUT' || e.target.classList.contains('e-checkselect')) && !document.querySelector('.e-popup-open')) {\n          this.deleteRecord();\n        }\n\n        break;\n\n      case 'f2':\n        this.startEdit();\n        break;\n\n      case 'enter':\n        if (!parentsUntil(e.target, 'e-unboundcelldiv') && this.parent.editSettings.mode !== 'Batch' && (parentsUntil(e.target, 'e-gridcontent') || this.parent.frozenRows && parentsUntil(e.target, 'e-headercontent')) && !document.querySelectorAll('.e-popup-open').length) {\n          e.preventDefault();\n          this.endEdit();\n        }\n\n        break;\n\n      case 'escape':\n        if (this.parent.isEdit) {\n          this.closeEdit();\n        }\n\n        break;\n    }\n  };\n\n  Edit.prototype.preventBatch = function (args) {\n    this.preventObj = args;\n    this.showDialog('BatchSaveLostChanges', this.dialogObj);\n  };\n\n  Edit.prototype.executeAction = function () {\n    this.preventObj.handler.call(this.preventObj.instance, this.preventObj.arg1, this.preventObj.arg2, this.preventObj.arg3, this.preventObj.arg4, this.preventObj.arg5, this.preventObj.arg6, this.preventObj.arg7, this.preventObj.arg8);\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.applyFormValidation = function (cols) {\n    var gObj = this.parent;\n    var frzCols = gObj.getFrozenColumns();\n    var form = this.parent.editSettings.mode !== 'Dialog' ? gObj.element.querySelector('.e-gridform') : document.querySelector('#' + gObj.element.id + '_dialogEdit_wrapper').querySelector('.e-gridform');\n    var mForm = gObj.element.querySelectorAll('.e-gridform')[1];\n    var rules = {};\n    var mRules = {};\n    cols = cols ? cols : gObj.getColumns();\n    cols.forEach(function (col, index) {\n      if (!col.visible) {\n        return;\n      }\n\n      if (isBlazor() && col.editTemplate) {\n        return;\n      }\n\n      if (index < frzCols && col.validationRules) {\n        rules[getComplexFieldID(col.field)] = col.validationRules;\n      } else if (index >= frzCols && col.validationRules) {\n        mRules[getComplexFieldID(col.field)] = col.validationRules;\n      }\n    });\n\n    if (frzCols && this.parent.editSettings.mode !== 'Dialog') {\n      this.parent.editModule.mFormObj = this.createFormObj(mForm, mRules);\n    } else {\n      rules = extend(rules, mRules);\n    }\n\n    if (isBlazor() && this.parent.editSettings.template) {\n      this.parent.editModule.formObj = this.createFormObj(form, {});\n    } else {\n      this.parent.editModule.formObj = this.createFormObj(form, rules);\n    }\n  };\n\n  Edit.prototype.createFormObj = function (form, rules) {\n    var _this = this;\n\n    return new FormValidator(form, {\n      rules: rules,\n      locale: this.parent.locale,\n      validationComplete: function (args) {\n        _this.validationComplete(args);\n      },\n      customPlacement: function (inputElement, error) {\n        var uid = inputElement.getAttribute('e-mappinguid');\n        var args = {\n          column: _this.parent.getColumnByUid(uid),\n          error: error,\n          inputElement: inputElement,\n          value: inputElement.value\n        };\n\n        _this.valErrorPlacement(inputElement, error);\n\n        _this.parent.notify(events.valCustomPlacement, args);\n      }\n    });\n  };\n\n  Edit.prototype.valErrorPlacement = function (inputElement, error) {\n    if (this.parent.isEdit) {\n      var id = error.getAttribute('for');\n      var elem = this.getElemTable(inputElement).querySelector('#' + id + '_Error');\n\n      if (!elem) {\n        this.createTooltip(inputElement, error, id, '');\n      } else {\n        elem.querySelector('.e-tip-content').innerHTML = error.outerHTML;\n      }\n    }\n  };\n\n  Edit.prototype.getElemTable = function (inputElement) {\n    var isFHdr;\n\n    if (this.parent.editSettings.mode !== 'Dialog') {\n      isFHdr = this.parent.frozenRows && this.parent.frozenRows > (parseInt(closest(inputElement, '.e-row').getAttribute('aria-rowindex'), 10) || 0);\n    }\n\n    return this.parent.editSettings.mode !== 'Dialog' ? isFHdr ? this.parent.getHeaderTable() : this.parent.getContentTable() : document.querySelector('#' + this.parent.element.id + '_dialogEdit_wrapper');\n  };\n\n  Edit.prototype.validationComplete = function (args) {\n    if (this.parent.isEdit) {\n      var elem = this.getElemTable(args.element).querySelector('#' + args.inputName + '_Error');\n\n      if (elem) {\n        if (args.status === 'failure') {\n          elem.style.display = '';\n        } else {\n          elem.style.display = 'none';\n        }\n      }\n    }\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  Edit.prototype.createTooltip = function (element, error, name, display) {\n    var gcontent = this.parent.getContent().firstElementChild;\n\n    if (this.parent.getFrozenColumns()) {\n      gcontent = this.parent.getMovableVirtualContent();\n    }\n\n    var isScroll = gcontent.scrollHeight > gcontent.clientHeight || gcontent.scrollWidth > gcontent.clientWidth;\n    var isInline = this.parent.editSettings.mode !== 'Dialog';\n    var td = closest(element, '.e-rowcell');\n    var row = closest(element, '.e-row');\n    var fCont = this.parent.getContent().querySelector('.e-frozencontent');\n    var isFHdr;\n    var isFHdrLastRow = false;\n    var validationForBottomRowPos;\n    var isBatchModeLastRow = false;\n\n    if (this.parent.editSettings.mode === 'Batch') {\n      var rows = !fCont ? [].slice.call(this.parent.getContent().querySelectorAll('.e-row')) : [].slice.call(this.parent.getFrozenVirtualContent().querySelectorAll('.e-row'));\n\n      if (rows[rows.length - 1].getAttribute('aria-rowindex') === row.getAttribute('aria-rowindex')) {\n        isBatchModeLastRow = true;\n      }\n    }\n\n    if (isInline) {\n      if (this.parent.frozenRows) {\n        var fHeraderRows = this.parent.getFrozenColumns() ? this.parent.getFrozenVirtualHeader().querySelector('tbody').children : this.parent.getHeaderTable().querySelector('tbody').children;\n        isFHdr = fHeraderRows.length > (parseInt(row.getAttribute('aria-rowindex'), 10) || 0);\n        isFHdrLastRow = isFHdr && parseInt(row.getAttribute('aria-rowindex'), 10) === fHeraderRows.length - 1;\n      }\n\n      if (isFHdrLastRow || this.parent.editSettings.newRowPosition === 'Bottom' && this.editModule.args && this.editModule.args.requestType === 'add' || td.classList.contains('e-lastrowcell') && !row.classList.contains('e-addedrow') || isBatchModeLastRow) {\n        validationForBottomRowPos = true;\n      }\n    }\n\n    var table = isInline ? isFHdr ? this.parent.getHeaderTable() : this.parent.getContentTable() : document.querySelector('#' + this.parent.element.id + '_dialogEdit_wrapper').querySelector('.e-dlg-content');\n    var client = table.getBoundingClientRect();\n    var left = isInline ? this.parent.element.getBoundingClientRect().left : client.left;\n    var input = closest(element, 'td');\n    var inputClient = input ? input.getBoundingClientRect() : element.parentElement.getBoundingClientRect();\n    var div = this.parent.createElement('div', {\n      className: 'e-tooltip-wrap e-lib e-control e-popup e-griderror',\n      id: name + '_Error',\n      styles: 'display:' + display + ';top:' + ((isFHdr ? inputClient.top + inputClient.height : inputClient.bottom - client.top - (this.parent.getFrozenColumns() ? fCont.scrollTop : 0)) + table.scrollTop + 9) + 'px;left:' + (inputClient.left - left + table.scrollLeft + inputClient.width / 2) + 'px;' + 'max-width:' + inputClient.width + 'px;text-align:center;'\n    });\n\n    if (isInline && client.left < left) {\n      div.style.left = parseInt(div.style.left, 10) - client.left + left + 'px';\n    }\n\n    var content = this.parent.createElement('div', {\n      className: 'e-tip-content'\n    });\n    content.appendChild(error);\n    var arrow;\n\n    if (validationForBottomRowPos) {\n      arrow = this.parent.createElement('div', {\n        className: 'e-arrow-tip e-tip-bottom'\n      });\n      arrow.appendChild(this.parent.createElement('div', {\n        className: 'e-arrow-tip-outer e-tip-bottom'\n      }));\n      arrow.appendChild(this.parent.createElement('div', {\n        className: 'e-arrow-tip-inner e-tip-bottom'\n      }));\n    } else {\n      arrow = this.parent.createElement('div', {\n        className: 'e-arrow-tip e-tip-top'\n      });\n      arrow.appendChild(this.parent.createElement('div', {\n        className: 'e-arrow-tip-outer e-tip-top'\n      }));\n      arrow.appendChild(this.parent.createElement('div', {\n        className: 'e-arrow-tip-inner e-tip-top'\n      }));\n    }\n\n    div.appendChild(content);\n    div.appendChild(arrow);\n\n    if ((this.parent.getFrozenColumns() || this.parent.frozenRows) && this.parent.editSettings.mode !== 'Dialog') {\n      var getEditCell = this.parent.editSettings.mode === 'Normal' ? closest(element, '.e-editcell') : closest(element, '.e-table');\n      getEditCell.style.position = 'relative';\n      div.style.position = 'absolute';\n\n      if (this.parent.editSettings.mode === 'Batch' || closest(element, '.e-frozencontent') || closest(element, '.e-frozenheader') || this.parent.frozenRows && !this.parent.getFrozenColumns()) {\n        this.formObj.element.appendChild(div);\n      } else {\n        this.mFormObj.element.appendChild(div);\n      }\n    } else {\n      this.formObj.element.appendChild(div);\n    }\n\n    if (!validationForBottomRowPos && isInline && gcontent.getBoundingClientRect().bottom < inputClient.bottom + inputClient.height) {\n      gcontent.scrollTop = gcontent.scrollTop + div.offsetHeight + arrow.scrollHeight;\n    }\n\n    var lineHeight = parseInt(document.defaultView.getComputedStyle(div, null).getPropertyValue('font-size'), 10);\n\n    if (div.getBoundingClientRect().width < inputClient.width && div.querySelector('label').getBoundingClientRect().height / (lineHeight * 1.2) >= 2) {\n      div.style.width = div.style.maxWidth;\n    }\n\n    if ((this.parent.getFrozenColumns() || this.parent.frozenRows) && (this.parent.editSettings.mode === 'Normal' || this.parent.editSettings.mode === 'Batch')) {\n      div.style.left = input.offsetLeft + (input.offsetWidth / 2 - div.offsetWidth / 2) + 'px';\n    } else {\n      div.style.left = parseInt(div.style.left, 10) - div.offsetWidth / 2 + 'px';\n    }\n\n    if (isInline && !isScroll && !this.parent.allowPaging || this.parent.getFrozenColumns() || this.parent.frozenRows) {\n      gcontent.style.position = 'static';\n      var pos = calculateRelativeBasedPosition(input, div);\n      div.style.top = pos.top + inputClient.height + 9 + 'px';\n    }\n\n    if (validationForBottomRowPos) {\n      if (isScroll && !this.parent.getFrozenColumns() && this.parent.height !== 'auto' && !this.parent.frozenRows) {\n        var scrollWidth = gcontent.scrollWidth > gcontent.offsetWidth ? getScrollBarWidth() : 0;\n        div.style.bottom = this.parent.height - gcontent.querySelector('table').offsetHeight - scrollWidth + inputClient.height + 9 + 'px';\n      } else {\n        div.style.bottom = inputClient.height + 9 + 'px';\n      }\n\n      div.style.top = null;\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.prototype.checkColumnIsGrouped = function (col) {\n    return !col.visible && !(this.parent.groupSettings.columns.indexOf(col.field) > -1);\n  };\n  /**\n   * @hidden\n   */\n\n\n  Edit.AddEditors = function (editors) {\n    Edit.editCellType = extend(Edit.editCellType, editors);\n  };\n\n  Edit.editCellType = {\n    'dropdownedit': DropDownEditCell,\n    'numericedit': NumericEditCell,\n    'datepickeredit': DatePickerEditCell,\n    'datetimepickeredit': DatePickerEditCell,\n    'booleanedit': BooleanEditCell,\n    'defaultedit': DefaultEditCell,\n    'templateedit': TemplateEditCell\n  };\n  return Edit;\n}();\n\nexport { Edit };","map":{"version":3,"sources":["C:/CN2/workspace-trunk/kain-front-end/node_modules/@syncfusion/ej2-grids/src/grid/actions/edit.js"],"names":["closest","addClass","extend","getValue","resetBlazorTemplate","isBlazor","remove","isNullOrUndefined","events","EditRender","BooleanEditCell","DropDownEditCell","NumericEditCell","DefaultEditCell","InlineEdit","BatchEdit","DialogEdit","Dialog","parentsUntil","getComplexFieldID","setComplexFieldID","getScrollBarWidth","FormValidator","DatePickerEditCell","calculateRelativeBasedPosition","TemplateEditCell","DataUtil","Edit","parent","serviceLocator","editType","l10n","getService","addEventListener","updateEditObj","createAlertDlg","createConfirmDlg","prototype","updateColTypeObj","_this","columnModel","forEach","col","editSettings","template","editTemplate","templteCell","edit","editCellType","log","getModuleName","onPropertyChanged","e","module","gObj","newProp","properties","_i","_a","Object","keys","length","prop","allowAdding","allowEditing","allowDeleting","initialEnd","isEdit","refresh","editModule","destroy","renderer","mode","startEdit","tr","element","classList","add","getSelectedRows","showDialog","alertDObj","isLastRow","rowIndex","getContent","querySelector","style","display","refreshToolbar","notify","checkLastRow","args","height","newRowPosition","requestType","querySelectorAll","closeEdit","showConfirmDialog","dialogObj","toolbarRefresh","addRecord","data","index","deleteRecord","fieldname","getSelectedRecords","showDeleteConfirmDialog","deleteRow","deleteRowUid","getAttribute","rowObj","getRowObjectFromUID","endEdit","formObj","validate","saveCell","editNextValCell","endEditing","updateCell","field","value","updateRow","batchCancel","batchSave","editCell","editFormValidate","getBatchChanges","getCurrentEditCellData","obj","getCurrentEditedData","content","getConstant","dataBind","show","getValueFromType","val","type","isNaN","parseFloat","Date","destroyToolTip","elements","slice","call","elements_1","elem","firstElementChild","position","dlgWidget","click","dlgOk","bind","buttonModel","cssClass","isPrimary","dlgCancel","alertClick","hide","btnOptions","name","div","createElement","id","appendChild","options","showCloseIcon","isModal","visible","closeOnEscape","target","width","animationSettings","effect","buttons","isStringTemplate","appendTo","innerText","addCancelWhilePaging","isServerRendered","executeAction","isDestroyed","on","inBoundModelChanged","keyPressed","keyPressHandler","autoCol","tooltipDestroy","preventBatch","destroyForm","actionBeginFunction","onActionBegin","actionCompleteFunction","actionComplete","actionBegin","removeEventListener","off","actions","indexOf","form","editedData","hasAttribute","column","getColumnByField","checked","ej2_instances","blur","read","window","setValue","filter","inputElements","input","inputs","i","len","getColumnByUid","isForeignColumn","temp","restrictedRequestTypes","destroyWidgets","cols","destroyTemplate","getColumns","some","cols_1","uid","gridElement","hasGridChild","childElementCount","action","tagName","contains","document","frozenRows","preventDefault","preventObj","handler","instance","arg1","arg2","arg3","arg4","arg5","arg6","arg7","arg8","applyFormValidation","frzCols","getFrozenColumns","mForm","rules","mRules","validationRules","mFormObj","createFormObj","locale","validationComplete","customPlacement","inputElement","error","valErrorPlacement","valCustomPlacement","getElemTable","createTooltip","innerHTML","outerHTML","isFHdr","parseInt","getHeaderTable","getContentTable","inputName","status","gcontent","getMovableVirtualContent","isScroll","scrollHeight","clientHeight","scrollWidth","clientWidth","isInline","td","row","fCont","isFHdrLastRow","validationForBottomRowPos","isBatchModeLastRow","rows","getFrozenVirtualContent","fHeraderRows","getFrozenVirtualHeader","children","table","client","getBoundingClientRect","left","inputClient","parentElement","className","styles","top","bottom","scrollTop","scrollLeft","arrow","getEditCell","offsetHeight","lineHeight","defaultView","getComputedStyle","getPropertyValue","maxWidth","offsetLeft","offsetWidth","allowPaging","pos","checkColumnIsGrouped","groupSettings","columns","AddEditors","editors"],"mappings":"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","sourcesContent":["import { closest, addClass } from '@syncfusion/ej2-base';\nimport { extend, getValue, resetBlazorTemplate, isBlazor } from '@syncfusion/ej2-base';\nimport { remove } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport { EditRender } from '../renderer/edit-renderer';\nimport { BooleanEditCell } from '../renderer/boolean-edit-cell';\nimport { DropDownEditCell } from '../renderer/dropdown-edit-cell';\nimport { NumericEditCell } from '../renderer/numeric-edit-cell';\nimport { DefaultEditCell } from '../renderer/default-edit-cell';\nimport { InlineEdit } from './inline-edit';\nimport { BatchEdit } from './batch-edit';\nimport { DialogEdit } from './dialog-edit';\nimport { Dialog } from '@syncfusion/ej2-popups';\nimport { parentsUntil, getComplexFieldID, setComplexFieldID, getScrollBarWidth } from '../base/util';\nimport { FormValidator } from '@syncfusion/ej2-inputs';\nimport { DatePickerEditCell } from '../renderer/datepicker-edit-cell';\nimport { calculateRelativeBasedPosition } from '@syncfusion/ej2-popups';\nimport { TemplateEditCell } from '../renderer/template-edit-cell';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * The `Edit` module is used to handle editing actions.\n */\nvar Edit = /** @class */ (function () {\n    /**\n     * Constructor for the Grid editing module\n     * @hidden\n     */\n    function Edit(parent, serviceLocator) {\n        this.editType = { 'Inline': InlineEdit, 'Normal': InlineEdit, 'Batch': BatchEdit, 'Dialog': DialogEdit };\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.l10n = this.serviceLocator.getService('localization');\n        this.addEventListener();\n        this.updateEditObj();\n        this.createAlertDlg();\n        this.createConfirmDlg();\n    }\n    Edit.prototype.updateColTypeObj = function () {\n        var _this = this;\n        this.parent.columnModel.forEach(function (col) {\n            if (_this.parent.editSettings.template || col.editTemplate) {\n                var templteCell = 'templateedit';\n                col.edit = extend(new Edit.editCellType[templteCell](_this.parent), col.edit || {});\n            }\n            else {\n                col.edit = extend(new Edit.editCellType[col.editType && Edit.editCellType[col.editType] ?\n                    col.editType : 'defaultedit'](_this.parent, _this.serviceLocator), col.edit || {});\n            }\n        });\n        this.parent.log('primary_column_missing');\n    };\n    /**\n     * For internal use only - Get the module name.\n     * @private\n     */\n    Edit.prototype.getModuleName = function () {\n        return 'edit';\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.onPropertyChanged = function (e) {\n        if (e.module !== this.getModuleName()) {\n            return;\n        }\n        var gObj = this.parent;\n        var newProp = e.properties;\n        for (var _i = 0, _a = Object.keys(e.properties); _i < _a.length; _i++) {\n            var prop = _a[_i];\n            switch (prop) {\n                case 'allowAdding':\n                case 'allowDeleting':\n                case 'allowEditing':\n                    if (gObj.editSettings.allowAdding || gObj.editSettings.allowEditing || gObj.editSettings.allowDeleting) {\n                        this.initialEnd();\n                    }\n                    break;\n                case 'mode':\n                    this.updateEditObj();\n                    gObj.isEdit = false;\n                    gObj.refresh();\n                    break;\n            }\n        }\n    };\n    Edit.prototype.updateEditObj = function () {\n        if (this.editModule) {\n            this.editModule.destroy();\n        }\n        this.renderer = new EditRender(this.parent, this.serviceLocator);\n        this.editModule = new this.editType[this.parent.editSettings.mode](this.parent, this.serviceLocator, this.renderer);\n    };\n    Edit.prototype.initialEnd = function () {\n        this.updateColTypeObj();\n    };\n    /**\n     * Edits any bound record in the Grid by TR element.\n     * @param {HTMLTableRowElement} tr - Defines the table row to be edited.\n     */\n    Edit.prototype.startEdit = function (tr) {\n        var gObj = this.parent;\n        if (!gObj.editSettings.allowEditing || gObj.isEdit || gObj.editSettings.mode === 'Batch') {\n            return;\n        }\n        this.parent.element.classList.add('e-editing');\n        if (!gObj.getSelectedRows().length) {\n            if (!tr) {\n                this.showDialog('EditOperationAlert', this.alertDObj);\n                return;\n            }\n        }\n        else if (!tr) {\n            tr = gObj.getSelectedRows()[0];\n        }\n        this.isLastRow = tr.rowIndex === this.parent.getContent().querySelector('tr:last-child').rowIndex;\n        if (tr.style.display === 'none') {\n            return;\n        }\n        this.editModule.startEdit(tr);\n        if (!isBlazor()) {\n            this.refreshToolbar();\n            gObj.element.querySelector('.e-gridpopup').style.display = 'none';\n            this.parent.notify('start-edit', {});\n        }\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.checkLastRow = function (tr, args) {\n        var checkLastRow = this.isLastRow;\n        if (this.parent.height !== 'auto' && this.parent.editSettings.newRowPosition === 'Bottom' && args &&\n            args.requestType === 'add') {\n            addClass(tr.querySelectorAll('.e-rowcell'), 'e-lastrowadded');\n        }\n        else if (checkLastRow) {\n            addClass(tr.querySelectorAll('.e-rowcell'), 'e-lastrowcell');\n        }\n    };\n    /**\n     * Cancels edited state.\n     */\n    Edit.prototype.closeEdit = function () {\n        if (this.parent.editSettings.mode === 'Batch' && this.parent.editSettings.showConfirmDialog\n            && this.parent.element.querySelectorAll('.e-updatedtd').length) {\n            this.showDialog('CancelEdit', this.dialogObj);\n            return;\n        }\n        this.editModule.closeEdit();\n        if (!isBlazor()) {\n            this.refreshToolbar();\n            this.parent.notify('close-edit', {});\n        }\n    };\n    Edit.prototype.refreshToolbar = function () {\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    /**\n     * To adds a new row at the top with the given data. When data is not passed, it will add empty rows.\n     * > `editSettings.allowEditing` should be true.\n     * @param {Object} data - Defines the new add record data.\n     * @param {number} index - Defines the row index to be added\n     */\n    Edit.prototype.addRecord = function (data, index) {\n        if (!this.parent.editSettings.allowAdding) {\n            return;\n        }\n        this.parent.element.classList.add('e-editing');\n        this.editModule.addRecord(data, index);\n        if (!isBlazor()) {\n            this.refreshToolbar();\n            this.parent.notify('start-add', {});\n        }\n    };\n    /**\n     * Deletes a record with the given options. If fieldname and data are not given, the Grid will delete the selected record.\n     * > `editSettings.allowDeleting` should be true.\n     * @param {string} fieldname - Defines the primary key field name of the column.\n     * @param {Object} data - Defines the JSON data record to be deleted.\n     */\n    Edit.prototype.deleteRecord = function (fieldname, data) {\n        var gObj = this.parent;\n        if (!gObj.editSettings.allowDeleting) {\n            return;\n        }\n        if (!data) {\n            if (!gObj.getSelectedRecords().length) {\n                this.showDialog('DeleteOperationAlert', this.alertDObj);\n                return;\n            }\n        }\n        if (gObj.editSettings.showDeleteConfirmDialog) {\n            this.showDialog('ConfirmDelete', this.dialogObj);\n            return;\n        }\n        this.editModule.deleteRecord(fieldname, data);\n    };\n    /**\n     * Deletes a visible row by TR element.\n     * @param {HTMLTableRowElement} tr - Defines the table row element.\n     */\n    Edit.prototype.deleteRow = function (tr) {\n        this.deleteRowUid = tr.getAttribute('data-uid');\n        var rowObj = this.parent.getRowObjectFromUID(this.deleteRowUid);\n        if (!isNullOrUndefined(rowObj)) {\n            this.deleteRecord(null, rowObj.data);\n        }\n    };\n    /**\n     * If Grid is in editable state, you can save a record by invoking endEdit.\n     */\n    Edit.prototype.endEdit = function () {\n        if (this.parent.editSettings.mode === 'Batch' && this.parent.editSettings.showConfirmDialog &&\n            (isNullOrUndefined(this.formObj) || this.formObj.validate())) {\n            this.parent.editModule.saveCell();\n            this.parent.notify(events.editNextValCell, {});\n            if (isNullOrUndefined(this.formObj) || this.formObj.validate()) {\n                this.showDialog('BatchSaveConfirm', this.dialogObj);\n                return;\n            }\n        }\n        this.endEditing();\n    };\n    /**\n     * To update the specified cell by given value without changing into edited state.\n     * @param {number} rowIndex Defines the row index.\n     * @param {string} field Defines the column field.\n     * @param {string | number | boolean | Date} value - Defines the value to be changed.\n     */\n    Edit.prototype.updateCell = function (rowIndex, field, value) {\n        this.editModule.updateCell(rowIndex, field, value);\n    };\n    /**\n     * To update the specified row by given values without changing into edited state.\n     * @param {number} index Defines the row index.\n     * @param {Object} data Defines the data object to be updated.\n     */\n    Edit.prototype.updateRow = function (index, data) {\n        this.editModule.updateRow(index, data);\n    };\n    /**\n     * Resets added, edited, and deleted records in the batch mode.\n     */\n    Edit.prototype.batchCancel = function () {\n        this.closeEdit();\n    };\n    /**\n     * Bulk saves added, edited, and deleted records in the batch mode.\n     */\n    Edit.prototype.batchSave = function () {\n        this.endEdit();\n    };\n    /**\n     * Changes a particular cell into edited state based on the row index and field name provided in the `batch` mode.\n     * @param {number} index - Defines row index to edit a particular cell.\n     * @param {string} field - Defines the field name of the column to perform batch edit.\n     */\n    Edit.prototype.editCell = function (index, field) {\n        this.editModule.editCell(index, field);\n    };\n    /**\n     * Checks the status of validation at the time of editing. If validation is passed, it returns true.\n     * @return {boolean}\n     */\n    Edit.prototype.editFormValidate = function () {\n        if (this.formObj) {\n            return this.formObj.validate();\n        }\n        return false;\n    };\n    /**\n     * Gets the added, edited,and deleted data before bulk save to the DataSource in batch mode.\n     * @return {Object}\n     */\n    Edit.prototype.getBatchChanges = function () {\n        return this.editModule.getBatchChanges ? this.editModule.getBatchChanges() : {};\n    };\n    /**\n     * Gets the current value of the edited component.\n     */\n    Edit.prototype.getCurrentEditCellData = function () {\n        var obj = this.getCurrentEditedData(this.formObj.element, {});\n        return obj[Object.keys(obj)[0]];\n    };\n    /**\n     * Saves the cell that is currently edited. It does not save the value to the DataSource.\n     */\n    Edit.prototype.saveCell = function () {\n        this.editModule.saveCell();\n    };\n    Edit.prototype.endEditing = function () {\n        this.parent.element.classList.remove('e-editing');\n        this.editModule.endEdit();\n        this.refreshToolbar();\n    };\n    Edit.prototype.showDialog = function (content, obj) {\n        obj.content = '<div>' + this.l10n.getConstant(content) + '</div>';\n        obj.dataBind();\n        obj.show();\n    };\n    Edit.prototype.getValueFromType = function (col, value) {\n        var val = value;\n        switch (col.type) {\n            case 'number':\n                val = !isNaN(parseFloat(value)) ? parseFloat(value) : null;\n                break;\n            case 'boolean':\n                if (col.editType !== 'booleanedit') {\n                    val = value === this.l10n.getConstant('True') || value === true ? true : false;\n                }\n                break;\n            case 'date':\n            case 'datetime':\n                if (col.editType !== 'datepickeredit' && col.editType !== 'datetimepickeredit'\n                    && value && value.length) {\n                    val = new Date(value);\n                }\n                else if (value === '') {\n                    val = null;\n                }\n                break;\n        }\n        return val;\n    };\n    Edit.prototype.destroyToolTip = function () {\n        var elements = [].slice.call(this.parent.element.querySelectorAll('.e-griderror'));\n        for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n            var elem = elements_1[_i];\n            remove(elem);\n        }\n        this.parent.getContent().firstElementChild.style.position = 'relative';\n    };\n    Edit.prototype.createConfirmDlg = function () {\n        this.dialogObj = this.dlgWidget([\n            {\n                click: this.dlgOk.bind(this),\n                buttonModel: { content: this.l10n.getConstant('OKButton'), cssClass: 'e-primary', isPrimary: true }\n            },\n            {\n                click: this.dlgCancel.bind(this),\n                buttonModel: { cssClass: 'e-flat', content: this.l10n.getConstant('CancelButton') }\n            }\n        ], 'EditConfirm');\n    };\n    Edit.prototype.createAlertDlg = function () {\n        this.alertDObj = this.dlgWidget([\n            {\n                click: this.alertClick.bind(this), buttonModel: { content: this.l10n.getConstant('OKButton'), cssClass: 'e-flat', isPrimary: true }\n            }\n        ], 'EditAlert');\n    };\n    Edit.prototype.alertClick = function () {\n        this.alertDObj.hide();\n    };\n    Edit.prototype.dlgWidget = function (btnOptions, name) {\n        var div = this.parent.createElement('div', { id: this.parent.element.id + name });\n        this.parent.element.appendChild(div);\n        var options = {\n            showCloseIcon: false,\n            isModal: true,\n            visible: false,\n            closeOnEscape: true,\n            target: this.parent.element,\n            width: '320px',\n            animationSettings: { effect: 'None' }\n        };\n        options.buttons = btnOptions;\n        var obj = new Dialog(options);\n        var isStringTemplate = 'isStringTemplate';\n        obj[isStringTemplate] = true;\n        obj.appendTo(div);\n        return obj;\n    };\n    Edit.prototype.dlgCancel = function () {\n        this.dialogObj.hide();\n    };\n    Edit.prototype.dlgOk = function (e) {\n        switch (this.dialogObj.element.querySelector('.e-dlg-content').firstElementChild.innerText) {\n            case this.l10n.getConstant('ConfirmDelete'):\n                this.editModule.deleteRecord();\n                break;\n            case this.l10n.getConstant('CancelEdit'):\n                this.editModule.closeEdit();\n                break;\n            case this.l10n.getConstant('BatchSaveConfirm'):\n                this.endEditing();\n                break;\n            case this.l10n.getConstant('BatchSaveLostChanges'):\n                if (this.parent.editSettings.mode === 'Batch') {\n                    this.editModule.addCancelWhilePaging();\n                    if (isBlazor() && this.parent.isServerRendered) {\n                        this.editModule.closeEdit();\n                    }\n                }\n                this.executeAction();\n                break;\n        }\n        this.dlgCancel();\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.inBoundModelChanged, this.onPropertyChanged, this);\n        this.parent.on(events.initialEnd, this.initialEnd, this);\n        this.parent.on(events.keyPressed, this.keyPressHandler, this);\n        this.parent.on(events.autoCol, this.updateColTypeObj, this);\n        this.parent.on(events.tooltipDestroy, this.destroyToolTip, this);\n        this.parent.on(events.preventBatch, this.preventBatch, this);\n        this.parent.on(events.destroyForm, this.destroyForm, this);\n        this.actionBeginFunction = this.onActionBegin.bind(this);\n        this.actionCompleteFunction = this.actionComplete.bind(this);\n        this.parent.addEventListener(events.actionBegin, this.actionBeginFunction);\n        this.parent.addEventListener(events.actionComplete, this.actionCompleteFunction);\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.inBoundModelChanged, this.onPropertyChanged);\n        this.parent.off(events.initialEnd, this.initialEnd);\n        this.parent.off(events.keyPressed, this.keyPressHandler);\n        this.parent.off(events.autoCol, this.updateColTypeObj);\n        this.parent.off(events.tooltipDestroy, this.destroyToolTip);\n        this.parent.off(events.preventBatch, this.preventBatch);\n        this.parent.off(events.destroyForm, this.destroyForm);\n        this.parent.removeEventListener(events.actionComplete, this.actionCompleteFunction);\n        this.parent.removeEventListener(events.actionBegin, this.actionBeginFunction);\n    };\n    Edit.prototype.actionComplete = function (e) {\n        var actions = ['add', 'beginEdit', 'save', 'delete', 'cancel'];\n        if (actions.indexOf(e.requestType) < 0) {\n            this.parent.isEdit = false;\n        }\n        this.refreshToolbar();\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.getCurrentEditedData = function (form, editedData) {\n        var _this = this;\n        var gObj = this.parent;\n        if (gObj.editSettings.template) {\n            [].slice.call(form.elements).forEach(function (element) {\n                if (element.hasAttribute('name')) {\n                    var field = setComplexFieldID(element.getAttribute('name'));\n                    var column = gObj.getColumnByField(field) || { field: field, type: element.getAttribute('type') };\n                    var value = void 0;\n                    if (column.type === 'checkbox' || column.type === 'boolean') {\n                        value = element.checked;\n                    }\n                    else if (element.value) {\n                        value = element.value;\n                        if (element.ej2_instances &&\n                            element.ej2_instances.length &&\n                            !isNullOrUndefined(element.ej2_instances[0].value)) {\n                            element.blur();\n                            value = element.ej2_instances[0].value;\n                            if ((column.type === 'date' || column.type === 'dateTime') &&\n                                (element.ej2_instances[0].isServerRendered)) {\n                                value = element.value;\n                            }\n                        }\n                    }\n                    if (column.edit && typeof column.edit.read === 'string') {\n                        value = getValue(column.edit.read, window)(element, value);\n                    }\n                    else if (column.edit && column.edit.read) {\n                        value = column.edit.read(element, value);\n                    }\n                    value = gObj.editModule.getValueFromType(column, value);\n                    DataUtil.setValue(column.field, value, editedData);\n                }\n            });\n            return editedData;\n        }\n        gObj.columnModel.filter(function (col) { return col.editTemplate; }).forEach(function (col) {\n            if (form[getComplexFieldID(col.field)]) {\n                var inputElements = [].slice.call(form[getComplexFieldID(col.field)]);\n                inputElements = inputElements.length ? inputElements : [form[getComplexFieldID(col.field)]];\n                inputElements.forEach(function (input) {\n                    var value = _this.getValue(col, input, editedData);\n                    DataUtil.setValue(col.field, value, editedData);\n                });\n            }\n        });\n        var inputs = [].slice.call(form.querySelectorAll('.e-field'));\n        for (var i = 0, len = inputs.length; i < len; i++) {\n            var col = gObj.getColumnByUid(inputs[i].getAttribute('e-mappinguid'));\n            if (col && col.field) {\n                var value = this.getValue(col, inputs[i], editedData);\n                DataUtil.setValue(col.field, value, editedData);\n            }\n        }\n        return editedData;\n    };\n    Edit.prototype.getValue = function (col, input, editedData) {\n        var value = col.isForeignColumn() ? (input.ej2_instances ?\n            input.ej2_instances[0].value : input.value) : input.value;\n        var gObj = this.parent;\n        var temp = col.edit.read;\n        if (col.type === 'checkbox' || col.type === 'boolean') {\n            value = input.checked;\n        }\n        if (typeof temp === 'string') {\n            temp = getValue(temp, window);\n            value = gObj.editModule.getValueFromType(col, (temp)(input, value));\n        }\n        else {\n            value = gObj.editModule.getValueFromType(col, col.edit.read(input, value));\n        }\n        if (isNullOrUndefined(editedData[col.field]) && value === '') {\n            value = editedData[col.field];\n        }\n        return value;\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.onActionBegin = function (e) {\n        var restrictedRequestTypes = ['filterafteropen', 'filterbeforeopen', 'filterchoicerequest', 'save'];\n        if (this.parent.editSettings.mode !== 'Batch' && this.formObj && !this.formObj.isDestroyed\n            && restrictedRequestTypes.indexOf(e.requestType) === -1) {\n            this.destroyWidgets();\n            this.destroyForm();\n        }\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.destroyWidgets = function (cols) {\n        var gObj = this.parent;\n        if (gObj.editSettings.template) {\n            this.parent.destroyTemplate(['editSettingsTemplate']);\n        }\n        cols = cols ? cols : this.parent.getColumns();\n        if (cols.some(function (column) { return !isNullOrUndefined(column.editTemplate); })) {\n            this.parent.destroyTemplate(['editTemplate']);\n        }\n        for (var _i = 0, cols_1 = cols; _i < cols_1.length; _i++) {\n            var col = cols_1[_i];\n            var temp = col.edit.destroy;\n            if (isBlazor() && col.editTemplate) {\n                resetBlazorTemplate(this.parent.element.id + col.uid + 'editTemplate', 'EditTemplate');\n            }\n            if (col.edit.destroy) {\n                if (typeof temp === 'string') {\n                    temp = getValue(temp, window);\n                    temp();\n                }\n                else {\n                    col.edit.destroy();\n                }\n            }\n        }\n        [].slice.call(this.formObj.element.elements).forEach(function (element) {\n            if (element.hasAttribute('name')) {\n                if (element.ej2_instances &&\n                    element.ej2_instances.length &&\n                    !element.ej2_instances[0].isDestroyed) {\n                    element.ej2_instances[0].destroy();\n                }\n            }\n        });\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.destroyForm = function () {\n        this.destroyToolTip();\n        if (this.formObj && !this.formObj.isDestroyed) {\n            this.formObj.destroy();\n        }\n        this.destroyToolTip();\n    };\n    /**\n     * To destroy the editing.\n     * @return {void}\n     * @hidden\n     */\n    Edit.prototype.destroy = function () {\n        var gridElement = this.parent.element;\n        if (!gridElement) {\n            return;\n        }\n        var hasGridChild = gridElement.querySelector('.e-gridheader') &&\n            gridElement.querySelector('.e-gridcontent') ? true : false;\n        if (hasGridChild) {\n            this.destroyForm();\n        }\n        this.removeEventListener();\n        var elem = this.dialogObj.element;\n        if (elem.childElementCount > 0) {\n            this.dialogObj.destroy();\n            remove(elem);\n        }\n        elem = this.alertDObj.element;\n        if (elem.childElementCount > 0) {\n            this.alertDObj.destroy();\n            remove(elem);\n        }\n        if (!hasGridChild) {\n            return;\n        }\n        if (this.editModule) {\n            this.editModule.destroy();\n        }\n    };\n    Edit.prototype.keyPressHandler = function (e) {\n        switch (e.action) {\n            case 'insert':\n                this.addRecord();\n                break;\n            case 'delete':\n                if ((e.target.tagName !== 'INPUT' || e.target.classList.contains('e-checkselect'))\n                    && !document.querySelector('.e-popup-open')) {\n                    this.deleteRecord();\n                }\n                break;\n            case 'f2':\n                this.startEdit();\n                break;\n            case 'enter':\n                if (!parentsUntil(e.target, 'e-unboundcelldiv') && this.parent.editSettings.mode !== 'Batch' &&\n                    (parentsUntil(e.target, 'e-gridcontent') || (this.parent.frozenRows\n                        && parentsUntil(e.target, 'e-headercontent')))\n                    && !document.querySelectorAll('.e-popup-open').length) {\n                    e.preventDefault();\n                    this.endEdit();\n                }\n                break;\n            case 'escape':\n                if (this.parent.isEdit) {\n                    this.closeEdit();\n                }\n                break;\n        }\n    };\n    Edit.prototype.preventBatch = function (args) {\n        this.preventObj = args;\n        this.showDialog('BatchSaveLostChanges', this.dialogObj);\n    };\n    Edit.prototype.executeAction = function () {\n        this.preventObj.handler.call(this.preventObj.instance, this.preventObj.arg1, this.preventObj.arg2, this.preventObj.arg3, this.preventObj.arg4, this.preventObj.arg5, this.preventObj.arg6, this.preventObj.arg7, this.preventObj.arg8);\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.applyFormValidation = function (cols) {\n        var gObj = this.parent;\n        var frzCols = gObj.getFrozenColumns();\n        var form = this.parent.editSettings.mode !== 'Dialog' ?\n            gObj.element.querySelector('.e-gridform') :\n            document.querySelector('#' + gObj.element.id + '_dialogEdit_wrapper').querySelector('.e-gridform');\n        var mForm = gObj.element.querySelectorAll('.e-gridform')[1];\n        var rules = {};\n        var mRules = {};\n        cols = cols ? cols : gObj.getColumns();\n        cols.forEach(function (col, index) {\n            if (!col.visible) {\n                return;\n            }\n            if (isBlazor() && col.editTemplate) {\n                return;\n            }\n            if (index < frzCols && col.validationRules) {\n                rules[getComplexFieldID(col.field)] = col.validationRules;\n            }\n            else if (index >= frzCols && col.validationRules) {\n                mRules[getComplexFieldID(col.field)] = col.validationRules;\n            }\n        });\n        if (frzCols && this.parent.editSettings.mode !== 'Dialog') {\n            this.parent.editModule.mFormObj = this.createFormObj(mForm, mRules);\n        }\n        else {\n            rules = extend(rules, mRules);\n        }\n        if (isBlazor() && this.parent.editSettings.template) {\n            this.parent.editModule.formObj = this.createFormObj(form, {});\n        }\n        else {\n            this.parent.editModule.formObj = this.createFormObj(form, rules);\n        }\n    };\n    Edit.prototype.createFormObj = function (form, rules) {\n        var _this = this;\n        return new FormValidator(form, {\n            rules: rules,\n            locale: this.parent.locale,\n            validationComplete: function (args) {\n                _this.validationComplete(args);\n            },\n            customPlacement: function (inputElement, error) {\n                var uid = inputElement.getAttribute('e-mappinguid');\n                var args = {\n                    column: _this.parent.getColumnByUid(uid),\n                    error: error,\n                    inputElement: inputElement,\n                    value: inputElement.value,\n                };\n                _this.valErrorPlacement(inputElement, error);\n                _this.parent.notify(events.valCustomPlacement, args);\n            }\n        });\n    };\n    Edit.prototype.valErrorPlacement = function (inputElement, error) {\n        if (this.parent.isEdit) {\n            var id = error.getAttribute('for');\n            var elem = this.getElemTable(inputElement).querySelector('#' + id + '_Error');\n            if (!elem) {\n                this.createTooltip(inputElement, error, id, '');\n            }\n            else {\n                elem.querySelector('.e-tip-content').innerHTML = error.outerHTML;\n            }\n        }\n    };\n    Edit.prototype.getElemTable = function (inputElement) {\n        var isFHdr;\n        if (this.parent.editSettings.mode !== 'Dialog') {\n            isFHdr = (this.parent.frozenRows && this.parent.frozenRows\n                > (parseInt(closest(inputElement, '.e-row').getAttribute('aria-rowindex'), 10) || 0));\n        }\n        return this.parent.editSettings.mode !== 'Dialog' ? isFHdr ? this.parent.getHeaderTable() : this.parent.getContentTable() :\n            document.querySelector('#' + this.parent.element.id + '_dialogEdit_wrapper');\n    };\n    Edit.prototype.validationComplete = function (args) {\n        if (this.parent.isEdit) {\n            var elem = this.getElemTable(args.element).querySelector('#' + args.inputName + '_Error');\n            if (elem) {\n                if (args.status === 'failure') {\n                    elem.style.display = '';\n                }\n                else {\n                    elem.style.display = 'none';\n                }\n            }\n        }\n    };\n    // tslint:disable-next-line:max-func-body-length\n    Edit.prototype.createTooltip = function (element, error, name, display) {\n        var gcontent = this.parent.getContent().firstElementChild;\n        if (this.parent.getFrozenColumns()) {\n            gcontent = this.parent.getMovableVirtualContent();\n        }\n        var isScroll = gcontent.scrollHeight > gcontent.clientHeight || gcontent.scrollWidth > gcontent.clientWidth;\n        var isInline = this.parent.editSettings.mode !== 'Dialog';\n        var td = closest(element, '.e-rowcell');\n        var row = closest(element, '.e-row');\n        var fCont = this.parent.getContent().querySelector('.e-frozencontent');\n        var isFHdr;\n        var isFHdrLastRow = false;\n        var validationForBottomRowPos;\n        var isBatchModeLastRow = false;\n        if (this.parent.editSettings.mode === 'Batch') {\n            var rows = !fCont ? [].slice.call(this.parent.getContent().querySelectorAll('.e-row'))\n                : [].slice.call(this.parent.getFrozenVirtualContent().querySelectorAll('.e-row'));\n            if (rows[rows.length - 1].getAttribute('aria-rowindex') === row.getAttribute('aria-rowindex')) {\n                isBatchModeLastRow = true;\n            }\n        }\n        if (isInline) {\n            if (this.parent.frozenRows) {\n                var fHeraderRows = this.parent.getFrozenColumns() ?\n                    this.parent.getFrozenVirtualHeader().querySelector('tbody').children\n                    : this.parent.getHeaderTable().querySelector('tbody').children;\n                isFHdr = fHeraderRows.length > (parseInt(row.getAttribute('aria-rowindex'), 10) || 0);\n                isFHdrLastRow = isFHdr && parseInt(row.getAttribute('aria-rowindex'), 10) === fHeraderRows.length - 1;\n            }\n            if (isFHdrLastRow || (this.parent.editSettings.newRowPosition === 'Bottom' && (this.editModule.args\n                && this.editModule.args.requestType === 'add')) || (td.classList.contains('e-lastrowcell')\n                && !row.classList.contains('e-addedrow')) || isBatchModeLastRow) {\n                validationForBottomRowPos = true;\n            }\n        }\n        var table = isInline ?\n            (isFHdr ? this.parent.getHeaderTable() : this.parent.getContentTable()) :\n            document.querySelector('#' + this.parent.element.id + '_dialogEdit_wrapper').querySelector('.e-dlg-content');\n        var client = table.getBoundingClientRect();\n        var left = isInline ?\n            this.parent.element.getBoundingClientRect().left : client.left;\n        var input = closest(element, 'td');\n        var inputClient = input ? input.getBoundingClientRect() : element.parentElement.getBoundingClientRect();\n        var div = this.parent.createElement('div', {\n            className: 'e-tooltip-wrap e-lib e-control e-popup e-griderror',\n            id: name + '_Error',\n            styles: 'display:' + display + ';top:' +\n                ((isFHdr ? inputClient.top + inputClient.height : inputClient.bottom - client.top\n                    - (this.parent.getFrozenColumns() ? fCont.scrollTop : 0)) + table.scrollTop + 9) + 'px;left:' +\n                (inputClient.left - left + table.scrollLeft + inputClient.width / 2) + 'px;' +\n                'max-width:' + inputClient.width + 'px;text-align:center;'\n        });\n        if (isInline && client.left < left) {\n            div.style.left = parseInt(div.style.left, 10) - client.left + left + 'px';\n        }\n        var content = this.parent.createElement('div', { className: 'e-tip-content' });\n        content.appendChild(error);\n        var arrow;\n        if (validationForBottomRowPos) {\n            arrow = this.parent.createElement('div', { className: 'e-arrow-tip e-tip-bottom' });\n            arrow.appendChild(this.parent.createElement('div', { className: 'e-arrow-tip-outer e-tip-bottom' }));\n            arrow.appendChild(this.parent.createElement('div', { className: 'e-arrow-tip-inner e-tip-bottom' }));\n        }\n        else {\n            arrow = this.parent.createElement('div', { className: 'e-arrow-tip e-tip-top' });\n            arrow.appendChild(this.parent.createElement('div', { className: 'e-arrow-tip-outer e-tip-top' }));\n            arrow.appendChild(this.parent.createElement('div', { className: 'e-arrow-tip-inner e-tip-top' }));\n        }\n        div.appendChild(content);\n        div.appendChild(arrow);\n        if ((this.parent.getFrozenColumns() || this.parent.frozenRows) && this.parent.editSettings.mode !== 'Dialog') {\n            var getEditCell = this.parent.editSettings.mode === 'Normal' ?\n                closest(element, '.e-editcell') : closest(element, '.e-table');\n            getEditCell.style.position = 'relative';\n            div.style.position = 'absolute';\n            if (this.parent.editSettings.mode === 'Batch' ||\n                (closest(element, '.e-frozencontent') || closest(element, '.e-frozenheader'))\n                || (this.parent.frozenRows && !this.parent.getFrozenColumns())) {\n                this.formObj.element.appendChild(div);\n            }\n            else {\n                this.mFormObj.element.appendChild(div);\n            }\n        }\n        else {\n            this.formObj.element.appendChild(div);\n        }\n        if (!validationForBottomRowPos && isInline && gcontent.getBoundingClientRect().bottom < inputClient.bottom + inputClient.height) {\n            gcontent.scrollTop = gcontent.scrollTop + div.offsetHeight + arrow.scrollHeight;\n        }\n        var lineHeight = parseInt(document.defaultView.getComputedStyle(div, null).getPropertyValue('font-size'), 10);\n        if (div.getBoundingClientRect().width < inputClient.width &&\n            div.querySelector('label').getBoundingClientRect().height / (lineHeight * 1.2) >= 2) {\n            div.style.width = div.style.maxWidth;\n        }\n        if ((this.parent.getFrozenColumns() || this.parent.frozenRows)\n            && (this.parent.editSettings.mode === 'Normal' || this.parent.editSettings.mode === 'Batch')) {\n            div.style.left = input.offsetLeft + (input.offsetWidth / 2 - div.offsetWidth / 2) + 'px';\n        }\n        else {\n            div.style.left = (parseInt(div.style.left, 10) - div.offsetWidth / 2) + 'px';\n        }\n        if (isInline && !isScroll && !this.parent.allowPaging || this.parent.getFrozenColumns() || this.parent.frozenRows) {\n            gcontent.style.position = 'static';\n            var pos = calculateRelativeBasedPosition(input, div);\n            div.style.top = pos.top + inputClient.height + 9 + 'px';\n        }\n        if (validationForBottomRowPos) {\n            if (isScroll && !this.parent.getFrozenColumns() && this.parent.height !== 'auto' && !this.parent.frozenRows) {\n                var scrollWidth = gcontent.scrollWidth > gcontent.offsetWidth ? getScrollBarWidth() : 0;\n                div.style.bottom = (this.parent.height - gcontent.querySelector('table').offsetHeight\n                    - scrollWidth) + inputClient.height + 9 + 'px';\n            }\n            else {\n                div.style.bottom = inputClient.height + 9 + 'px';\n            }\n            div.style.top = null;\n        }\n    };\n    /**\n     * @hidden\n     */\n    Edit.prototype.checkColumnIsGrouped = function (col) {\n        return !col.visible && !(this.parent.groupSettings.columns.indexOf(col.field) > -1);\n    };\n    /**\n     * @hidden\n     */\n    Edit.AddEditors = function (editors) {\n        Edit.editCellType = extend(Edit.editCellType, editors);\n    };\n    Edit.editCellType = {\n        'dropdownedit': DropDownEditCell, 'numericedit': NumericEditCell,\n        'datepickeredit': DatePickerEditCell, 'datetimepickeredit': DatePickerEditCell,\n        'booleanedit': BooleanEditCell, 'defaultedit': DefaultEditCell,\n        'templateedit': TemplateEditCell\n    };\n    return Edit;\n}());\nexport { Edit };\n"]},"metadata":{},"sourceType":"module"}