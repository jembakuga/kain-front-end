{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Predicate, DataUtil } from '@syncfusion/ej2-data';\nimport { initForeignKeyColumn, getForeignKeyData, generateQuery } from '../base/constant';\nimport { getDatePredicate } from '../base/util';\nimport { Data } from './data';\n/**\n * `ForeignKey` module is used to handle foreign key column's actions.\n */\n\nvar ForeignKey =\n/** @class */\nfunction (_super) {\n  __extends(ForeignKey, _super);\n\n  function ForeignKey(parent, serviceLocator) {\n    var _this = _super.call(this, parent, serviceLocator) || this;\n\n    _this.parent = parent;\n    _this.serviceLocator = serviceLocator;\n\n    _this.initEvent();\n\n    return _this;\n  }\n\n  ForeignKey.prototype.initEvent = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(initForeignKeyColumn, this.initForeignKeyColumns, this);\n    this.parent.on(getForeignKeyData, this.getForeignKeyData, this);\n    this.parent.on(generateQuery, this.generateQueryFormData, this);\n  };\n\n  ForeignKey.prototype.initForeignKeyColumns = function (columns) {\n    columns.forEach(function (column) {\n      column.dataSource = column.dataSource instanceof DataManager ? column.dataSource : isNullOrUndefined(column.dataSource) ? new DataManager() : new DataManager(column.dataSource);\n    });\n  };\n\n  ForeignKey.prototype.getForeignKeyData = function (args) {\n    var _this = this;\n\n    var foreignColumns = args.column ? [args.column] : this.parent.getForeignKeyColumns();\n    var allPromise = [];\n    foreignColumns.forEach(function (col) {\n      var promise;\n      var query = args.isComplex ? _this.genarateColumnQuery(col) : _this.genarateQuery(col, args.result.result, false, true);\n      query.params = _this.parent.query.params;\n      var dataSource = col.dataSource;\n\n      if (!dataSource.ready || dataSource.dataSource.offline) {\n        promise = dataSource.executeQuery(query);\n      } else {\n        promise = dataSource.ready.then(function () {\n          return dataSource.executeQuery(query);\n        });\n      }\n\n      allPromise.push(promise);\n    });\n    Promise.all(allPromise).then(function (responses) {\n      responses.forEach(function (data, index) {\n        foreignColumns[index].columnData = data.result;\n      });\n      args.promise.resolve(args.result);\n    }).catch(function (e) {\n      _this.parent.log(['actionfailure', 'foreign_key_failure']);\n\n      if (args.promise && args.promise.reject) {\n        args.promise.reject(e);\n      }\n\n      return e;\n    });\n  };\n\n  ForeignKey.prototype.generateQueryFormData = function (args) {\n    args.predicate.predicate = this.genarateQuery(args.column, args.column.columnData, true);\n  };\n\n  ForeignKey.prototype.genarateQuery = function (column, e, fromData, needQuery) {\n    var gObj = this.parent;\n    var predicates = [];\n    var predicate;\n    var query = new Query();\n    var field = fromData ? column.foreignKeyField : column.field;\n\n    if (gObj.allowPaging || gObj.enableVirtualization || fromData) {\n      e = new DataManager(gObj.allowGrouping && gObj.groupSettings.columns.length && !fromData ? e.records : e).executeLocal(new Query().select(field));\n      var filteredValue = DataUtil.distinct(e, field, false);\n      field = fromData ? column.field : column.foreignKeyField;\n      filteredValue.forEach(function (obj) {\n        if (obj && obj.getDay) {\n          predicates.push(getDatePredicate({\n            field: field,\n            operator: 'equal',\n            value: obj,\n            matchCase: false\n          }));\n        } else {\n          predicates.push(new Predicate(field, 'equal', obj, false));\n        }\n      });\n    }\n\n    if (needQuery) {\n      return predicates.length ? query.where(Predicate.or(predicates)) : query;\n    }\n\n    predicate = predicates.length ? Predicate.or(predicates) : {\n      predicates: []\n    };\n    return predicate;\n  };\n\n  ForeignKey.prototype.genarateColumnQuery = function (column) {\n    var gObj = this.parent;\n    var query = new Query();\n    var queryColumn = this.isFiltered(column);\n\n    if (queryColumn.isTrue) {\n      query = this.filterQuery(query, queryColumn.column, true);\n    }\n\n    if (gObj.searchSettings.key.length) {\n      var sSettings = gObj.searchSettings;\n      query.search(sSettings.key, column.foreignKeyValue, sSettings.operator, sSettings.ignoreCase);\n    }\n\n    return query;\n  };\n\n  ForeignKey.prototype.isFiltered = function (column) {\n    var filterColumn = this.parent.filterSettings.columns.filter(function (fColumn) {\n      return fColumn.field === column.foreignKeyValue && fColumn.uid === column.uid;\n    });\n    return {\n      column: filterColumn,\n      isTrue: !!filterColumn.length\n    };\n  };\n\n  ForeignKey.prototype.getModuleName = function () {\n    return 'foreignKey';\n  };\n\n  ForeignKey.prototype.destroy = function () {\n    this.destroyEvent();\n  };\n\n  ForeignKey.prototype.destroyEvent = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(initForeignKeyColumn, this.initForeignKeyColumns);\n    this.parent.off(getForeignKeyData, this.getForeignKeyData);\n    this.parent.off(generateQuery, this.generateQueryFormData);\n  };\n\n  return ForeignKey;\n}(Data);\n\nexport { ForeignKey };","map":{"version":3,"sources":["C:/CN2/workspace-trunk/kain-front-end/node_modules/@syncfusion/ej2-grids/src/grid/actions/foreign-key.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","isNullOrUndefined","DataManager","Query","Predicate","DataUtil","initForeignKeyColumn","getForeignKeyData","generateQuery","getDatePredicate","Data","ForeignKey","_super","parent","serviceLocator","_this","call","initEvent","isDestroyed","on","initForeignKeyColumns","generateQueryFormData","columns","forEach","column","dataSource","args","foreignColumns","getForeignKeyColumns","allPromise","col","promise","query","isComplex","genarateColumnQuery","genarateQuery","result","params","ready","offline","executeQuery","then","push","Promise","all","responses","data","index","columnData","resolve","catch","e","log","reject","predicate","fromData","needQuery","gObj","predicates","field","foreignKeyField","allowPaging","enableVirtualization","allowGrouping","groupSettings","length","records","executeLocal","select","filteredValue","distinct","obj","getDay","operator","value","matchCase","where","or","queryColumn","isFiltered","isTrue","filterQuery","searchSettings","key","sSettings","search","foreignKeyValue","ignoreCase","filterColumn","filterSettings","filter","fColumn","uid","getModuleName","destroy","destroyEvent","off"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Predicate, DataUtil } from '@syncfusion/ej2-data';\nimport { initForeignKeyColumn, getForeignKeyData, generateQuery } from '../base/constant';\nimport { getDatePredicate } from '../base/util';\nimport { Data } from './data';\n/**\n * `ForeignKey` module is used to handle foreign key column's actions.\n */\nvar ForeignKey = /** @class */ (function (_super) {\n    __extends(ForeignKey, _super);\n    function ForeignKey(parent, serviceLocator) {\n        var _this = _super.call(this, parent, serviceLocator) || this;\n        _this.parent = parent;\n        _this.serviceLocator = serviceLocator;\n        _this.initEvent();\n        return _this;\n    }\n    ForeignKey.prototype.initEvent = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(initForeignKeyColumn, this.initForeignKeyColumns, this);\n        this.parent.on(getForeignKeyData, this.getForeignKeyData, this);\n        this.parent.on(generateQuery, this.generateQueryFormData, this);\n    };\n    ForeignKey.prototype.initForeignKeyColumns = function (columns) {\n        columns.forEach(function (column) {\n            column.dataSource = (column.dataSource instanceof DataManager ? column.dataSource :\n                (isNullOrUndefined(column.dataSource) ? new DataManager() : new DataManager(column.dataSource)));\n        });\n    };\n    ForeignKey.prototype.getForeignKeyData = function (args) {\n        var _this = this;\n        var foreignColumns = args.column ? [args.column] : this.parent.getForeignKeyColumns();\n        var allPromise = [];\n        foreignColumns.forEach(function (col) {\n            var promise;\n            var query = args.isComplex ? _this.genarateColumnQuery(col) :\n                _this.genarateQuery(col, args.result.result, false, true);\n            query.params = _this.parent.query.params;\n            var dataSource = col.dataSource;\n            if (!dataSource.ready || dataSource.dataSource.offline) {\n                promise = dataSource.executeQuery(query);\n            }\n            else {\n                promise = dataSource.ready.then(function () {\n                    return dataSource.executeQuery(query);\n                });\n            }\n            allPromise.push(promise);\n        });\n        Promise.all(allPromise).then(function (responses) {\n            responses.forEach(function (data, index) {\n                foreignColumns[index].columnData = data.result;\n            });\n            args.promise.resolve(args.result);\n        }).catch(function (e) {\n            _this.parent.log(['actionfailure', 'foreign_key_failure']);\n            if (args.promise && args.promise.reject) {\n                args.promise.reject(e);\n            }\n            return e;\n        });\n    };\n    ForeignKey.prototype.generateQueryFormData = function (args) {\n        args.predicate.predicate = this.genarateQuery(args.column, args.column.columnData, true);\n    };\n    ForeignKey.prototype.genarateQuery = function (column, e, fromData, needQuery) {\n        var gObj = this.parent;\n        var predicates = [];\n        var predicate;\n        var query = new Query();\n        var field = fromData ? column.foreignKeyField : column.field;\n        if (gObj.allowPaging || gObj.enableVirtualization || fromData) {\n            e = new DataManager(((gObj.allowGrouping && gObj.groupSettings.columns.length && !fromData) ?\n                e.records : e)).executeLocal(new Query().select(field));\n            var filteredValue = DataUtil.distinct(e, field, false);\n            field = fromData ? column.field : column.foreignKeyField;\n            filteredValue.forEach(function (obj) {\n                if (obj && obj.getDay) {\n                    predicates.push(getDatePredicate({ field: field, operator: 'equal', value: obj, matchCase: false }));\n                }\n                else {\n                    predicates.push(new Predicate(field, 'equal', obj, false));\n                }\n            });\n        }\n        if (needQuery) {\n            return predicates.length ? query.where(Predicate.or(predicates)) : query;\n        }\n        predicate = (predicates.length ? Predicate.or(predicates) : { predicates: [] });\n        return predicate;\n    };\n    ForeignKey.prototype.genarateColumnQuery = function (column) {\n        var gObj = this.parent;\n        var query = new Query();\n        var queryColumn = this.isFiltered(column);\n        if (queryColumn.isTrue) {\n            query = this.filterQuery(query, queryColumn.column, true);\n        }\n        if (gObj.searchSettings.key.length) {\n            var sSettings = gObj.searchSettings;\n            query.search(sSettings.key, column.foreignKeyValue, sSettings.operator, sSettings.ignoreCase);\n        }\n        return query;\n    };\n    ForeignKey.prototype.isFiltered = function (column) {\n        var filterColumn = this.parent.filterSettings.columns.filter(function (fColumn) {\n            return (fColumn.field === column.foreignKeyValue && fColumn.uid === column.uid);\n        });\n        return {\n            column: filterColumn, isTrue: !!filterColumn.length\n        };\n    };\n    ForeignKey.prototype.getModuleName = function () {\n        return 'foreignKey';\n    };\n    ForeignKey.prototype.destroy = function () {\n        this.destroyEvent();\n    };\n    ForeignKey.prototype.destroyEvent = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(initForeignKeyColumn, this.initForeignKeyColumns);\n        this.parent.off(getForeignKeyData, this.getForeignKeyData);\n        this.parent.off(generateQuery, this.generateQueryFormData);\n    };\n    return ForeignKey;\n}(Data));\nexport { ForeignKey };\n"]},"metadata":{},"sourceType":"module"}